function t(t,e,o,i){Object.defineProperty(t,e,{get:o,set:i,enumerable:!0,configurable:!0})}var e=globalThis,o={},i={},n=e.parcelRequire1e7e;null==n&&((n=function(t){if(t in o)return o[t].exports;if(t in i){var e=i[t];delete i[t];var n={id:t,exports:{}};return o[t]=n,e.call(n.exports,n,n.exports),n.exports}var s=Error("Cannot find module '"+t+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(t,e){i[t]=e},e.parcelRequire1e7e=n);var s=n.register;s("04BFj",function(e,o){t(e.exports,"TestMic",()=>a);var i=n("ck9ES"),s=n("4TAOB");let r=document.getElementById("gainSliderTestMic");class a{constructor(){this.CURRENT_GAIN_TEST_MIC=1,this.audioCtxTestMic=null,this.analyser=null,this.gainNode=null,this.recordGainNode=null,this.buttonHandlers=null}init(t){let e=this;navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1}}).then(function(o){e.recordGainNode=t,e.getUserMediaOnSuccess(o)},function(t){console.log("The following error occured: "+t)}):console.log("MediaDevices.getUserMedia() not supported on your browser!")}getUserMediaOnSuccess=t=>{let e=localStorage.getItem("micgain");this.CURRENT_GAIN_TEST_MIC=e?parseInt(e):this.CURRENT_GAIN_TEST_MIC,this.audioCtxTestMic||(this.audioCtxTestMic=new AudioContext);let o=this.audioCtxTestMic.createMediaStreamSource(t);this.gainNode=this.audioCtxTestMic.createGain(),this.gainNode.gain.value=this.CURRENT_GAIN_TEST_MIC,o.connect(this.gainNode),this.analyser=this.audioCtxTestMic.createAnalyser(),this.analyser.fftSize=2048,this.gainNode.connect(this.analyser);let i=this.audioCtxTestMic.createMediaStreamDestination();this.gainNode.connect(i);let n=new MediaRecorder(i.stream);this.draw(),this.buttonHandlers=new s.ButtonHandlers(n,this),this.buttonHandlers.init(),this.mediaRecoderHandlers(n),this.uiHandlers()};mediaRecoderHandlers=t=>{let e=[];t.onstop=function(o){let i=new Blob(e,{type:t.mimeType});e=[];let n=window.URL.createObjectURL(i);(0,s.mediaRecorderStopUI)(n)},t.ondataavailable=function(t){e.push(t.data)}};draw=()=>{let t=this,e=this.analyser.frequencyBinCount,o=new Uint8Array(e);this.analyser.getByteTimeDomainData(o),(0,s.setCanvasData)(e,o),requestAnimationFrame(()=>{t.draw()})};async connectSource(){this.analyser.connect(this.audioCtxTestMic.destination),i.isSafari&&(console.log(`Audio context state change: ${this.audioCtxTestMic.state}`),"suspended"===this.audioCtxTestMic.state&&await this.audioCtxTestMic.resume())}disconnectSource(){this.analyser.disconnect()}uiHandlers(){let t=this;$("#testMicrophoneModal").on("show.bs.modal",e=>{r.value=t.CURRENT_GAIN_TEST_MIC,document.getElementById("current-input-gain-test-mic").value=t.CURRENT_GAIN_TEST_MIC}),$("#testMicrophoneModal").on("hide.bs.modal",async e=>{t.buttonHandlers.stopButtonClick(),t.analyser.disconnect()}),r.addEventListener("input",function(){let e=parseFloat(this.value);t.CURRENT_GAIN_TEST_MIC=e,t.gainNode.gain.value=e,t.recordGainNode.gain.value=e,localStorage.setItem("micgain",e),document.getElementById("current-input-gain-test-mic").value=e})}}}),s("ck9ES",function(e,o){t(e.exports,"LOADER_ELEM_ID",()=>s),t(e.exports,"uriUserPage",()=>r),t(e.exports,"uriCollectionPage",()=>a),t(e.exports,"LevelPrivacy",()=>c),t(e.exports,"PRIVACY_BADGE_STYLE",()=>l),t(e.exports,"PRIVACY_BADGE_TEXT",()=>d),t(e.exports,"startLoader",()=>u),t(e.exports,"cancelLoader",()=>h),t(e.exports,"callJsonApi",()=>p),t(e.exports,"looksLikeMail",()=>m),t(e.exports,"activateGoHomeLink",()=>g),t(e.exports,"isSafari",()=>T);var i=n("9QUIF");let s="loader",r="/index.html?userid=",a="/index.html?collectionid=";Object.freeze({none:0,owner:1,admin:2,member:3,guest:4});let c=Object.freeze({public:1,onlyreg:2,private:3}),l={[c.public]:"badge-public",[c.onlyreg]:"badge-onlyreg",[c.private]:"badge-private"},d={[c.public]:"PUBLIC",[c.onlyreg]:"REG USERS",[c.private]:"PRIVATE"},u=(t,e)=>{let o=document.getElementById(t);o.nextElementSibling.textContent=e,o.classList.add(t)},h=t=>{let e=document.getElementById(t);e.classList.remove(t),e.nextElementSibling.textContent=""},p=async(t,e,o)=>{let n={method:e||"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}};o&&(n.body=JSON.stringify(o));try{u(s,"Loading...");let e=await fetch(i.ENDPOINT+t,n);h(s);let o=await e.json();if(o&&!o.error)return o;return o?.error||"An error occurred"}catch(t){return h(s),t}},m=t=>{let e=t.lastIndexOf("@"),o=t.lastIndexOf(".");return e<o&&e>0&&-1==t.indexOf("@@")&&o>2&&t.length-o>2},g=()=>{let t=document.getElementById("goHome");"localhost:80"===window.location.host||"http://localhost"===window.location.origin?t.href=window.location.origin+"/index.html":t.href=window.location.origin},T=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}),s("9QUIF",function(t,e){let o="STAGE",i={PROD:{ENDPOINT:"",UPLOAD_ENDPOINT:""},STAGE:{ENDPOINT:window.location.protocol+"//"+window.location.host,UPLOAD_ENDPOINT:window.location.protocol+"//"+window.location.host+"/fileUpload"},DEV:{ENDPOINT:window.location.protocol+"//"+window.location.host,UPLOAD_ENDPOINT:window.location.protocol+"//"+window.location.host+"/fileUpload"}};t.exports={ENDPOINT:i[o].ENDPOINT,UPLOAD_ENDPOINT:i[o].UPLOAD_ENDPOINT}}),s("4TAOB",function(e,o){t(e.exports,"setCanvasData",()=>r),t(e.exports,"ButtonHandlers",()=>a),t(e.exports,"mediaRecorderStopUI",()=>c);let i=document.querySelector(".visualizer-test-mic"),n=i.getContext("2d"),s=document.querySelector(".main-controls-test-mic"),r=(t,e)=>{i.width=s.offsetWidth;let o=i.width,r=i.height;n.fillStyle="rgb(200, 200, 200)",n.fillRect(0,0,o,r),n.lineWidth=2,n.strokeStyle="rgb(0, 0, 0)",n.beginPath();let a=1*o/t,c=0;for(let o=0;o<t;o++){let t=e[o]/128*r/2;0===o?n.moveTo(c,t):n.lineTo(c,t),c+=a}n.lineTo(i.width,i.height/2),n.stroke()};class a{constructor(t,e){this.mediaRecorder=t,this.testMic=e,this.recordButton=document.querySelector(".record-test-mic"),this.stopButton=document.querySelector(".stop-test-mic")}init(){this.stopButton.disabled=!0,this.recordButton.onclick=this.recorButtonClick.bind(this),this.stopButton.onclick=this.stopButtonClick.bind(this)}async recorButtonClick(){await this.testMic.connectSource(),this.mediaRecorder.start(),this.recordButton.style.background="red",this.stopButton.disabled=!1,this.recordButton.disabled=!0}stopButtonClick(){this.mediaRecorder.stop(),this.recordButton.style.background="",this.recordButton.style.color="",this.stopButton.disabled=!0,this.recordButton.disabled=!1,this.testMic.disconnectSource()}}let c=t=>{let e=document.querySelector(".audio-test-mic");if(e)e.src=t;else{let e=l(t);document.querySelector(".sound-clips-test-mic").appendChild(e)}},l=t=>{let e=d(),o=u(t),i=h(),n=document.createElement("article");return n.classList.add("clip-test-mic"),n.appendChild(o),n.appendChild(e),n.appendChild(i),n},d=()=>{let t="test ("+new Date().toLocaleTimeString()+")",e=document.createElement("span");return e.textContent=t,e},u=t=>{let e=document.createElement("audio");return e.setAttribute("controls",""),e.classList.add("audio-test-mic"),e.controls=!0,e.src=t,e},h=()=>{let t=document.createElement("button");return t.textContent="Delete",t.className="button-test-mic delete",t.onclick=function(t){t.target.closest(".clip-test-mic").remove()},t}}),n("04BFj");
//# sourceMappingURL=composition.c30d63e1.js.map
