!function(){function e(e,t,l,n){Object.defineProperty(e,t,{get:l,set:n,enumerable:!0,configurable:!0})}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},l={},n={},o=t.parcelRequire1e7e;null==o&&((o=function(e){if(e in l)return l[e].exports;if(e in n){var t=n[e];delete n[e];var o={id:e,exports:{}};return l[e]=o,t.call(o.exports,o,o.exports),o.exports}var a=Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(e,t){n[e]=t},t.parcelRequire1e7e=o);var a=o.register;a("2yJoz",function(t,l){e(t.exports,"register",function(){return n},function(e){return n=e});var n,o=new Map;n=function(e,t){for(var l=0;l<t.length-1;l+=2)o.set(t[l],{baseUrl:e,path:t[l+1]})}}),a("luG8Y",function(t,l){e(t.exports,"getBundleURL",function(){return n},function(e){return n=e}),e(t.exports,"getOrigin",function(){return o},function(e){return o=e});var n,o,a={};n=function(e){var t=a[e];return t||(t=function(){try{throw Error()}catch(t){var e=(""+t.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^)\n]+/g);if(e)return(""+e[2]).replace(/^((?:https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/.+)\/[^/]+$/,"$1")+"/"}return"/"}(),a[e]=t),t},o=function(e){var t=(""+e).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^/]+/);if(!t)throw Error("Origin not found");return t[0]}}),a("72lX3",function(e,t){let l="STAGE",n={PROD:{ENDPOINT:"",UPLOAD_ENDPOINT:""},STAGE:{ENDPOINT:window.location.protocol+"//"+window.location.host,UPLOAD_ENDPOINT:window.location.protocol+"//"+window.location.host+"/fileUpload"},DEV:{ENDPOINT:window.location.protocol+"//"+window.location.host,UPLOAD_ENDPOINT:window.location.protocol+"//"+window.location.host+"/fileUpload"}};e.exports={ENDPOINT:n[l].ENDPOINT,UPLOAD_ENDPOINT:n[l].UPLOAD_ENDPOINT}}),a("lV0Oe",function(t,l){e(t.exports,"default",function(){return n});var n=new class{dynamicModalDialog(e,t,l,n,o,a,i){this.setDynamicModalContent('<div class="modal-header '+a+' text-white"><h5 class="modal-title" id="dynamicModalLabel">'+o+'</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body">'+e+'</div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">'+n+"</button>"+(null!==t?"<button id="+t+' type="button" class="btn btn-primary">'+l+"</button>":"")+"</div>"),this.callbackDismiss=i,$(this.modal).modal("show")}getDynamicModal(){return document.getElementById("dynamicModal")}setDynamicModalContent(e){this.modal.querySelector(".modal-content").innerHTML=e}closeDynamicModal(e){$(this.modal).modal("hide"),e&&e()}initDynamicModal(){let e=document.createElement("div");return e.classList.add("modal","fade"),e.setAttribute("id","dynamicModal"),e.setAttribute("tabindex","-1"),e.setAttribute("role","dialog"),e.setAttribute("aria-labelledby","dynamicModalLabel"),e.setAttribute("aria-hidden","true"),e.innerHTML='<div class="modal-dialog modal-sm modal-dialog-centered" role="document"><div class="modal-content"></div></div>',document.body.appendChild(e),e}constructor(){if(this.modal=this.getDynamicModal(),this.callbackDismiss=null,!this.modal){this.modal=this.initDynamicModal();let e=this;$(this.modal).on("hide.bs.modal",function(t){e.callbackDismiss&&(e.callbackDismiss(),e.callbackDismiss=null)})}}}}),a("7hG31",function(t,l){e(t.exports,"uriUserPage",function(){return a}),e(t.exports,"uriCollectionPage",function(){return i}),e(t.exports,"UserRole",function(){return s}),e(t.exports,"LevelPrivacy",function(){return r}),e(t.exports,"PRIVACY_BADGE_STYLE",function(){return c}),e(t.exports,"PRIVACY_BADGE_TEXT",function(){return d}),e(t.exports,"startLoader",function(){return u}),e(t.exports,"cancelLoader",function(){return m}),e(t.exports,"callJsonApi",function(){return p}),e(t.exports,"looksLikeMail",function(){return g}),e(t.exports,"activateGoHomeLink",function(){return b}),e(t.exports,"MEDIA_CONSTRAINTS",function(){return h});var n=o("72lX3");let a="/index.html?userid=",i="/index.html?collectionid=",s=Object.freeze({none:0,owner:1,admin:2,member:3,guest:4}),r=Object.freeze({public:1,onlyreg:2,private:3}),c={[r.public]:"badge-public",[r.onlyreg]:"badge-onlyreg",[r.private]:"badge-private"},d={[r.public]:"PUBLIC",[r.onlyreg]:"REG USERS",[r.private]:"PRIVATE"},u=e=>{let t=document.getElementById("loader");t.innerHTML=`<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>&nbsp;${e}`,t.classList.remove("loader-hidden")},m=()=>{document.getElementById("loader").classList.add("loader-hidden")},p=async(e,t,l,o)=>{let a={method:t||"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}};l&&(a.body=JSON.stringify(l));try{o&&u(o);let t=await fetch(n.ENDPOINT+e,a);o&&m();let l=await t.json();if(l&&!l.error)return l;return(null==l?void 0:l.error)||"An error occurred"}catch(e){return o&&m(),e}},g=e=>{let t=e.lastIndexOf("@"),l=e.lastIndexOf(".");return t<l&&t>0&&-1==e.indexOf("@@")&&l>2&&e.length-l>2},b=()=>{let e=document.getElementById("goHome");"localhost:80"===window.location.host||"http://localhost"===window.location.origin?e.href=window.location.origin+"/index.html":e.href=window.location.origin};/^((?!chrome|android).)*safari/i.test(navigator.userAgent);let h={audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,latency:0,channelCount:1}}}),a("Nsii8",function(t,l){e(t.exports,"checkIfTermsAccepted",function(){return a}),e(t.exports,"generateAcceptTermsModal",function(){return c});var n=o("7hG31");let a=(e,t)=>{(0,n.cancelLoader)(),t(null==e?void 0:e.terms_accepted)},i=()=>{$("#acceptTermsModal").modal({backdrop:"static",keyboard:!1}),$("#acceptTermsModal").modal("show"),document.getElementById("buttonAcceptTerms").onclick=s,document.getElementById("buttonRejectTerms").onclick=r},s=async()=>{(await (0,n.callJsonApi)("/acceptterms","PUT",null,"Welcome...")).ok&&$("#acceptTermsModal").modal("hide")},r=async()=>{(await (0,n.callJsonApi)("/rejectterms","PUT",null,"Deleting information...")).ok&&($("#acceptTermsModal").modal("hide"),window.location.href=window.location.origin)},c=e=>{if(!document.getElementById("acceptTermsModal")){let t=`<div class="modal fade" id="acceptTermsModal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title">Accept Terms</h5>                
                </div>
                <div class="modal-body">
                <p>By clicking on OK you accept the Terms of Use.</p>
                <p>More information at: <span> <a href="${window.location.origin}/static/terms.html" target="_blank">${window.location.origin}/static/terms.html</a></span></p>
                </div>
                <div class="modal-footer">
                <button id="buttonRejectTerms" type="button" class="btn btn-secondary" data-dismiss="modal">Reject</button>
                <button id="buttonAcceptTerms" type="button" class="btn btn-primary">OK</button>
                </div>
            </div>
            </div>
        </div>`;document.getElementsByTagName(e)[0].insertAdjacentHTML("afterend",t)}i()}}),a("d2TTa",function(t,l){e(t.exports,"getCollections",function(){return i}),e(t.exports,"getCollectionsError",function(){return s}),e(t.exports,"createListCollections",function(){return r});var n=o("72lX3"),a=o("lV0Oe");let i=async()=>{let e=await fetch(n.ENDPOINT+"/mycollections"),t=null;return(null==e?void 0:e.ok)&&(t=await e.json()),t},s=()=>{(0,a.default).dynamicModalDialog("Problem getting collections",null,"","Close","Error","bg-danger")},r=(e,t,l)=>{let n=e.all_collections,o=document.getElementById(t),a="<option value='0'>...</option>",i=null;n.forEach(e=>{if(e){i=e.uuid===l?"selected>":null;let t=`<option value='${e.uuid}' ${i||">"}${e.title}</option>`;a+=t}});let s=`<select class='custom-select' id='inputGroupSelectCollect'>${a}</select>`;o.insertAdjacentHTML("afterbegin",s)}}),o("2yJoz").register(o("luG8Y").getBundleURL("1T7VR"),JSON.parse('["1T7VR","index.3ce9b43d.js","74vOp","static/videos/compress_home_page_video.mp4"]'));var i=o("72lX3"),s=o("lV0Oe"),r=(o("7hG31"),o("7hG31"));let c=(e,t)=>{d(e,t),document.querySelectorAll(".breadcrumb-item a").forEach(function(t){t.addEventListener("click",function(t){var l;t.preventDefault(),null===(l=document.querySelector(".active-breadcrumb"))||void 0===l||l.classList.remove("active-breadcrumb"),t.currentTarget.classList.add("active-breadcrumb"),u(t.currentTarget.getAttribute("data-section"),e)})})},d=(e,t)=>{let l=document.getElementById("breadcrumbnavbar"),n="";n=e.ok?`<li class='breadcrumb-item ${t?"":"active-breadcrumb"}' aria-current='page'><a href='#' data-section='my-comp'>My Music</a></li>
        <li class='breadcrumb-item'><a href='#' data-section='all-comp'>All</a></li>`:`<li class='breadcrumb-item ${t?"":"active-breadcrumb"}' aria-current='page'><a href='#' data-section='recent-comp'>Recent</a></li>
        <li class='breadcrumb-item'><a href='#' data-section='all-comp'>All</a></li>`,l.innerHTML=n};function u(e,t){let l=new URL(window.location.href);l.searchParams.delete("userid"),l.searchParams.delete("collectionid"),history.replaceState(null,null,l);let n=!1;switch(e){case"recent-comp":eh(n=!0);break;case"my-comp":ep();break;case"all-comp":document.getElementById("initialmessage").classList.remove("d-flex"),document.getElementById("initialmessage").hidden=!0,t.ok||(n=!0),ey(n);break;default:console.log("section default")}}var m=o("Nsii8");let p=null,g=e=>{let t=!1;return("/mycompositions"===e||e.includes("/compositionsbyuserid/")||e.includes("/collectionastreebyid/"))&&(t=!0),t},b=()=>p,h=e=>{p=e},y=(e,t)=>!g(e)||t!==b(),f=e=>{let t={},l={};return e.forEach(e=>{let n=e.collection_uid,o=e.user_id;null!==n?(t[n]||(t[n]=[]),t[n].push(e)):(l[o]||(l[o]=[]),l[o].push(e))}),{groupedbycoll:t,groupedbyuser_aux:l}},v=(e,t)=>{let l={},n=[];return e.forEach(e=>{let o=e.collection_uid;null!==o&&o!==t?(l[o]||(l[o]=[]),l[o].push(e)):n.push(e)}),{groupedbycoll:l,singlecomps:n}},w=e=>{let t={},l={},n=[];return e.forEach(e=>{let o=e.collection_uid;null!==o?(t[o]||(t[o]=[]),t[o].push(e)):e.contributors.length?(l.collabs||(l.collabs=[]),l.collabs.push(e)):n.push(e)}),{groupedbycoll:t,groupedbycollab:l,singlecomps:n}},E=e=>{let t={},l=[];for(let n in e)1===e[n].length?l.push(e[n][0]):(t[n]||(t[n]=[]),t[n]=e[n]);return{singlecomps:l,groupedbyuser_final:t}},T=e=>{let{groupedbycoll:t,groupedbyuser_aux:l}=f(e),{singlecomps:n,groupedbyuser_final:o}=E(l);return{groupedbycoll:t,groupedbyuser_final:o,singlecomps:n}},k=e=>{let{groupedbycoll:t,groupedbycollab:l,singlecomps:n}=w(e);return{groupedbycoll:t,groupedbycollab:l,singlecomps:n}},I=(e,t)=>{let{groupedbycoll:l,singlecomps:n}=v(e,t);return{groupedbycoll:l,singlecomps:n}},x=e=>{let t=[],l={},n={};return e.forEach(e=>{if(l[e.uuid]=e,null==e?void 0:e.tracks.length){for(let t=0;t<e.tracks.length;t++){let l=e.tracks[t];l.comp_uuid=e.uuid,n[l.uuid]=l}t.push(...e.tracks)}}),{tracksList:t,compositionsDictionary:l,tracksDictionary:n}};var r=o("7hG31");let L=new URL(o("luG8Y").getBundleURL("1T7VR")+"static/videos/compress_home_page_video.mp4"),A={coll:"badge-collection",user:"badge-warning",collab:"badge-collab"},B={coll:"border-collection",user:"border-warning",collab:"border-collab"},C={coll:r.uriCollectionPage,user:r.uriUserPage},M=`<div id="landing-video-container" class="fullscreen-video-container">
    <video playsinline autoplay loop muted>
      <source src="${L}">
    </video>  
  <div class='fullscreen-video-content'>
    <div class="typewriter">
      <h1>Welcome!</h1>      
    </div>
    <div class="h-100 d-flex">
      <div class="m-auto">
        <a id="start-link" class="btn btn-link" href="/login.html" role="button"><b>LET'S JAM?</b></a>
      </div>
    </div>    
  </div>
</div>`,_=(e,t,l,n,o)=>{let a=e||!g(n)&&t||l;return`<ul class="nav justify-content-end">
              ${a?'<li class="legenditem nav-item"><h4><span class="badge badge-light">Groups by:&nbsp;</span></h4></li>':""}
              ${e?'<li class="legenditem nav-item"><h4><span class="badge badge-collection">Collections&nbsp;<span class="badge badge-light">'+e+"</span></span></h4></li>":""}            
              ${!g(n)&&t?'<li class="legenditem nav-item"><h4><span class="badge badge-warning">Users&nbsp;<span class="badge badge-light">'+t+"</span></span></h4></li>":""}
              ${l?'<li class="legenditem nav-item"><h4><span class="badge badge-success">Singles&nbsp;<span class="badge badge-light">'+l+"</span></span></h4></li>":""}
              <li class="legenditem nav-item"><h4><span class="badge badge-light">Total compositions:&nbsp;</span><span class="badge badge-light">${o}</span></h4></li>
            </ul>`},D=(e,t)=>{document.getElementById("grid").innerHTML="",document.getElementById("grid").insertAdjacentHTML("afterbegin",e),document.getElementById("legendbuttons").innerHTML="",document.getElementById("legendbuttons").insertAdjacentHTML("afterbegin",t),document.getElementById("searchInput").removeAttribute("disabled")},P=(e,t)=>{var l,n,o;let a=y(t,e.username),i=e.contributors.length,s=null==e?void 0:null===(l=e.tracks[(null==e?void 0:e.tracks.length)-1])||void 0===l?void 0:l.uuid;return`<div class='card border-success'>                       
              <div class="card-body">
              ${ed?`<span class="badge ${r.PRIVACY_BADGE_STYLE[e.privacy]}">${r.PRIVACY_BADGE_TEXT[e.privacy]}</span>`:""}
              ${e.opentocontrib?'<p class="badge badge-info">OPEN TO CONTRIB</p>':""}
              ${e.is_template?'<p class="badge badge-template">TEMPLATE</p>':""}  
                  <div>
                    <p class="list-group-item-heading">  
                      <a href='${ec+e.uuid}' class='card-url'>
                        <h5 class='card-title'>${e.title}</h5>
                      </a>
                    </p>
                    <p>${a?`<span class="d-inline-block text-truncate" style="max-width: 250px;">
                        <i class='fa fa-user'></i>&nbsp;
                        <a href='${r.uriUserPage+e.owner_uuid}' class='card-url'>
                          ${e.username}&nbsp;
                        </a>
                      </span>`:""}
                    </p>
                    <p class='text-black-50'>${i?"Collaborators: "+i:""}</p>
                    <p class='card-text text-truncate'>${e.description||""}</p>
                    ${(null===(n=e.tracks)||void 0===n?void 0:n.length)?`<span class="play-control-card d-inline-block text-truncate" style="max-width: 200px;" ${s?` data-trackid="${s}"`:""}>
                      <i class='fa fa-play'>&nbsp;</i>Play last added track </span>&nbsp;`:""}
                    <span class="d-inline-block text-truncate" style="max-width: 250px;">
                        <i class='fa fa-music'></i>&nbsp;${"Tracks: "+(null===(o=e.tracks)||void 0===o?void 0:o.length)}
                    </span>
                  </div>                
              </div>            
          </div>`},O=(e,t,l)=>{var n,o,a;let i=y(l,e.username),s=e.contributors.length,c=null==e?void 0:null===(n=e.tracks[(null==e?void 0:e.tracks.length)-1])||void 0===n?void 0:n.uuid;return`<div class="list-group-item ">
              ${ed?`<span class="badge ${r.PRIVACY_BADGE_STYLE[e.privacy]}">${r.PRIVACY_BADGE_TEXT[e.privacy]}</span>`:""}
              ${e.opentocontrib?'<span class="badge badge-info">OPEN TO CONTRIB</span>':""}
              ${e.is_template?'<span class="badge badge-template">TEMPLATE</span>':""}  
              <p class="list-group-item-heading">
                <a href='${ec+e.uuid}' class='card-url'>
                    <h5 class='card-title'>${e.title}</h5>
                </a>
              </p>
              ${"user"!==t&&i?'<p><span class="d-inline-block text-truncate" style="max-width: 220px;"><i class="fa fa-user"></i>&nbsp;<a href='+r.uriUserPage+e.owner_uuid+' class="card-url">'+e.username+"&nbsp;</a></span></p>":""}
              <p class='text-black-50'>${s?"Collaborators: "+s:""}</p>
              <p class="list-group-item-text text-truncate">
                ${e.description||""}
              </p>
              ${(null===(o=e.tracks)||void 0===o?void 0:o.length)?`<span class="play-control-card d-inline-block text-truncate" style="max-width: 200px;" ${c?` data-trackid="${c}"`:""}>
                <i class='fa fa-play'>&nbsp;</i>Play last added track 
              </span>&nbsp;`:""}
              <span class="d-inline-block text-truncate" style="max-width: 200px;">
                <i class='fa fa-music'></i>&nbsp;${"Tracks: "+(null===(a=e.tracks)||void 0===a?void 0:a.length)}
              </span>
            </div>`},N=(e,t,l,n,o)=>{let a=A[e],i=B[e],s=C[e],r=`<span class="badge ${a} d-inline-block text-truncate" style="max-width:85%;">
                              <span class="badge badge-light">${t}</span>&nbsp;
                              ${s?`<a href=${s+n} class="card-header-url">${l}</a>`:`${l}`}                              
                          </span>`;return`<div class='card ${i}'>                        
              <h4>${r}</h4>        
              <div class="card-body">
                <div class="list-group border">              
                  ${o}
                </div>
              </div>
            </div>`},S=(e,t)=>{var l,n;let o=document.getElementById("welcomecontainer"),a=document.getElementById("landing-video-container");if((null===(l=o.lastChild)||void 0===l?void 0:l.id)&&(null===(n=o.lastChild)||void 0===n?void 0:n.id)!=="welcometext"&&o.removeChild(o.lastChild),!e&&!o.lastChild&&!a){let e=document.createElement("div");e.id="welcometext",e.innerHTML=ed?"":`${M}`,document.getElementById("welcomecontainer").appendChild(e)}t&&document.getElementById("grid").scrollIntoView({behavior:"smooth"})},R=(e,t,l)=>{S(!0);let n=document.createElement("div");n.id="infocontainer",n.innerHTML=`<div class="card border-collection mb-3">
                                          <div class="card-header bg-transparent border-collection"><b>Collection</b></div>
                                          <div class="card-body text-dark">
                                            <h5 class="card-title">${e}</h5>
                                            <p class="card-text" style="width:300px;">Owner: <a href=${r.uriUserPage+l} class="card-url">${t}</a></p>
                                          </div>
                                        </div>`,document.getElementById("welcomecontainer").appendChild(n)},G=(e,t)=>{S(!0);let l=document.createElement("div");l.id="infocontainer",l.innerHTML=`<div class="card mb-3" style="max-width: 540px;">
                                    <div class="row no-gutters">
                                      <div class="col-md-4">
                                        <img class="img-fluid hidden-first" src="https://picsum.photos/seed/${t}/200" alt="User Picture" width="200" height="200">
                                      </div>
                                      <div class="col-md-8">
                                        <div class="card-body">
                                          <h5 class="card-title">User</h5>
                                          <p class="card-text" style="width:300px;">${e?`${e}`:""}</p>                                        
                                          <p class="card-text"><small class="text-muted"></small></p>
                                        </div>
                                      </div>
                                    </div>
                                  </div>`,document.getElementById("welcomecontainer").appendChild(l)},U=null,j=null,H=!1,J=null,q=null,V={container:"#waveform",responsive:!0,height:80,waveColor:"#007bff",progressColor:"#6610f2",barWidth:2,barGap:1,barRadius:2,cursorWidth:0},Y=()=>document.getElementById("waveform").getAttribute("data-currentaudio"),X=(e,t)=>{var l;let n=null===(l=document.querySelector(`[data-trackid='${e}']`))||void 0===l?void 0:l.firstChild.nextSibling;n&&(t?n.classList.replace("fa-play","fa-volume-down"):(n.classList.replace("fa-volume-down","fa-play"),n.classList.remove("fa-beat")))},z=e=>{let t=document.getElementById("playfloatingbutton").firstChild.nextSibling;e?(t.classList.remove("fa-play"),t.classList.add("fa-pause")):(t.classList.remove("fa-pause"),t.classList.add("fa-play"))},W=()=>{J.isPlaying()?J.pause():J.play()},F=e=>{(null==J?void 0:J.isPlaying())&&(X(e,!1),J.pause())},K=e=>{document.getElementById("sticky-player").hidden&&(document.getElementById("sticky-player").hidden=!1);let t=Y();t===e?W():(X(t,!1),F(e),en(e,!0))},Q=(e,t)=>{H=t,J.seekTo(0),J.load(e)},Z=(e,t)=>{let l=document.querySelector(`[data-trackid='${e}']`);if(l){l.onclick=null;let e=l.firstChild.nextSibling;e.classList.remove("fa-volume-down"),e.classList.remove("fa-beat"),e.classList.add("fa-times")}z(!1);let n=et(e);document.getElementById("current-play-info").textContent=" Error loading track at: "+n.comp_title,J.destroy()},ee=e=>{let t=et(e);document.getElementById("current-play-info").textContent=t.comp_title+" / "+t.track_title},et=e=>({track_title:U[e].title,comp_title:j[U[e].comp_uuid].title}),el=e=>{let t=x(e);t.tracksList.length&&(document.querySelector(".sticky-container").style.display="block",U=t.tracksDictionary,j=t.compositionsDictionary)},en=async(e,t)=>{J&&(es(),J.destroy()),J=ei(),er(),document.getElementById("waveform").setAttribute("data-currentaudio",e),document.getElementById("current-play-info").textContent="Downloading track ... 0%",document.getElementById("playfloatingbutton").classList.add("isDisabled");let l=window.location.origin+"/trackfile/"+e;q&&q.abort();let n=(q=new AbortController).signal;(await fetch(l,{signal:n})).ok?Q(l,t):Z(e,"Fetching error")},eo=()=>{document.querySelectorAll("[data-trackid]").forEach(e=>{let t=e.getAttribute("data-trackid");e.onclick=()=>{K(t)}})},ea=()=>{J.isPlaying()?J.pause():J.play()},ei=()=>WaveSurfer.create(V),es=()=>{J.unAll()},er=()=>{J.on("finish",()=>{let e=Y();z(!1),X(e,!1)}),J.on("play",()=>{let e=Y();z(!0),X(e,!0)}),J.on("loading",e=>{document.getElementById("current-play-info").textContent=`Downloading track ... ${e}%`}),J.on("pause",()=>{let e=Y();z(!1),X(e,!1)}),J.on("ready",e=>{document.getElementById("playfloatingbutton").classList.remove("isDisabled"),ee(Y()),H?J.play():z(!1)}),J.on("error",e=>{e&&Z(Y(),e)})},ec="/composition.html?compositionId=",ed=!1,eu=e=>{e||(0,m.generateAcceptTermsModal)("header")},em=async()=>{let e=await (0,r.callJsonApi)("/profile","GET",null,"Loading profile...");return e.ok&&(h(e.name),document.getElementById("userlogin").style.display="none",document.getElementById("useroptions").style.display="",document.getElementById("display_profile_name").innerText=`[${e.name}]`,(0,m.checkIfTermsAccepted)(e,eu)),e},ep=async()=>{let e="/mycompositions",t=await (0,r.callJsonApi)(e,"GET",null,"Loading my music...");if(t.compositions)return ef(t.compositions,e);alert("invalid return value for compisitions list")},eg=async(e,t)=>{let l="/compositionsbyuserid/"+e,n=await (0,r.callJsonApi)(l,"GET",null,"Loading user...");if(n.compositions)return h(n.username),G(n.username,e),ef(n.compositions,l);alert("invalid return value for user id"),t.ok?u("my-comp"):u("recent-comp")},eb=async(e,t)=>{let l="/collectionastreebyid/"+e,n=await (0,r.callJsonApi)(l,"GET",null,"Loading collection...");if(n.compositions)return h(n.username),R(n.collection_name,n.username,n.owneruid),ef(n.compositions,l);alert("invalid return value for collection id"),t.ok?u("my-comp"):u("recent-comp")},eh=async e=>{let t=await (0,r.callJsonApi)("/recentcompositions","GET",null,"Loading recent...");if(t.compositions)return ef(t.compositions,"/recentcompositions",e);alert("invalid return value for compisitions list")},ey=async e=>{let t=await (0,r.callJsonApi)("/compositions","GET",null,"Loading all...");if(t.compositions)return ef(t.compositions,"/compositions",e);alert("invalid return value for compisitions list")},ef=(e,t,l)=>{document.getElementById("grid").innerHTML="",document.getElementById("legendbuttons").innerHTML="";let n=!t.includes("/compositionsbyuserid/")&&!t.includes("/collectionastreebyid/");n&&S(!1,l),!e.length&&n?(document.getElementById("initialmessage").hidden=!1,document.getElementById("initialmessage").classList.add("d-flex")):ev(e,t),el(e),eo()},ev=(e,t)=>{t.includes("/collectionastreebyid/")?eT(I(e,t.replace("/collectionastreebyid/","")),null,t,e.length):g(t)?eT(k(e),"groupedbycollab",t,e.length):eT(T(e),"groupedbyuser_final",t,e.length)},ew=(e,t,l)=>{let n="";for(let o in e){let a=e[o],i="",s="",r=null;for(let e of("collab"===t?s="Collaborations":"coll"===t?(s=Object.values(a)[0].parent_collection,r=Object.values(a)[0].collection_uid):(s=Object.values(a)[0].username,r=Object.values(a)[0].owner_uuid),a))i+=O(e,t,l);n+=N(t,a.length,s,r,i)}return n},eE=(e,t)=>{let l="",n=e.singlecomps;return null==n||n.forEach(e=>{let n=P(e,t);l+=n}),l},eT=(e,t,l,n)=>{let o="",a=Object.keys(e.groupedbycoll).length,i=t?Object.keys(e[t]).length:0,s=e.singlecomps.length;a>0&&(o+=ew(e.groupedbycoll,"coll",l)),i>0&&(o+=ew(e[t],"groupedbycollab"===t?"collab":"user",l)),s>0&&(o+=eE(e,l)),D(o,_(a,i,s,l,n))},ek=async()=>{let e=window.location.search,t=e.split("userid=")[1],l=e.split("collectionid=")[1],n=await em();ed=n.ok,t?await eg(t,n):l?await eb(l,n):n.ok?await ep():await eh(),c(n,t||l)};document.getElementById("userlogin").innerHTML=`<li class='nav-item'>
        <a class='dropdown-item' href='${window.location.origin}/login.html'>Register / Login</a>
    </li>
    <li class='nav-item'>
        <a class='dropdown-item' href='${ec}demopage'>Test DAW</a>
    </li>
    <li class='nav-item'>
        <a class='dropdown-item' href='${window.location.origin}/static/howto.html'>How-To</a>
    </li>
    <li class='nav-item'>
        <a class='dropdown-item' href='#' id='openNewsModalButton' data-toggle='modal' data-target='#newsModal'><b>News<b></a>
    </li>
    `,document.getElementById("useroptions").innerHTML=`<li class='nav-item'>
      <a class='nav-link' href='${window.location.origin+"/profile.html"}'>Profile <i id='display_profile_name'></i></a>
    </li>
    <li class='nav-item'>
          <a class='nav-link' href='#' id='createNewButton' data-toggle='modal' data-target='#newMusicModal'>/ Create new</a>
    </li>
    <li class='nav-item'>
        <a class='nav-link' href='#' id='openMyCollectionsButton' data-toggle='modal' data-target='#editCollectionsModal'>/ My Collections</a>
    </li>
    <li class='nav-item'>
        <a class='nav-link' href='${window.location.origin+"/static/howto.html"}'>/ How-to</a>
    </li>
    <li class='nav-item'>
        <a class='nav-link' href='#' id='openNewsModalButton' data-toggle='modal' data-target='#newsModal'>/ News</a>
    </li>
    `,$("#newsModal").on("hidden.bs.modal",function(e){let t=document.getElementById("promo-video");t.paused||t.pause()}),(0,r.activateGoHomeLink)(),ek(),document.getElementById("playfloatingbutton").onclick=()=>{ea()};var eI=o("d2TTa"),i=o("72lX3");let ex=!1,e$=document.getElementById("openMyCollectionsButton"),eL=document.getElementById("editmycollectionsbutton"),eA=async()=>{let e=await fetch("/mycollectionsastree");return await e.json()},eB=e=>{let t=`
        <span id='removeCollIcon${e.uuid}' data-uuid='${e.uuid}' data-title='${e.title}' role='button' class='badge badge-pill badge-danger' hidden>-</span>
        <li id='${e.uuid}' class='list-group-item border-bottom-0 border-right-0 border-top-0 border-warning'>
            <input type='text' class='form-control border-secondary' id='treecolltitleinput${e.uuid}' data-uuid='${e.uuid}' placeholder='Type a new title'
            title='collectiontitle' value='${e.title}' disabled>
        </li>`;if(e.compositions.length>0||e.collections.length>0){for(let l of(t+="<ul>",e.compositions))t+=`<li class='list-group-item border-0'><a href='${ec+l.uuid}'><u>${l.title}</u></a></li>`;for(let l of e.collections)t+=eB(l);t+="</ul>"}return t},eC=async()=>{let e=document.getElementById("listCollContainerAllColl"),t=await eA(),l="<ul>";for(let e of t)l+=eB(e);l+="</ul>",e.innerHTML=l},eM=()=>{ex?(ex=!1,eL.innerText="Edit",eD()):(ex=!0,eL.innerText="Done",e_())},e_=()=>{document.querySelectorAll("[id*='removeCollIcon']").forEach(e=>{e.removeAttribute("hidden"),eN(e.getAttribute("data-uuid"),e.getAttribute("data-title"))}),document.querySelectorAll("[id*='treecolltitleinput']").forEach(e=>{e.removeAttribute("disabled"),eS(e.getAttribute("data-uuid"),e.value)})},eD=()=>{document.querySelectorAll("[id*='removeCollIcon']").forEach(e=>{e.setAttribute("hidden","true")}),document.querySelectorAll("[id*='treecolltitleinput']").forEach(e=>{e.setAttribute("disabled","true")})},eP=async()=>{ex=!1,eL.innerText="Edit",await eC(),eL.addEventListener("click",eM,!1)};null==e$||e$.addEventListener("click",eP,!1);let eO=async(e,t,l)=>{if("SPAN"===e.target.tagName){if(!0==confirm(`Are you sure you want remove the collection ${l} and all of its content?`)){let e=await fetch(i.ENDPOINT+"/deletecollection/"+t,{method:"DELETE"});if(null==e?void 0:e.ok){var n;document.getElementById("removeCollIcon"+t).remove();let e=document.getElementById(t);(null==e?void 0:null===(n=e.nextSibling)||void 0===n?void 0:n.tagName)==="UL"&&e.nextSibling.remove(),e.remove()}}else e.target.checked=!1}},eN=(e,t)=>{document.getElementById("removeCollIcon"+e).onclick=async l=>{await eO(l,e,t)}},eS=(e,t)=>{document.getElementById("treecolltitleinput"+e).onblur=l=>{eG(l,e,t)}},eR=(e,t)=>{fetch(i.ENDPOINT+"/updatecolltitle",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:e,uuid:t})}).then().catch(e=>{console.error("Error updating value:",e)})},eG=(e,t,l)=>{let n=e.target.value;if(l!==n){if(n&&""!==n)eR(n,t);else{e.target.value=l,alert("Introduce a valid title, please");return}}},eU=document.getElementById("createNewButton"),ej=document.getElementById("createNewButtonAtHome"),eH=()=>{ed?(document.getElementById("newtitle").value="",document.getElementById("newdescription").value="",eq(document.getElementById("newcreation")),(0,eI.getCollections)().then(e=>{e?eJ(e):(0,eI.getCollectionsError)()})):window.location.href="/login.html"};null==eU||eU.addEventListener("click",eH,!1),null==ej||ej.addEventListener("click",eH,!1);let eJ=e=>{document.getElementById("listCollContainer").innerHTML="",(0,eI.createListCollections)(e,"listCollContainer")},eq=e=>{null==e||e.addEventListener("click",eV)},eV=e=>{let t=document.querySelector('input[name="newMusicTypeRadioButton"]:checked').value,l="/newcomposition";"coll"===t&&(l="/newcollection");let n=document.getElementById("newtitle").value,o=document.querySelector('input[name="newMusicPrivacyRadios"]:checked').value;if(!n){alert("Introduce a valid title, please");return}let a=document.getElementById("newdescription").value,s=document.getElementById("inputGroupSelectCollect"),c=(null==s?void 0:s.value)||null;"0"===c&&(c=null);let d=JSON.stringify({title:n,privacy_level:o,parent_uuid:c,description:a});(0,r.startLoader)("Creating..."),fetch(i.ENDPOINT+l,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:d}).then(e=>(e.ok||e.statusText,e.json())).then(e=>{if((0,r.cancelLoader)(),e)eY(e);else throw Error(e)}).catch(e=>{(0,r.cancelLoader)()})},eY=e=>{$("#newMusicModal").modal("hide"),e.composition?window.location.href=ec+e.composition.uuid:e.ok?(0,s.default).dynamicModalDialog("Collection created successfully!",null,"","Close","New Collection","bg-success"):(0,s.default).dynamicModalDialog("An error happened, item not created",null,"","Close","Error at Creation","bg-danger")}}();
//# sourceMappingURL=index.3ce9b43d.js.map
