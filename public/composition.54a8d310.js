!function(){function e(e,t,n,i){Object.defineProperty(e,t,{get:n,set:i,enumerable:!0,configurable:!0})}var t,n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},i={},a={},o=n.parcelRequire1e7e;null==o&&((o=function(e){if(e in i)return i[e].exports;if(e in a){var t=a[e];delete a[e];var n={id:e,exports:{}};return i[e]=n,t.call(n.exports,n,n.exports),n.exports}var o=Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){a[e]=t},n.parcelRequire1e7e=o);var r=o.register;r("72lX3",function(t,n){e(t.exports,"ENDPOINT",function(){return a}),e(t.exports,"UPLOAD_ENDPOINT",function(){return o});let i={PROD:{ENDPOINT:"https://hiaudio.fr",UPLOAD_ENDPOINT:"https://hiaudio.fr/fileUpload"},STAGE:{ENDPOINT:window.location.protocol+"//"+window.location.host,UPLOAD_ENDPOINT:window.location.protocol+"//"+window.location.host+"/fileUpload"},DEV:{ENDPOINT:window.location.protocol+"//"+window.location.host,UPLOAD_ENDPOINT:window.location.protocol+"//"+window.location.host+"/fileUpload"}},a=i.DEV.ENDPOINT,o=i.DEV.UPLOAD_ENDPOINT}),r("lV0Oe",function(t,n){e(t.exports,"default",function(){return i});var i=new class{dynamicModalDialog(e,t,n,i,a,o,r){this.setDynamicModalContent('<div class="modal-header '+o+' text-white"><h5 class="modal-title" id="dynamicModalLabel">'+a+'</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body">'+e+'</div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">'+i+"</button>"+(null!==t?"<button id="+t+' type="button" class="btn btn-primary">'+n+"</button>":"")+"</div>"),this.callbackDismiss=r,$(this.modal).modal("show")}getDynamicModal(){return document.getElementById("dynamicModal")}setDynamicModalContent(e){this.modal.querySelector(".modal-content").innerHTML=e}closeDynamicModal(e){$(this.modal).modal("hide"),e&&e()}initDynamicModal(){let e=document.createElement("div");return e.classList.add("modal","fade"),e.setAttribute("id","dynamicModal"),e.setAttribute("tabindex","-1"),e.setAttribute("role","dialog"),e.setAttribute("aria-labelledby","dynamicModalLabel"),e.setAttribute("aria-hidden","true"),e.innerHTML='<div class="modal-dialog modal-sm modal-dialog-centered" role="document"><div class="modal-content"></div></div>',document.body.appendChild(e),e}constructor(){if(this.modal=this.getDynamicModal(),this.callbackDismiss=null,!this.modal){this.modal=this.initDynamicModal();let e=this;$(this.modal).on("hide.bs.modal",function(t){e.callbackDismiss&&(e.callbackDismiss(),e.callbackDismiss=null)})}}}}),r("7hG31",function(t,n){e(t.exports,"uriUserPage",function(){return a}),e(t.exports,"uriCollectionPage",function(){return r}),e(t.exports,"UserRole",function(){return s}),e(t.exports,"LevelPrivacy",function(){return l}),e(t.exports,"PRIVACY_BADGE_STYLE",function(){return c}),e(t.exports,"PRIVACY_BADGE_TEXT",function(){return d}),e(t.exports,"ROLE_BADGE_STYLE",function(){return u}),e(t.exports,"startLoader",function(){return h}),e(t.exports,"cancelLoader",function(){return p}),e(t.exports,"callJsonApi",function(){return m}),e(t.exports,"looksLikeMail",function(){return f}),e(t.exports,"activateGoHomeLink",function(){return g}),e(t.exports,"MEDIA_CONSTRAINTS",function(){return v});var i=o("72lX3");let a="/index.html?userid=",r="/index.html?collectionid=",s=Object.freeze({none:0,owner:1,admin:2,member:3,guest:4}),l=Object.freeze({public:1,onlyreg:2,private:3}),c={[l.public]:"badge-public",[l.onlyreg]:"badge-onlyreg",[l.private]:"badge-private"},d={[l.public]:"PUBLIC",[l.onlyreg]:"REG USERS",[l.private]:"PRIVATE"},u={[s.owner]:"badge-owner",[s.admin]:"badge-admin",[s.member]:"badge-member",[s.guest]:"badge-guest"},h=e=>{let t=document.getElementById("loader");t.innerHTML=`<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>&nbsp;${e}`,t.classList.remove("loader-hidden")},p=()=>{document.getElementById("loader").classList.add("loader-hidden")},m=async(e,t,n,a)=>{let o={method:t||"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}};n&&(o.body=JSON.stringify(n));try{a&&h(a);let t=await fetch(i.ENDPOINT+e,o);a&&p();let n=await t.json();if(n&&!n.error)return n;return(null==n?void 0:n.error)||"An error occurred"}catch(e){return a&&p(),e}},f=e=>{let t=e.lastIndexOf("@"),n=e.lastIndexOf(".");return t<n&&t>0&&-1==e.indexOf("@@")&&n>2&&e.length-n>2},g=()=>{let e=document.getElementById("goHome");"localhost:80"===window.location.host||"http://localhost"===window.location.origin?e.href=window.location.origin+"/index.html":e.href=window.location.origin};/^((?!chrome|android).)*safari/i.test(navigator.userAgent);let v={audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,latency:0,channelCount:1}}}),r("d2TTa",function(t,n){e(t.exports,"getCollections",function(){return r}),e(t.exports,"getCollectionsError",function(){return s}),e(t.exports,"createListCollections",function(){return l});var i=o("72lX3"),a=o("lV0Oe");let r=async()=>{let e=await fetch(i.ENDPOINT+"/mycollections"),t=null;return(null==e?void 0:e.ok)&&(t=await e.json()),t},s=()=>{(0,a.default).dynamicModalDialog("Problem getting collections",null,"","Close","Error","bg-danger")},l=(e,t,n)=>{let i=e.all_collections,a=document.getElementById(t),o="<option value='0'>...</option>",r=null;i.forEach(e=>{if(e){r=e.uuid===n?"selected>":null;let t=`<option value='${e.uuid}' ${r||">"}${e.title}</option>`;o+=t}});let s=`<select class='custom-select' id='inputGroupSelectCollect'>${o}</select>`;a.insertAdjacentHTML("afterbegin",s)}});var s=o("72lX3"),l=o("lV0Oe"),c=o("7hG31"),s=o("72lX3"),l=o("lV0Oe");let d=null,u=e=>new Promise((t,n)=>{let i=indexedDB.open(e,2);i.onerror=e=>{console.log(e),n(Error("Error opening database"))},i.onsuccess=e=>{let n=e.target.result;d=n,t(n)},i.onupgradeneeded=e=>{let n=e.target.result;d=n;let i=n.createObjectStore("tracks",{keyPath:"track_id"});i.createIndex("composition_id","composition_id",{unique:!1}),i.transaction.oncomplete=e=>{t(n)}}}),h=(e,t)=>{if(e)return new Promise((n,i)=>{let a=e.transaction(["tracks"],"readwrite");a.oncomplete=e=>{n()},a.onerror=e=>{console.log("error",e),i(Error("Error updating database"))},a.objectStore("tracks").put(t)})},p=(e,t)=>new Promise((n,i)=>{e&&t||i(Error("No DB or Comp ID"));let a=[],o=e.transaction("tracks").objectStore("tracks").index("composition_id"),r=IDBKeyRange.only(t);o.openCursor(r).onsuccess=e=>{let t=e.target.result;t?(a.push(t.value),t.continue()):n(a)}});var c=o("7hG31"),s=o("72lX3"),l=o("lV0Oe"),c=(o("7hG31"),o("7hG31")),m=o("d2TTa");let f=null,g=e=>{(0,m.getCollections)().then(t=>{t?y(t,e):(0,m.getCollectionsError)()})},v=e=>{let t=document.getElementById("openSettingsButton");null==t||t.addEventListener("click",()=>{g(f||e)},!1)},y=(e,t)=>{document.getElementById("listCollContainerNewColl").innerHTML="",(0,m.createListCollections)(e,"listCollContainerNewColl",f||t),(null==e?void 0:e.all_collections.length)&&t&&(f=t)},b=async e=>{let t=document.getElementById("inputGroupSelectCollect");if(t){let n=t.value,i=t.options[t.selectedIndex].text;(f||"0"!==n)&&n!==f&&await k(e,n,i)}},k=async(e,t,n)=>{let i=await ek("PATCH","/updatecompcollection",{uuid:e,collection_id:"0"===t?null:t});(null==i?void 0:i.ok)&&(f=t,w(t,n))},w=(e,t)=>{let n=document.getElementById("collection-badge");"0"===e?x(n):E(n,e,t)},x=e=>{let t=e.previousElementSibling.previousElementSibling,n=e.previousElementSibling;t.remove(),n.remove(),e.remove()},E=(e,t,n)=>{if(e)e.textContent=n,e.href=c.uriCollectionPage+t;else{let e=document.getElementById("owner-badge"),i=tu(t,n);e.insertAdjacentHTML("afterend",i)}},T=null,C=()=>T,S=e=>{T=e,document.getElementById("newtitle").value=e},P=async e=>{let t=document.getElementById("newtitle").value;t!==T&&await I(e,t)},I=async(e,t)=>{(await ek("PATCH","/updatecomptitle",{uuid:e,title:t})).ok&&(T=t,document.getElementById("comp-title").innerHTML=t,document.getElementById("clonetitle").value=t+" (Copy)")},O=null,_=()=>O,A=e=>{O=e,document.getElementById("newdescription").value=e},R=async e=>{let t=document.getElementById("newdescription").value;t!==O&&await B(e,t)},B=async(e,t)=>{(await ek("PATCH","/updatecompdescription",{uuid:e,description:t})).ok&&(O=t,document.getElementById("comp-description").innerHTML=t,document.getElementById("clonedescription").value=t+" (Copy)")},L=null,D=()=>L,M=e=>{L=e,document.getElementById("opentocontribution").checked=e},N=async e=>{let t=document.getElementById("opentocontribution").checked;t!==L&&await G(e,t)},j=e=>{let t=document.getElementById("opentocontribution");0===e?(t.checked=!1,t.disabled=!0):t.disabled=!1},G=async(e,t)=>{if((await ek("PATCH","/updatecomptocontrib",{uuid:e,opentocontrib:t})).ok){if(L=t,t)document.getElementById("privacybadgetext").insertAdjacentHTML("afterend",'&nbsp;<span class="badge badge-light">STATUS:&nbsp;</span><span class="badge badge-info">OPEN TO CONTRIB</span>');else if(document.querySelector(".badge-info")){let e=document.getElementById("privacybadgetext").nextSibling.nextSibling,t=e.nextSibling;e.remove(),t.remove()}}};var c=o("7hG31"),l=o("lV0Oe");let F=e=>{document.getElementById("clonetitle").value=e.title+" (Copy)",document.getElementById("clonedescription").value=e.description+" (Copy)",document.getElementById("btn-clone-container").hidden=!1,document.getElementById("btn-clone-comp").onclick=()=>{$("#cloneMusicModal").modal("show")},document.getElementById("clonecreationbtn").onclick=()=>{U(e)}},U=async e=>{document.getElementById("clonetitle").classList.remove("is-invalid"),document.getElementById("validationclonedtitle").innerText="";let t=document.getElementById("clonetitle").value,n=document.querySelector('input[name="cloneMusicPrivacyRadios"]:checked').value;if(!t){document.getElementById("clonetitle").classList.add("is-invalid"),document.getElementById("validationclonedtitle").innerText="Sorry, title can't be empty";return}let i={title:t,description:document.getElementById("clonedescription").value,privacy_level:n,clone_from:e.uuid},a=await (0,c.callJsonApi)("/clonecomposition","POST",i,"Cloning composition...");a.ok?window.location.href="/composition.html?compositionId="+a.composition.uuid:(0,l.default).dynamicModalDialog(a.msg||a,null,"","Close","Error Cloning","bg-danger")},V=null,H=()=>V,z=e=>{V=e,document.getElementById("markastemplatebtn").checked=e},W=async e=>{let t=document.getElementById("markastemplatebtn").checked;t!==V&&await q(e,t)},q=async(e,t)=>{let n={uuid:e.uuid,is_template:t};(await ek("PATCH","/updatecompastemplate",n)).ok&&(V=t,t?(document.getElementById("btn-clone-container").hidden=!1,F(e)):document.getElementById("btn-clone-container").hidden=!0)};var c=o("7hG31");let X=null,Y=()=>X,J=()=>{for(let e of document.getElementsByName("settingsPrivacyRadios"))e.addEventListener("change",function(){this.checked&&(3===parseInt(this.value)?j(0):j(1))})},K=e=>{X=e,document.getElementById("settingsPrivacyRadios"+e).checked=!0,e===c.LevelPrivacy.private&&j(0)},Z=async e=>{let t=parseInt(document.querySelector('input[name="settingsPrivacyRadios"]:checked').value);t!==X&&await Q(e,t)},Q=async(e,t)=>{if((await ek("PATCH","/updatecompprivacy",{uuid:e,privacy:t})).ok){X=t;let e=document.getElementById("privacybadgetext");e.className="badge "+c.PRIVACY_BADGE_STYLE[t],e.innerText=c.PRIVACY_BADGE_TEXT[t]}};var s=o("72lX3"),l=o("lV0Oe"),c=o("7hG31");let ee=[],et=[],en=[],ei={1:"Owner",2:"Admin",3:"Member",4:"Guest"},ea=()=>ee,eo=()=>{document.getElementById("contributorinput").value="",document.getElementById("listOfContributors").innerHTML=""},er=()=>{et=[],en=[]},es=e=>{let t=document.getElementById("listOfContributors");e.length?(ee=e,e.flatMap(e=>ec(t,e))):(document.getElementById("contributorinput").value="",t.innerHTML="")},el=(e,t)=>{let n=document.getElementById("addContribButton"),i=document.getElementById("contributorinput"),a=document.getElementById("listOfContributors");n.addEventListener("click",function(){let n=document.getElementById("inputGroupSelectRole").value;document.getElementById("contributorinput").classList.remove("is-invalid"),document.getElementById("validationemailresult").innerText="",i.value&&(0,c.looksLikeMail)(i.value)?ed(a,i.value.trim(),e,n,t):(document.getElementById("contributorinput").classList.add("is-invalid"),document.getElementById("validationemailresult").innerText="Sorry, invalid email address format.")})},ec=(e,t,n)=>{let i=ei[t.role],a=document.createElement("li");a.className="list-group-item",a.id=n||t.user_uid,a.textContent=t.email+" ("+i+")";let o=`&nbsp;<div class='custom-control custom-switch custom-control-inline float-right'>
    <input type='checkbox' class='custom-control-input is-invalid' id='removeContSwitch${t.user_uid}'>
    <label class='custom-control-label is-invalid' for='removeContSwitch${t.user_uid}'>Remove</label>
  </div>`;a.innerHTML+=o,e.appendChild(a),eg(t)},ed=async(e,t,n,i,a)=>{if(0!==parseInt(document.getElementById("inputGroupSelectRole").value)){let o={email:t,user_uid:t,composition_id:n,role:parseInt(i)},r=ee.findIndex(e=>e.email===t),l=et.findIndex(e=>e.email===t),c=en.indexOf(t);c>-1&&en.splice(c,1);if(l<0&&r<0||eh(o,l,r,e)){let n=await fetch(s.ENDPOINT+"/checkuser/"+t);if((null==n?void 0:n.ok)||(null==n?void 0:n.status)===404){let i=await n.json();a!==i.user_uid?((null==n?void 0:n.status)===200&&(o.user_uid=i.user_uid),et.push(o),ec(e,o),(null==n?void 0:n.status)===404&&eu("An invitation via email will be sent to: "+t+", after clicking on the button Confirm")):eu(`Can't add ${t} as contributor`)}else eu(`${t} can't be added`)}else eu(`${t} can't be updated`)}else eu("Choose a role, please")},eu=e=>{(0,l.default).dynamicModalDialog(e,null,"","Close","Warning!","bg-warning")},eh=(e,t,n,i)=>{var a,o;let r=!1,s=(null===(a=ee[n])||void 0===a?void 0:a.user_uid)||(null===(o=et[t])||void 0===o?void 0:o.user_uid),l=document.getElementById(s);if(l){if(n>=0&&t<0){let t=e6===ee[n].user_uid,i=ee[n].email===e.email&&ee[n].role===e.role;t||i||(r=!0,l.remove())}t>=0&&n<0&&et[t].role!==e.role&&(r=!0,et.splice(t,1),l.remove()),t>=0&&n>=0&&(ee[n].role===e.role&&(et.splice(t,1),l.remove(),ec(i,e,s)),et.length&&et[t].role!==e.role&&(r=!0,et.splice(t,1),l.remove()))}return r},ep=async()=>{if(et.length>0){let e=[...et],t=0;for(let n=0;n<et.length;n++){let i=et[n],a=await ek("POST","/addcontributorbyemail",i);(null==a?void 0:a.ok)?(et[n].id=a.contribid,i.email===i.user_uid&&(et[n].user_uid=a.uuid,document.getElementById(i.email).id=a.uuid),e[n]=null):t++}if(t>0)et.splice(t-et.length),em(`${t} contributor/s can't be added`);else{let t=e.filter(e=>null!=e);for(let e=0;e<et.length;e++){let t=ee.findIndex(t=>t.email===et[e].email);t>-1&&(ee[t].role=et[e].role,et.splice(e,1))}ee=ee.concat(et),document.getElementById("contributorinput").value="",et=t}}},em=e=>{eo(),es(ea()),(0,l.default).dynamicModalDialog(e,null,"","Close","Error","bg-danger")},ef=async e=>{if(en.length>0){let n=[...en],i=0;for(let a=0;a<en.length;a++){var t;let o=ee.findIndex(e=>e.email===en[a]),r=null===(t=ee[o])||void 0===t?void 0:t.user_uid,s={contrib_uuid:r,comp_uuid:e},l=await ek("DELETE","/deletecontributor",s);(null==l?void 0:l.ok)?(n[a]=null,ee.splice(o,1),document.getElementById(r).remove()):i++}i>0?(en.splice(i-en.length),em(`${i} contributor/s can't be removed`)):en=n.filter(e=>null!=e)}},eg=e=>{document.getElementById("removeContSwitch"+e.user_uid).addEventListener("change",function(t){let n=t.target;if("INPUT"===n.tagName&&"checkbox"===n.type){if(n.checked)(0,l.default).dynamicModalDialog(`Do you want remove the contributor: ${e.email}?`,"btn-delete-contributor","OK","Cancel","Delete Contributor","bg-warning",()=>{n.checked=!1}),document.getElementById("btn-delete-contributor").onclick=async()=>{let t=et.findIndex(t=>t.email===e.email);t>-1?(et.splice(t,1),-1===ee.findIndex(t=>t.email===e.email)?document.getElementById(e.user_uid).remove():en.push(e.email)):en.push(e.email),(0,l.default).closeDynamicModal(()=>{n.checked=!0})};else{let t=en.indexOf(e.email);t>-1&&en.splice(t,1)}}})},ev=()=>{let e=document.getElementById("contributorsbadgetext");if(e||ee.length){let t=document.getElementById("rolebadgetext");if(e){if(ee.length!==parseInt(e.innerText)){if(ee.length)e.innerText=ee.length;else{let t=e.previousSibling.previousSibling,n=e.previousSibling;t.remove(),n.remove(),e.remove()}}}else if(t){let e=`&nbsp;<span class="badge badge-light">COLLABORATORS:&nbsp;</span><span id="contributorsbadgetext" class="badge badge-dark">${ee.length}</span>`;t.insertAdjacentHTML("afterend",e)}}},ey=e=>{e.user_isadmin&&!e.cloned_from&&(document.getElementById("form-group-marktemplate").hidden=!1),es(e.contributors),el(e.uuid,e.user_id),S(e.title),A(e.description),K(e.privacy),M(e.opentocontrib),z(e.is_template),eE(e),ex(e),eb(),J(),!e.cloned_from&&e.owner?v(null==e?void 0:e.collection_id):document.getElementById("listCollContainerNewColl").innerHTML=e.parent_collection?`<h5><span class="badge badge-secondary">${e.parent_collection}</span></h5>`:"",e.owner?document.getElementById("deleteCompositionFormGroup").hidden=!1:document.getElementById("inputGroupSelectRole").remove(c.UserRole.owner),document.querySelector(`${'#inputGroupSelectRole [value="'+c.UserRole.member+'"]'}`).selected=!0,window.addEventListener("click",function(t){let n=document.getElementById("settingsModal");t.target===n&&ew(e)})},eb=()=>{(0,c.cancelLoader)();let e=document.getElementById("useroptions"),t=document.createElement("li");t.innerHTML=`<li class="nav-item">
    <a class="nav-link" href="#" id="openSettingsButton" data-toggle="modal" data-target="#settingsModal">Composition Info</a>
  </li>
   `,e.appendChild(t)},ek=async(e,t,n)=>{let i=JSON.stringify(n),a=null;try{let n=await fetch(s.ENDPOINT+t,{method:e,headers:{"Content-Type":"application/json",Accept:"application/json"},body:i}),o=await n.json();o&&(a=o)}catch(e){(0,l.default).dynamicModalDialog(e,null,"","Close","Error","bg-danger")}return a},ew=e=>{S(C()||e.title),A(_()||e.description),K(Y()||e.privacy),M(D()||e.opentocontrib),z(H()||e.is_template),eo(),es(ea().length?ea():e.contributors),er(),document.getElementById("deleteComposition").checked=!1},ex=e=>{let t=document.getElementById("cancelsettingsbutton"),n=document.getElementById("closesettingsmodalbutton");t.onclick=()=>{ew(e)},n.onclick=()=>{ew(e)}},eE=async e=>{let t=e.uuid;document.getElementById("updatecompositionbutton").onclick=async n=>{(0,c.startLoader)("Updating Settings..."),!0===document.getElementById("deleteComposition").checked?await eT(t):(await P(t),await R(t),await Z(t),await N(t),await W(e),await ep(),await ef(t),await b(t),ev(),$("#settingsModal").modal("hide")),(0,c.cancelLoader)()}},eT=async e=>{(0,l.default).dynamicModalDialog("Delete "+C()+"?","btn-delete-composition","OK","Cancel","Delete Composition","bg-danger"),document.getElementById("btn-delete-composition").onclick=async()=>{(await ek("DELETE","/deletecomposition/"+e,null)).ok&&(window.location.href=window.location.origin),(0,l.default).closeDynamicModal()}};function eC(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function eS(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),i.forEach(function(t){eC(e,t,n[t])})}return e}var c=o("7hG31"),l=o("lV0Oe");let eP=!1,eI=null,eO=null,e_=null,eA=null,eR=["bit_rate","bits_per_sample","channel_layout","channels","codec_long_name","codec_name","duration","format_long_name","format_name","probe_score","sample_rate","sample_fmt","uploading_date","RMS","size"],eB=document.getElementById("edittrackinfobutton"),eL=document.getElementById("btn-add-new-annot"),eD=document.getElementById("trackinfo-modal-footer"),eM=()=>{e0(),eK(),ej(),eB.addEventListener("click",e2,!1)},eN=async(e,t,n,i)=>{eP=!1,eO=e,e_=n,eB.innerText="Edit",(0,c.startLoader)("Loading track info...");let a=await (0,c.callJsonApi)("/getinfotrack/"+n,"GET");e$(i),"object"==typeof a?(eI=a,eW(a,null)):((0,l.default).dynamicModalDialog("Error getting track info",null,"","Close","Error","bg-danger"),eW(null,t))},e$=e=>{e!==c.UserRole.owner&&e!==c.UserRole.admin?(eB.hidden=!0,eL.hidden=!0,eD.hidden=!0):(eB.hidden=!1,eL.hidden=!1,eD.hidden=!1)},ej=()=>{eL.onclick=()=>{let e=Date.now(),t=document.getElementById("trackinfotablebody"),n=`<tr class="linebreak"><th id='key-edit-${e}' contenteditable='true' scope='row'></th>
        <td contenteditable='true' data-key=''></td>
        <td id='btn-rem-${e}' class='delete-row' data-key=''>&nbsp;<i class="fa fa-trash text-danger"></i></td>
        </tr>`;t.insertAdjacentHTML("beforeend",n),eP||eB.click();let i=document.getElementById("key-edit-"+e);i.addEventListener("input",function(){i.parentNode.children[1].dataset.key=i.innerText,i.parentNode.children[2].dataset.key=i.innerText});let a=document.getElementById("btn-rem-"+e);a.onclick=()=>{eX(a)}}},eG=e=>{let t="";return e.title&&(t+=`<tr><th scope='row'>title</th><td contenteditable='false' data-key='title'>${e.title}</td></tr>`),t},eF=(e,t)=>{let n=[];return t.forEach(t=>{e.some(e=>e.key===t)||n.push(t)}),n},eU=e=>{let t="";for(let n in e)"title"!==e[n]&&(t+=`<tr><th scope='row'>${e[n]}</th><td contenteditable='false' data-key='${e[n]}'></td></tr>`);return t},eV=e=>{let t="";return e.annotations&&(t+=eU(eF(e.annotations,eA))+eq(e.annotations)),t},eH=e=>{let t=`<tr><th scope='row'>track_uuid</th><td data-key='track_uuid'>${e_}</td></tr>`;if(e.file_metadata){let n=e.file_metadata;for(let e of eR)t+=`<tr><th scope='row'>${e}</th><td data-key='${e}'>${n[e]}</td></tr>`}return t},ez=e=>e.reserved_keys?e.reserved_keys:null,eW=async(e,t)=>{(0,c.cancelLoader)();let n=document.getElementById("trackinfotablebody"),i=document.getElementById("metadatatablebody"),a="",o="";e?(document.getElementById("audio-pending-analysis").hidden=null==e?void 0:e.is_audio_processed,eA=ez(e),a+=eG(e)+eV(e),o+=eH(e)):a+=`<tr><th scope='row'>title</th><td data-key='title' class='linebreak'>${t}</td></tr>`,n.innerHTML=a,i.innerHTML=o},eq=e=>{let t="";for(let n in e){let i=e[n];t+=`<tr class="linebreak"><th ${i.custom_added?"contenteditable='false'":""} scope='row'>${i.key}</th>
        <td contenteditable='false' data-key='${i.key}' data-uuid='${i.uuid}'>${i.value}</td>
        <td class='delete-row' data-key='${i.key}' data-uuid='${i.uuid}' hidden>${i.custom_added?'&nbsp;<i class="fa fa-trash text-danger"></i>':""}</td>
        </tr>`}return t},eX=e=>{(0,l.default).dynamicModalDialog("Delete: <b>"+e.dataset.key+"</b> ?","btn-delete-row","Delete","Cancel","Warning","bg-warning"),document.getElementById("btn-delete-row").onclick=()=>{eY(e)}},eY=async e=>{let t=e.dataset.uuid;t?"object"==typeof await (0,c.callJsonApi)("/deleteannotation/"+t,"DELETE")&&e.parentNode.remove():e.parentNode.remove(),(0,l.default).closeDynamicModal()},eJ=()=>{document.getElementById("trackinfotablebody").innerHTML=""},eK=()=>{let e=document.getElementById("canceltrackinfobutton");null==e||e.addEventListener("click",()=>{eJ()})},eZ=e=>{let t=e.getAttribute("data-uuid"),n=e.getAttribute("data-key"),i=e.innerText,a=eI.annotations.find(e=>e.uuid===t),o={};return!t||eA.includes(a.key)||eA.includes(n)||a.key===n||(o.key=n),a.value!==i&&(o.value=i),Object.keys(o).length>0&&(o.uuid=t),o},eQ=()=>{let e={};return e.annotations=[],document.querySelectorAll("td[contenteditable]").forEach(t=>{if(t.getAttribute("data-uuid")){let n=eZ(t);Object.keys(n).length>0&&e.annotations.push(n)}else{let n=t.getAttribute("data-key");"title"===n?eI[n]!==t.innerText&&(e[n]=t.innerText):""===t.innerText&&(""===n||eA.includes(n))||(e.annotations||(e.annotations=[]),e.annotations.push({key:n,value:t.innerText}))}}),e},e0=async()=>{let e=document.getElementById("updatetrackinfobutton");null==e||e.addEventListener("click",async e=>{let t=eQ();if(t.title||t.annotations.length>0){(0,c.startLoader)("Updating track info...");let e={trackid:e_};e1(await (0,c.callJsonApi)("/updatetrackinfo","PATCH",eS({},t,e)),t),(0,c.cancelLoader)()}$("#trackInfoModal").modal("hide")})},e1=(e,t)=>{if("object"==typeof e&&e.ok){if(null==t?void 0:t.title){nL.tracks[eO].name=t.title;let e=document.querySelectorAll(`[data-track-id='${e_}']`);1===e.length&&(e[0].dataset.name=t.title),nL.getEventEmitter().emit("updateview")}}else if((null==e?void 0:e.errors)||"string"==typeof e){let t="";e.errors?e.errors.forEach(e=>{t+=e+". "}):t=e,(0,l.default).dynamicModalDialog("Error updating track info: "+t,null,"","Close","Error","bg-danger")}else(0,l.default).dynamicModalDialog("Unexpected error happened when updating track info",null,"","Close","Error","bg-danger")},e2=()=>{eP?(eP=!1,eB.innerText="Edit",e4()):(eP=!0,eB.innerText="Done",e3())},e3=()=>{document.querySelectorAll("*[contenteditable='false']").forEach(e=>{if(e.contentEditable=!0,e.classList.add("italic"),"TH"===e.tagName){e.addEventListener("input",function(){e.parentNode.children[1].dataset.key=e.innerText});let t=e.parentNode.lastElementChild;t.classList.contains("delete-row")&&(t.hidden=!1,t.onclick=()=>{eX(t)})}})},e4=()=>{document.querySelectorAll("*[contenteditable='true']").forEach(e=>{if(e.contentEditable=!1,e.classList.remove("italic"),"TH"===e.tagName){let t=e.parentNode.lastElementChild;t.classList.contains("delete-row")&&(t.hidden=!0)}})},e6=null,e7=0;function e9(e,t,n,i,a,o,r){this.id=e,this.name=t,this.src=s.ENDPOINT+"/trackfile/"+e,this.muted=n,this.soloed=i,this.gain=a,this.stereoPan=o,this.customClass=r}let e5=(e,t,n)=>{let i=null,a={};fetch(s.ENDPOINT+"/composition/"+e,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}}).then(t=>{if("demopage"!==e)return t.ok||(i=t.statusText),t.json()}).then(t=>{t&&"demopage"!==e&&(a=t)}).catch(e=>{i=e}).then(()=>{i&&(0,l.default).dynamicModalDialog(i,null,"","Close","Error","bg-danger"),t(a,n)})},e8=e=>{(0,c.cancelLoader)(),d?te(d,e):u(e.viewer_id||"null").then(t=>{te(t,e)})},te=(e,t)=>{let n=null;p(e,null==t?void 0:t.uuid).then(e=>{n=e}).catch(e=>{console.log(e)}).finally(()=>{ti(t,n),th(t)})},tt=e=>{let t={};return e.forEach(e=>{t[e.track_id]=e}),t},tn=(e,t,n)=>{let i=!!n&&!!n[null==e?void 0:e.uuid]&&n[e.uuid].muted,a=!!n&&!!n[null==e?void 0:e.uuid]&&n[e.uuid].soloed,o=n&&n[null==e?void 0:e.uuid]?n[e.uuid].gain:1,r=n&&n[null==e?void 0:e.uuid]?n[e.uuid].stereoPan:0,s=e.title,l={name:s,track_id:e.uuid,user_id:e.user_id,user_uid:e.user_uid,composition_id:t.uuid,viewer_id:t.viewer_id||"null"};return new e9(e.uuid,s,i,a,o,r,l)},ti=(e,t)=>{document.getElementById("fileInput").accept=[".mp3",".wav",".m4a",".flac",".aac"];let n=e.owner||c.UserRole.owner<=e.role&&e.role<=c.UserRole.member||!1,i=e.role;e6=e.viewer_id;let a=null;if(e6&&e.is_template&&F(e),(null==t?void 0:t.length)&&(a=tt(t)),n&&(nL.controls.widgets.remove=!1,nR(!0),i===c.UserRole.owner&&(document.getElementById("download-mix-btn").hidden=!1,ey(e))),e.tracks){let t=[];e.tracks.length&&(e7=e.tracks.length,document.getElementById("download-progress-elems").hidden=!1,e.tracks.forEach(n=>{if(n){let i=tn(n,e,a);t.push(i)}})),ta(t,n,i)}else nL.initExporter()},ta=(e,t,n)=>{let i=null;nL.load(e).then(()=>{nL.initExporter()}).catch(e=>{i=e}).then(()=>{i?alert(i):t&&(eM(),nD.detectClickOutsideMenuOpt(),nD.displayOptMenuForTracks(n))})},to=e=>`<span class="badge badge-light">HOLDER:&nbsp;</span>
            <i class="fa fa-user"></i>&nbsp;
            <a id="owner-badge" href="${c.uriUserPage+e.user_id}" class="card-url">${e.username}&nbsp;</a>`,tr=e=>`${e.role?`<span class="badge badge-light">YOUR ROLE:&nbsp;</span>
        <span id="rolebadgetext" class="badge ${e.owner?"badge-holder":c.ROLE_BADGE_STYLE[e.role]}">
         ${e.owner?"Holder":ei[e.role]}
        </span>&nbsp;`:""}`,ts=e=>`${e.contributors.length?`<span class="badge badge-light">COLLABORATORS:&nbsp;</span>
        <span id="contributorsbadgetext" class="badge badge-dark">
        ${e.contributors.length}</span>&nbsp;`:""}`,tl=e=>`${e.opentocontrib?'<span class="badge badge-light">STATUS:&nbsp;</span><span class="badge badge-info">OPEN TO CONTRIB</span>':""}`,tc=e=>{let t=e.description||"";return`<p>
                <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseDescription" aria-expanded="false">
                Description
                </button>
            </p>
            <div class="collapse" id="collapseDescription">
                <div class="card card-body" id="comp-description">
                ${t}
                </div>
            </div>`},td=e=>`<span class="badge badge-light">PRIVACY:&nbsp;</span>
            <span id="privacybadgetext" class="badge 
            ${c.PRIVACY_BADGE_STYLE[e.privacy]}">${c.PRIVACY_BADGE_TEXT[e.privacy]}
            </span>&nbsp;`,tu=(e,t)=>`${e?`<span class="badge badge-light">COLLECTION:&nbsp;</span>
    <i class="fa fa-th-list"></i>&nbsp;
    <a id="collection-badge" href="${c.uriCollectionPage+e}" class="card-url">${t}&nbsp;</a>`:""}`,th=e=>{let t=`<br><h1 class="post-title">${e.error||"Test DAW"}</h1>`;e.title&&(t="<br>"+to(e)+tu(e.collection_id,e.parent_collection)+"<br>"+tr(e)+ts(e)+td(e)+tl(e)+`<p><h2 id="comp-title" class="post-title">${e.title}</h2></p>`+tc(e)),document.getElementById("post-header").insertAdjacentHTML("afterbegin",t)};class tp{displayOptMenuForNewTrack(e){var t,n;let i=e.result,a=(null==i?void 0:null===(t=i.message)||void 0===t?void 0:t.audio)||(null==i?void 0:null===(n=i.message)||void 0===n?void 0:n.voice),o=a.title||i.message.date,r=a.file_unique_id,s=document.getElementsByClassName("controls"),l=0,d=!1;for(;!d&&l<nL.tracks.length;)nL.tracks[l].trackuid===e.trackuid?d=!0:l++;if(d){let e={name:o,track_id:r,user_id:a.user_id,user_uid:a.user_uid,composition_id:a.composition_id};nL.tracks[l].customClass=e,this.createMenuOptButton(s,l,o,r,c.UserRole.owner)}}displayOptMenuForTracks(e){var t;document.querySelectorAll(".menuoptbtn").length&&document.querySelectorAll(".menuoptbtn").forEach(e=>e.remove());let n=document.getElementsByClassName("controls"),i=nL.getInfo().tracks;for(let a=0;a<i.length;a++)if(null===(t=i[a])||void 0===t?void 0:t.customClass){let t=e;e===c.UserRole.member&&i[a].customClass.user_uid===e6&&(t=c.UserRole.owner);let o=i[a].customClass.name,r=i[a].customClass.track_id;this.createMenuOptButton(n,a,o,r,t)}}createMenuOptButton(e,t,n,i,a){let o="menuoptbtn-"+t,r="menuDropdown"+t,s=document.createElement("button"),l=document.createTextNode("...");s.className="menuoptbtn",s.onclick=()=>{document.getElementById(r).classList.toggle("dropdown-show")},s.id=o,s.appendChild(l),e[t].appendChild(s);let c=this.createListMenuOpt(r,t,n,i,a);document.getElementById(o).appendChild(c),e[t].getElementsByClassName("track-header")[0].getElementsByTagName("span")[0].style["margin-left"]="3em"}createListMenuOpt(e,t,n,i,a){let o=document.createElement("ul");if(o.id=e,o.className="dropdown-menu",a===c.UserRole.owner||a===c.UserRole.admin){let e=this.createDeleteMenuOpt(t,n,i),a=this.createDownloadMenuOpt(i);o.appendChild(e),o.appendChild(a)}let r=this.createTrackInfoMenuOpt(t,n,i,a);return o.appendChild(r),o}createDeleteMenuOpt(e,t,n){let i=document.createElement("li");return i.className="dropdown-item btn-light",i.dataset.pos=e,i.dataset.name=t,i.dataset.trackId=n,i.onclick=e=>{this.deleteTrackConfirmDialog(e,this.sendDeleteRequest,this.doAfterDeleted)},i.appendChild(document.createTextNode("Delete")),i}createDownloadMenuOpt(e){let t=document.createElement("li");return t.className="dropdown-item btn-light",t.dataset.trackId=e,t.onclick=t=>{window.open(window.location.protocol+"//"+window.location.host+"/trackfile/"+e,"_blank")},t.appendChild(document.createTextNode("Download")),t}createTrackInfoMenuOpt(e,t,n,i){let a=document.createElement("li");return a.className="dropdown-item btn-light",a.dataset.target="#trackInfoModal",a.dataset.toggle="modal",a.onclick=a=>{eN(e,t,n,i)},a.appendChild(document.createTextNode("Track Info")),a}detectClickOutsideMenuOpt(){window.onclick=function(e){let t=document.getElementsByClassName("dropdown-menu dropdown-show");t.length>0&&"menuoptbtn"!==e.target.className?Array.from(t).forEach(function(e){e.className="dropdown-menu"}):t.length>1&&Array.from(t).forEach(function(t){e.target.contains(t)||(t.className="dropdown-menu")})}}deleteTrackConfirmDialog(e,t,n){(0,l.default).dynamicModalDialog(`Delete <span class="breakword"><i>${e.target.dataset.name}</i></span> ?`,"btn-delete-track","OK","Cancel","Delete Track","bg-danger"),document.getElementById("btn-delete-track").onclick=()=>{t(e.target.dataset.pos,e.target.dataset.trackId,n),(0,l.default).closeDynamicModal()}}sendDeleteRequest(e,t,n){(0,c.startLoader)("Deleting track..."),fetch(s.ENDPOINT+"/deletetrack/"+t,{method:"DELETE"}).then(e=>e.json()).then(t=>{n(t,e)}).catch(e=>{console.log(e),(0,c.cancelLoader)()})}doAfterDeleted(e,t){if((0,c.cancelLoader)(),e.ok){let n=e.role,i=nL.tracks;nL.getEventEmitter().emit("removeTrack",i[t]),new tp().displayOptMenuForTracks(n)}}}var s=o("72lX3"),l=o("lV0Oe");class tm{sendData(e,t,n){let i=this,a=new XMLHttpRequest,o=new FormData,r=t?e.fileName:e.name;o.append("composition_id",this.compositionId),o.append("audio",e,r);let l=`<div id='${"progress-elem-"+n}'>${r}<br><progress id='upload-progress-bar-${n}'></progress>&nbsp;<span id='upload-percentage-${n}'></span><br/></div>`,c=document.getElementById("upload-progress-bar-container");c.innerHTML+=l,a.addEventListener("load",e=>{if(e.target&&e.target.response){let t=JSON.parse(e.target.response);fileInput.value="",t.ok?(t.trackuid=n,nD.displayOptMenuForNewTrack(t)):i.displayModalDialog(t.error)}else i.displayModalDialog("Oops! Something went wrong.")}),a.addEventListener("error",e=>{i.displayModalDialog("Problem sending file")}),a.upload.addEventListener("progress",e=>{let t=document.getElementById("progress-elem-"+n),i=document.getElementById("upload-progress-bar-"+n),a=document.getElementById("upload-percentage-"+n);e.lengthComputable&&(i.value=e.loaded/e.total,a.innerText=(e.loaded/e.total*100).toFixed(2)+"%",1===i.value&&t.remove())}),a.open("POST",s.UPLOAD_ENDPOINT),a.send(o)}displayModalDialog(e){(0,l.default).dynamicModalDialog(e,null,"","Close","Error","bg-danger")}constructor(e,t){this.compositionId=e,this.trackhandler=t}}var tf={};tf=(()=>{var e={6824:e=>{var t,n,i;/*!
 * Cross-Browser Split 1.1.1
 * Copyright 2007-2012 Steven Levithan <stevenlevithan.com>
 * Available under the MIT License
 * ECMAScript compliant, uniform cross-browser split method
 */e.exports=(n=String.prototype.split,i=/()??/.exec("")[1]===t,function(e,a,o){if("[object RegExp]"!==Object.prototype.toString.call(a))return n.call(e,a,o);var r,s,l,c,d=[],u=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.extended?"x":"")+(a.sticky?"y":""),h=0,a=RegExp(a.source,u+"g");for(e+="",i||(r=RegExp("^"+a.source+"$(?!\\s)",u)),o=o===t?4294967295:o>>>0;(s=a.exec(e))&&(!((l=s.index+s[0].length)>h)||(d.push(e.slice(h,s.index)),!i&&s.length>1&&s[0].replace(r,function(){for(var e=1;e<arguments.length-2;e++)arguments[e]===t&&(s[e]=t)}),s.length>1&&s.index<e.length&&Array.prototype.push.apply(d,s.slice(1)),c=s[0].length,h=l,!(d.length>=o)));)a.lastIndex===s.index&&a.lastIndex++;return h===e.length?(c||!a.test(""))&&d.push(""):d.push(e.slice(h)),d.length>o?d.slice(0,o):d})},1804:(e,t,n)=>{var i=n(5618),a=n(7205),o=n(7191),r=n(5516),s=n(9981);(e.exports=function(e,t){var n,a,l,c,d;return arguments.length<2||"string"!=typeof e?(c=t,t=e,e=null):c=arguments[2],i(e)?(n=s.call(e,"c"),a=s.call(e,"e"),l=s.call(e,"w")):(n=l=!0,a=!1),d={value:t,configurable:n,enumerable:a,writable:l},c?o(r(c),d):d}).gs=function(e,t,n){var l,c,d,u;return"string"!=typeof e?(d=n,n=t,t=e,e=null):d=arguments[3],i(t)?a(t)?i(n)?a(n)||(d=n,n=void 0):n=void 0:(d=t,t=n=void 0):t=void 0,i(e)?(l=s.call(e,"c"),c=s.call(e,"e")):(l=!0,c=!1),u={get:t,set:n,configurable:l,enumerable:c},d?o(r(d),u):u}},430:e=>{e.exports=function(){}},7191:(e,t,n)=>{e.exports=n(6560)()?Object.assign:n(7346)},6560:e=>{e.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},7346:(e,t,n)=>{var i=n(5103),a=n(2745),o=Math.max;e.exports=function(e,t){var n,r,s,l=o(arguments.length,2);for(r=1,e=Object(a(e)),s=function(i){try{e[i]=t[i]}catch(e){n||(n=e)}};r<l;++r)t=arguments[r],i(t).forEach(s);if(void 0!==n)throw n;return e}},6914:(e,t,n)=>{var i=n(430)();e.exports=function(e){return e!==i&&null!==e}},5103:(e,t,n)=>{e.exports=n(7446)()?Object.keys:n(6137)},7446:e=>{e.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},6137:(e,t,n)=>{var i=n(6914),a=Object.keys;e.exports=function(e){return a(i(e)?Object(e):e)}},5516:(e,t,n)=>{var i=n(6914),a=Array.prototype.forEach,o=Object.create,r=function(e,t){var n;for(n in e)t[n]=e[n]};e.exports=function(e){var t=o(null);return a.call(arguments,function(e){i(e)&&r(Object(e),t)}),t}},1290:e=>{e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function");return e}},2745:(e,t,n)=>{var i=n(6914);e.exports=function(e){if(!i(e))throw TypeError("Cannot use null or undefined");return e}},9981:(e,t,n)=>{e.exports=n(3591)()?String.prototype.contains:n(6042)},3591:e=>{var t="razdwatrzy";e.exports=function(){return"function"==typeof t.contains&&!0===t.contains("dwa")&&!1===t.contains("foo")}},6042:e=>{var t=String.prototype.indexOf;e.exports=function(e){return t.call(this,e,arguments[1])>-1}},8832:(e,t,n)=>{n(4167)("ev-store","7");var i="__EV_STORE_KEY@7";e.exports=function(e){var t=e[i];return t||(t=e[i]={}),t}},8370:(e,t,n)=>{var i,a,o,r,s,l,c,d=n(1804),u=n(1290),h=Function.prototype.apply,p=Function.prototype.call,m=Object.create,f=Object.defineProperty,g=Object.defineProperties,v=Object.prototype.hasOwnProperty,y={configurable:!0,enumerable:!1,writable:!0};i=function(e,t){var n;return u(t),v.call(this,"__ee__")?n=this.__ee__:(n=y.value=m(null),f(this,"__ee__",y),y.value=null),n[e]?"object"==typeof n[e]?n[e].push(t):n[e]=[n[e],t]:n[e]=t,this},a=function(e,t){var n,a;return u(t),a=this,i.call(this,e,n=function(){o.call(a,e,n),h.call(t,this,arguments)}),n.__eeOnceListener__=t,this},s={on:i,once:a,off:o=function(e,t){var n,i,a,o;if(u(t),!v.call(this,"__ee__")||!(n=this.__ee__)[e])return this;if("object"==typeof(i=n[e]))for(o=0;a=i[o];++o)(a===t||a.__eeOnceListener__===t)&&(2===i.length?n[e]=i[o?0:1]:i.splice(o,1));else(i===t||i.__eeOnceListener__===t)&&delete n[e];return this},emit:r=function(e){var t,n,i,a,o;if(v.call(this,"__ee__")&&(a=this.__ee__[e])){if("object"==typeof a){for(t=1,n=arguments.length,o=Array(n-1);t<n;++t)o[t-1]=arguments[t];for(t=0,a=a.slice();i=a[t];++t)h.call(i,this,o)}else switch(arguments.length){case 1:p.call(a,this);break;case 2:p.call(a,this,arguments[1]);break;case 3:p.call(a,this,arguments[1],arguments[2]);break;default:for(t=1,n=arguments.length,o=Array(n-1);t<n;++t)o[t-1]=arguments[t];h.call(a,this,o)}}}},c=g({},l={on:d(i),once:d(a),off:d(o),emit:d(r)}),e.exports=t=function(e){return null==e?m(c):g(Object(e),l)},t.methods=s},6226:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.linear=function(e,t){var n,i,a=new Float32Array(e),o=e-1;for(n=0;n<e;n++)i=n/o,t>0?a[n]=i:a[n]=1-i;return a},t.exponential=function(e,t){var n,i,a=new Float32Array(e),o=e-1;for(n=0;n<e;n++)i=n/o,a[t>0?n:e-1-n]=Math.exp(2*i-1)/Math.exp(1);return a},t.sCurve=function(e,t){var n,i=new Float32Array(e),a=t>0?Math.PI/2:-(Math.PI/2);for(n=0;n<e;++n)i[n]=Math.sin(Math.PI*n/e-a)/2+.5;return i},t.logarithmic=function(e,t,n){var i,a,o=new Float32Array(e),r=0;for(a=0;a<e;a++)i=n>0?a:e-1-a,r=a/e,o[i]=Math.log(1+t*r)/Math.log(1+t);return o}},1114:(e,t,n)=>{t.h7=t.Y1=t.Hp=t.Jl=t.t$=t._h=void 0,t.L7=function(e,t,n,i){switch(t){case a:l.call(e,n,i);break;case o:d.call(e,n,i);break;case r:h.call(e,n,i);break;case s:m.call(e,n,i);break;default:throw Error("Unsupported Fade type")}},t.Mt=function(e,t,n,i){switch(t){case a:c.call(e,n,i);break;case o:u.call(e,n,i);break;case r:p.call(e,n,i);break;case s:f.call(e,n,i);break;default:throw Error("Unsupported Fade type")}};var i=n(6226),a=t._h="sCurve",o=t.t$="linear",r=t.Jl="exponential",s=t.Hp="logarithmic";function l(e,t){var n=(0,i.sCurve)(1e4,1);this.setValueCurveAtTime(n,e,t)}function c(e,t){var n=(0,i.sCurve)(1e4,-1);this.setValueCurveAtTime(n,e,t)}function d(e,t){this.linearRampToValueAtTime(0,e),this.linearRampToValueAtTime(1,e+t)}function u(e,t){this.linearRampToValueAtTime(1,e),this.linearRampToValueAtTime(0,e+t)}function h(e,t){this.exponentialRampToValueAtTime(.01,e),this.exponentialRampToValueAtTime(1,e+t)}function p(e,t){this.exponentialRampToValueAtTime(1,e),this.exponentialRampToValueAtTime(.01,e+t)}function m(e,t){var n=(0,i.logarithmic)(1e4,10,1);this.setValueCurveAtTime(n,e,t)}function f(e,t){var n=(0,i.logarithmic)(1e4,10,-1);this.setValueCurveAtTime(n,e,t)}t.Y1="FadeIn",t.h7="FadeOut"},9144:(e,t,n)=>{var i,a=void 0!==n.g?n.g:"undefined"!=typeof window?window:{},o=n(5893);"undefined"!=typeof document?i=document:(i=a["__GLOBAL_DOCUMENT_CACHE@4"])||(i=a["__GLOBAL_DOCUMENT_CACHE@4"]=o),e.exports=i},8070:(e,t,n)=>{var i="undefined"!=typeof window?window:void 0!==n.g?n.g:{};e.exports=function(e,t){return e in i?i[e]:(i[e]=t,t)}},4167:(e,t,n)=>{var i=n(8070);e.exports=function(e,t,n){var a="__INDIVIDUAL_ONE_VERSION_"+e,o=i(a+"_ENFORCE_SINGLETON",t);if(o!==t)throw Error("Can only have one copy of "+e+".\nYou already have version "+o+" installed.\nThis means you cannot install version "+t);return i(a,n)}},849:(e,t,n)=>{var i=!!(n.g===n.g.window&&n.g.URL&&n.g.Blob&&n.g.Worker);function a(e,t){var a,o=this;if(t=t||{},i)return a=e.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],new n.g.Worker(n.g.URL.createObjectURL(new n.g.Blob([a],{type:"text/javascript"})));this.self=t,this.self.postMessage=function(e){setTimeout(function(){o.onmessage({data:e})},0)},setTimeout(e.bind(t,t),0)}a.prototype.postMessage=function(e){var t=this;setTimeout(function(){t.self.onmessage({data:e})},0)},e.exports=a},6240:e=>{e.exports=function(e){return"object"==typeof e&&null!==e}},1730:e=>{var t,n,i,a,o,r=/^(?:0|[1-9]\d*)$/,s=Object.prototype,l=s.hasOwnProperty,c=s.toString,d=s.propertyIsEnumerable,u=(t=Object.keys,n=Object,function(e){return t(n(e))}),h=Math.max,p=!d.call({valueOf:1},"valueOf");function m(e,t,n){var i=e[t];l.call(e,t)&&v(i,n)&&(void 0!==n||t in e)||(e[t]=n)}function f(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||r.test(e))&&e>-1&&e%1==0&&e<t}function g(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||s)}function v(e,t){return e===t||e!=e&&t!=t}var y=Array.isArray;function b(e){var t,n;return null!=e&&"number"==typeof(t=e.length)&&t>-1&&t%1==0&&t<=9007199254740991&&!("[object Function]"==(n=k(e)?c.call(e):"")||"[object GeneratorFunction]"==n)}function k(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}var w=(i=function(e,t){if(p||g(t)||b(t)){!function(e,t,n,i){n||(n={});for(var a=-1,o=t.length;++a<o;){var r=t[a],s=void 0;m(n,r,void 0===s?e[r]:s)}}(t,b(t)?function(e,t){var n=y(e)||e&&"object"==typeof e&&b(e)&&l.call(e,"callee")&&(!d.call(e,"callee")||"[object Arguments]"==c.call(e))?function(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}(e.length,String):[],i=n.length,a=!!i;for(var o in e)l.call(e,o)&&!(a&&("length"==o||f(o,i)))&&n.push(o);return n}(t):function(e){if(!g(e))return u(e);var t=[];for(var n in Object(e))l.call(e,n)&&"constructor"!=n&&t.push(n);return t}(t),e);return}for(var n in t)l.call(t,n)&&m(e,n,t[n])},a=function(e,t){var n=-1,a=t.length,o=a>1?t[a-1]:void 0,r=a>2?t[2]:void 0;for(o=i.length>3&&"function"==typeof o?(a--,o):void 0,r&&function(e,t,n){if(!k(n))return!1;var i=typeof t;return("number"==i?!!(b(n)&&f(t,n.length)):"string"==i&&(t in n))&&v(n[t],e)}(t[0],t[1],r)&&(o=a<3?void 0:o,a=1),e=Object(e);++n<a;){var s=t[n];s&&i(e,s,n,o)}return e},o=h(void 0===o?a.length-1:o,0),function(){for(var e=arguments,t=-1,n=h(e.length-o,0),i=Array(n);++t<n;)i[t]=e[o+t];t=-1;for(var r=Array(o+1);++t<o;)r[t]=e[t];return r[o]=i,function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}(a,this,r)});e.exports=w},2098:(e,t,n)=>{e=n.nmd(e);var i,a,o,r,s,l,c,d="__lodash_hash_undefined__",u="[object Arguments]",h="[object Function]",p="[object Object]",m=/^\[object .+?Constructor\]$/,f=/^(?:0|[1-9]\d*)$/,g={};g["[object Float32Array]"]=g["[object Float64Array]"]=g["[object Int8Array]"]=g["[object Int16Array]"]=g["[object Int32Array]"]=g["[object Uint8Array]"]=g["[object Uint8ClampedArray]"]=g["[object Uint16Array]"]=g["[object Uint32Array]"]=!0,g[u]=g["[object Array]"]=g["[object ArrayBuffer]"]=g["[object Boolean]"]=g["[object DataView]"]=g["[object Date]"]=g["[object Error]"]=g[h]=g["[object Map]"]=g["[object Number]"]=g[p]=g["[object RegExp]"]=g["[object Set]"]=g["[object String]"]=g["[object WeakMap]"]=!1;var v="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,y="object"==typeof self&&self&&self.Object===Object&&self,b=v||y||Function("return this")(),k=t&&!t.nodeType&&t,w=k&&e&&!e.nodeType&&e,x=w&&w.exports===k,E=x&&v.process,T=function(){try{var e=w&&w.require&&w.require("util").types;if(e)return e;return E&&E.binding&&E.binding("util")}catch(e){}}(),C=T&&T.isTypedArray;function S(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}var P=Array.prototype,I=Function.prototype,O=Object.prototype,_=b["__core-js_shared__"],A=I.toString,R=O.hasOwnProperty,B=(r=/[^.]+$/.exec(_&&_.keys&&_.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"",L=O.toString,D=A.call(Object),M=RegExp("^"+A.call(R).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),N=x?b.Buffer:void 0,j=b.Symbol,G=b.Uint8Array,F=N?N.allocUnsafe:void 0,U=(s=Object.getPrototypeOf,l=Object,function(e){return s(l(e))}),V=Object.create,H=O.propertyIsEnumerable,z=P.splice,W=j?j.toStringTag:void 0,q=function(){try{var e=em(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),X=N?N.isBuffer:void 0,Y=Math.max,J=Date.now,K=em(b,"Map"),Z=em(Object,"create"),Q=function(){function e(){}return function(t){if(!eS(t))return{};if(V)return V(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function ee(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function et(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function en(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function ei(e){var t=this.__data__=new et(e);this.size=t.size}function ea(e,t,n){(void 0===n||eb(e[t],n))&&(void 0!==n||t in e)||er(e,t,n)}function eo(e,t){for(var n=e.length;n--;)if(eb(e[n][0],t))return n;return -1}function er(e,t,n){"__proto__"==t&&q?q(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}ee.prototype.clear=function(){this.__data__=Z?Z(null):{},this.size=0},ee.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},ee.prototype.get=function(e){var t=this.__data__;if(Z){var n=t[e];return n===d?void 0:n}return R.call(t,e)?t[e]:void 0},ee.prototype.has=function(e){var t=this.__data__;return Z?void 0!==t[e]:R.call(t,e)},ee.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Z&&void 0===t?d:t,this},et.prototype.clear=function(){this.__data__=[],this.size=0},et.prototype.delete=function(e){var t=this.__data__,n=eo(t,e);return!(n<0)&&(n==t.length-1?t.pop():z.call(t,n,1),--this.size,!0)},et.prototype.get=function(e){var t=this.__data__,n=eo(t,e);return n<0?void 0:t[n][1]},et.prototype.has=function(e){return eo(this.__data__,e)>-1},et.prototype.set=function(e,t){var n=this.__data__,i=eo(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this},en.prototype.clear=function(){this.size=0,this.__data__={hash:new ee,map:new(K||et),string:new ee}},en.prototype.delete=function(e){var t=ep(this,e).delete(e);return this.size-=t?1:0,t},en.prototype.get=function(e){return ep(this,e).get(e)},en.prototype.has=function(e){return ep(this,e).has(e)},en.prototype.set=function(e,t){var n=ep(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this},ei.prototype.clear=function(){this.__data__=new et,this.size=0},ei.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},ei.prototype.get=function(e){return this.__data__.get(e)},ei.prototype.has=function(e){return this.__data__.has(e)},ei.prototype.set=function(e,t){var n=this.__data__;if(n instanceof et){var i=n.__data__;if(!K||i.length<199)return i.push([e,t]),this.size=++n.size,this;n=this.__data__=new en(i)}return n.set(e,t),this.size=n.size,this};var es=function(e,t,n){for(var i=-1,a=Object(e),o=n(e),r=o.length;r--;){var s=o[++i];if(!1===t(a[s],s,a))break}return e};function el(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":W&&W in Object(e)?function(e){var t=R.call(e,W),n=e[W];try{e[W]=void 0;var i=!0}catch(e){}var a=L.call(e);return i&&(t?e[W]=n:delete e[W]),a}(e):L.call(e)}function ec(e){return eP(e)&&el(e)==u}function ed(e,t,n,i,a){e!==t&&es(t,function(o,r){if(a||(a=new ei),eS(o))!function(e,t,n,i,a,o,r){var s=ev(e,n),l=ev(t,n),c=r.get(l);if(c){ea(e,n,c);return}var d=o?o(s,l,n+"",e,t,r):void 0,u=void 0===d;if(u){var h,m,f,g=ew(l),v=!g&&eE(l),y=!g&&!v&&eI(l);d=l,g||v||y?ew(s)?d=s:eP(s)&&ex(s)?d=function(e,t){var n=-1,i=e.length;for(t||(t=Array(i));++n<i;)t[n]=e[n];return t}(s):v?(u=!1,d=function(e,t){if(t)return e.slice();var n=e.length,i=F?F(n):new e.constructor(n);return e.copy(i),i}(l,!0)):y?(u=!1,new G(m=new(h=l.buffer).constructor(h.byteLength)).set(new G(h)),f=m,d=new l.constructor(f,l.byteOffset,l.length)):d=[]:function(e){if(!eP(e)||el(e)!=p)return!1;var t=U(e);if(null===t)return!0;var n=R.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&A.call(n)==D}(l)||ek(l)?(d=s,ek(s)?d=function(e,t,n,i){var a=!n;n||(n={});for(var o=-1,r=t.length;++o<r;){var s=t[o],l=void 0;void 0===l&&(l=e[s]),a?er(n,s,l):function(e,t,n){var i=e[t];R.call(e,t)&&eb(i,n)&&(void 0!==n||t in e)||er(e,t,n)}(n,s,l)}return n}(s,e_(s)):(!eS(s)||eT(s))&&(d="function"!=typeof l.constructor||eg(l)?{}:Q(U(l)))):u=!1}u&&(r.set(l,d),a(d,l,i,o,r),r.delete(l)),ea(e,n,d)}(e,t,r,n,ed,i,a);else{var s=i?i(ev(e,r),o,r+"",e,t,a):void 0;void 0===s&&(s=o),ea(e,r,s)}},e_)}function eu(e,t){var n,i;return ey((n=t,i=eR,n=Y(void 0===n?e.length-1:n,0),function(){for(var t=arguments,a=-1,o=Y(t.length-n,0),r=Array(o);++a<o;)r[a]=t[n+a];a=-1;for(var s=Array(n+1);++a<n;)s[a]=t[a];return s[n]=i(r),S(e,this,s)}),e+"")}function eh(e,t,n,i,a,o){return eS(e)&&eS(t)&&(o.set(t,e),ed(e,t,void 0,eh,o),o.delete(t)),e}function ep(e,t){var n,i=e.__data__;return("string"==(n=typeof t)||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t)?i["string"==typeof t?"string":"hash"]:i.map}function em(e,t){var n=null==e?void 0:e[t];return!(!eS(n)||B&&B in n)&&(eT(n)?M:m).test(function(e){if(null!=e){try{return A.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(n))?n:void 0}function ef(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&f.test(e))&&e>-1&&e%1==0&&e<t}function eg(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||O)}function ev(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var ey=(i=q?function(e,t){return q(e,"toString",{configurable:!0,enumerable:!1,value:function(){return t},writable:!0})}:eR,a=0,o=0,function(){var e=J(),t=16-(e-o);if(o=e,t>0){if(++a>=800)return arguments[0]}else a=0;return i.apply(void 0,arguments)});function eb(e,t){return e===t||e!=e&&t!=t}var ek=ec(function(){return arguments}())?ec:function(e){return eP(e)&&R.call(e,"callee")&&!H.call(e,"callee")},ew=Array.isArray;function ex(e){return null!=e&&eC(e.length)&&!eT(e)}var eE=X||function(){return!1};function eT(e){if(!eS(e))return!1;var t=el(e);return t==h||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function eC(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function eS(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function eP(e){return null!=e&&"object"==typeof e}var eI=C?function(e){return C(e)}:function(e){return eP(e)&&eC(e.length)&&!!g[el(e)]},eO=eu(function(e){return e.push(void 0,eh),S(eA,void 0,e)});function e_(e){return ex(e)?function(e,t){var n=ew(e),i=!n&&ek(e),a=!n&&!i&&eE(e),o=!n&&!i&&!a&&eI(e),r=n||i||a||o,s=r?function(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}(e.length,String):[],l=s.length;for(var c in e)(t||R.call(e,c))&&!(r&&("length"==c||a&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||ef(c,l)))&&s.push(c);return s}(e,!0):function(e){if(!eS(e))return function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}(e);var t=eg(e),n=[];for(var i in e)"constructor"==i&&(t||!R.call(e,i))||n.push(i);return n}(e)}var eA=(c=function(e,t,n,i){ed(e,t,n,i)},eu(function(e,t){var n=-1,i=t.length,a=i>1?t[i-1]:void 0,o=i>2?t[2]:void 0;for(a=c.length>3&&"function"==typeof a?(i--,a):void 0,o&&function(e,t,n){if(!eS(n))return!1;var i=typeof t;return("number"==i?!!(ex(n)&&ef(t,n.length)):"string"==i&&(t in n))&&eb(n[t],e)}(t[0],t[1],o)&&(a=i<3?void 0:a,i=1),e=Object(e);++n<i;){var r=t[n];r&&c(e,r,n,a)}return e}));function eR(e){return e}e.exports=eO},3520:e=>{var t,n,i=/^(?:0|[1-9]\d*)$/,a=Object.prototype,o=a.hasOwnProperty,r=a.toString,s=a.propertyIsEnumerable,l=(t=Object.keys,n=Object,function(e){return t(n(e))}),c=function(e,t,n){for(var i=-1,a=Object(e),o=n(e),r=o.length;r--;){var s=o[++i];if(!1===t(a[s],s,a))break}return e},d=Array.isArray;function u(e){var t,n,i;return null!=e&&"number"==typeof(t=e.length)&&t>-1&&t%1==0&&t<=9007199254740991&&!("[object Function]"==(n=typeof e,i=e&&("object"==n||"function"==n)?r.call(e):"")||"[object GeneratorFunction]"==i)}function h(e){return u(e)?function(e,t){var n,a=d(e)||e&&"object"==typeof e&&u(e)&&o.call(e,"callee")&&(!s.call(e,"callee")||"[object Arguments]"==r.call(e))?function(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}(e.length,String):[],l=a.length,c=!!l;for(var h in e)o.call(e,h)&&!(c&&("length"==h||(n=null==(n=l)?9007199254740991:n)&&("number"==typeof h||i.test(h))&&h>-1&&h%1==0&&h<n))&&a.push(h);return a}(e):function(e){if(t=e&&e.constructor,e!==("function"==typeof t&&t.prototype||a))return l(e);var t,n=[];for(var i in Object(e))o.call(e,i)&&"constructor"!=i&&n.push(i);return n}(e)}function p(e){return e}e.exports=function(e,t){var n;return e&&(n="function"==typeof t?t:p,e&&c(e,n,h))}},372:(e,t,n)=>{var i=n(6060);e.exports=function(e){if("function"!=typeof e||!hasOwnProperty.call(e,"length"))return!1;try{if("number"!=typeof e.length||"function"!=typeof e.call||"function"!=typeof e.apply)return!1}catch(e){return!1}return!i(e)}},3940:(e,t,n)=>{var i=n(5618),a={object:!0,function:!0,undefined:!0};e.exports=function(e){return!!i(e)&&hasOwnProperty.call(a,typeof e)}},7205:(e,t,n)=>{var i=n(372),a=/^\s*class[\s{/}]/,o=Function.prototype.toString;e.exports=function(e){return!(!i(e)||a.test(o.call(e)))}},6060:(e,t,n)=>{var i=n(3940);e.exports=function(e){if(!i(e))return!1;try{if(!e.constructor)return!1;return e.constructor.prototype===e}catch(e){return!1}}},5618:e=>{var t=void 0;e.exports=function(e){return e!==t&&null!==e}},4935:(e,t,n)=>{var i=n(3513);e.exports=i},7921:(e,t,n)=>{var i=n(3072);e.exports=i},347:(e,t,n)=>{var i=n(8744);e.exports=i},9720:(e,t,n)=>{var i=n(6943);e.exports=i},6672:(e,t,n)=>{var i=n(6240),a=n(7265);function o(e,t,n,i){if(i){var o=i[t];if(a(o))o.unhook&&o.unhook(e,t,n);else if("attributes"===t)for(var r in o)e.removeAttribute(r);else if("style"===t)for(var s in o)e.style[s]="";else"string"==typeof o?e[t]="":e[t]=null}}function r(e){return Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__?e.__proto__:e.constructor?e.constructor.prototype:void 0}e.exports=function(e,t,n){for(var s in t){var l=t[s];void 0===l?o(e,s,l,n):a(l)?(o(e,s,l,n),l.hook&&l.hook(e,s,n?n[s]:void 0)):i(l)?function(e,t,n,a,o){var s=n?n[a]:void 0;if("attributes"===a){for(var l in o){var c=o[l];void 0===c?e.removeAttribute(l):e.setAttribute(l,c)}return}if(s&&i(s)&&r(s)!==r(o)){e[a]=o;return}i(e[a])||(e[a]={});var d="style"===a?"":void 0;for(var u in o){var h=o[u];e[a][u]=void 0===h?d:h}}(e,0,n,s,l):e[s]=l}}},3513:(e,t,n)=>{var i=n(9144),a=n(6672),o=n(5170),r=n(6221),s=n(4097),l=n(6078);e.exports=function e(t,n){var c=n&&n.document||i,d=n?n.warn:null;if(s(t=l(t).a))return t.init();if(r(t))return c.createTextNode(t.text);if(!o(t))return d&&d("Item is not a valid virtual dom node",t),null;var u=null===t.namespace?c.createElement(t.tagName):c.createElementNS(t.namespace,t.tagName);a(u,t.properties);for(var h=t.children,p=0;p<h.length;p++){var m=e(h[p],n);m&&u.appendChild(m)}return u}},8992:e=>{var t={};function n(e,t,n){if(0===e.length)return!1;for(var i,a,o=0,r=e.length-1;o<=r;){if(a=e[i=(r+o)/2>>0],o===r)return a>=t&&a<=n;if(a<t)o=i+1;else{if(!(a>n))return!0;r=i-1}}return!1}function i(e,t){return e>t?1:-1}e.exports=function(e,a,o,r){return o&&0!==o.length?(o.sort(i),function e(i,a,o,r,s){if(r=r||{},i){n(o,s,s)&&(r[s]=i);var l=a.children;if(l)for(var c=i.childNodes,d=0;d<a.children.length;d++){s+=1;var u=l[d]||t,h=s+(u.count||0);n(o,s,h)&&e(c[d],u,o,r,s),s=h}}return r}(e,a,o,r,0)):{}}},9120:(e,t,n)=>{var i=n(6672),a=n(4097),o=n(8057),r=n(6670);function s(e,t){"function"==typeof t.destroy&&a(t)&&t.destroy(e)}e.exports=function(e,t,n){var a,l,c,d,u,h,p,m,f=e.type,g=e.vNode,v=e.patch;switch(f){case o.REMOVE:return(a=t.parentNode)&&a.removeChild(t),s(t,g),null;case o.INSERT:return l=n.render(v,n),t&&t.appendChild(l),t;case o.VTEXT:return function(e,t,n,i){var a;if(3===e.nodeType)e.replaceData(0,e.length,n.text),a=e;else{var o=e.parentNode;a=i.render(n,i),o&&a!==e&&o.replaceChild(a,e)}return a}(t,0,v,n);case o.WIDGET:return c=(d=r(g,v))?v.update(g,t)||t:n.render(v,n),(u=t.parentNode)&&c!==t&&u.replaceChild(c,t),d||s(t,g),c;case o.VNODE:return h=t.parentNode,p=n.render(v,n),h&&p!==t&&h.replaceChild(p,t),p;case o.ORDER:return function(e,t){for(var n,i,a,o=e.childNodes,r={},s=0;s<t.removes.length;s++)n=o[(i=t.removes[s]).from],i.key&&(r[i.key]=n),e.removeChild(n);for(var l=o.length,c=0;c<t.inserts.length;c++)n=r[(a=t.inserts[c]).key],e.insertBefore(n,a.to>=l++?null:o[a.to])}(t,v),t;case o.PROPS:return i(t,v,g.properties),t;case o.THUNK:return m=n.patch(t,v,n),t&&m&&t!==m&&t.parentNode&&t.parentNode.replaceChild(m,t),m;default:return t}}},6943:(e,t,n)=>{var i=n(9144),a=n(7362),o=n(3513),r=n(8992),s=n(9120);function l(e,t,n){var o=function(e){var t=[];for(var n in e)"a"!==n&&t.push(Number(n));return t}(t);if(0===o.length)return e;var l=r(e,t.a,o),c=e.ownerDocument;n.document||c===i||(n.document=c);for(var d=0;d<o.length;d++){var u=o[d];e=function(e,t,n,i){if(!t)return e;if(a(n))for(var o,r=0;r<n.length;r++)o=s(n[r],t,i),t===e&&(e=o);else o=s(n,t,i),t===e&&(e=o);return e}(e,l[u],t[u],n)}return e}e.exports=function e(t,n,i){return(i=i||{}).patch=i.patch&&i.patch!==e?i.patch:l,i.render=i.render||o,i.patch(t,n,i)}},6670:(e,t,n)=>{var i=n(4097);e.exports=function(e,t){return!!(i(e)&&i(t))&&("name"in e&&"name"in t?e.id===t.id:e.init===t.init)}},6505:(e,t,n)=>{var i=n(8832);function a(e){if(!(this instanceof a))return new a(e);this.value=e}e.exports=a,a.prototype.hook=function(e,t){i(e)[t.substr(3)]=this.value},a.prototype.unhook=function(e,t){i(e)[t.substr(3)]=void 0}},7199:e=>{function t(e){if(!(this instanceof t))return new t(e);this.value=e}e.exports=t,t.prototype.hook=function(e,t){e[t]!==this.value&&(e[t]=this.value)}},8744:(e,t,n)=>{var i=n(7362),a=n(4282),o=n(4268),r=n(5170),s=n(6221),l=n(4097),c=n(7265),d=n(6741),u=n(1948),h=n(7199),p=n(6505);function m(e){return r(e)||s(e)||l(e)||d(e)}function f(e){try{return JSON.stringify(e,null,"    ")}catch(t){return String(e)}}e.exports=function(e,t,n){var r,s,l,d,g=[];return!n&&("string"==typeof t||i(t)||m(t))&&(n=t,s={}),r=u(e,s=s||t||{}),s.hasOwnProperty("key")&&(l=s.key,s.key=void 0),s.hasOwnProperty("namespace")&&(d=s.namespace,s.namespace=void 0),"INPUT"===r&&!d&&s.hasOwnProperty("value")&&void 0!==s.value&&!c(s.value)&&(s.value=h(s.value)),function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];if(c(n))continue;"ev-"===t.substr(0,3)&&(e[t]=p(n))}}(s),null!=n&&function e(t,n,a,r){if("string"==typeof t)n.push(new o(t));else if("number"==typeof t)n.push(new o(String(t)));else if(m(t))n.push(t);else if(i(t))for(var s,l,c=0;c<t.length;c++)e(t[c],n,a,r);else{if(null==t)return;throw s={foreignObject:t,parentVnode:{tagName:a,properties:r}},(l=Error()).type="virtual-hyperscript.unexpected.virtual-element",l.message="Unexpected virtual child passed to h().\nExpected a VNode / Vthunk / VWidget / string but:\ngot:\n"+f(s.foreignObject)+".\nThe parent vnode is:\n"+f(s.parentVnode),l.foreignObject=s.foreignObject,l.parentVnode=s.parentVnode,l}}(n,g,r,s),new a(r,s,g,l,d)}},1948:(e,t,n)=>{var i=n(6824),a=/([\.#]?[a-zA-Z0-9\u007F-\uFFFF_:-]+)/,o=/^\.|#/;e.exports=function(e,t){if(!e)return"DIV";var n,r,s,l,c=!t.hasOwnProperty("id"),d=i(e,a),u=null;for(o.test(d[1])&&(u="DIV"),l=0;l<d.length;l++)(r=d[l])&&(s=r.charAt(0),u?"."===s?(n=n||[]).push(r.substring(1,r.length)):"#"===s&&c&&(t.id=r.substring(1,r.length)):u=r);return n&&(t.className&&n.push(t.className),t.className=n.join(" ")),t.namespace?u:u.toUpperCase()}},6078:(e,t,n)=>{var i=n(5170),a=n(6221),o=n(4097),r=n(6741);function s(e,t){var n=e.vnode;if(n||(n=e.vnode=e.render(t)),!(i(n)||a(n)||o(n)))throw Error("thunk did not return a valid node");return n}e.exports=function(e,t){var n=e,i=t;return r(t)&&(i=s(t,e)),r(e)&&(n=s(e,null)),{a:n,b:i}}},6741:e=>{e.exports=function(e){return e&&"Thunk"===e.type}},7265:e=>{e.exports=function(e){return e&&("function"==typeof e.hook&&!e.hasOwnProperty("hook")||"function"==typeof e.unhook&&!e.hasOwnProperty("unhook"))}},5170:(e,t,n)=>{var i=n(9962);e.exports=function(e){return e&&"VirtualNode"===e.type&&e.version===i}},6221:(e,t,n)=>{var i=n(9962);e.exports=function(e){return e&&"VirtualText"===e.type&&e.version===i}},4097:e=>{e.exports=function(e){return e&&"Widget"===e.type}},9962:e=>{e.exports="2"},4282:(e,t,n)=>{var i=n(9962),a=n(5170),o=n(4097),r=n(6741),s=n(7265);e.exports=d;var l={},c=[];function d(e,t,n,i,d){this.tagName=e,this.properties=t||l,this.children=n||c,this.key=null!=i?String(i):void 0,this.namespace="string"==typeof d?d:null;var u,h=n&&n.length||0,p=0,m=!1,f=!1,g=!1;for(var v in t)if(t.hasOwnProperty(v)){var y=t[v];s(y)&&y.unhook&&(u||(u={}),u[v]=y)}for(var b=0;b<h;b++){var k=n[b];a(k)?(p+=k.count||0,!m&&k.hasWidgets&&(m=!0),!f&&k.hasThunks&&(f=!0),!g&&(k.hooks||k.descendantHooks)&&(g=!0)):!m&&o(k)?"function"==typeof k.destroy&&(m=!0):!f&&r(k)&&(f=!0)}this.count=h+p,this.hasWidgets=m,this.hasThunks=f,this.hooks=u,this.descendantHooks=g}d.prototype.version=i,d.prototype.type="VirtualNode"},8057:(e,t,n)=>{var i=n(9962);function a(e,t,n){this.type=Number(e),this.vNode=t,this.patch=n}a.NONE=0,a.VTEXT=1,a.VNODE=2,a.WIDGET=3,a.PROPS=4,a.ORDER=5,a.INSERT=6,a.REMOVE=7,a.THUNK=8,e.exports=a,a.prototype.version=i,a.prototype.type="VirtualPatch"},4268:(e,t,n)=>{var i=n(9962);function a(e){this.text=String(e)}e.exports=a,a.prototype.version=i,a.prototype.type="VirtualText"},9973:(e,t,n)=>{var i=n(6240),a=n(7265);function o(e){return Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__?e.__proto__:e.constructor?e.constructor.prototype:void 0}e.exports=function e(t,n){var r;for(var s in t){s in n||((r=r||{})[s]=void 0);var l=t[s],c=n[s];if(l!==c){if(i(l)&&i(c)){if(o(c)!==o(l))(r=r||{})[s]=c;else if(a(c))(r=r||{})[s]=c;else{var d=e(l,c);d&&((r=r||{})[s]=d)}}else(r=r||{})[s]=c}}for(var u in n)u in t||((r=r||{})[u]=n[u]);return r}},3072:(e,t,n)=>{var i=n(7362),a=n(8057),o=n(5170),r=n(6221),s=n(4097),l=n(6741),c=n(6078),d=n(9973);function u(e,t){var n={a:e};return function e(t,n,i,c){if(t!==n){var u=i[c],v=!1;if(l(t)||l(n))p(t,n,i,c);else if(null==n)s(t)||(h(t,i,c),u=i[c]),u=g(u,new a(a.REMOVE,t,n));else if(o(n)){if(o(t)){if(t.tagName===n.tagName&&t.namespace===n.namespace&&t.key===n.key){var y=d(t.properties,n.properties);y&&(u=g(u,new a(a.PROPS,t,y))),u=function(t,n,i,r,s){for(var l=t.children,c=function(e,t){var n,i=f(t),a=i.keys,o=i.free;if(o.length===t.length)return{children:t,moves:null};var r=f(e),s=r.keys;if(r.free.length===e.length)return{children:t,moves:null};for(var l=[],c=0,d=o.length,u=0,h=0;h<e.length;h++){var p,g=e[h];g.key?a.hasOwnProperty(g.key)?(p=a[g.key],l.push(t[p])):(p=h-u++,l.push(null)):c<d?(p=o[c++],l.push(t[p])):(p=h-u++,l.push(null))}for(var v=c>=o.length?t.length:o[c],y=0;y<t.length;y++){var b=t[y];b.key?s.hasOwnProperty(b.key)||l.push(b):y>=v&&l.push(b)}for(var k=l.slice(),w=0,x=[],E=[],T=0;T<t.length;){var C=t[T];for(n=k[w];null===n&&k.length;)x.push(m(k,w,null)),n=k[w];n&&n.key===C.key?(w++,T++):C.key?(n&&n.key&&a[n.key]!==T+1?(x.push(m(k,w,n.key)),(n=k[w])&&n.key===C.key?w++:E.push({key:C.key,to:T})):E.push({key:C.key,to:T}),T++):n&&n.key&&x.push(m(k,w,n.key))}for(;w<k.length;)n=k[w],x.push(m(k,w,n&&n.key));return x.length!==u||E.length?{children:l,moves:{removes:x,inserts:E}}:{children:l,moves:null}}(l,n.children),d=c.children,u=l.length,h=d.length,p=u>h?u:h,v=0;v<p;v++){var y=l[v],b=d[v];s+=1,y?e(y,b,i,s):b&&(r=g(r,new a(a.INSERT,null,b))),o(y)&&y.count&&(s+=y.count)}return c.moves&&(r=g(r,new a(a.ORDER,t,c.moves))),r}(t,n,i,u,c)}else u=g(u,new a(a.VNODE,t,n)),v=!0}else u=g(u,new a(a.VNODE,t,n)),v=!0}else r(n)?r(t)?t.text!==n.text&&(u=g(u,new a(a.VTEXT,t,n))):(u=g(u,new a(a.VTEXT,t,n)),v=!0):s(n)&&(s(t)||(v=!0),u=g(u,new a(a.WIDGET,t,n)));u&&(i[c]=u),v&&h(t,i,c)}}(e,t,n,0),n}function h(e,t,n){(function e(t,n,i){if(o(t)){if(t.hooks&&(n[i]=g(n[i],new a(a.PROPS,t,function(e){var t={};for(var n in e)t[n]=void 0;return t}(t.hooks)))),t.descendantHooks||t.hasThunks)for(var r=t.children,s=r.length,c=0;c<s;c++){var d=r[c];e(d,n,i+=1),o(d)&&d.count&&(i+=d.count)}}else l(t)&&p(t,null,n,i)})(e,t,n),function e(t,n,i){if(s(t))"function"==typeof t.destroy&&(n[i]=g(n[i],new a(a.REMOVE,t,null)));else if(o(t)&&(t.hasWidgets||t.hasThunks))for(var r=t.children,c=r.length,d=0;d<c;d++){var u=r[d];e(u,n,i+=1),o(u)&&u.count&&(i+=u.count)}else l(t)&&p(t,null,n,i)}(e,t,n)}function p(e,t,n,i){var o=c(e,t),r=u(o.a,o.b);(function(e){for(var t in e)if("a"!==t)return!0;return!1})(r)&&(n[i]=new a(a.THUNK,null,r))}function m(e,t,n){return e.splice(t,1),{from:t,key:n}}function f(e){for(var t={},n=[],i=e.length,a=0;a<i;a++){var o=e[a];o.key?t[o.key]=a:n.push(a)}return{keys:t,free:n}}function g(e,t){return e?(i(e)?e.push(t):e=[e,t],e):t}e.exports=u},4991:e=>{function t(e,t){var n=Math.pow(2,t-1);return Math.max(-n,Math.min(n-1,e<0?e*n:e*(n-1)))}function n(e,n,a){var o,r,s,l,c,d,u=e.length,h=Math.ceil(u/n),p=i(a,2*h);for(o=0;o<h;o++)r=o*n,s=(o+1)*n>u?u:(o+1)*n,c=t((d=function(e){for(var t,n=1/0,i=-1/0,a=0,o=e.length;a<o;a++)n>(t=e[a])&&(n=t),i<t&&(i=t);return{min:n,max:i}}(e.subarray(r,s))).min,a),l=t(d.max,a),p[2*o]=c,p[2*o+1]=l;return p}function i(e,t){return new(Function(`return Int${e}Array`)())(t)}function a(e,t){return"number"==typeof e?e:t}e.exports=function(e,t,o,r,s,l){if(t=a(t,1e3),l=a(l,16),null==o&&(o=!0),0>[8,16,32].indexOf(l))throw Error("Invalid number of bits specified for peaks.");var c,d,u=e.numberOfChannels,h=[];if(r=a(r,0),s=a(s,e.length),void 0===e.subarray)for(c=0;c<u;c++)d=e.getChannelData(c).subarray(r,s),h.push(n(d,t,l));else h.push(n(e.subarray(r,s),t,l));return o&&h.length>1&&(h=function(e,t){var n,a,o=e.length,r=1/o,s=e[0].length/2,l=0,c=0,d=i(t,2*s);for(c=0;c<s;c++){for(l=0,n=0,a=0;l<o;l++)n+=r*e[l][2*c],a+=r*e[l][2*c+1];d[2*c]=n,d[2*c+1]=a}return[d]}(h,l)),{length:h[0].length/2,data:h,bits:l}}},7362:e=>{var t=Array.isArray,n=Object.prototype.toString;e.exports=t||function(e){return"[object Array]"===n.call(e)}},5893:()=>{}},t={};function n(i){var a=t[i];if(void 0!==a)return a.exports;var o=t[i]={id:i,loaded:!1,exports:{}};return e[i](o,o.exports,n),o.loaded=!0,o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var i={};return(()=>{n.r(i),n.d(i,{default:()=>eo,init:()=>ea});var e,t=n(2098),a=n.n(t),o=n(4935),r=n.n(o),s=n(8370),l=n.n(s),c=n(347),d=n.n(c),u=n(7921),h=n.n(u),p=n(9720),m=n.n(p),f=n(849),g=n.n(f);function v(e,t){return Math.ceil(e*t)}function y(e,t,n){return Math.ceil(e*n/t)}let b=class{setStateChange(e){this.audioRequestState=e,this.ee.emit("audiorequeststatechange",this.audioRequestState,this.src)}fileProgress(e){let t=0;0===this.audioRequestState&&this.setStateChange(1),e.lengthComputable&&(t=e.loaded/e.total*100),this.ee.emit("loadprogress",t,this.src)}fileLoad(e){let t=e.target.response||e.target.result;return this.setStateChange(2),new Promise((e,n)=>{this.ac.decodeAudioData(t,t=>{this.audioBuffer=t,this.setStateChange(3),e(t)},e=>{null===e?n(Error("MediaDecodeAudioDataUnknownContentType")):n(e)})})}fetchLoad(e){return this.setStateChange(2),new Promise((t,n)=>{this.ac.decodeAudioData(e,e=>{this.audioBuffer=e,this.setStateChange(3),t(e)},e=>{null===e?n(Error("MediaDecodeAudioDataUnknownContentType")):n(e)})})}constructor(e,t,n=l()()){this.src=e,this.ac=t,this.audioRequestState=0,this.ee=n}},k=class extends b{load(){return new Promise((e,t)=>{if(this.src.type.match(/audio.*/)||this.src.type.match(/video\/ogg/)){let n=new FileReader;n.readAsArrayBuffer(this.src),n.addEventListener("progress",e=>{super.fileProgress(e)}),n.addEventListener("load",n=>{super.fileLoad(n).then(t=>{e(t)}).catch(t)}),n.addEventListener("error",t)}else t(Error(`Unsupported file type ${this.src.type}`))})}};class w extends b{load(){return Promise.resolve(this.src)}}let x=class extends b{load(){return new Promise((e,t)=>{let n=new XMLHttpRequest;n.open("GET",this.src,!0),n.responseType="arraybuffer",n.send(),n.addEventListener("progress",e=>{super.fileProgress(e)}),n.addEventListener("load",n=>{super.fileLoad(n).then(t=>{e(t)}).catch(t)}),n.addEventListener("error",()=>{t(Error(`Track ${this.src} failed to load`))})})}},E=class{static createLoader(e,t,n){if(e instanceof Blob)return new k(e,t,n);if(e instanceof AudioBuffer)return new w(e,t,n);if("string"==typeof e)return new x(e,t,n);throw Error("Unsupported src type")}},T=class{hook(e){let t=this.playlist;if(!t.isScrolling){if(t.isAutomaticScroll){let n=e.getBoundingClientRect(),i=t.controls.show?t.controls.width:0,a=(n.width-i)*t.samplesPerPixel/t.sampleRate,o=t.isPlaying()?t.playbackSeconds:t.getTimeSelection().start;(o<t.scrollLeft||o>=t.scrollLeft+a)&&(t.scrollLeft=Math.min(o,t.duration-a))}let n=y(t.scrollLeft,t.samplesPerPixel,t.sampleRate);e.scrollLeft=n}}constructor(e){this.playlist=e}},C=class{hook(e,t,n){if(void 0!==n&&n.offset===this.offset&&n.duration===this.duration&&n.samplesPerPixel===this.samplesPerPixel)return;let i=e.width,a=e.height,o=e.getContext("2d");o.clearRect(0,0,i,a),o.fillStyle=this.colors.timeColor,Object.keys(this.tickInfo).forEach(e=>{let t=this.tickInfo[e];o.fillRect(e,a-t,1,t)})}constructor(e,t,n,i,a){this.tickInfo=e,this.offset=t,this.samplesPerPixel=n,this.duration=i,this.colors=a}};class S{getScaleInfo(e){let t=Object.keys(this.timeinfo).map(e=>parseInt(e,10));t=t.sort((e,t)=>e-t);for(let n=0;n<t.length;n+=1)if(e<=t[n])return this.timeinfo[t[n]];return this.timeinfo[t[0]]}static formatTime(e){let t=e/1e3,n=t%60,i=(t-n)/60;return n<10&&(n=`0${n}`),`${i}:${n}`}render(){let e=y(this.duration,this.samplesPerPixel,this.sampleRate),t=this.sampleRate/this.samplesPerPixel,n=y(this.offset,this.samplesPerPixel,this.sampleRate),i=this.getScaleInfo(this.samplesPerPixel),a={},o=[],r=e+n,s=0;for(let e=0;e<r;e+=t*i.secondStep){let t=Math.floor(e),r=t-n;t>=n&&(i.marker&&s%i.marker==0?(o.push(d()("div.time",{attributes:{style:`position: absolute; left: ${r}px;`}},[S.formatTime(s)])),a[r]=10):i.bigStep&&s%i.bigStep==0?a[r]=5:i.smallStep&&s%i.smallStep==0&&(a[r]=2)),s+=1e3*i.secondStep}return d()("div.playlist-time-scale",{attributes:{style:`position: relative; left: 0; right: 0; margin-left: ${this.marginLeft}px;`}},[o,d()("canvas",{attributes:{width:e,height:30,style:"position: absolute; left: 0; right: 0; top: 0; bottom: 0;"},hook:new C(a,this.offset,this.samplesPerPixel,this.duration,this.colors)})])}constructor(e,t,n,i,a=0,o){this.duration=e,this.offset=t,this.samplesPerPixel=n,this.sampleRate=i,this.marginLeft=a,this.colors=o,this.timeinfo={2e4:{marker:3e4,bigStep:1e4,smallStep:5e3,secondStep:5},12e3:{marker:15e3,bigStep:5e3,smallStep:1e3,secondStep:1},1e4:{marker:1e4,bigStep:5e3,smallStep:1e3,secondStep:1},5e3:{marker:5e3,bigStep:1e3,smallStep:500,secondStep:.5},2500:{marker:2e3,bigStep:1e3,smallStep:500,secondStep:.5},1500:{marker:2e3,bigStep:1e3,smallStep:200,secondStep:.2},700:{marker:1e3,bigStep:500,smallStep:100,secondStep:.1}}}}var P=n(1730),I=n.n(P),O=n(3520),_=n.n(O),A=new Uint8Array(16);let R=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var B=[],L=0;L<256;++L)B.push((L+256).toString(16).substr(1));let D=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(B[e[t+0]]+B[e[t+1]]+B[e[t+2]]+B[e[t+3]]+"-"+B[e[t+4]]+B[e[t+5]]+"-"+B[e[t+6]]+B[e[t+7]]+"-"+B[e[t+8]]+B[e[t+9]]+"-"+B[e[t+10]]+B[e[t+11]]+B[e[t+12]]+B[e[t+13]]+B[e[t+14]]+B[e[t+15]]).toLowerCase();if(!("string"==typeof n&&R.test(n)))throw TypeError("Stringified UUID is invalid");return n},M=function(t,n,i){var a=(t=t||{}).random||(t.rng||function(){if(!e&&!(e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(A)})();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,n){i=i||0;for(var o=0;o<16;++o)n[i+o]=a[o];return n}return D(a)};var N=n(4991),j=n.n(N),G=n(1114);let F=class{setup(e,t){this.samplesPerPixel=e,this.sampleRate=t}click(e){e.preventDefault();let t=e.offsetX*this.samplesPerPixel/this.sampleRate;this.track.ee.emit("select",t,t,this.track)}static getClass(){return".state-cursor"}static getEvents(){return["click"]}constructor(e){this.track=e}},U=class{setup(e,t){this.samplesPerPixel=e,this.sampleRate=t}emitSelection(e){let t=Math.min(e,this.startX),n=Math.max(e,this.startX),i=t*this.samplesPerPixel/this.sampleRate,a=n*this.samplesPerPixel/this.sampleRate;this.track.ee.emit("select",i,a,this.track)}complete(e){this.emitSelection(e),this.active=!1}mousedown(e){e.preventDefault(),this.active=!0,this.startX=e.offsetX;let t=this.startX*this.samplesPerPixel/this.sampleRate;this.track.ee.emit("select",t,t,this.track)}mousemove(e){this.active&&(e.preventDefault(),this.emitSelection(e.offsetX))}mouseup(e){this.active&&(e.preventDefault(),this.complete(e.offsetX))}mouseleave(e){this.active&&(e.preventDefault(),this.complete(e.offsetX))}static getClass(){return".state-select"}static getEvents(){return["mousedown","mousemove","mouseup","mouseleave"]}constructor(e){this.track=e,this.active=!1}},V={cursor:F,select:U,shift:class{setup(e,t){this.samplesPerPixel=e,this.sampleRate=t}emitShift(e){let t=(e-this.prevX)*this.samplesPerPixel/this.sampleRate;this.prevX=e,this.track.ee.emit("shift",t,this.track)}complete(e){this.emitShift(e),this.active=!1}mousedown(e){e.preventDefault(),this.active=!0,this.el=e.target,this.prevX=e.offsetX}mousemove(e){this.active&&(e.preventDefault(),this.emitShift(e.offsetX))}mouseup(e){this.active&&(e.preventDefault(),this.complete(e.offsetX))}mouseleave(e){this.active&&(e.preventDefault(),this.complete(e.offsetX))}static getClass(){return".state-shift"}static getEvents(){return["mousedown","mousemove","mouseup","mouseleave"]}constructor(e){this.track=e,this.active=!1}},fadein:class{setup(e,t){this.samplesPerPixel=e,this.sampleRate=t}click(e){let t=e.offsetX*this.samplesPerPixel/this.sampleRate;t>this.track.getStartTime()&&t<this.track.getEndTime()&&this.track.ee.emit("fadein",t-this.track.getStartTime(),this.track)}static getClass(){return".state-fadein"}static getEvents(){return["click"]}constructor(e){this.track=e}},fadeout:class{setup(e,t){this.samplesPerPixel=e,this.sampleRate=t}click(e){let t=e.offsetX*this.samplesPerPixel/this.sampleRate;t>this.track.getStartTime()&&t<this.track.getEndTime()&&this.track.ee.emit("fadeout",this.track.getEndTime()-t,this.track)}static getClass(){return".state-fadeout"}static getEvents(){return["click"]}constructor(e){this.track=e}}};class H{static drawFrame(e,t,n,i,a,o,r){let s=Math.abs(i*t),l=Math.abs(a*t);e.fillRect(n,0,o,t-l),e.fillRect(n,t+s,o,t-s),0!==r&&e.fillRect(n+o,0,r,2*t)}hook(e,t,n){if(void 0!==n&&n.peaks===this.peaks&&n.scale===this.scale&&n.height===this.height)return;let i=this.scale,a=e.width/i,o=e.getContext("2d"),r=e.height/i/2,s=2**(this.bits-1),l=this.barWidth,c=this.barGap,d=l+c;o.clearRect(0,0,e.width,e.height),o.save(),o.fillStyle=this.color,o.scale(i,i);for(let e=0;e<a;e+=d){let t=this.peaks[(e+this.offset)*2]/s,n=this.peaks[(e+this.offset)*2+1]/s;H.drawFrame(o,r,e,t,n,l,c)}o.restore()}constructor(e,t,n,i,a,o,r,s){this.peaks=e,this.offset=t,this.color=i,this.bits=n,this.scale=a,this.height=o,this.barWidth=r,this.barGap=s}}var z=n(6226);class W{static createCurve(e,t,n){let i,a;switch(t){case G.Y1:i=1;break;case G.h7:i=-1;break;default:throw Error("Unsupported fade type.")}switch(e){case G._h:a=(0,z.sCurve)(n,i);break;case G.t$:a=(0,z.linear)(n,i);break;case G.Jl:a=(0,z.exponential)(n,i);break;case G.Hp:a=(0,z.logarithmic)(n,10,i);break;default:throw Error("Unsupported fade shape")}return a}hook(e,t,n){if(void 0!==n&&n.shape===this.shape&&n.type===this.type&&n.duration===this.duration&&n.samplesPerPixel===this.samplesPerPixel)return;let i=e.getContext("2d"),a=e.width,o=e.height,r=W.createCurve(this.shape,this.type,a),s=r.length,l=o-r[0]*o;i.clearRect(0,0,e.width,e.height),i.save(),i.strokeStyle="black",i.beginPath(),i.moveTo(0,l);for(let e=1;e<s;e+=1)l=o-r[e]*o,i.lineTo(e,l);i.stroke(),i.restore()}constructor(e,t,n,i){this.type=e,this.shape=t,this.duration=n,this.samplesPerPixel=i}}let q=class{hook(e){e.value=100*this.gain,e.title=`${Math.round(100*this.gain)}% volume`}constructor(e){this.gain=e}},X=class{hook(e){let t;e.value=100*this.stereoPan,t=0===this.stereoPan?"Center":this.stereoPan<0?"Left":"Right";let n=`${Math.abs(Math.round(100*this.stereoPan))}% `;e.title=`Pan: ${0!==this.stereoPan?n:""}${t}`}constructor(e){this.stereoPan=e}},Y=class{setEventEmitter(e){this.ee=e}setName(e){this.name=e}setCustomClass(e){this.customClass=e}setWaveOutlineColor(e){this.waveOutlineColor=e}setCues(e,t){if(t<e)throw Error("cue out cannot be less than cue in");this.cueIn=e,this.cueOut=t,this.duration=this.cueOut-this.cueIn,this.endTime=this.startTime+this.duration}trim(e,t){let n=this.getStartTime(),i=this.getEndTime(),a=this.cueIn-n;if(n<=e&&i>=e||n<=t&&i>=t){let o=e<n?n:e;this.setCues(o+a,(t>i?i:t)+a),e>n&&this.setStartTime(e)}}setStartTime(e){this.startTime=e,this.endTime=e+this.duration}setPlayout(e){this.playout=e}setOfflinePlayout(e){this.offlinePlayout=e}setEnabledStates(e={}){this.enabledStates=I()({},{cursor:!0,fadein:!0,fadeout:!0,select:!0,shift:!0},e)}setFadeIn(e,t="logarithmic"){if(e>this.duration)throw Error("Invalid Fade In");this.fadeIn&&(this.removeFade(this.fadeIn),this.fadeIn=void 0),this.fadeIn=this.saveFade(G.Y1,t,0,e)}setFadeOut(e,t="logarithmic"){if(e>this.duration)throw Error("Invalid Fade Out");let n={shape:t,start:this.duration-e,end:this.duration};this.fadeOut&&(this.removeFade(this.fadeOut),this.fadeOut=void 0),this.fadeOut=this.saveFade(G.h7,n.shape,n.start,n.end)}saveFade(e,t,n,i){let a=M();return this.fades[a]={type:e,shape:t,start:n,end:i},a}removeFade(e){delete this.fades[e]}setBuffer(e){this.buffer=e}setPeakData(e){this.peakData=e}calculatePeaks(e,t){let n=v(this.cueIn,t),i=v(this.cueOut,t);this.setPeaks(j()(this.buffer,e,this.peakData.mono,n,i))}setPeaks(e){this.peaks=e}setState(e){if(this.state=e,this.state&&this.enabledStates[this.state]){let e=V[this.state];this.stateObj=new e(this)}else this.stateObj=void 0}getStartTime(){return this.startTime}getEndTime(){return this.endTime}getDuration(){return this.duration}isPlaying(){var e;return null===(e=this.playout)||void 0===e?void 0:e.isPlaying()}setShouldPlay(e){this.playout.setShouldPlay(e)}setGainLevel(e){this.gain=e,this.playout.setVolumeGainLevel(e)}setMasterGainLevel(e){this.playout.setMasterGainLevel(e)}setStereoPanValue(e){this.stereoPan=e,this.playout.setStereoPanValue(e)}setEffects(e){this.effectsGraph=e,this.playout.setEffects(e)}schedulePlay(e,t,n,i){let a,o;let r=e,s=n?n-t:void 0,l=I()({},{shouldPlay:!0,masterGain:1,isOffline:!1},i),c=l.isOffline?this.offlinePlayout:this.playout;if(this.endTime<=t||s&&t+s<this.startTime)return Promise.resolve();this.startTime>=t?(a=0,r+=this.startTime-t,n?(s-=this.startTime-t,o=Math.min(s,this.duration)):o=this.duration):(a=t-this.startTime,o=n?Math.min(s,this.duration-a):this.duration-a),a+=this.cueIn;let d=t-this.startTime,u=c.setUpSource();return _()(this.fades,t=>{let n,i;if(d<t.end)switch(d<=t.start?(n=e+(t.start-d),i=t.end-t.start):d>t.start&&d<t.end&&(n=e-(d-t.start),i=t.end-t.start),t.type){case G.Y1:c.applyFadeIn(n,i,t.shape);break;case G.h7:c.applyFadeOut(n,i,t.shape);break;default:throw Error("Invalid fade type saved on track.")}}),c.setVolumeGainLevel(this.gain),c.setShouldPlay(l.shouldPlay),c.setMasterGainLevel(l.masterGain),c.setStereoPanValue(this.stereoPan),c.play(r,a,o),u}scheduleStop(e=0){this.playout.stop(e)}renderOverlay(e){let t=y(e.playlistLength,e.resolution,e.sampleRate),n={attributes:{style:`position: absolute; top: 0; right: 0; bottom: 0; left: 0; width: ${t}px; z-index: 9;`}},i="";if(this.stateObj){this.stateObj.setup(e.resolution,e.sampleRate);let t=V[this.state];t.getEvents().forEach(e=>{n[`on${e}`]=this.stateObj[e].bind(this.stateObj)}),i=t.getClass()}return d()(`div.playlist-overlay${i}`,n)}renderControls(e){let t=e.muted?".active":"",n=e.soloed?".active":"",i=e.collapsed,a=this.peaks.data.length,o=e.controls.widgets,r=d()("button.btn.btn-danger.btn-xs.track-remove",{attributes:{type:"button",title:"Remove track"},onclick:()=>{this.ee.emit("removeTrack",this)}},[d()("i.fas.fa-times")]),s=d()("span",[this.name]),l=d()("button.btn.btn-info.btn-xs.track-collapse",{attributes:{type:"button",title:i?"Expand track":"Collapse track"},onclick:()=>{this.ee.emit("changeTrackView",this,{collapsed:!i})}},[d()(`i.fas.${i?"fa-caret-down":"fa-caret-up"}`)]),c=[];o.remove&&c.push(r),c.push(s),o.collapse&&c.push(l);let u=[d()("div.track-header",c)];return!i&&(o.muteOrSolo&&u.push(d()("div.btn-group",[d()(`button.btn.btn-outline-dark.btn-xs.btn-mute${t}`,{attributes:{type:"button"},onclick:()=>{this.ee.emit("mute",this)}},["Mute"]),d()(`button.btn.btn-outline-dark.btn-xs.btn-solo${n}`,{onclick:()=>{this.ee.emit("solo",this)}},["Solo"])])),o.volume&&u.push(d()("label.volume",[d()("input.volume-slider",{attributes:{"aria-label":"Track volume control",type:"range",min:0,max:100,value:100},hook:new q(this.gain),oninput:e=>{this.ee.emit("volumechange",e.target.value,this)}})])),o.stereoPan&&u.push(d()("label.stereopan",[d()("input.stereopan-slider",{attributes:{"aria-label":"Track stereo pan control",type:"range",min:-100,max:100,value:100},hook:new X(this.stereoPan),oninput:e=>{this.ee.emit("stereopan",e.target.value/100,this)}})]))),d()("div.controls",{attributes:{style:`height: ${a*e.height}px; width: ${e.controls.width}px; position: absolute; left: 0; z-index: 10;`}},u)}render(e){if(!this.peaks)return;let t=this.peaks.length,n=y(e.playbackSeconds,e.resolution,e.sampleRate),i=y(this.startTime,e.resolution,e.sampleRate),a=y(this.endTime,e.resolution,e.sampleRate),o=0,r=this.peaks.data.length,s=Math.ceil(window.devicePixelRatio);n>0&&n>i&&(o=n<a?n-i:t);let l=[d()("div.cursor",{attributes:{style:`position: absolute; width: 1px; margin: 0; padding: 0; top: 0; left: ${n}px; bottom: 0; z-index: 5;`}})],c=Object.keys(this.peaks.data).map(n=>{let a=[d()("div.channel-progress",{attributes:{style:`position: absolute; width: ${o}px; height: ${e.height}px; z-index: 2;`}})],r=0,l=t,c=this.peaks.data[n];for(;l>0;){let t=Math.min(l,1e3),n=this.waveOutlineColor?this.waveOutlineColor:e.colors.waveOutlineColor;a.push(d()("canvas",{attributes:{width:t*s,height:e.height*s,style:`float: left; position: relative; margin: 0; padding: 0; z-index: 3; width: ${t}px; height: ${e.height}px;`},hook:new H(c,r,this.peaks.bits,n,s,e.height,e.barWidth,e.barGap)})),l-=t,r+=1e3}if(this.fadeIn){let t=this.fades[this.fadeIn],n=y(t.end-t.start,e.resolution,e.sampleRate);a.push(d()("div.wp-fade.wp-fadein",{attributes:{style:`position: absolute; height: ${e.height}px; width: ${n}px; top: 0; left: 0; z-index: 4;`}},[d()("canvas",{attributes:{width:n,height:e.height},hook:new W(t.type,t.shape,t.end-t.start,e.resolution)})]))}if(this.fadeOut){let t=this.fades[this.fadeOut],n=y(t.end-t.start,e.resolution,e.sampleRate);a.push(d()("div.wp-fade.wp-fadeout",{attributes:{style:`position: absolute; height: ${e.height}px; width: ${n}px; top: 0; right: 0; z-index: 4;`}},[d()("canvas",{attributes:{width:n,height:e.height},hook:new W(t.type,t.shape,t.end-t.start,e.resolution)})]))}return d()(`div.channel.channel-${n}`,{attributes:{style:`height: ${e.height}px; width: ${t}px; top: ${n*e.height}px; left: ${i}px; position: absolute; margin: 0; padding: 0; z-index: 1;`}},a)});if(l.push(c),l.push(this.renderOverlay(e)),!0===e.isActive){let t=y(e.timeSelection.start,e.resolution,e.sampleRate),n=y(e.timeSelection.end,e.resolution,e.sampleRate)-t+1;l.push(d()(`div.selection${n>1?".segment":".point"}`,{attributes:{style:`position: absolute; width: ${n}px; bottom: 0; top: 0; left: ${t}px; z-index: 4;`}}))}let u=d()("div.waveform",{attributes:{style:`height: ${r*e.height}px; position: relative;`}},l),h=[],p=0;e.controls.show&&(h.push(this.renderControls(e)),p=e.controls.width),h.push(u);let m=e.shouldPlay?"":".silent",f=void 0===this.customClass?"":`.${this.customClass}`;return d()(`div.channel-wrapper${m}${f}`,{attributes:{style:`margin-left: ${p}px; height: ${e.height*r}px;`}},h)}getTrackDetails(){let e={src:this.src,start:this.startTime,end:this.endTime,name:this.name,muted:this.muted,soloed:this.soloed,customClass:this.customClass,cuein:this.cueIn,cueout:this.cueOut,stereoPan:this.stereoPan,gain:this.gain,effects:this.effectsGraph};if(this.fadeIn){let t=this.fades[this.fadeIn];e.fadeIn={shape:t.shape,duration:t.end-t.start}}if(this.fadeOut){let t=this.fades[this.fadeOut];e.fadeOut={shape:t.shape,duration:t.end-t.start}}return e}constructor(){this.name="Untitled",this.customClass=void 0,this.waveOutlineColor=void 0,this.gain=1,this.muted=!1,this.soloed=!1,this.fades={},this.peakData={type:"WebAudio",mono:!1},this.cueIn=0,this.cueOut=0,this.duration=0,this.startTime=0,this.endTime=0,this.stereoPan=0}};function J(e,t){e.connect(t)}let K=class{applyFade(e,t,n,i="logarithmic"){if(e===G.Y1)(0,G.L7)(this.fadeGain.gain,i,t,n);else if(e===G.h7)(0,G.Mt)(this.fadeGain.gain,i,t,n);else throw Error("Unsupported fade type")}applyFadeIn(e,t,n="logarithmic"){this.applyFade(G.Y1,e,t,n)}applyFadeOut(e,t,n="logarithmic"){this.applyFade(G.h7,e,t,n)}isPlaying(){return void 0!==this.source}getDuration(){return this.buffer.duration}setAudioContext(e){this.ac=e,this.destination=this.ac.destination}createStereoPanner(){return this.ac.createStereoPanner?this.ac.createStereoPanner():this.ac.createPanner()}setUpSource(){let e,t;this.source=this.ac.createBufferSource(),this.source.buffer=this.buffer;let n=new Promise(n=>{this.source.onended=()=>{this.source.disconnect(),this.fadeGain.disconnect(),this.volumeGain.disconnect(),this.shouldPlayGain.disconnect(),this.panner.disconnect(),e&&e(),t&&t(),this.source=void 0,this.fadeGain=void 0,this.volumeGain=void 0,this.shouldPlayGain=void 0,this.panner=void 0,n()}});return this.fadeGain=this.ac.createGain(),this.volumeGain=this.ac.createGain(),this.shouldPlayGain=this.ac.createGain(),this.panner=this.createStereoPanner(),this.source.connect(this.fadeGain),this.fadeGain.connect(this.volumeGain),this.volumeGain.connect(this.shouldPlayGain),this.shouldPlayGain.connect(this.panner),e=this.effectsGraph(this.panner,this.masterGain,this.ac instanceof(window.OfflineAudioContext||window.webkitOfflineAudioContext)),t=this.masterEffectsGraph(this.masterGain,this.destination,this.ac instanceof(window.OfflineAudioContext||window.webkitOfflineAudioContext)),n}setVolumeGainLevel(e){this.volumeGain&&(this.volumeGain.gain.value=e)}setShouldPlay(e){this.shouldPlayGain&&(this.shouldPlayGain.gain.value=e?1:0)}setMasterGainLevel(e){this.masterGain&&(this.masterGain.gain.value=e)}setStereoPanValue(e=0){this.panner&&(void 0!==this.panner.pan?this.panner.pan.value=e:(this.panner.panningModel="equalpower",this.panner.setPosition(e,0,1-Math.abs(e))))}setEffects(e=J){this.effectsGraph=e}setMasterEffects(e=J){this.masterEffectsGraph=e}play(e,t,n){this.source.start(e,t,n)}stop(e=0){this.source&&this.source.stop(e)}constructor(e,t,n=e.createGain()){this.ac=e,this.gain=1,this.effectsGraph=J,this.masterEffectsGraph=J,this.buffer=t,this.masterGain=n,this.destination=this.ac.destination}},Z=class{emitDrag(e){let t=e-this.prevX;if(t){let n=t*this.playlist.samplesPerPixel/this.playlist.sampleRate;this.prevX=e,this.playlist.ee.emit("dragged",n,this.data)}}complete(){this.active=!1,document.removeEventListener("dragover",this.ondragover)}dragstart(e){this.active=!0,this.prevX=e.clientX,e.dataTransfer.dropEffect="move",e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",""),document.addEventListener("dragover",this.ondragover)}dragend(e){this.active&&(e.preventDefault(),this.complete())}static getClass(){return".shift"}static getEvents(){return["dragstart","dragend"]}constructor(e,t={}){this.playlist=e,this.data=t,this.active=!1,this.ondragover=e=>{this.active&&(e.preventDefault(),this.emitDrag(e.clientX))}}},Q=function(){};Q.prototype.hook=function(e){let t=e.querySelector(".current");if(t){let n=e.getBoundingClientRect(),i=t.getBoundingClientRect().top-n.top;e.scrollTop+=i}};let ee=class{setupInteractions(){this.annotations.forEach((e,t)=>{let n=new Z(this.playlist,{direction:"left",index:t}),i=new Z(this.playlist,{direction:"right",index:t});this.resizeHandlers.push(n),this.resizeHandlers.push(i)})}setupEE(e){return e.on("dragged",(e,t)=>{let n=t.index,i=this.annotations,a=i[n];if("left"===t.direction){let t=a.start;a.start+=e,a.start<0&&(a.start=0),n&&i[n-1].end>a.start&&(i[n-1].end=a.start),this.playlist.linkEndpoints&&n&&i[n-1].end===t&&(i[n-1].end=a.start)}else{let t=a.end;a.end+=e,a.end>this.playlist.duration&&(a.end=this.playlist.duration),n<i.length-1&&i[n+1].start<a.end&&(i[n+1].start=a.end),this.playlist.linkEndpoints&&n<i.length-1&&i[n+1].start===t&&(i[n+1].start=a.end)}this.playlist.drawRequest()}),e.on("continuousplay",e=>{this.playlist.isContinuousPlay=e}),e.on("linkendpoints",e=>{this.playlist.linkEndpoints=e}),e.on("annotationsrequest",()=>{this.export()}),e}export(){let e=this.annotations.map(e=>({begin:String(e.start.toFixed(3)),end:String(e.end.toFixed(3)),id:String(e.id),language:e.lang,lines:e.lines})),t=`data:text/json;charset=utf-8,${encodeURIComponent(JSON.stringify(e))}`,n=document.createElement("a");document.body.appendChild(n),n.href=t,n.download="annotations.json",n.click(),document.body.removeChild(n)}renderResizeLeft(e){let t=Z.getEvents(),n={attributes:{style:"position: absolute; height: 30px; width: 10px; top: 0; left: -2px",draggable:!0}},i=this.resizeHandlers[2*e];return t.forEach(e=>{n[`on${e}`]=i[e].bind(i)}),d()("div.resize-handle.resize-w",n)}renderResizeRight(e){let t=Z.getEvents(),n={attributes:{style:"position: absolute; height: 30px; width: 10px; top: 0; right: -2px",draggable:!0}},i=this.resizeHandlers[2*e+1];return t.forEach(e=>{n[`on${e}`]=i[e].bind(i)}),d()("div.resize-handle.resize-e",n)}renderControls(e,t){let n=this;return this.controls.map(i=>d()(`i.${i.class}`,{attributes:{title:i.title},onclick:()=>{i.action(e,t,n.annotations,{linkEndpoints:n.playlist.linkEndpoints}),this.setupInteractions(),n.playlist.drawRequest()}}))}render(){let e=d()("div.annotations-boxes",{attributes:{style:`height: 30px; position: relative; margin-left: ${this.marginLeft}px;`}},this.annotations.map((e,t)=>{let n=this.playlist.samplesPerPixel,i=this.playlist.sampleRate,a=i/n,o=y(this.playlist.scrollLeft,n,i),r=Math.floor(e.start*a-o),s=Math.ceil(e.end*a-e.start*a);return d()("div.annotation-box",{attributes:{style:`position: absolute; height: 30px; width: ${s}px; left: ${r}px`,"data-id":e.id}},[this.renderResizeLeft(t),d()("span.id",{onclick:()=>{let e=this.annotations[t].start,n=this.annotations[t].end;this.playlist.isContinuousPlay?(this.playlist.seek(e,e),this.playlist.ee.emit("play",e)):(this.playlist.seek(e,n),this.playlist.ee.emit("play",e,n))}},[e.id]),this.renderResizeRight(t)])})),t=d()("div.annotations-boxes-wrapper",{attributes:{style:"overflow: hidden;"}},[e]),n=d()("div.annotations-text",{hook:new Q},this.annotations.map((e,t)=>{let n=function(e){function t(e,t){let n=parseInt(e/3600,10)%24,i=parseInt(e/60,10)%60,a=(e%60).toFixed(t),o=n<10?`0${n}`:n,r=i<10?`0${i}`:i,s=a<10?`0${a}`:a;return`${o}:${r}:${s}`}return({seconds:e=>e.toFixed(0),thousandths:e=>e.toFixed(3),"hh:mm:ss":function(e){return t(e,0)},"hh:mm:ss.u":function(e){return t(e,1)},"hh:mm:ss.uu":function(e){return t(e,2)},"hh:mm:ss.uuu":function(e){return t(e,3)}})[e]}(this.playlist.durationFormat),i=n(e.start),a=n(e.end),o="";this.playlist.isPlaying()&&this.playlist.playbackSeconds>=e.start&&this.playlist.playbackSeconds<=e.end&&(o=".current");let r=this.editable?{attributes:{contenteditable:!0},oninput:t=>{e.lines=[t.target.innerText]},onkeypress:e=>{(13===e.which||13===e.keyCode)&&(e.target.blur(),e.preventDefault())}}:{};return d()(`div.annotation${o}`,[d()("span.annotation-id",[e.id]),d()("span.annotation-start",[i]),d()("span.annotation-end",[a]),d()("span.annotation-lines",r,[e.lines]),d()("span.annotation-actions",this.renderControls(e,t))])}));return d()("div.annotations",[t,n])}constructor(e,t,n=[],i=!1,a=!1,o=!1,r=0){this.playlist=e,this.marginLeft=r,this.resizeHandlers=[],this.editable=i,this.annotations=t.map(e=>({id:e.id||M(),start:Number(e.begin)||0,end:Number(e.end)||0,lines:e.lines||[""],lang:e.language||"en"})),this.setupInteractions(),this.controls=n,this.setupEE(e.ee),this.playlist.isContinuousPlay=o,this.playlist.linkEndpoints=a,this.length=this.annotations.length}};function et(){function e(e,t){let n=2**(t-1);return Math.max(-n,Math.min(n-1,e<0?e*n:e*n-1))}onmessage=function(t){postMessage(function(t,n=1e4,i=8){if(0>[8,16,32].indexOf(i))throw Error("Invalid number of bits specified for peaks.");let a=[],o=t.length;return a.push(function(t,n,i){let a,o,r,s,l;let c=t.length,d=Math.ceil(c/n),u=new self[`Int${i}Array`](2*d);for(let h=0;h<d;h+=1)a=h*n,o=(h+1)*n>c?c:(h+1)*n,s=e((l=function(e){let t,n=1/0,i=-1/0;for(let a=0;a<e.length;a+=1)n>(t=e[a])&&(n=t),i<t&&(i=t);return{min:n,max:i}}(t.subarray(a,o))).min,i),r=e(l.max,i),u[2*h]=s,u[2*h+1]=r;return u}(t.subarray(0,o),n,i)),{bits:i,length:a[0].length/2,data:a}}(t.data.samples,t.data.samplesPerPixel))}}function en(){let e,t=0,n=[],i=[];function a(e,t,n){for(let i=0;i<n.length;i+=1)e.setUint8(t+i,n.charCodeAt(i))}function o(e,t){let n=new Float32Array(t),i=0;for(let t=0;t<e.length;t+=1)n.set(e[t],i),i+=e[t].length;return n}onmessage=function(r){var s,l;switch(r.data.command){case"init":e=r.data.config.sampleRate;break;case"record":s=r.data.buffer,n.push(s[0]),i.push(s[1]),t+=s[0].length;break;case"exportWAV":l=r.data.type,postMessage(new Blob([function(t,n=!1){let i=new DataView(new ArrayBuffer(44+2*t.length));return a(i,0,"RIFF"),i.setUint32(4,32+2*t.length,!0),a(i,8,"WAVE"),a(i,12,"fmt "),i.setUint32(16,16,!0),i.setUint16(20,1,!0),i.setUint16(22,n?1:2,!0),i.setUint32(24,e,!0),i.setUint32(28,4*e,!0),i.setUint16(32,4,!0),i.setUint16(34,16,!0),a(i,36,"data"),i.setUint32(40,2*t.length,!0),function(e,t,n){let i=44;for(let t=0;t<n.length;t+=1,i+=2){let a=Math.max(-1,Math.min(1,n[t]));e.setInt16(i,a<0?32768*a:32767*a,!0)}}(i,0,t),i}(function(e,t){let n=e.length+t.length,i=new Float32Array(n),a=0,o=0;for(;a<n;)i[a+=1]=e[o],i[a+=1]=t[o],o+=1;return i}(o(n,t),o(i,t)))],{type:l}));break;case"clear":t=0,n=[],i=[];break;default:throw Error("Unknown export worker command")}}}let ei=class{initExporter(){this.exportWorker=new(g())(en)}trimAudioBuffer(e,t){let n=e.sampleRate,i=Math.floor(t*n);if(i>=e.length)return this.ac.createBuffer(1,1,n);let a=this.ac.createBuffer(e.numberOfChannels,e.length-i,n);for(let t=0;t<e.numberOfChannels;t++){let n=e.getChannelData(t),o=a.getChannelData(t);for(let e=0;e<a.length;e++)o[e]=n[e+i]}return a}initRecorder(e,t,n="Recording"){this.fixedRecordingTrack=void 0!==t,this.recordingTrack=t,this.mediaRecorder=new MediaRecorder(e),this.mediaRecorder.onstart=()=>{if(!this.fixedRecordingTrack){let e=new Y;e.setName(n),e.setEnabledStates(),e.setEventEmitter(this.ee),this.recordingTrack=e,this.tracks.push(e)}let e=this.cursor;this.recordingTrack.setStartTime(e),this.chunks=[],this.working=!1},this.mediaRecorder.ondataavailable=e=>{if(this.chunks.push(e.data),!this.working){let e=new Blob(this.chunks,{type:"audio/ogg; codecs=opus"});E.createLoader(e,this.ac).load().then(e=>{this.latency>0&&(e=this.trimAudioBuffer(e,this.latency)),this.recorderWorker.postMessage({samples:e.getChannelData(0),samplesPerPixel:this.samplesPerPixel}),this.recordingTrack.setCues(0,e.duration),this.recordingTrack.setBuffer(e),this.recordingTrack.setPlayout(new K(this.ac,e,this.masterGainNode)),this.adjustDuration()}).catch(()=>{this.working=!1}),this.working=!0}},this.mediaRecorder.onstop=()=>{this.chunks=[],this.working=!1},this.recorderWorker=new(g())(et),this.recorderWorker.onmessage=e=>{this.recordingTrack.setPeaks(e.data),this.working=!1,this.drawRequest()}}setShowTimeScale(e){this.showTimescale=e}setMono(e){this.mono=e}setExclSolo(e){this.exclSolo=e}setSeekStyle(e){this.seekStyle=e}getSeekStyle(){return this.seekStyle}setSampleRate(e){this.sampleRate=e}setSamplesPerPixel(e){this.samplesPerPixel=e}setAudioContext(e){this.ac=e,this.masterGainNode=e.createGain()}getAudioContext(){return this.ac}setControlOptions(e){this.controls=e}setWaveHeight(e){this.waveHeight=e}setCollapsedWaveHeight(e){this.collapsedWaveHeight=e}setColors(e){this.colors=e}setBarWidth(e){this.barWidth=e}setBarGap(e){this.barGap=e}setAnnotations(e){let t=this.controls.show?this.controls.width:0;this.annotationList=new ee(this,e.annotations,e.controls,e.editable,e.linkEndpoints,e.isContinuousPlay,t)}setEffects(e){this.effectsGraph=e}setEventEmitter(e){this.ee=e}getEventEmitter(){return this.ee}setUpEventEmitter(){let e=this.ee;e.on("automaticscroll",e=>{this.isAutomaticScroll=e}),e.on("durationformat",e=>{this.durationFormat=e,this.drawRequest()}),e.on("select",(e,t,n)=>{this.isPlaying()?(this.lastSeeked=e,this.pausedAt=void 0,this.restartPlayFrom(e)):(this.seek(e,t,n),this.ee.emit("timeupdate",e),this.drawRequest())}),e.on("startaudiorendering",(e,t)=>{this.startOfflineRender(e,t)}),e.on("statechange",e=>{this.setState(e),this.drawRequest()}),e.on("shift",(e,t)=>{t.setStartTime(t.getStartTime()+e),this.adjustDuration(),this.drawRequest()}),e.on("record",e=>{this.latency=e,this.record()}),e.on("updateview",()=>{this.drawRequest()}),e.on("resume",async()=>{console.log(`Audio context state change: ${this.getAudioContext().state}`),"running"===this.getAudioContext().state&&await this.getAudioContext().resume()}),e.on("play",(e,t)=>{this.play(e,t)}),e.on("pause",()=>{this.pause()}),e.on("stop",()=>{this.stop()}),e.on("rewind",()=>{this.rewind()}),e.on("fastforward",()=>{this.fastForward()}),e.on("clear",()=>{this.clear().then(()=>{this.drawRequest()})}),e.on("solo",e=>{this.soloTrack(e),this.adjustTrackPlayout(),this.drawRequest()}),e.on("mute",e=>{this.muteTrack(e),this.adjustTrackPlayout(),this.drawRequest()}),e.on("removeTrack",e=>{this.removeTrack(e),this.adjustTrackPlayout(),this.drawRequest()}),e.on("changeTrackView",(e,t)=>{this.collapseTrack(e,t),this.drawRequest()}),e.on("volumechange",(e,t)=>{t.setGainLevel(e/100),this.drawRequest()}),e.on("mastervolumechange",e=>{this.masterGain=e/100,this.tracks.forEach(e=>{e.setMasterGainLevel(this.masterGain)})}),e.on("fadein",(e,t)=>{t.setFadeIn(e,this.fadeType),this.drawRequest()}),e.on("fadeout",(e,t)=>{t.setFadeOut(e,this.fadeType),this.drawRequest()}),e.on("stereopan",(e,t)=>{t.setStereoPanValue(e),this.drawRequest()}),e.on("fadetype",e=>{this.fadeType=e}),e.on("newtrack",e=>{this.load([{src:e,name:e.name}])}),e.on("trim",()=>{let e=this.getActiveTrack(),t=this.getTimeSelection();e.trim(t.start,t.end),e.calculatePeaks(this.samplesPerPixel,this.sampleRate),this.setTimeSelection(0,0),this.adjustDuration(),this.drawRequest()}),e.on("zoomin",()=>{let e=Math.max(0,this.zoomIndex-1),t=this.zoomLevels[e];t!==this.samplesPerPixel&&(this.setZoom(t),this.drawRequest())}),e.on("zoomout",()=>{let e=Math.min(this.zoomLevels.length-1,this.zoomIndex+1),t=this.zoomLevels[e];t!==this.samplesPerPixel&&(this.setZoom(t),this.drawRequest())}),e.on("scroll",()=>{this.isScrolling=!0,this.drawRequest(),clearTimeout(this.scrollTimer),this.scrollTimer=setTimeout(()=>{this.isScrolling=!1},200)})}load(e){return Promise.all(e.map(e=>E.createLoader(e.src,this.ac,this.ee).load().then(e=>e.sampleRate===this.sampleRate?e:function(e,t){let n=Math.ceil(e.duration*t),i=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(e.numberOfChannels,n,t),a=i.createBufferSource();return a.buffer=e,a.connect(i.destination),a.start(),i.startRendering()}(e,this.sampleRate)))).then(t=>{this.ee.emit("audiosourcesloaded");let n=t.map((t,n)=>{let i=e[n],a=i.name||"Untitled",o=i.start||0,r=i.states||{},s=i.fadeIn,l=i.fadeOut,c=i.cuein||0,d=i.cueout||t.duration,u=i.gain||1,h=i.muted||!1,p=i.soloed||!1,m=i.selected,f=i.peaks||{type:"WebAudio",mono:this.mono},g=i.customClass||void 0,v=i.waveOutlineColor||void 0,y=i.stereoPan||0,b=i.effects||null,k=new K(this.ac,t,this.masterGainNode),w=new Y;return w.src=i.src,w.setBuffer(t),w.setName(a),w.setEventEmitter(this.ee),w.setEnabledStates(r),w.setCues(c,d),w.setCustomClass(g),w.setWaveOutlineColor(v),void 0!==s&&w.setFadeIn(s.duration,s.shape),void 0!==l&&w.setFadeOut(l.duration,l.shape),void 0!==m&&(this.setActiveTrack(w),this.setTimeSelection(m.start,m.end)),void 0!==f&&w.setPeakData(f),w.setState(this.getState()),w.setStartTime(o),w.setPlayout(k),w.setGainLevel(u),w.setStereoPanValue(y),b&&w.setEffects(b),h&&this.muteTrack(w),p&&this.soloTrack(w),w.calculatePeaks(this.samplesPerPixel,this.sampleRate),w});this.tracks=this.tracks.concat(n),this.adjustDuration(),this.draw(this.render()),this.ee.emit("audiosourcesrendered")}).catch(e=>{this.ee.emit("audiosourceserror",e)})}setActiveTrack(e){this.activeTrack=e}getActiveTrack(){return this.activeTrack}isSegmentSelection(){return this.timeSelection.start!==this.timeSelection.end}setTimeSelection(e=0,t){this.timeSelection={start:e,end:void 0===t?e:t},this.cursor=e}async startOfflineRender(e,t){if(this.isRendering)return;this.isRendering=!0,this.offlineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(2,44100*this.duration,44100);let n=[];this.ee.emit("audiorenderingstarting",this.offlineAudioContext,n);let i=this.offlineAudioContext.currentTime,a=this.offlineAudioContext.createGain();this.tracks.forEach((e,n)=>{let o=this.shouldTrackPlay(e);t>=0&&(o=n===t);let r=new K(this.offlineAudioContext,e.buffer,a);r.setEffects(e.effectsGraph),r.setMasterEffects(this.effectsGraph),e.setOfflinePlayout(r),e.schedulePlay(i,0,0,{shouldPlay:o,masterGain:1,isOffline:!0})}),await Promise.all(n);let o=await this.offlineAudioContext.startRendering();"buffer"===e?(this.ee.emit("audiorenderingfinished",e,o),this.isRendering=!1):"wav"===e&&(this.exportWorker.postMessage({command:"init",config:{sampleRate:44100}}),this.exportWorker.onmessage=n=>{this.ee.emit("audiorenderingfinished",e,n.data,t),this.isRendering=!1,this.exportWorker.postMessage({command:"clear"})},this.exportWorker.postMessage({command:"record",buffer:[o.getChannelData(0),o.getChannelData(1)]}),this.exportWorker.postMessage({command:"exportWAV",type:"audio/wav"}))}getTimeSelection(){return this.timeSelection}setState(e){this.state=e,this.tracks.forEach(t=>{t.setState(e)})}getState(){return this.state}setZoomIndex(e){this.zoomIndex=e}setZoomLevels(e){this.zoomLevels=e}setZoom(e){this.samplesPerPixel=e,this.zoomIndex=this.zoomLevels.indexOf(e),this.tracks.forEach(t=>{t.calculatePeaks(e,this.sampleRate)})}muteTrack(e){let t=this.mutedTracks.indexOf(e);t>-1?(e.muted=!1,this.mutedTracks.splice(t,1)):(e.muted=!0,this.mutedTracks.push(e))}soloTrack(e){let t=this.soloedTracks.indexOf(e);t>-1?(e.soloed=!1,this.soloedTracks.splice(t,1)):this.exclSolo?(e.soloed=!0,this.soloedTracks=[e]):(e.soloed=!0,this.soloedTracks.push(e))}collapseTrack(e,t){if(t.collapsed)this.collapsedTracks.push(e);else{let t=this.collapsedTracks.indexOf(e);t>-1&&this.collapsedTracks.splice(t,1)}}removeTrack(e){e.isPlaying()&&e.scheduleStop(),[this.mutedTracks,this.soloedTracks,this.collapsedTracks,this.tracks].forEach(t=>{let n=t.indexOf(e);n>-1&&t.splice(n,1)}),this.adjustDuration()}adjustTrackPlayout(){this.tracks.forEach(e=>{e.setShouldPlay(this.shouldTrackPlay(e))})}adjustDuration(){this.duration=this.tracks.reduce((e,t)=>Math.max(e,t.getEndTime()),0)}shouldTrackPlay(e){let t;return this.soloedTracks.length>0?(t=!1,this.soloedTracks.indexOf(e)>-1&&(t=!0)):(t=!0,this.mutedTracks.indexOf(e)>-1&&(t=!1)),t}isPlaying(){return this.tracks.reduce((e,t)=>e||t.isPlaying()||this.mediaRecorder&&"recording"===this.mediaRecorder.state,!1)}getCurrentTime(){return(this.lastSeeked||this.pausedAt||this.cursor)+this.getElapsedTime()}getElapsedTime(){return this.ac.currentTime-this.lastPlay}setMasterGain(e){this.ee.emit("mastervolumechange",e)}restartPlayFrom(e,t){return this.stopAnimation(),this.tracks.forEach(e=>{e.scheduleStop()}),Promise.all(this.playoutPromises).then(this.play.bind(this,e,t))}play(e,t){clearTimeout(this.resetDrawTimer);let n=this.ac.currentTime,i=this.getTimeSelection(),a=[],o=0===e?0:e||this.pausedAt||this.cursor,r=t;return(!r&&i.end!==i.start&&i.end>o&&(r=i.end),this.isPlaying())?this.restartPlayFrom(o,r):(this.effectsGraph&&this.tracks&&this.tracks[0].playout.setMasterEffects(this.effectsGraph),this.tracks.forEach(e=>{e.setState("cursor"),a.push(e.schedulePlay(n,o,r,{shouldPlay:this.shouldTrackPlay(e),masterGain:this.masterGain}))}),this.lastPlay=n,this.playoutPromises=a,this.startAnimation(o),Promise.all(this.playoutPromises))}pause(){return this.isPlaying()?(this.pausedAt=this.getCurrentTime(),this.playbackReset()):Promise.all(this.playoutPromises)}stop(){return this.mediaRecorder&&"recording"===this.mediaRecorder.state&&this.mediaRecorder.stop(),this.pausedAt=void 0,this.playbackSeconds=0,this.playbackReset()}playbackReset(){return this.lastSeeked=void 0,this.stopAnimation(),this.tracks.forEach(e=>{e.scheduleStop(),e.setState(this.getState())}),this.isSafari||this.masterGainNode.disconnect(),this.drawRequest(),Promise.all(this.playoutPromises)}rewind(){return this.stop().then(()=>{this.scrollLeft=0,this.ee.emit("select",0,0)})}fastForward(){return this.stop().then(()=>{this.viewDuration<this.duration?this.scrollLeft=this.duration-this.viewDuration:this.scrollLeft=0,this.ee.emit("select",this.duration,this.duration)})}clear(e){return this.stop().then(()=>{var t=[];(e||0===e)&&(this.tracks.splice(e,1),t=this.tracks),this.tracks=t,this.soloedTracks=[],this.mutedTracks=[],this.playoutPromises=[],this.cursor=0,this.playbackSeconds=0,this.duration=0,this.scrollLeft=0,this.seek(0,0,void 0)})}record(){let e=[],t=this.cursor;this.mediaRecorder.start(300),this.tracks.forEach(n=>{n.setState("none"),e.push(n.schedulePlay(this.ac.currentTime,t,void 0,{shouldPlay:n!==this.recordingTrack&&this.shouldTrackPlay(n)}))}),this.playoutPromises=e,this.startAnimation(t)}startAnimation(e){this.lastDraw=this.ac.currentTime,this.animationRequest=window.requestAnimationFrame(()=>{this.updateEditor(e)})}stopAnimation(){window.cancelAnimationFrame(this.animationRequest),this.lastDraw=void 0}seek(e,t,n){this.isPlaying()?(this.lastSeeked=e,this.pausedAt=void 0,this.restartPlayFrom(e)):(this.setActiveTrack(n||this.tracks[0]),this.pausedAt=e,this.setTimeSelection(e,t),"fill"===this.getSeekStyle()&&(this.playbackSeconds=e))}updateEditor(e){let t=this.ac.currentTime,n=this.getTimeSelection(),i=e||this.cursor,a=t-this.lastDraw;if(this.isPlaying()){let e=i+a;this.ee.emit("timeupdate",e),this.animationRequest=window.requestAnimationFrame(()=>{this.updateEditor(e)}),this.playbackSeconds=e,this.draw(this.render()),this.lastDraw=t}else i+a>=(this.isSegmentSelection()?n.end:this.duration)&&this.ee.emit("finished"),this.stopAnimation(),this.resetDrawTimer=setTimeout(()=>{this.pausedAt=void 0,this.lastSeeked=void 0,this.setState(this.getState()),this.playbackSeconds=0,this.draw(this.render())},0)}drawRequest(){window.requestAnimationFrame(()=>{this.draw(this.render())})}draw(e){let t=h()(this.tree,e);this.rootNode=m()(this.rootNode,t),this.tree=e,this.viewDuration=(this.rootNode.clientWidth-this.controls.width)*this.samplesPerPixel/this.sampleRate}getTrackRenderData(e={}){let t={height:this.waveHeight,resolution:this.samplesPerPixel,sampleRate:this.sampleRate,controls:this.controls,isActive:!1,timeSelection:this.getTimeSelection(),playlistLength:this.duration,playbackSeconds:this.playbackSeconds,colors:this.colors,barWidth:this.barWidth,barGap:this.barGap};return a()({},e,t)}isActiveTrack(e){let t=this.getActiveTrack();return!this.isSegmentSelection()||t===e}renderAnnotations(){return this.annotationList.render()}renderTimeScale(){let e=this.controls.show?this.controls.width:0;return new S(this.duration,this.scrollLeft,this.samplesPerPixel,this.sampleRate,e,this.colors).render()}renderTrackSection(){let e=this.tracks.map(e=>{let t=this.collapsedTracks.indexOf(e)>-1;return e.render(this.getTrackRenderData({isActive:this.isActiveTrack(e),shouldPlay:this.shouldTrackPlay(e),soloed:this.soloedTracks.indexOf(e)>-1,muted:this.mutedTracks.indexOf(e)>-1,collapsed:t,height:t?this.collapsedWaveHeight:this.waveHeight,barGap:this.barGap,barWidth:this.barWidth}))});return d()("div.playlist-tracks",{attributes:{style:"overflow: auto;"},onscroll:e=>{this.scrollLeft=e.target.scrollLeft*this.samplesPerPixel/this.sampleRate,this.ee.emit("scroll")},hook:new T(this)},e)}render(){let e=[];return this.showTimescale&&e.push(this.renderTimeScale()),e.push(this.renderTrackSection()),this.annotationList.length&&e.push(this.renderAnnotations()),d()("div.playlist",{attributes:{style:"overflow: hidden; position: relative;"}},e)}getInfo(){let e=[];return this.tracks.forEach(t=>{e.push(t.getTrackDetails())}),{tracks:e,effects:this.effectsGraph}}constructor(){this.tracks=[],this.soloedTracks=[],this.mutedTracks=[],this.collapsedTracks=[],this.playoutPromises=[],this.cursor=0,this.playbackSeconds=0,this.duration=0,this.scrollLeft=0,this.scrollTimer=void 0,this.showTimescale=!1,this.isScrolling=!1,this.fadeType="logarithmic",this.masterGain=1,this.annotations=[],this.durationFormat="hh:mm:ss.uuu",this.isAutomaticScroll=!1,this.resetDrawTimer=void 0,this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}};function ea(e={},t=l()()){if(void 0===e.container)throw Error("DOM element container must be given.");let n=a()({},e,{samplesPerPixel:4096,mono:!0,fadeType:"logarithmic",exclSolo:!1,timescale:!1,controls:{show:!1,width:150,widgets:{muteOrSolo:!0,volume:!0,stereoPan:!0,collapse:!0,remove:!0}},colors:{waveOutlineColor:"white",timeColor:"grey",fadeColor:"black"},seekStyle:"line",waveHeight:128,collapsedWaveHeight:30,barWidth:1,barGap:0,state:"cursor",zoomLevels:[512,1024,2048,4096],annotationList:{annotations:[],controls:[],editable:!1,linkEndpoints:!1,isContinuousPlay:!1},isAutomaticScroll:!1}),i=n.zoomLevels.indexOf(n.samplesPerPixel);if(-1===i)throw Error("initial samplesPerPixel must be included in array zoomLevels");let o=new ei,s=window.AudioContext||window.webkitAudioContext||!1,c=n.ac||new s({latencyHint:0});o.setAudioContext(c),o.setSampleRate(n.sampleRate||c.sampleRate),o.setSamplesPerPixel(n.samplesPerPixel),o.setEventEmitter(t),o.setUpEventEmitter(),o.setTimeSelection(0,0),o.setState(n.state),o.setControlOptions(n.controls),o.setWaveHeight(n.waveHeight),o.setCollapsedWaveHeight(n.collapsedWaveHeight),o.setColors(n.colors),o.setZoomLevels(n.zoomLevels),o.setZoomIndex(i),o.setMono(n.mono),o.setExclSolo(n.exclSolo),o.setShowTimeScale(n.timescale),o.setSeekStyle(n.seekStyle),o.setAnnotations(n.annotationList),o.setBarGap(n.barGap),o.setBarWidth(n.barWidth),o.isAutomaticScroll=n.isAutomaticScroll,o.isContinuousPlay=n.isContinuousPlay,o.linkedEndpoints=n.linkedEndpoints,n.effects&&o.setEffects(n.effects);let d=o.render(),u=r()(d);return n.container.appendChild(u),o.tree=d,o.rootNode=u,o}function eo(e={},t=l()()){return ea(e,t)}})(),i})();var c=o("7hG31"),tg=o("kJxWi"),l=o("lV0Oe"),tv={},ty={};ty=function(e,t,n){if(t===self.location.origin)return e;var i=n?"import "+JSON.stringify(e)+";":"importScripts("+JSON.stringify(e)+");";return URL.createObjectURL(new Blob([i],{type:"application/javascript"}))};var tb=o("luG8Y");let tk=tb.getBundleURL("4Iqbg")+"metronomeworker.fe4b894a.js";tv=ty(tk,tb.getOrigin(tk),!1);class tw{init(){this.timerWorker=new Worker(tv),this.timerWorker.onmessage=e=>{"tick"===e.data&&this.scheduler()},this.timerWorker.postMessage({interval:this.lookahead})}nextNote(){let e=60/this.tempo*(4/this.noteDuration);this.nextNoteTime+=e,this.currentBeatInBar++,(this.currentBeatInBar===this.beatsPerBar||this.prevBeatBar!==this.beatsPerBar)&&(this.currentBeatInBar=0,this.prevBeatBar=this.beatsPerBar)}scheduleNote(e,t){this.notesInQueue.push({note:e,time:t});let n=this.audioContext.createOscillator(),i=this.audioContext.createGain();n.frequency.value=0===e?1e3:800,i.gain.value=1,i.gain.exponentialRampToValueAtTime(1,t+.001),i.gain.exponentialRampToValueAtTime(.001,t+.02),n.connect(i),i.connect(this.audioContext.destination),n.start(t),n.stop(t+.03)}scheduler(){for(;this.nextNoteTime<this.audioContext.currentTime+this.scheduleAheadTime;)this.scheduleNote(this.currentBeatInBar,this.nextNoteTime),this.nextNote()}start(e=0){if(this.isRunning)return;null===this.audioContext&&(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.isRunning=!0;let t=60/this.tempo*(4/this.noteDuration),n=Math.floor(e/t),i=e%(t*this.beatsPerBar);this.currentBeatInBar=n%this.beatsPerBar,this.nextNoteTime=this.audioContext.currentTime+.05-i,this.timerWorker.postMessage("start"),this.callback_start&&this.callback_start()}stop(){this.isRunning=!1,this.timerWorker.postMessage("stop"),this.callback_stop&&this.callback_stop()}startStop(e=0){this.isRunning?this.stop():this.start(e)}constructor(){this.audioContext=null,this.notesInQueue=[],this.currentBeatInBar=0,this.beatsPerBar=4,this.noteDuration=4,this.tempo=120,this.lookahead=25,this.scheduleAheadTime=.1,this.nextNoteTime=0,this.isRunning=!1,this.timerWorker=null,this.activate=!1,this.callback_start=null,this.callback_stop=null,this.prevBeatBar=4}}let tx=null,tE=()=>{(null==tx?void 0:tx.isRunning)&&tx.stop()},tT=()=>{let e=document.getElementById("tempo");e.textContent=tx.tempo;let t=document.querySelectorAll("[data-id='tempo-change']");for(let n=0;n<t.length;n++)t[n].addEventListener("click",function(){let t=parseInt(this.dataset.change),n=tx.tempo+t;n>=5&&n<=500&&(tx.tempo=n,e.textContent=tx.tempo,tI())})},tC=()=>{let e=document.getElementById("beatsperbar");e.textContent=tx.beatsPerBar;let t=document.querySelectorAll("[data-id='beatsperbar-change']");for(let n=0;n<t.length;n++)t[n].addEventListener("click",function(){let t=parseInt(this.dataset.change),n=tx.beatsPerBar+t;n>=1&&n<=50&&(tx.beatsPerBar=n,e.textContent=tx.beatsPerBar,document.getElementById("topnumbersignature").textContent=tx.beatsPerBar,tI())})},tS={1:"",2:"",4:"",8:"",16:""},tP=()=>{let e=document.getElementById("notedurationselectable");e.onchange=()=>{tx.noteDuration=e.value,document.getElementById("bottomnumbersignature").textContent=e.value,document.getElementById("noteMusicSymbol").textContent=tS[e.value],tI()}},tI=()=>{if(null==tx?void 0:tx.isRunning){let e=60/tx.tempo*(4/tx.noteDuration);document.getElementById("metronome-fonticon").style.animation=`blink ${e}s infinite`}},tO=()=>{document.getElementById("metronome-fonticon").classList.remove("text-success"),document.getElementById("metronome-fonticon").classList.add("text-warning"),tI()},t_=()=>{document.getElementById("metronome-fonticon").classList.remove("text-warning"),tx.activate&&document.getElementById("metronome-fonticon").classList.add("text-success"),document.getElementById("metronome-fonticon").style.animation="none"},tA=()=>{let e=document.getElementById("play-pause-icon");tx.startStop(),tx.isRunning?e.className="pause-metronome-icon":e.className="play-metronome-icon"},tR=()=>{tx.activate=!tx.activate,tx.activate?document.getElementById("metronome-fonticon").classList.add("text-success"):document.getElementById("metronome-fonticon").classList.remove("text-success")},tB=()=>{(0,l.default).dynamicModalDialog(`<div class='subtext-metronome'>Time signature: <span id='topnumbersignature'>4</span>/<span id='bottomnumbersignature'>4</span></div>
        <div class='metronome-controls'>
            <div class='metronome-switch custom-control custom-switch'>
                <input type='checkbox' class='custom-control-input' id='metronomeSwitch'>
                <label class='custom-control-label' for='metronomeSwitch'>Activate</label>
            </div>
        </div>
        <div class='metronome-controls'>
            <button id='play-button' type='button' class='btn metronome-button play-pause-metronome-button btn-success'>
                <div id='play-pause-icon' class='play-metronome-icon'></div>
            </button>
        </div>        
        <div class='metronome-controls'>
        
            <button data-id='tempo-change' type='button' class='btn btn-secondary metronome-button' data-change='-5'>-5</button>
            <button data-id='tempo-change' type='button' class='btn btn-light metronome-button' data-change='-1'>-</button>

            <div class='tempo-container'>
                <div id='tempo' class='number-metronome'>120</div>
                <div class='subtext-metronome'>bpm</div>
            </div>

            <button data-id='tempo-change' type='button' class='btn btn-light metronome-button' data-change='+1'>+</button>
            <button data-id='tempo-change' type='button' class='btn btn-secondary metronome-button' data-change='+5'>+5</button>
        </div>
        <div class='metronome-controls'>
            <button data-id='beatsperbar-change' type='button' class='btn btn-light metronome-button' data-change='-1'>-</button>
            <div class='bar-container'>
                <div id='beatsperbar' class='number-metronome'>4</div>
                <div class='subtext-metronome'>&nbsp;beats / bar</div>                
            </div>
            <button data-id='beatsperbar-change' type='button' class='btn btn-light metronome-button' data-change='+1'>+</button>            
        </div>
        <div class='metronome-controls'>
            <div class='tempo-container'>
                <label class='subtext-metronome' for='notedurationselectable'>Note value:&nbsp;</label>
                <span id='noteMusicSymbol' class='music-symbols'>
                    &#xE1D3;
                </span>
                <select class='custom-select' id='notedurationselectable'>
                    <option value='1'>1 = Whole note (semibreve)</option>
                    <option value='2'>2 = Minim</option>
                    <option value='4' selected>4 = Crotchet</option>
                    <option value='8'>8 = Quaver</option>
                    <option value='16'>16 = Semi-Quaver</option>
                </select>
            </div>
        </div>`,null,"","Close","<i class='fas fa-music'></i>&nbsp;&nbsp;<span>Metronome</span>","bg-secondary",tE),tx||((tx=new tw).init(),tx.callback_start=tO,tx.callback_stop=t_),tx.isRunning&&(document.getElementById("play-pause-icon").className="pause-metronome-icon");let e=document.getElementById("metronomeSwitch");e.checked=tx.activate,document.getElementById("play-button").onclick=tA,tT(),tC(),tP(),e.onclick=tR,document.getElementById("topnumbersignature").textContent=tx.beatsPerBar,document.getElementById("bottomnumbersignature").textContent=tx.noteDuration,document.getElementById("notedurationselectable").value=tx.noteDuration,document.getElementById("noteMusicSymbol").textContent=tS[tx.noteDuration]},tL=()=>`<li class='nav-item'>
    <a class='nav-link' href='#' id='trigger-metronome-btn' data-toggle='modal' 
      data-toggle='popover' data-placement='bottom'  title='Tic Tac...' data-content='Volume please'>
      METRONOME  <i id='metronome-fonticon' class='fas fa-square'>&nbsp;</i></a>
  </li>`,tD=()=>{document.getElementById("trigger-metronome-btn").onclick=()=>{tB()}};var tM=null,tN=$("body"),t$=tN.find(".time-format"),tj=tN.find(".audio-start"),tG=tN.find(".audio-end"),tF=tN.find(".audio-pos"),tU="hh:mm:ss.uuu",tV=0,tH=0,tz=0,tW=void 0,tq=!1,tX=!1;function tY(e){for(var t=e.parentNode.querySelectorAll(".active"),n=0,i=t.length;n<i;n++)t[n].classList.remove("active");e.classList.toggle("active")}function tJ(e){function t(e,t){var n,i,a;return((n=parseInt(e/3600,10)%24)<10?"0"+n:n)+":"+((i=parseInt(e/60,10)%60)<10?"0"+i:i)+":"+((a=(a=e%60).toFixed(t))<10?"0"+a:a)}return({seconds:function(e){return e.toFixed(0)},thousandths:function(e){return e.toFixed(3)},"hh:mm:ss":function(e){return t(e,0)},"hh:mm:ss.u":function(e){return t(e,1)},"hh:mm:ss.uu":function(e){return t(e,2)},"hh:mm:ss.uuu":function(e){return t(e,3)}})[e]}function tK(e,t){e<t?($(".btn-trim-audio").removeClass("disabled"),$(".btn-loop").removeClass("disabled")):($(".btn-trim-audio").addClass("disabled"),$(".btn-loop").addClass("disabled")),tj.val(tJ(tU)(e)),tG.val(tJ(tU)(t)),tV=e,tH=t}function tZ(e){tF.html(tJ(tU)(e)),tz=e}tK(0,0),tZ(tz);let tQ={};tN.on("click",".btn-annotations-download",function(){tM.emit("annotationsrequest")}),tN.on("click",".btn-loop",function(){tq=!0,t=nL.play(tV,tH)}),tN.on("click",".btn-play",function(){(null==tx?void 0:tx.activate)&&!(null==tx?void 0:tx.isRunning)&&tx.start(nL.cursor),tM.emit("play"),$(".btn-group .btn-record").prop("disabled",!0)}),tN.on("click",".btn-pause",function(){tq=!1,tM.emit("pause"),$(".btn-group .btn-record").prop("disabled",!1)}),tN.on("click",".btn-stop",function(){if((null==tx?void 0:tx.activate)&&(null==tx?void 0:tx.isRunning)&&tx.stop(),tq=!1,tX&&(tX=!1,n_)){let e=nL.getInfo().tracks.length-1;tM.emit("startaudiorendering","wav",e)}tM.emit("stop"),$(".btn-group button").prop("disabled",!1)}),tN.on("click",".btn-rewind",function(){tq=!1,tM.emit("rewind"),$(".btn-group .btn-record").prop("disabled",!1)}),tN.on("click",".btn-fast-forward",function(){tq=!1,tM.emit("fastforward"),$(".btn-group .btn-record").prop("disabled",!1)}),tN.on("click",".btn-clear",function(){tq=!1,tM.emit("clear")});let t0=e=>{tX||((null==tx?void 0:tx.activate)&&((null==tx?void 0:tx.isRunning)&&tx.stop(),tx.start(nL.cursor)),tX=!0,$(".btn-group button").prop("disabled",!0),$(".btn-group .btn-stop").prop("disabled",!1),tM.emit("record",e/1e3))};function t1(e){if(null==e?void 0:e.customClass){let t=(({muted:e,gain:t,soloed:n,stereoPan:i})=>({muted:e,gain:t,soloed:n,stereoPan:i}))(e);t.track_id=e.customClass.track_id,t.composition_id=e.customClass.composition_id;let n=e.customClass.viewer_id||e6;d?h(d,t):u(n).then(e=>{h(e,t)})}}function t2(e,t){t1(t),$(".sound-status").html(e)}function t3(e){var t=$("<div/>").append(e);$(".loading-data").append(t)}tN.on("click",".btn-record",function(){if(nA)nH();else if(!tX){e6?n_||nq():nW();let e=localStorage.getItem("latency");t0(e=e?parseInt(e):0)}}),tN.on("click",".btn-cursor",function(){tM.emit("statechange","cursor"),tY(this)}),tN.on("click",".btn-select",function(){tM.emit("statechange","select"),tY(this)}),tN.on("click",".btn-shift",function(){tM.emit("statechange","shift"),tY(this)}),tN.on("click",".btn-fadein",function(){tM.emit("statechange","fadein"),tY(this)}),tN.on("click",".btn-fadeout",function(){tM.emit("statechange","fadeout"),tY(this)}),tN.on("click",".btn-logarithmic",function(){tM.emit("fadetype","logarithmic"),tY(this)}),tN.on("click",".btn-linear",function(){tM.emit("fadetype","linear"),tY(this)}),tN.on("click",".btn-scurve",function(){tM.emit("fadetype","sCurve"),tY(this)}),tN.on("click",".btn-exponential",function(){tM.emit("fadetype","exponential"),tY(this)}),tN.on("click",".btn-zoom-in",function(){tM.emit("zoomin")}),tN.on("click",".btn-zoom-out",function(){tM.emit("zoomout")}),tN.on("click",".btn-trim-audio",function(){tM.emit("trim")}),tN.on("click",".btn.print",function(){console.log(nL.getInfo())}),tN.on("click",".btn-download",function(){nL.tracks.length&&tM.emit("startaudiorendering","wav")}),tN.on("click",".btn-seektotime",function(){var e=parseInt(document.getElementById("seektime").value,10);tM.emit("select",e,e)}),tN.on("change",".select-seek-style",function(e){nL.setSeekStyle(e.target.value)}),tN.on("change","#fileInput",function(e){for(var t=this.files,n=0;n<t.length;n++)tM.emit("newtrack",t[n])}),tN.on("dragenter",".track-drop",function(e){e.preventDefault(),e.target.classList.add("drag-enter")}),tN.on("dragover",".track-drop",function(e){e.preventDefault()}),tN.on("dragleave",".track-drop",function(e){e.preventDefault(),e.target.classList.remove("drag-enter")}),tN.on("drop",".track-drop",function(e){e.preventDefault(),e.target.classList.remove("drag-enter");for(var t=e.originalEvent,n=0;n<t.dataTransfer.files.length;n++)tM.emit("newtrack",t.dataTransfer.files[n])}),tN.on("change",".time-format",function(e){tU=t$.val(),tM.emit("durationformat",tU),tK(tV,tH),tZ(tz)}),tN.on("input change",".master-gain",function(e){tM.emit("mastervolumechange",e.target.value)}),tN.on("change",".continuous-play",function(e){tM.emit("continuousplay",$(e.target).is(":checked"))}),tN.on("change",".link-endpoints",function(e){tM.emit("linkendpoints",$(e.target).is(":checked"))}),tN.on("change",".automatic-scroll",function(e){tM.emit("automaticscroll",$(e.target).is(":checked"))});let t4=()=>{tM=nL.getEventEmitter()},t6=()=>{tM.on("select",tK),tM.on("timeupdate",tZ),tM.on("mute",function(e){t2("Mute button pressed for "+e.name,e)}),tM.on("solo",function(e){t2("Solo button pressed for "+e.name,e)});let e=null;tM.on("volumechange",function(t,n){t2(n.name+" now has volume "+t+"."),clearTimeout(e),e=setTimeout(()=>{t1(n)},500)});let n=null;tM.on("stereopan",function(e,t){t2(t.name+" now has stereo pan "+e+"."),clearTimeout(n),n=setTimeout(()=>{t1(t)},500)}),tM.on("mastervolumechange",function(e){t2("Master volume now has volume "+e+".")});var i=["uninitialized","loading","decoding","finished"];tM.on("audiorequeststatechange",function(e,t){var n=t;t instanceof File&&(n=t.name),t3("Track "+n+" is in state "+i[e])}),tM.on("loadprogress",function(e,t){var n=t;t instanceof File&&(n=t.name),function(e,t){let n=document.getElementById("download-progress-elems");if(n&&!n.hidden){let i=0;tQ[e]=t;let a=document.getElementById("download-progress-bar"),o=document.getElementById("download-percentage");for(let[e,t]of Object.entries(tQ))i+=t;let r=(i/e7).toFixed(2);a.value=r/100,o.innerHTML=r+" %",100==r&&(n.innerHTML="Rendering...<br><progress></progress>")}}(n,e),t3("Track "+n+" has loaded "+e+"%")}),tM.on("audiosourcesloaded",function(){t3("Tracks have all finished decoding.")});let a=0,o=[];tM.on("audiosourcesrendered",function(){if(nV(),nX(),n_){let e=document.getElementById("fileInput"),t=e.files.length;if(t){let n=nL.tracks.length-1,i=Date.now();if(nL.tracks[n].trackuid=i,a<t&&(o.push(nL.tracks[n]),a++),a===t){let t=Array.from(e.files);for(let n=0;n<e.files.length;n++){let e=t.findIndex(e=>e.name===o[n].name);nM.sendData(t[e],null,o[n].trackuid)}o=[],a=0}}else t3("Tracks have been rendered")}}),tM.on("audiosourceserror",function(e){nz(e)}),tM.on("audiorenderingfinished",function(e,t,n){if(n>=0&&n_){let e=Date.now();t.name="audio",t.fileName=e+".wav",nL.tracks[n].trackuid=e,nM.sendData(t,"blob",e)}else if("wav"==e){var i,a;tW&&window.URL.revokeObjectURL(tW),a=$("<a/>",{href:tW=window.URL.createObjectURL(t),download:"waveformplaylist"+(i=new Date().toISOString())+".wav",text:"Download mix "+i,class:"btn btn-small btn-download-link"}),$(".btn-download-link").remove(),$(".btn-download").after(a)}}),tM.on("finished",function(){console.log("The cursor has reached the end of the selection !"),$(".btn-group .btn-record").prop("disabled",!1),tq&&t.then(function(){t=nL.play(tV,tH)})})},t7=window.AudioContext||window.webkitAudioContext||!1,t9=()=>{let e=document.getElementById("autocorrelationCanvas1");e.width=window.innerWidth/2,e.height=window.innerHeight/2,e.getContext("2d").clearRect(0,0,e.width,e.height);let t=document.getElementById("autocorrelationCanvas2");t.width=window.innerWidth/2,t.height=window.innerHeight/2,t.getContext("2d").clearRect(0,0,t.width,t.height);let n=document.getElementById("leftChannelCanvas");n.getContext("2d").clearRect(0,0,n.width,n.height);let i=document.getElementById("rightChannelCanvas");i.getContext("2d").clearRect(0,0,i.width,i.height)},t5=(e,t,n,i)=>{let a=document.getElementById(t);!function(e,t,n,i){let a=Math.ceil(i.length/e),o=t/2;for(let t=0;t<e;t++){let e=1,r=-1;for(let n=0;n<a;n++){let o=i[t*a+n];o<e&&(e=o),o>r&&(r=o)}n.fillRect(t,(1+e)*o,1,Math.max(1,(r-e)*o))}}(a.width,a.height,a.getContext("2d"),e),function(e,t){let n=document.getElementById(t);n.width=window.innerWidth/2,n.height=window.innerHeight/2;let i=n.getContext("2d");i.clearRect(0,0,n.width,n.height);let a=n.width,o=n.height,r=Math.max(...e);e.forEach((t,n)=>{let s=n/e.length*(a-40)+20;i.beginPath(),i.moveTo(s,o-20),i.lineTo(s,(1-t/r)*(o-40)+20),i.strokeStyle="#FF0000",i.stroke()}),i.fillStyle="#000000",i.textAlign="center",i.textBaseline="top";let s=Math.ceil(e.length/10);for(let t=0;t<=e.length;t+=s){let n=t/e.length*(a-40)+20;i.fillText(t,n,o-10)}i.textAlign="right",i.textBaseline="middle";let l=r/5;for(let e=0;e<=5;e++){let t=(l*e).toFixed(2),n=(1-e/5)*(o-40)+20;i.fillText(t,10,n)}}(i,n)};class t8 extends Error{constructor(e){super(e),this.name="BitError"}}let ne={2:[1],3:[2],4:[3],5:[2],6:[5],7:[6],8:[4,5,6],9:[5],10:[7],11:[9],12:[6,8,11],13:[4,12],14:[5,13],15:[14],16:[4,13,15]},nt=`<div class='container' id='audio-area'>
                    <canvas id='leftChannelCanvas' width='800' height='100' style='border:1px solid #000000;'></canvas>
                    <canvas id='rightChannelCanvas' width='800' height='100' style='border:1px solid #000000;' hidden></canvas>
                    <canvas id='autocorrelationCanvas1' style='border:1px solid #000000;'></canvas>
                    <canvas id='autocorrelationCanvas2' style='border:1px solid #000000;' hidden></canvas>
                </div>`;var nn={},tb=o("luG8Y");let ni=tb.getBundleURL("4Iqbg")+"worker.e40333ee.js";nn=ty(ni,tb.getOrigin(ni),!1);class na{static setCurrentLatency(e){localStorage.setItem("latency",e),nk(e),na.currentlatency=e}static getCurrentLatency(){return na.currentlatency}static getCorrectStreamForSafari(e){let t=parseInt(na.browserId.version);if("safari"!==na.browserId.browser||!(t>=16))return e;{let t=na.audioContext.createMediaStreamSource(e);na.recordGainNode=na.audioContext.createGain(),t.connect(na.recordGainNode),na.recordGainNode.gain.value=50;let n=na.audioContext.createMediaStreamDestination();return n.channelCount=1,na.recordGainNode.connect(n),n.stream}}static async initialize(e,t,n,i,a){na.browserId=a,na.btnId=n,na.worker=new Worker(nn),na.worker.addEventListener("message",e=>{na.workerMessageHanlder(e)}),i&&(console.log("AudioContext",e),na.debugCanvas=i,document.getElementById("page-header").insertAdjacentHTML("afterend",nt));let o=localStorage.getItem("latency");na.currentlatency=o?parseInt(o):null,na.audioContext=e,na.onAudioPermissionGranted(t)}static onAudioPermissionGranted(e){let t=function(e,t=null){if(!(e in ne))throw new t8(`taps for ${e} bits unknown`);let n=ne[e];if(null===t)t=Array(e).fill(1);else if(t.length!==e)throw new t8(`length of seed must equal ${e}`);return function(e,t){let n=t.length,i=t.slice(),a=[];for(let t=0;t<(1<<n)-1;t++){let t=i[0];a.push(t?1:0),e.forEach(e=>{t^=i[e]}),i.push(t),i.shift()}return a}(n,t)}(parseInt(15));na.noiseBuffer=na.generateAudio(t,na.audioContext.sampleRate);let n=na.getCorrectStreamForSafari(e);na.inputStream=n,na.debugCanvas&&n.getTracks().forEach(async function(e){console.log("Test Latency Track Settings",e.getSettings())}),na.displayStart()}static displayStart(){na.content=document.getElementById(na.btnId),na.content.innerHTML="",na.startbutton=document.createElement("a"),na.startbutton.innerText="TEST LATENCY",na.startbutton.classList.add("btn-outline-success"),na.startbutton.onclick=na.onAudioSetupFinished,na.content.appendChild(na.startbutton),na.debugCanvas&&t9()}static async onAudioSetupFinished(){na.startbutton.innerText="STOP",na.startbutton.classList.remove("btn-outline-success"),na.startbutton.classList.add("btn-outline-danger"),na.startbutton.onclick=na.displayStart,na.prepareAudioToPlayAndrecord()}static prepareAudioToPlayAndrecord(){na.signalrecorded=null;let e=na.audioContext.createBuffer(1,4*na.audioContext.sampleRate,na.audioContext.sampleRate),t=na.audioContext.createBufferSource();t.buffer=e,t.start(0),(()=>{let e=na.audioContext.createBufferSource();e.buffer=na.noiseBuffer,e.connect(na.audioContext.destination);let t=[],n=new MediaRecorder(na.inputStream);n.ondataavailable=async e=>{t.push(e.data)},n.onstop=async()=>{e.disconnect(na.audioContext.destination),na.displayAudioTagElem(t,n.mimeType)},n.start(),e.start(),e.onended=function(){n.stop(),na.finishTest()}})()}static finishTest(){na.startbutton.innerText="PROCESSING... ",na.startbutton.classList.remove("btn-outline-danger"),na.startbutton.classList.add("btn-outline-primary"),na.startbutton.onclick=na.displayStart}static async blobToAudioBuffer(e,t){let n=await t.arrayBuffer();return await e.decodeAudioData(n)}static workerMessageHanlder(e){e.data.correlation&&(na.correlation=e.data.correlation,na.worker.postMessage({command:"findpeak",array:na.correlation,channel:e.data.channel})),e.data.peakValuePow&&na.displayresults(e.data,na.signalrecorded,na.noiseBuffer,na.correlation)}static async displayAudioTagElem(e,t){let n=new Blob(e,{type:t});na.signalrecorded=await na.blobToAudioBuffer(na.audioContext,n),na.debugCanvas&&(console.log("signalrecorded",na.signalrecorded),console.log("mlssignal",na.noiseBuffer)),na.correlation=null,na.worker.postMessage({command:"correlation",data1:na.signalrecorded.getChannelData(0),data2:na.noiseBuffer.getChannelData(0),maxLag:.6*na.audioContext.sampleRate,channel:0}),URL.revokeObjectURL(n)}static generateAudio(e,t){let n=na.audioContext.createBuffer(1,e.length,t),i=n.getChannelData(0);for(let t=0;t<e.length;t++)i[t]=1===e[t]?1:-1;return n}static displayresults(e,t,n,i){if(0===e.channel){let a=Number(e.peakIndex/n.sampleRate*1e3).toFixed(2),o=10*Math.log10(e.peakValuePow/e.mean);console.log("Corr Ratio",o),isNaN(o)||o<=18?$("#latencyTestWarning").modal("show"):na.setCurrentLatency(a),na.startbutton.innerText="TEST AGAIN ",na.startbutton.innerHTML+=`<span class='badge badge-info'>lat: ${a} ms.</span>`,na.startbutton.innerHTML+=`<span class='badge badge-light'>ratio: ${o.toFixed(2)} dB</span>`,na.startbutton.classList.remove("btn-outline-danger"),na.debugCanvas&&(console.log("peak energy info",e),console.log("Latency = ",a+" ms"),t5(t.getChannelData(0),"leftChannelCanvas","autocorrelationCanvas1",i),console.log("signalrecorded.numberOfChannels",t.numberOfChannels),t.numberOfChannels>1&&(document.getElementById("rightChannelCanvas").hidden=!1,document.getElementById("autocorrelationCanvas2").hidden=!1,na.correlation=null,na.worker.postMessage({command:"correlation",data1:na.signalrecorded.getChannelData(1),data2:na.noiseBuffer.getChannelData(0),maxLag:.6*na.audioContext.sampleRate,channel:1})))}else console.log("Channel",e.channel),console.log("Latency = ",e.peakIndex/n.sampleRate*1e3+" ms"),console.log("Corr Ratio",10*Math.log10(e.peakValuePow/e.mean)),t5(t.getChannelData(1),"rightChannelCanvas","autocorrelationCanvas2",na.correlation)}constructor(){eC(this,"currentlatency",null),eC(this,"noiseBuffer",null),eC(this,"debugCanvas",!1),eC(this,"audioContext",null),eC(this,"worker",null),eC(this,"signalrecorded",null),eC(this,"btnId",null),eC(this,"inputStream",null),eC(this,"browserId",null)}}var l=o("lV0Oe");let no=/^mozilla\/\d\.\d\W/,nr=/(\w+)\/(\d+\.\d+(?:\.\d+)?(?:\.\d+)?)/g,ns=/^(ver|cri|gec)/,nl=["chrome","opera","safari","edge","firefox"],nc="Unknown",{isArray:nd}=Array,nu=window.navigator.userAgentData,nh=window.navigator.userAgent,np={iphone:/iphone/,ipad:/ipad|macintosh/,android:/android/},nm={windows:/win/,mac:/macintosh/,linux:/linux/};var nf=(e,t)=>{if(nh="string"==typeof e?e:nh,nu="string"==typeof t?t:nu,nh){let e=nh.toLowerCase().replace(no,""),t=Object.keys(np).find(t=>np[t].test(e)&&window.navigator.maxTouchPoints>=1),n=Object.keys(nm).find(t=>nm[t].test(e)),i=e.match(nr),a=e.match(/version\/(\d+(\.\d+)*)/),o=nd(a)?a[1]:null,r=i&&(i.length>2&&!ns.test(i[1])?1:0),s=i&&i[i.length-1-(r||0)].split("/"),l=s&&s[0],c=o||s&&s[1];if(e.includes("edg/")){let t=e.match(/edg\/(\d+\.\d+)/);l="edge",c=t&&t[1]}return{os:t||n,browser:l,version:c}}if(!nu)return console.error("Could not find `userAgent` or `userAgentData` window.navigator properties to set `os`, `browser` and `version`"),{os:navigator.platform||nc,browser:nc,version:nc};{let e;let t=nu.platform.toLowerCase();for(let t of nu.brands){let n=t.brand.toLowerCase(),i=nl.find(e=>{if(n.includes(e))return e});if(i){e={browser:i,version:t.version};break}}return eS({os:t},e||{browser:nc,version:nc})}};let ng="testlatencymlsbtn",nv=!1,ny=nf(),nb=new URL(o("luG8Y").getBundleURL("4Iqbg")+"imgtestlatdemo.92f5146f.webp"),nk=e=>{let t=document.getElementById("current-lat-val");t&&(t.innerText=e)},nw=()=>`<li class='nav-item'>
    <a class='nav-link' href='#' id='trigger-lat-test-btn' data-toggle='modal' 
      data-toggle='popover' data-placement='bottom'  title='Testing ...' data-content='No input detected'>
      LATENCY TEST</a>
  </li>`,nx={mls:!0},nE=`<div class="modal fade" id="latencyTestWarning" tabindex="-1" aria-labelledby="latencyTestWarningLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header bg-warning">
              <h5 class="modal-title" id="latencyTestWarning">Latency Test Issue</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
                <p>It seems there's a problem trying to estimate the latency. Please check the audio settings of your device carefully.</p> 
                <!-- If you have any issue you can also visit our support page. <p>More information at: <span> <a href="${window.location.origin}/static/support.html" target="_blank">${window.location.origin}/static/support.html</a></span></p> -->
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
    </div>`,nT=()=>{document.getElementById("latencyslider").onchange=e=>{localStorage.setItem("latency",e.target.value),document.getElementById("latinputval").value=e.target.value,nk(e.target.value)},document.getElementById("latinputval").onchange=e=>{localStorage.setItem("latency",e.target.value),document.getElementById("latencyslider").value=e.target.value,nk(e.target.value)}},nC=e=>{let t=-1!==document.location.search.indexOf("debug"),n=localStorage.getItem("latency");(0,l.default).dynamicModalDialog(`<img src='${nb}' class='mx-auto d-block visible-animate' alt='...' width='266' height='266'>
        <p>Place your mic as close as possible to the speakers/headphones.</p>
        <p class='alert alert-danger'><b>WARNING!</b> Be careful with the volume as a noise will be played through the speakers.</p>
        <p>${n?'<i>Current latency: <span id="current-lat-val">'+n+"</span> ms.</i>":""}</p>
        ${nx.mls?`<a class='nav-link' href='#' id='${ng}' data-toggle='modal' 
        data-toggle='popover' data-placement='bottom'  title='Testing ...' data-content='No input detected'></a><br>`:""}       
        <details ${t?"":"hidden"}>
            <summary>Advanced</summary>
            <br/>
            <p><label for='formControlLatRange'>Set the value manually (ms): </label>
                <div class='form-group col-md-5'>
                <input id='latinputval' type='number' min='0' max='500' class='form-control' placeholder='${n||0}'>
                </div>
                <input type='range' min='0' max='500' class='form-control-range' id='latencyslider' value='${n||0}'>
            </p>
        </details>
        ${nE}
       `,null,"","Close","Latency Test","bg-success",null),nT(),nv?nx.mls&&na.displayStart():(nv=!0,nx.mls&&na.initialize(nL.ac,e,ng,t,ny))},nS=null,nP=async()=>{if("wakeLock"in navigator)try{nS=await navigator.wakeLock.request("screen"),console.log("Wake Lock Activated")}catch(e){nS=!1,console.log("Error",e)}},nI=e=>{console.log(ny),document.getElementById("trigger-lat-test-btn").onclick=async()=>{nA?nH():(null===nS&&await nP(),nC(e))}};var l=o("lV0Oe"),c=o("7hG31");let nO=window.location.search.split("compositionId=")[1],n_=!1,nA=null,nR=e=>{n_=e},nB=e=>{nA=e},nL=null,nD=null,nM=null,nN=(e,t)=>{var n;nL=((n=tf)&&n.__esModule?n.default:n)({samplesPerPixel:3e3,waveHeight:100,container:document.getElementById("playlist"),state:"cursor",colors:{waveOutlineColor:"#E0EFF1",timeColor:"grey",fadeColor:"black"},controls:{show:!0,width:200,widgets:{stereoPan:!0,collapse:!1,remove:!0}},zoomLevels:[500,1e3,3e3,5e3],isAutomaticScroll:!0,timescale:!0,ac:e}),nM=new tm(nO,nD=new tp),nI(t),tD()},n$=nf(),nj=new class{init(e){let t;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;let n=n=>{nN(new t7({latencyHint:0}),n),t=this.getCorrectStreamForSafari(n),nL.initRecorder(t,void 0,"Voice Track"),$(".btn-record").removeClass("disabled"),this.setRecordGainNodeForTest(this.recordGainNode),t4(),t6(),e5(e,e8)},i=t=>{console.error(t),nN(new t7({latencyHint:0})),t4(),t6(),e5(e,e8),nB(t)};navigator.mediaDevices?navigator.mediaDevices.getUserMedia(c.MEDIA_CONSTRAINTS).then(n).catch(i):navigator.getUserMedia&&"MediaRecorder"in window&&navigator.getUserMedia(c.MEDIA_CONSTRAINTS,n,i)}getCorrectStreamForSafari(e){let t=parseInt(this.browserId.version);if("safari"!==this.browserId.browser||!(t>=16))return e;{let t=nL.ac.createMediaStreamSource(e);this.recordGainNode=nL.ac.createGain(),t.connect(this.recordGainNode);let n=localStorage.getItem("micgain"),i=n?parseInt(n):1;this.recordGainNode.gain.value=i;let a=nL.ac.createMediaStreamDestination();return a.channelCount=1,this.recordGainNode.connect(a),a.stream}}setRecordGainNodeForTest(e){let t=parseInt(this.browserId.version);"safari"===this.browserId.browser&&t>=16&&new tg.TestMic().init(e,nL.ac)}constructor(e){this.recordGainNode=null,this.browserId=e}}(n$),nG=()=>{let e=parseInt(nj.browserId.version);return"safari"===nj.browserId.browser&&e>=16?`<li class='nav-item'>
              <a class='nav-link' href='#' id='testmicrophone'>
                <i class='fa-solid fa-microphone'></i> TEST MIC
              </a>
            </li>`:""},nF=e=>{e.onclick=nU},nU=()=>{nA?nH():$("#testMicrophoneModal").modal("show")},nV=()=>{let e=document.querySelectorAll(".hidden-first");if(e.length)for(let t=0;t<e.length;t++)e[t].classList.add("visible-animate")},nH=e=>{(0,l.default).dynamicModalDialog(`<p>Please, verify the following error related to your microphone/input: &#10;&#13;</p>
      <p><b><i>${e||nA}</i></b></p>`,null,"","Close","Warning!","bg-warning")},nz=e=>{(0,l.default).dynamicModalDialog(`<p>There was a problem while loading the data, probably not supported type of media by the browser: &#10;&#13;</p>
      <p class="breakword"><b>${e}</b></p>`,null,"","Close","Error","bg-danger",nX)},nW=()=>{document.getElementById("toastNotLoggedIn").style.display="",$("#toastNotLoggedIn").toast("show")},nq=()=>{document.getElementById("toastNotPermission").style.display="",$("#toastNotPermission").toast("show")},nX=()=>{let e=document.getElementById("download-progress-elems");e&&!e.hidden&&e.remove()};(0,c.activateGoHomeLink)(),(()=>{document.getElementById("useroptions").innerHTML=`${nw()}${nG()}${tL()}`;let e=document.getElementById("testmicrophone");e&&nF(e)})(),nj.init(nO),"demopage"===nO&&(document.getElementById("download-mix-btn").hidden=!1,(0,l.default).dynamicModalDialog("Be careful, the music you record or upload won't be saved, as you are not a registered user and this is only a test feature!",null,"","Close","Warning!","bg-warning",nV))}();
//# sourceMappingURL=composition.54a8d310.js.map
