!function(){function e(e,t,i,n){Object.defineProperty(e,t,{get:i,set:n,enumerable:!0,configurable:!0})}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},i={},n={},o=t.parcelRequire1e7e;null==o&&((o=function(e){if(e in i)return i[e].exports;if(e in n){var t=n[e];delete n[e];var o={id:e,exports:{}};return i[e]=o,t.call(o.exports,o,o.exports),o.exports}var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,t){n[e]=t},t.parcelRequire1e7e=o);var r=o.register;r("72lX3",function(e,t){let i="STAGE",n={PROD:{ENDPOINT:"",UPLOAD_ENDPOINT:""},STAGE:{ENDPOINT:window.location.protocol+"//"+window.location.host,UPLOAD_ENDPOINT:window.location.protocol+"//"+window.location.host+"/fileUpload"},DEV:{ENDPOINT:window.location.protocol+"//"+window.location.host,UPLOAD_ENDPOINT:window.location.protocol+"//"+window.location.host+"/fileUpload"}};e.exports={ENDPOINT:n[i].ENDPOINT,UPLOAD_ENDPOINT:n[i].UPLOAD_ENDPOINT}}),r("lV0Oe",function(t,i){e(t.exports,"default",function(){return n});var n=new class{dynamicModalDialog(e,t,i,n,o,r,s){this.setDynamicModalContent('<div class="modal-header '+r+' text-white"><h5 class="modal-title" id="dynamicModalLabel">'+o+'</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body">'+e+'</div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">'+n+"</button>"+(null!==t?"<button id="+t+' type="button" class="btn btn-primary">'+i+"</button>":"")+"</div>"),this.callbackDismiss=s,$(this.modal).modal("show")}getDynamicModal(){return document.getElementById("dynamicModal")}setDynamicModalContent(e){this.modal.querySelector(".modal-content").innerHTML=e}closeDynamicModal(e){$(this.modal).modal("hide"),e&&e()}initDynamicModal(){let e=document.createElement("div");return e.classList.add("modal","fade"),e.setAttribute("id","dynamicModal"),e.setAttribute("tabindex","-1"),e.setAttribute("role","dialog"),e.setAttribute("aria-labelledby","dynamicModalLabel"),e.setAttribute("aria-hidden","true"),e.innerHTML='<div class="modal-dialog modal-sm modal-dialog-centered" role="document"><div class="modal-content"></div></div>',document.body.appendChild(e),e}constructor(){if(this.modal=this.getDynamicModal(),this.callbackDismiss=null,!this.modal){this.modal=this.initDynamicModal();let e=this;$(this.modal).on("hide.bs.modal",function(t){e.callbackDismiss&&(e.callbackDismiss(),e.callbackDismiss=null)})}}}}),r("7hG31",function(t,i){e(t.exports,"uriUserPage",function(){return r}),e(t.exports,"uriCollectionPage",function(){return s}),e(t.exports,"UserRole",function(){return a}),e(t.exports,"LevelPrivacy",function(){return l}),e(t.exports,"PRIVACY_BADGE_STYLE",function(){return d}),e(t.exports,"PRIVACY_BADGE_TEXT",function(){return c}),e(t.exports,"startLoader",function(){return u}),e(t.exports,"cancelLoader",function(){return h}),e(t.exports,"callJsonApi",function(){return p}),e(t.exports,"looksLikeMail",function(){return m}),e(t.exports,"activateGoHomeLink",function(){return g}),e(t.exports,"MEDIA_CONSTRAINTS",function(){return f});var n=o("72lX3");let r="/index.html?userid=",s="/index.html?collectionid=",a=Object.freeze({none:0,owner:1,admin:2,member:3,guest:4}),l=Object.freeze({public:1,onlyreg:2,private:3}),d={[l.public]:"badge-public",[l.onlyreg]:"badge-onlyreg",[l.private]:"badge-private"},c={[l.public]:"PUBLIC",[l.onlyreg]:"REG USERS",[l.private]:"PRIVATE"},u=e=>{let t=document.getElementById("loader");t.innerHTML=`<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>&nbsp;${e}`,t.classList.remove("loader-hidden")},h=()=>{document.getElementById("loader").classList.add("loader-hidden")},p=async(e,t,i,o)=>{let r={method:t||"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}};i&&(r.body=JSON.stringify(i));try{o&&u(o);let t=await fetch(n.ENDPOINT+e,r);o&&h();let i=await t.json();if(i&&!i.error)return i;return(null==i?void 0:i.error)||"An error occurred"}catch(e){return o&&h(),e}},m=e=>{let t=e.lastIndexOf("@"),i=e.lastIndexOf(".");return t<i&&t>0&&-1==e.indexOf("@@")&&i>2&&e.length-i>2},g=()=>{let e=document.getElementById("goHome");"localhost:80"===window.location.host||"http://localhost"===window.location.origin?e.href=window.location.origin+"/index.html":e.href=window.location.origin};/^((?!chrome|android).)*safari/i.test(navigator.userAgent);let f={audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,latency:0,channelCount:1}}}),r("Nsii8",function(t,i){e(t.exports,"checkIfTermsAccepted",function(){return r}),e(t.exports,"generateAcceptTermsModal",function(){return d});var n=o("7hG31");let r=(e,t)=>{(0,n.cancelLoader)(),t(null==e?void 0:e.terms_accepted)},s=()=>{$("#acceptTermsModal").modal({backdrop:"static",keyboard:!1}),$("#acceptTermsModal").modal("show"),document.getElementById("buttonAcceptTerms").onclick=a,document.getElementById("buttonRejectTerms").onclick=l},a=async()=>{(await (0,n.callJsonApi)("/acceptterms","PUT",null,"Welcome...")).ok&&$("#acceptTermsModal").modal("hide")},l=async()=>{(await (0,n.callJsonApi)("/rejectterms","PUT",null,"Deleting information...")).ok&&($("#acceptTermsModal").modal("hide"),window.location.href=window.location.origin)},d=e=>{if(!document.getElementById("acceptTermsModal")){let t=`<div class="modal fade" id="acceptTermsModal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title">Accept Terms</h5>                
                </div>
                <div class="modal-body">
                <p>By clicking on OK you accept the Terms of Use.</p>
                <p>More information at: <span> <a href="${window.location.origin}/static/terms.html" target="_blank">${window.location.origin}/static/terms.html</a></span></p>
                </div>
                <div class="modal-footer">
                <button id="buttonRejectTerms" type="button" class="btn btn-secondary" data-dismiss="modal">Reject</button>
                <button id="buttonAcceptTerms" type="button" class="btn btn-primary">OK</button>
                </div>
            </div>
            </div>
        </div>`;document.getElementsByTagName(e)[0].insertAdjacentHTML("afterend",t)}s()}}),r("d2TTa",function(t,i){e(t.exports,"getCollections",function(){return s}),e(t.exports,"getCollectionsError",function(){return a}),e(t.exports,"createListCollections",function(){return l});var n=o("72lX3"),r=o("lV0Oe");let s=async()=>{let e=await fetch(n.ENDPOINT+"/mycollections"),t=null;return(null==e?void 0:e.ok)&&(t=await e.json()),t},a=()=>{(0,r.default).dynamicModalDialog("Problem getting collections",null,"","Close","Error","bg-danger")},l=(e,t,i)=>{let n=e.all_collections,o=document.getElementById(t),r="<option value='0'>...</option>",s=null;n.forEach(e=>{if(e){s=e.uuid===i?"selected>":null;let t=`<option value='${e.uuid}' ${s||">"}${e.title}</option>`;r+=t}});let a=`<select class='custom-select' id='inputGroupSelectCollect'>${r}</select>`;o.insertAdjacentHTML("afterbegin",a)}});var s=o("72lX3"),a=o("lV0Oe"),l=(o("7hG31"),o("7hG31"));let d=(e,t)=>{c(e,t),document.querySelectorAll(".breadcrumb-item a").forEach(function(t){t.addEventListener("click",function(t){var i;t.preventDefault(),null===(i=document.querySelector(".active-breadcrumb"))||void 0===i||i.classList.remove("active-breadcrumb"),t.currentTarget.classList.add("active-breadcrumb"),u(t.currentTarget.getAttribute("data-section"),e)})})},c=(e,t)=>{let i=document.getElementById("breadcrumbnavbar"),n="";n=e.ok?`<li class='breadcrumb-item ${t?"":"active-breadcrumb"}' aria-current='page'><a href='#' data-section='my-comp'>My Music</a></li>
        <li class='breadcrumb-item'><a href='#' data-section='all-comp'>All</a></li>`:`<li class='breadcrumb-item ${t?"":"active-breadcrumb"}' aria-current='page'><a href='#' data-section='recent-comp'>Recent</a></li>
        <li class='breadcrumb-item'><a href='#' data-section='all-comp'>All</a></li>`,i.innerHTML=n};function u(e,t){let i=new URL(window.location.href);i.searchParams.delete("userid"),i.searchParams.delete("collectionid"),history.replaceState(null,null,i);let n=!1;switch(e){case"recent-comp":eL(n=!0);break;case"my-comp":ex();break;case"all-comp":document.getElementById("initialmessage").classList.remove("d-flex"),document.getElementById("initialmessage").hidden=!0,t.ok||(n=!0),eP(n);break;default:console.log("section default")}}var h=o("Nsii8");let p=null,m=e=>{let t=!1;return("/mycompositions"===e||e.includes("/compositionsbyuserid/")||e.includes("/collectionastreebyid/"))&&(t=!0),t},g=()=>p,f=e=>{p=e},b=(e,t)=>!m(e)||t!==g(),v=e=>{let t={},i={};return e.forEach(e=>{let n=e.collection_uid,o=e.user_id;null!==n?(t[n]||(t[n]=[]),t[n].push(e)):(i[o]||(i[o]=[]),i[o].push(e))}),{groupedbycoll:t,groupedbyuser_aux:i}},y=(e,t)=>{let i={},n=[];return e.forEach(e=>{let o=e.collection_uid;null!==o&&o!==t?(i[o]||(i[o]=[]),i[o].push(e)):n.push(e)}),{groupedbycoll:i,singlecomps:n}},w=e=>{let t={},i={},n=[];return e.forEach(e=>{let o=e.collection_uid;null!==o?(t[o]||(t[o]=[]),t[o].push(e)):e.contributors.length?(i.collabs||(i.collabs=[]),i.collabs.push(e)):n.push(e)}),{groupedbycoll:t,groupedbycollab:i,singlecomps:n}},E=e=>{let t={},i=[];for(let n in e)1===e[n].length?i.push(e[n][0]):(t[n]||(t[n]=[]),t[n]=e[n]);return{singlecomps:i,groupedbyuser_final:t}},C=e=>{let{groupedbycoll:t,groupedbyuser_aux:i}=v(e),{singlecomps:n,groupedbyuser_final:o}=E(i);return{groupedbycoll:t,groupedbyuser_final:o,singlecomps:n}},T=e=>{let{groupedbycoll:t,groupedbycollab:i,singlecomps:n}=w(e);return{groupedbycoll:t,groupedbycollab:i,singlecomps:n}},x=(e,t)=>{let{groupedbycoll:i,singlecomps:n}=y(e,t);return{groupedbycoll:i,singlecomps:n}},k=e=>{let t=[],i={},n={};return e.forEach(e=>{if(i[e.uuid]=e,null==e?void 0:e.tracks.length){for(let t=0;t<e.tracks.length;t++){let i=e.tracks[t];i.comp_uuid=e.uuid,n[i.uuid]=i}t.push(...e.tracks)}}),{tracksList:t,compositionsDictionary:i,tracksDictionary:n}};var l=o("7hG31");let M=new URL(o("luG8Y").getBundleURL("1T7VR")+"static/videos/compress_home_page_video.mp4"),L={coll:"badge-collection",user:"badge-warning",collab:"badge-collab"},P={coll:"border-collection",user:"border-warning",collab:"border-collab"},S={coll:l.uriCollectionPage,user:l.uriUserPage},D=`<div id="landing-video-container" class="fullscreen-video-container">
    <video playsinline autoplay loop muted>
      <source src="${M}">
    </video>  
  <div class='fullscreen-video-content'>
    <div class="typewriter">
      <h1>Welcome!</h1>      
    </div>
    <div class="h-100 d-flex">
      <div class="m-auto">
        <a id="start-link" class="btn btn-link" href="/login.html" role="button"><b>LET'S JAM?</b></a>
      </div>
    </div>    
  </div>
</div>`,A=(e,t,i,n,o)=>{let r=e||!m(n)&&t||i;return`<ul class="nav justify-content-end">
              ${r?'<li class="legenditem nav-item"><h4><span class="badge badge-light">Groups by:&nbsp;</span></h4></li>':""}
              ${e?'<li class="legenditem nav-item"><h4><span class="badge badge-collection">Collections&nbsp;<span class="badge badge-light">'+e+"</span></span></h4></li>":""}            
              ${!m(n)&&t?'<li class="legenditem nav-item"><h4><span class="badge badge-warning">Users&nbsp;<span class="badge badge-light">'+t+"</span></span></h4></li>":""}
              ${i?'<li class="legenditem nav-item"><h4><span class="badge badge-success">Singles&nbsp;<span class="badge badge-light">'+i+"</span></span></h4></li>":""}
              <li class="legenditem nav-item"><h4><span class="badge badge-light">Total compositions:&nbsp;</span><span class="badge badge-light">${o}</span></h4></li>
            </ul>`},I=(e,t)=>{document.getElementById("grid").innerHTML="",document.getElementById("grid").insertAdjacentHTML("afterbegin",e),document.getElementById("legendbuttons").innerHTML="",document.getElementById("legendbuttons").insertAdjacentHTML("afterbegin",t),document.getElementById("searchInput").removeAttribute("disabled")},O=(e,t)=>{var i,n,o;let r=b(t,e.username),s=e.contributors.length,a=null==e?void 0:null===(i=e.tracks[(null==e?void 0:e.tracks.length)-1])||void 0===i?void 0:i.uuid;return`<div class='card border-success'>                       
              <div class="card-body">
              ${eE?`<span class="badge ${l.PRIVACY_BADGE_STYLE[e.privacy]}">${l.PRIVACY_BADGE_TEXT[e.privacy]}</span>`:""}
              ${e.opentocontrib?'<p class="badge badge-info">OPEN TO CONTRIB</p>':""}
              ${e.is_template?'<p class="badge badge-template">TEMPLATE</p>':""}  
                  <div>
                    <p class="list-group-item-heading">  
                      <a href='${ew+e.uuid}' class='card-url'>
                        <h5 class='card-title'>${e.title}</h5>
                      </a>
                    </p>
                    <p>${r?`<span class="d-inline-block text-truncate" style="max-width: 250px;">
                        <i class='fa fa-user'></i>&nbsp;
                        <a href='${l.uriUserPage+e.owner_uuid}' class='card-url'>
                          ${e.username}&nbsp;
                        </a>
                      </span>`:""}
                    </p>
                    <p class='text-black-50'>${s?"Collaborators: "+s:""}</p>
                    <p class='card-text text-truncate'>${e.description||""}</p>
                    ${(null===(n=e.tracks)||void 0===n?void 0:n.length)?`<span class="play-control-card d-inline-block text-truncate" style="max-width: 200px;" ${a?` data-trackid="${a}"`:""}>
                      <i class='fa fa-play'>&nbsp;</i>Play last added track </span>&nbsp;`:""}
                    <span class="d-inline-block text-truncate" style="max-width: 250px;">
                        <i class='fa fa-music'></i>&nbsp;${"Tracks: "+(null===(o=e.tracks)||void 0===o?void 0:o.length)}
                    </span>
                  </div>                
              </div>            
          </div>`},N=(e,t,i)=>{var n,o,r;let s=b(i,e.username),a=e.contributors.length,d=null==e?void 0:null===(n=e.tracks[(null==e?void 0:e.tracks.length)-1])||void 0===n?void 0:n.uuid;return`<div class="list-group-item ">
              ${eE?`<span class="badge ${l.PRIVACY_BADGE_STYLE[e.privacy]}">${l.PRIVACY_BADGE_TEXT[e.privacy]}</span>`:""}
              ${e.opentocontrib?'<span class="badge badge-info">OPEN TO CONTRIB</span>':""}
              ${e.is_template?'<span class="badge badge-template">TEMPLATE</span>':""}  
              <p class="list-group-item-heading">
                <a href='${ew+e.uuid}' class='card-url'>
                    <h5 class='card-title'>${e.title}</h5>
                </a>
              </p>
              ${"user"!==t&&s?'<p><span class="d-inline-block text-truncate" style="max-width: 220px;"><i class="fa fa-user"></i>&nbsp;<a href='+l.uriUserPage+e.owner_uuid+' class="card-url">'+e.username+"&nbsp;</a></span></p>":""}
              <p class='text-black-50'>${a?"Collaborators: "+a:""}</p>
              <p class="list-group-item-text text-truncate">
                ${e.description||""}
              </p>
              ${(null===(o=e.tracks)||void 0===o?void 0:o.length)?`<span class="play-control-card d-inline-block text-truncate" style="max-width: 200px;" ${d?` data-trackid="${d}"`:""}>
                <i class='fa fa-play'>&nbsp;</i>Play last added track 
              </span>&nbsp;`:""}
              <span class="d-inline-block text-truncate" style="max-width: 200px;">
                <i class='fa fa-music'></i>&nbsp;${"Tracks: "+(null===(r=e.tracks)||void 0===r?void 0:r.length)}
              </span>
            </div>`},B=(e,t,i,n,o)=>{let r=L[e],s=P[e],a=S[e],l=`<span class="badge ${r} d-inline-block text-truncate" style="max-width:85%;">
                              <span class="badge badge-light">${t}</span>&nbsp;
                              ${a?`<a href=${a+n} class="card-header-url">${i}</a>`:`${i}`}                              
                          </span>`;return`<div class='card ${s}'>                        
              <h4>${l}</h4>        
              <div class="card-body">
                <div class="list-group border">              
                  ${o}
                </div>
              </div>
            </div>`},R=(e,t)=>{var i,n;let o=document.getElementById("welcomecontainer"),r=document.getElementById("landing-video-container");if((null===(i=o.lastChild)||void 0===i?void 0:i.id)&&(null===(n=o.lastChild)||void 0===n?void 0:n.id)!=="welcometext"&&o.removeChild(o.lastChild),!e&&!o.lastChild&&!r){let e=document.createElement("div");e.id="welcometext",e.innerHTML=eE?"":`${D}`,document.getElementById("welcomecontainer").appendChild(e)}t&&document.getElementById("grid").scrollIntoView({behavior:"smooth"})},_=(e,t,i)=>{R(!0);let n=document.createElement("div");n.id="infocontainer",n.innerHTML=`<div class="card border-collection mb-3">
                                          <div class="card-header bg-transparent border-collection"><b>Collection</b></div>
                                          <div class="card-body text-dark">
                                            <h5 class="card-title">${e}</h5>
                                            <p class="card-text" style="width:300px;">Owner: <a href=${l.uriUserPage+i} class="card-url">${t}</a></p>
                                          </div>
                                        </div>`,document.getElementById("welcomecontainer").appendChild(n)},W=(e,t)=>{R(!0);let i=document.createElement("div");i.id="infocontainer",i.innerHTML=`<div class="card mb-3" style="max-width: 540px;">
                                    <div class="row no-gutters">
                                      <div class="col-md-4">
                                        <img class="img-fluid hidden-first" src="https://picsum.photos/seed/${t}/200" alt="User Picture" width="200" height="200">
                                      </div>
                                      <div class="col-md-8">
                                        <div class="card-body">
                                          <h5 class="card-title">User</h5>
                                          <p class="card-text" style="width:300px;">${e?`${e}`:""}</p>                                        
                                          <p class="card-text"><small class="text-muted"></small></p>
                                        </div>
                                      </div>
                                    </div>
                                  </div>`,document.getElementById("welcomecontainer").appendChild(i)};var j=class{on(e,t,i){if(this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e].add(t),null==i?void 0:i.once){let i=()=>{this.un(e,i),this.un(e,t)};return this.on(e,i),i}return()=>this.un(e,t)}un(e,t){var i;null===(i=this.listeners[e])||void 0===i||i.delete(t)}once(e,t){return this.on(e,t,{once:!0})}unAll(){this.listeners={}}emit(e,...t){this.listeners[e]&&this.listeners[e].forEach(e=>e(...t))}constructor(){this.listeners={}}},H={decode:function(e,t){var i,n,o,r;return i=this,n=void 0,o=void 0,r=function*(){let i=new AudioContext({sampleRate:t});return i.decodeAudioData(e).finally(()=>i.close())},new(o||(o=Promise))(function(e,t){function s(e){try{l(r.next(e))}catch(e){t(e)}}function a(e){try{l(r.throw(e))}catch(e){t(e)}}function l(t){var i;t.done?e(t.value):((i=t.value)instanceof o?i:new o(function(e){e(i)})).then(s,a)}l((r=r.apply(i,n||[])).next())})},createBuffer:function(e,t){return"number"==typeof e[0]&&(e=[e]),!function(e){let t=e[0];if(t.some(e=>e>1||e<-1)){let i=t.length,n=0;for(let e=0;e<i;e++){let i=Math.abs(t[e]);i>n&&(n=i)}for(let t of e)for(let e=0;e<i;e++)t[e]/=n}}(e),{duration:t,length:e[0].length,sampleRate:e[0].length/t,numberOfChannels:e.length,getChannelData:t=>null==e?void 0:e[t],copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}},G={};function U(e,t,i){let n=function e(t,i){let n=i.xmlns?document.createElementNS(i.xmlns,t):document.createElement(t);for(let[t,o]of Object.entries(i))if("children"===t)for(let[t,o]of Object.entries(i))"string"==typeof o?n.appendChild(document.createTextNode(o)):n.appendChild(e(t,o));else"style"===t?Object.assign(n.style,o):"textContent"===t?n.textContent=o:n.setAttribute(t,o.toString());return n}(e,t||{});return null==i||i.appendChild(n),n}Object.defineProperty(G,"__esModule",{value:!0,configurable:!0}),e(G,"createElement",function(){return U}),e(G,"default",function(){return q});var q=U,V=function(e,t,i,n){return new(i||(i=Promise))(function(o,r){function s(e){try{l(n.next(e))}catch(e){r(e)}}function a(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})},z={fetchBlob:function(e,t,i){return V(this,void 0,void 0,function*(){let n=yield fetch(e,i);if(n.status>=400)throw Error(`Failed to fetch ${e}: ${n.status} (${n.statusText})`);return!function(e,t){V(this,void 0,void 0,function*(){if(!e.body||!e.headers)return;let i=e.body.getReader(),n=Number(e.headers.get("Content-Length"))||0,o=0,r=e=>V(this,void 0,void 0,function*(){t(Math.round((o+=(null==e?void 0:e.length)||0)/n*100))}),s=()=>V(this,void 0,void 0,function*(){let e;try{e=yield i.read()}catch(e){return}e.done||(r(e.value),yield s())});s()})}(n.clone(),t),n.blob()})}},X=class extends j{onMediaEvent(e,t,i){return this.media.addEventListener(e,t,i),()=>this.media.removeEventListener(e,t,i)}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){let e=this.getSrc();e.startsWith("blob:")&&URL.revokeObjectURL(e)}canPlayType(e){return""!==this.media.canPlayType(e)}setSrc(e,t){let i=this.getSrc();if(e&&i===e)return;this.revokeSrc();let n=t instanceof Blob&&(this.canPlayType(t.type)||!e)?URL.createObjectURL(t):e;try{this.media.src=n}catch(t){this.media.src=e}}destroy(){this.media.pause(),this.isExternalMedia||(this.media.remove(),this.revokeSrc(),this.media.src="",this.media.load())}setMediaElement(e){this.media=e}play(){var e,t,i,n;return e=this,t=void 0,n=function*(){return this.media.play()},new(i=void 0,i=Promise)(function(o,r){function s(e){try{l(n.next(e))}catch(e){r(e)}}function a(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})}pause(){this.media.pause()}isPlaying(){return!this.media.paused&&!this.media.ended}setTime(e){this.media.currentTime=e}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(e){this.media.volume=e}getMuted(){return this.media.muted}setMuted(e){this.media.muted=e}getPlaybackRate(){return this.media.playbackRate}isSeeking(){return this.media.seeking}setPlaybackRate(e,t){null!=t&&(this.media.preservesPitch=t),this.media.playbackRate=e}getMediaElement(){return this.media}setSinkId(e){return this.media.setSinkId(e)}constructor(e){super(),this.isExternalMedia=!1,e.media?(this.media=e.media,this.isExternalMedia=!0):this.media=document.createElement("audio"),e.mediaControls&&(this.media.controls=!0),e.autoplay&&(this.media.autoplay=!0),null!=e.playbackRate&&this.onMediaEvent("canplay",()=>{null!=e.playbackRate&&(this.media.playbackRate=e.playbackRate)},{once:!0})}},Y=function(e,t,i,n){return new(i||(i=Promise))(function(o,r){function s(e){try{l(n.next(e))}catch(e){r(e)}}function a(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})},J=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)0>t.indexOf(n[o])&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(i[n[o]]=e[n[o]]);return i};class F extends j{parentFromOptionsContainer(e){let t;if("string"==typeof e?t=document.querySelector(e):e instanceof HTMLElement&&(t=e),!t)throw Error("Container not found");return t}initEvents(){let e=e=>{let t=this.wrapper.getBoundingClientRect(),i=e.clientX-t.left,n=e.clientY-t.top;return[i/t.width,n/t.height]};if(this.wrapper.addEventListener("click",t=>{let[i,n]=e(t);this.emit("click",i,n)}),this.wrapper.addEventListener("dblclick",t=>{let[i,n]=e(t);this.emit("dblclick",i,n)}),(!0===this.options.dragToSeek||"object"==typeof this.options.dragToSeek)&&this.initDrag(),this.scrollContainer.addEventListener("scroll",()=>{let{scrollLeft:e,scrollWidth:t,clientWidth:i}=this.scrollContainer;this.emit("scroll",e/t,(e+i)/t,e,e+i)}),"function"==typeof ResizeObserver){let e=this.createDelay(100);this.resizeObserver=new ResizeObserver(()=>{e().then(()=>this.onContainerResize()).catch(()=>void 0)}),this.resizeObserver.observe(this.scrollContainer)}}onContainerResize(){let e=this.parent.clientWidth;(e!==this.lastContainerWidth||"auto"===this.options.height)&&(this.lastContainerWidth=e,this.reRender())}initDrag(){this.subscriptions.push(function(e,t,i,n,o=3,r=0,s=100){if(!e)return()=>void 0;let a=matchMedia("(pointer: coarse)").matches,l=()=>void 0,d=d=>{if(d.button!==r)return;d.preventDefault(),d.stopPropagation();let c=d.clientX,u=d.clientY,h=!1,p=Date.now(),m=n=>{if(n.preventDefault(),n.stopPropagation(),a&&Date.now()-p<s)return;let r=n.clientX,l=n.clientY,d=r-c,m=l-u;if(h||Math.abs(d)>o||Math.abs(m)>o){let{left:n,top:o}=e.getBoundingClientRect();h||(null==i||i(c-n,u-o),h=!0),t(d,m,r-n,l-o),c=r,u=l}},g=t=>{if(h){let i=t.clientX,o=t.clientY,{left:r,top:s}=e.getBoundingClientRect();null==n||n(i-r,o-s)}l()},f=e=>{e.relatedTarget&&e.relatedTarget!==document.documentElement||g(e)},b=e=>{h&&(e.stopPropagation(),e.preventDefault())},v=e=>{h&&e.preventDefault()};document.addEventListener("pointermove",m),document.addEventListener("pointerup",g),document.addEventListener("pointerout",f),document.addEventListener("pointercancel",f),document.addEventListener("touchmove",v,{passive:!1}),document.addEventListener("click",b,{capture:!0}),l=()=>{document.removeEventListener("pointermove",m),document.removeEventListener("pointerup",g),document.removeEventListener("pointerout",f),document.removeEventListener("pointercancel",f),document.removeEventListener("touchmove",v),setTimeout(()=>{document.removeEventListener("click",b,{capture:!0})},10)}};return e.addEventListener("pointerdown",d),()=>{l(),e.removeEventListener("pointerdown",d)}}(this.wrapper,(e,t,i)=>{this.emit("drag",Math.max(0,Math.min(1,i/this.wrapper.getBoundingClientRect().width)))},e=>{this.isDragging=!0,this.emit("dragstart",Math.max(0,Math.min(1,e/this.wrapper.getBoundingClientRect().width)))},e=>{this.isDragging=!1,this.emit("dragend",Math.max(0,Math.min(1,e/this.wrapper.getBoundingClientRect().width)))}))}getHeight(e,t){var i;let n=(null===(i=this.audioData)||void 0===i?void 0:i.numberOfChannels)||1;if(null==e)return 128;if(!isNaN(Number(e)))return Number(e);if("auto"===e){let e=this.parent.clientHeight||128;return(null==t?void 0:t.every(e=>!e.overlay))?e/n:e}return 128}initHtml(){let e=document.createElement("div"),t=e.attachShadow({mode:"open"}),i=this.options.cspNonce&&"string"==typeof this.options.cspNonce?this.options.cspNonce.replace(/"/g,""):"";return t.innerHTML=`
      <style${i?` nonce="${i}"`:""}>
        :host {
          user-select: none;
          min-width: 1px;
        }
        :host audio {
          display: block;
          width: 100%;
        }
        :host .scroll {
          overflow-x: auto;
          overflow-y: hidden;
          width: 100%;
          position: relative;
        }
        :host .noScrollbar {
          scrollbar-color: transparent;
          scrollbar-width: none;
        }
        :host .noScrollbar::-webkit-scrollbar {
          display: none;
          -webkit-appearance: none;
        }
        :host .wrapper {
          position: relative;
          overflow: visible;
          z-index: 2;
        }
        :host .canvases {
          min-height: ${this.getHeight(this.options.height,this.options.splitChannels)}px;
        }
        :host .canvases > div {
          position: relative;
        }
        :host canvas {
          display: block;
          position: absolute;
          top: 0;
          image-rendering: pixelated;
        }
        :host .progress {
          pointer-events: none;
          position: absolute;
          z-index: 2;
          top: 0;
          left: 0;
          width: 0;
          height: 100%;
          overflow: hidden;
        }
        :host .progress > div {
          position: relative;
        }
        :host .cursor {
          pointer-events: none;
          position: absolute;
          z-index: 5;
          top: 0;
          left: 0;
          height: 100%;
          border-radius: 2px;
        }
      </style>

      <div class="scroll" part="scroll">
        <div class="wrapper" part="wrapper">
          <div class="canvases" part="canvases"></div>
          <div class="progress" part="progress"></div>
          <div class="cursor" part="cursor"></div>
        </div>
      </div>
    `,[e,t]}setOptions(e){if(this.options.container!==e.container){let t=this.parentFromOptionsContainer(e.container);t.appendChild(this.container),this.parent=t}(!0===e.dragToSeek||"object"==typeof this.options.dragToSeek)&&this.initDrag(),this.options=e,this.reRender()}getWrapper(){return this.wrapper}getWidth(){return this.scrollContainer.clientWidth}getScroll(){return this.scrollContainer.scrollLeft}setScroll(e){this.scrollContainer.scrollLeft=e}setScrollPercentage(e){let{scrollWidth:t}=this.scrollContainer;this.setScroll(t*e)}destroy(){var e,t;this.subscriptions.forEach(e=>e()),this.container.remove(),null===(e=this.resizeObserver)||void 0===e||e.disconnect(),null===(t=this.unsubscribeOnScroll)||void 0===t||t.forEach(e=>e()),this.unsubscribeOnScroll=[]}createDelay(e=10){let t,i;let n=()=>{t&&clearTimeout(t),i&&i()};return this.timeouts.push(n),()=>new Promise((o,r)=>{n(),i=r,t=setTimeout(()=>{t=void 0,i=void 0,o()},e)})}convertColorValues(e){if(!Array.isArray(e))return e||"";if(e.length<2)return e[0]||"";let t=document.createElement("canvas"),i=t.getContext("2d"),n=t.height*(window.devicePixelRatio||1),o=i.createLinearGradient(0,0,0,n),r=1/(e.length-1);return e.forEach((e,t)=>{o.addColorStop(t*r,e)}),o}getPixelRatio(){return Math.max(1,window.devicePixelRatio||1)}renderBarWaveform(e,t,i,n){let o=e[0],r=e[1]||e[0],s=o.length,{width:a,height:l}=i.canvas,d=l/2,c=this.getPixelRatio(),u=t.barWidth?t.barWidth*c:1,h=t.barGap?t.barGap*c:t.barWidth?u/2:0,p=t.barRadius||0,m=a/(u+h)/s,g=p&&"roundRect"in i?"roundRect":"rect";i.beginPath();let f=0,b=0,v=0;for(let e=0;e<=s;e++){let s=Math.round(e*m);if(s>f){let e=Math.round(b*d*n),o=e+Math.round(v*d*n)||1,r=d-e;"top"===t.barAlign?r=0:"bottom"===t.barAlign&&(r=l-o),i[g](f*(u+h),r,u,o,p),f=s,b=0,v=0}let a=Math.abs(o[e]||0),c=Math.abs(r[e]||0);a>b&&(b=a),c>v&&(v=c)}i.fill(),i.closePath()}renderLineWaveform(e,t,i,n){let o=t=>{let o=e[t]||e[0],r=o.length,{height:s}=i.canvas,a=s/2,l=i.canvas.width/r;i.moveTo(0,a);let d=0,c=0;for(let e=0;e<=r;e++){let r=Math.round(e*l);if(r>d){let e=Math.round(c*a*n)||1,o=a+e*(0===t?-1:1);i.lineTo(d,o),d=r,c=0}let s=Math.abs(o[e]||0);s>c&&(c=s)}i.lineTo(d,a)};i.beginPath(),o(0),o(1),i.fill(),i.closePath()}renderWaveform(e,t,i){if(i.fillStyle=this.convertColorValues(t.waveColor),t.renderFunction){t.renderFunction(e,i);return}let n=t.barHeight||1;if(t.normalize){let t=Array.from(e[0]).reduce((e,t)=>Math.max(e,Math.abs(t)),0);n=t?1/t:1}if(t.barWidth||t.barGap||t.barAlign){this.renderBarWaveform(e,t,i,n);return}this.renderLineWaveform(e,t,i,n)}renderSingleCanvas(e,t,i,n,o,r,s){let a=this.getPixelRatio(),l=document.createElement("canvas");l.width=Math.round(i*a),l.height=Math.round(n*a),l.style.width=`${i}px`,l.style.height=`${n}px`,l.style.left=`${Math.round(o)}px`,r.appendChild(l);let d=l.getContext("2d");if(this.renderWaveform(e,t,d),l.width>0&&l.height>0){let e=l.cloneNode(),i=e.getContext("2d");i.drawImage(l,0,0),i.globalCompositeOperation="source-in",i.fillStyle=this.convertColorValues(t.progressColor),i.fillRect(0,0,l.width,l.height),s.appendChild(e)}}renderMultiCanvas(e,t,i,n,o,r){let s=this.getPixelRatio(),{clientWidth:a}=this.scrollContainer,l=i/s,d=Math.min(F.MAX_CANVAS_WIDTH,a,l),c={};if(t.barWidth||t.barGap){let e=t.barWidth||.5,i=t.barGap||e/2,n=e+i;d%n!=0&&(d=Math.floor(d/n)*n)}let u=i=>{if(i<0||i>=p||c[i])return;c[i]=!0;let s=i*d,a=Math.min(l-s,d);if(a<=0)return;let u=e.map(e=>{let t=Math.floor(s/l*e.length),i=Math.floor((s+a)/l*e.length);return e.slice(t,i)});this.renderSingleCanvas(u,t,a,n,s,o,r)},h=()=>{Object.keys(c).length>F.MAX_NODES&&(o.innerHTML="",r.innerHTML="",c={})},p=Math.ceil(l/d);if(!this.isScrollable){for(let e=0;e<p;e++)u(e);return}let m=Math.floor(this.scrollContainer.scrollLeft/l*p);if(u(m-1),u(m),u(m+1),p>1){let e=this.on("scroll",()=>{let{scrollLeft:e}=this.scrollContainer,t=Math.floor(e/l*p);h(),u(t-1),u(t),u(t+1)});this.unsubscribeOnScroll.push(e)}}renderChannel(e,t,i,n){var{overlay:o}=t,r=J(t,["overlay"]);let s=document.createElement("div"),a=this.getHeight(r.height,r.splitChannels);s.style.height=`${a}px`,o&&n>0&&(s.style.marginTop=`-${a}px`),this.canvasWrapper.style.minHeight=`${a}px`,this.canvasWrapper.appendChild(s);let l=s.cloneNode();this.progressWrapper.appendChild(l),this.renderMultiCanvas(e,r,i,a,s,l)}render(e){return Y(this,void 0,void 0,function*(){var t;this.timeouts.forEach(e=>e()),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",null!=this.options.width&&(this.scrollContainer.style.width="number"==typeof this.options.width?`${this.options.width}px`:this.options.width);let i=this.getPixelRatio(),n=this.scrollContainer.clientWidth,o=Math.ceil(e.duration*(this.options.minPxPerSec||0));this.isScrollable=o>n;let r=this.options.fillParent&&!this.isScrollable,s=(r?n:o)*i;if(this.wrapper.style.width=r?"100%":`${o}px`,this.scrollContainer.style.overflowX=this.isScrollable?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.audioData=e,this.emit("render"),this.options.splitChannels)for(let i=0;i<e.numberOfChannels;i++){let n=Object.assign(Object.assign({},this.options),null===(t=this.options.splitChannels)||void 0===t?void 0:t[i]);this.renderChannel([e.getChannelData(i)],n,s,i)}else{let t=[e.getChannelData(0)];e.numberOfChannels>1&&t.push(e.getChannelData(1)),this.renderChannel(t,this.options,s,0)}Promise.resolve().then(()=>this.emit("rendered"))})}reRender(){if(this.unsubscribeOnScroll.forEach(e=>e()),this.unsubscribeOnScroll=[],!this.audioData)return;let{scrollWidth:e}=this.scrollContainer,{right:t}=this.progressWrapper.getBoundingClientRect();if(this.render(this.audioData),this.isScrollable&&e!==this.scrollContainer.scrollWidth){let{right:e}=this.progressWrapper.getBoundingClientRect(),i=e-t;i*=2,i=(i<0?Math.floor(i):Math.ceil(i))/2,this.scrollContainer.scrollLeft+=i}}zoom(e){this.options.minPxPerSec=e,this.reRender()}scrollIntoView(e,t=!1){let{scrollLeft:i,scrollWidth:n,clientWidth:o}=this.scrollContainer,r=e*n,s=i+o,a=o/2;if(this.isDragging)r+30>s?this.scrollContainer.scrollLeft+=30:r-30<i&&(this.scrollContainer.scrollLeft-=30);else{(r<i||r>s)&&(this.scrollContainer.scrollLeft=r-(this.options.autoCenter?a:0));let e=r-i-a;t&&this.options.autoCenter&&e>0&&(this.scrollContainer.scrollLeft+=Math.min(e,10))}{let e=this.scrollContainer.scrollLeft;this.emit("scroll",e/n,(e+o)/n,e,e+o)}}renderProgress(e,t){if(isNaN(e))return;let i=100*e;this.canvasWrapper.style.clipPath=`polygon(${i}% 0, 100% 0, 100% 100%, ${i}% 100%)`,this.progressWrapper.style.width=`${i}%`,this.cursor.style.left=`${i}%`,this.cursor.style.transform=`translateX(-${100===Math.round(i)?this.options.cursorWidth:0}px)`,this.isScrollable&&this.options.autoScroll&&this.scrollIntoView(e,t)}exportImage(e,t,i){return Y(this,void 0,void 0,function*(){let n=this.canvasWrapper.querySelectorAll("canvas");if(!n.length)throw Error("No waveform data");return"dataURL"===i?Promise.resolve(Array.from(n).map(i=>i.toDataURL(e,t))):Promise.all(Array.from(n).map(i=>new Promise((n,o)=>{i.toBlob(e=>{e?n(e):o(Error("Could not export image"))},e,t)})))})}constructor(e,t){super(),this.timeouts=[],this.isScrollable=!1,this.audioData=null,this.resizeObserver=null,this.lastContainerWidth=0,this.isDragging=!1,this.subscriptions=[],this.unsubscribeOnScroll=[],this.subscriptions=[],this.options=e;let i=this.parentFromOptionsContainer(e.container);this.parent=i;let[n,o]=this.initHtml();i.appendChild(n),this.container=n,this.scrollContainer=o.querySelector(".scroll"),this.wrapper=o.querySelector(".wrapper"),this.canvasWrapper=o.querySelector(".canvases"),this.progressWrapper=o.querySelector(".progress"),this.cursor=o.querySelector(".cursor"),t&&o.appendChild(t),this.initEvents()}}F.MAX_CANVAS_WIDTH=8e3,F.MAX_NODES=10;var K=class extends j{start(){this.unsubscribe=this.on("tick",()=>{requestAnimationFrame(()=>{this.emit("tick")})}),this.emit("tick")}stop(){this.unsubscribe()}destroy(){this.unsubscribe()}constructor(){super(...arguments),this.unsubscribe=()=>void 0}},Q=function(e,t,i,n){return new(i||(i=Promise))(function(o,r){function s(e){try{l(n.next(e))}catch(e){r(e)}}function a(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})},Z=class extends j{load(){return Q(this,void 0,void 0,function*(){})}get src(){return this.currentSrc}set src(e){if(this.currentSrc=e,this._duration=void 0,!e){this.buffer=null,this.emit("emptied");return}fetch(e).then(t=>{if(t.status>=400)throw Error(`Failed to fetch ${e}: ${t.status} (${t.statusText})`);return t.arrayBuffer()}).then(t=>this.currentSrc!==e?null:this.audioContext.decodeAudioData(t)).then(t=>{this.currentSrc===e&&(this.buffer=t,this.emit("loadedmetadata"),this.emit("canplay"),this.autoplay&&this.play())})}_play(){var e;if(!this.paused)return;this.paused=!1,null===(e=this.bufferNode)||void 0===e||e.disconnect(),this.bufferNode=this.audioContext.createBufferSource(),this.buffer&&(this.bufferNode.buffer=this.buffer),this.bufferNode.playbackRate.value=this._playbackRate,this.bufferNode.connect(this.gainNode);let t=this.playedDuration*this._playbackRate;t>=this.duration&&(t=0,this.playedDuration=0),this.bufferNode.start(this.audioContext.currentTime,t),this.playStartTime=this.audioContext.currentTime,this.bufferNode.onended=()=>{this.currentTime>=this.duration&&(this.pause(),this.emit("ended"))}}_pause(){var e;this.paused=!0,null===(e=this.bufferNode)||void 0===e||e.stop(),this.playedDuration+=this.audioContext.currentTime-this.playStartTime}play(){return Q(this,void 0,void 0,function*(){this.paused&&(this._play(),this.emit("play"))})}pause(){this.paused||(this._pause(),this.emit("pause"))}stopAt(e){var t,i;let n=e-this.currentTime;null===(t=this.bufferNode)||void 0===t||t.stop(this.audioContext.currentTime+n),null===(i=this.bufferNode)||void 0===i||i.addEventListener("ended",()=>{this.bufferNode=null,this.pause()},{once:!0})}setSinkId(e){return Q(this,void 0,void 0,function*(){return this.audioContext.setSinkId(e)})}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this.bufferNode&&(this.bufferNode.playbackRate.value=e)}get currentTime(){return(this.paused?this.playedDuration:this.playedDuration+(this.audioContext.currentTime-this.playStartTime))*this._playbackRate}set currentTime(e){let t=!this.paused;t&&this._pause(),this.playedDuration=e/this._playbackRate,t&&this._play(),this.emit("seeking"),this.emit("timeupdate")}get duration(){var e,t;return null!==(e=this._duration)&&void 0!==e?e:(null===(t=this.buffer)||void 0===t?void 0:t.duration)||0}set duration(e){this._duration=e}get volume(){return this.gainNode.gain.value}set volume(e){this.gainNode.gain.value=e,this.emit("volumechange")}get muted(){return this._muted}set muted(e){this._muted!==e&&(this._muted=e,this._muted?this.gainNode.disconnect():this.gainNode.connect(this.audioContext.destination))}canPlayType(e){return/^(audio|video)\//.test(e)}getGainNode(){return this.gainNode}getChannelData(){let e=[];if(!this.buffer)return e;let t=this.buffer.numberOfChannels;for(let i=0;i<t;i++)e.push(this.buffer.getChannelData(i));return e}constructor(e=new AudioContext){super(),this.bufferNode=null,this.playStartTime=0,this.playedDuration=0,this._muted=!1,this._playbackRate=1,this._duration=void 0,this.buffer=null,this.currentSrc="",this.paused=!0,this.crossOrigin=null,this.seeking=!1,this.autoplay=!1,this.addEventListener=this.on,this.removeEventListener=this.un,this.audioContext=e,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination)}},ee=function(e,t,i,n){return new(i||(i=Promise))(function(o,r){function s(e){try{l(n.next(e))}catch(e){r(e)}}function a(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(s,a)}l((n=n.apply(e,t||[])).next())})};let et={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,dragToSeek:!1,autoScroll:!0,autoCenter:!0,sampleRate:8e3};class ei extends X{static create(e){return new ei(e)}updateProgress(e=this.getCurrentTime()){return this.renderer.renderProgress(e/this.getDuration(),this.isPlaying()),e}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",()=>{if(!this.isSeeking()){let e=this.updateProgress();this.emit("timeupdate",e),this.emit("audioprocess",e)}}))}initPlayerEvents(){this.isPlaying()&&(this.emit("play"),this.timer.start()),this.mediaSubscriptions.push(this.onMediaEvent("timeupdate",()=>{let e=this.updateProgress();this.emit("timeupdate",e)}),this.onMediaEvent("play",()=>{this.emit("play"),this.timer.start()}),this.onMediaEvent("pause",()=>{this.emit("pause"),this.timer.stop()}),this.onMediaEvent("emptied",()=>{this.timer.stop()}),this.onMediaEvent("ended",()=>{this.emit("finish")}),this.onMediaEvent("seeking",()=>{this.emit("seeking",this.getCurrentTime())}),this.onMediaEvent("error",e=>{this.emit("error",e.error)}))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",(e,t)=>{this.options.interact&&(this.seekTo(e),this.emit("interaction",e*this.getDuration()),this.emit("click",e,t))}),this.renderer.on("dblclick",(e,t)=>{this.emit("dblclick",e,t)}),this.renderer.on("scroll",(e,t,i,n)=>{let o=this.getDuration();this.emit("scroll",e*o,t*o,i,n)}),this.renderer.on("render",()=>{this.emit("redraw")}),this.renderer.on("rendered",()=>{this.emit("redrawcomplete")}),this.renderer.on("dragstart",e=>{this.emit("dragstart",e)}),this.renderer.on("dragend",e=>{this.emit("dragend",e)}));{let e;this.subscriptions.push(this.renderer.on("drag",t=>{let i;this.options.interact&&(this.renderer.renderProgress(t),clearTimeout(e),this.isPlaying()?i=0:!0===this.options.dragToSeek?i=200:"object"==typeof this.options.dragToSeek&&void 0!==this.options.dragToSeek&&(i=this.options.dragToSeek.debounceTime),e=setTimeout(()=>{this.seekTo(t)},i),this.emit("interaction",t*this.getDuration()),this.emit("drag",t))}))}}initPlugins(){var e;(null===(e=this.options.plugins)||void 0===e?void 0:e.length)&&this.options.plugins.forEach(e=>{this.registerPlugin(e)})}unsubscribePlayerEvents(){this.mediaSubscriptions.forEach(e=>e()),this.mediaSubscriptions=[]}setOptions(e){this.options=Object.assign({},this.options,e),this.renderer.setOptions(this.options),e.audioRate&&this.setPlaybackRate(e.audioRate),null!=e.mediaControls&&(this.getMediaElement().controls=e.mediaControls)}registerPlugin(e){return e._init(this),this.plugins.push(e),this.subscriptions.push(e.once("destroy",()=>{this.plugins=this.plugins.filter(t=>t!==e)})),e}getWrapper(){return this.renderer.getWrapper()}getWidth(){return this.renderer.getWidth()}getScroll(){return this.renderer.getScroll()}setScroll(e){return this.renderer.setScroll(e)}setScrollTime(e){let t=e/this.getDuration();this.renderer.setScrollPercentage(t)}getActivePlugins(){return this.plugins}loadAudio(e,t,i,n){return ee(this,void 0,void 0,function*(){var o;if(this.emit("load",e),!this.options.media&&this.isPlaying()&&this.pause(),this.decodedData=null,!t&&!i){let i=this.options.fetchParams||{};window.AbortController&&!i.signal&&(this.abortController=new AbortController,i.signal=null===(o=this.abortController)||void 0===o?void 0:o.signal),t=yield z.fetchBlob(e,e=>this.emit("loading",e),i)}this.setSrc(e,t);let r=yield new Promise(e=>{let t=n||this.getDuration();t?e(t):this.mediaSubscriptions.push(this.onMediaEvent("loadedmetadata",()=>e(this.getDuration()),{once:!0}))});if(!e&&!t){let e=this.getMediaElement();e instanceof Z&&(e.duration=r)}if(i)this.decodedData=H.createBuffer(i,r||0);else if(t){let e=yield t.arrayBuffer();this.decodedData=yield H.decode(e,this.options.sampleRate)}this.decodedData&&(this.emit("decode",this.getDuration()),this.renderer.render(this.decodedData)),this.emit("ready",this.getDuration())})}load(e,t,i){return ee(this,void 0,void 0,function*(){try{return yield this.loadAudio(e,void 0,t,i)}catch(e){throw this.emit("error",e),e}})}loadBlob(e,t,i){return ee(this,void 0,void 0,function*(){try{return yield this.loadAudio("",e,t,i)}catch(e){throw this.emit("error",e),e}})}zoom(e){if(!this.decodedData)throw Error("No audio loaded");this.renderer.zoom(e),this.emit("zoom",e)}getDecodedData(){return this.decodedData}exportPeaks({channels:e=2,maxLength:t=8e3,precision:i=1e4}={}){if(!this.decodedData)throw Error("The audio has not been decoded yet");let n=Math.min(e,this.decodedData.numberOfChannels),o=[];for(let e=0;e<n;e++){let n=this.decodedData.getChannelData(e),r=[],s=n.length/t;for(let e=0;e<t;e++){let t=n.slice(Math.floor(e*s),Math.ceil((e+1)*s)),o=0;for(let e=0;e<t.length;e++){let i=t[e];Math.abs(i)>Math.abs(o)&&(o=i)}r.push(Math.round(o*i)/i)}o.push(r)}return o}getDuration(){let e=super.getDuration()||0;return(0===e||e===1/0)&&this.decodedData&&(e=this.decodedData.duration),e}toggleInteraction(e){this.options.interact=e}setTime(e){super.setTime(e),this.updateProgress(e),this.emit("timeupdate",e)}seekTo(e){let t=this.getDuration()*e;this.setTime(t)}playPause(){return ee(this,void 0,void 0,function*(){return this.isPlaying()?this.pause():this.play()})}stop(){this.pause(),this.setTime(0)}skip(e){this.setTime(this.getCurrentTime()+e)}empty(){this.load("",[[0]],.001)}setMediaElement(e){this.unsubscribePlayerEvents(),super.setMediaElement(e),this.initPlayerEvents()}exportImage(){return ee(this,arguments,void 0,function*(e="image/png",t=1,i="dataURL"){return this.renderer.exportImage(e,t,i)})}destroy(){var e;this.emit("destroy"),null===(e=this.abortController)||void 0===e||e.abort(),this.plugins.forEach(e=>e.destroy()),this.subscriptions.forEach(e=>e()),this.unsubscribePlayerEvents(),this.timer.destroy(),this.renderer.destroy(),super.destroy()}constructor(e){let t=e.media||("WebAudio"===e.backend?new Z:void 0);super({media:t,mediaControls:e.mediaControls,autoplay:e.autoplay,playbackRate:e.audioRate}),this.plugins=[],this.decodedData=null,this.subscriptions=[],this.mediaSubscriptions=[],this.abortController=null,this.options=Object.assign({},et,e),this.timer=new K;let i=t?void 0:this.getMediaElement();this.renderer=new F(this.options,i),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initPlugins();let n=this.options.url||this.getSrc()||"";Promise.resolve().then(()=>{this.emit("init");let{peaks:e,duration:t}=this.options;(n||e&&t)&&this.load(n,e,t).catch(()=>null)})}}ei.BasePlugin=class extends j{onInit(){}_init(e){this.wavesurfer=e,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(e=>e())}constructor(e){super(),this.subscriptions=[],this.options=e}},ei.dom=G;let en=null,eo=null,er=!1,es=()=>document.getElementById("waveform").getAttribute("data-currentaudio"),ea=(e,t)=>{var i;let n=null===(i=document.querySelector(`[data-trackid='${e}']`))||void 0===i?void 0:i.firstChild.nextSibling;n&&(t?(n.classList.remove("fa-play"),n.classList.add("fa-pause")):(n.classList.remove("fa-pause"),n.classList.add("fa-play")))},el=e=>{let t=document.getElementById("playfloatingbutton").firstChild.nextSibling;e?(t.classList.remove("fa-play"),t.classList.add("fa-pause")):(t.classList.remove("fa-pause"),t.classList.add("fa-play"))},ed=()=>{ey.isPlaying()?ey.pause():ey.play()},ec=e=>{ey.isPlaying()?(ea(e,!0),ey.pause()):ea(e,!0)},eu=e=>{es()===e?ed():(ec(e),ef(e,!0),em(e))},eh=(e,t,i)=>{er=i,document.getElementById("waveform").setAttribute("data-currentaudio",t),ey.seekTo(0),ey.load(e)},ep=e=>{let t=document.querySelector(`[data-trackid='${e}']`);t.onclick=null;let i=t.firstChild.nextSibling;i.classList.remove("fa-play"),i.classList.add("fa-times"),el(!1),alert("Error playing track")},em=e=>{let t=en[e].title,i=eo[en[e].comp_uuid].title;document.getElementById("current-play-info").textContent=i+" / "+t},eg=e=>{let t=k(e);if(t.tracksList.length){en=t.tracksDictionary,eo=t.compositionsDictionary;let e=Math.floor(Math.random()*t.tracksList.length),i=t.tracksList[e].uuid;em(i),ef(i)}},ef=async(e,t)=>{let i=window.location.origin+"/trackfile/"+e;(await fetch(i)).ok?eh(i,e,t):ep(e)},eb=()=>{document.querySelectorAll("[data-trackid]").forEach(e=>{let t=e.getAttribute("data-trackid");e.onclick=()=>{eu(t)}})},ev=()=>{ey.isPlaying()?ey.pause():ey.play()},ey=ei.create({container:"#waveform",responsive:!0,height:80,waveColor:"#007bff",progressColor:"#6610f2",barWidth:2,barGap:1,barRadius:2});ey.on("finish",()=>{let e=es();el(!1),ea(e,!1)}),ey.on("ready",e=>{er?ey.play():el(!1)}),ey.on("play",()=>{let e=es();el(!0),ea(e,!0)}),ey.on("pause",()=>{let e=es();el(!1),ea(e,!1)}),ey.on("error",e=>{console.log(e)});let ew="/composition.html?compositionId=",eE=!1,eC=e=>{e||(0,h.generateAcceptTermsModal)("header")},eT=async()=>{let e=await (0,l.callJsonApi)("/profile","GET",null,"Loading profile...");return e.ok&&(f(e.name),document.getElementById("userlogin").style.display="none",document.getElementById("useroptions").style.display="",document.getElementById("display_profile_name").innerText=`[${e.name}]`,(0,h.checkIfTermsAccepted)(e,eC)),e},ex=async()=>{let e="/mycompositions",t=await (0,l.callJsonApi)(e,"GET",null,"Loading my music...");if(t.compositions)return eS(t.compositions,e);alert("invalid return value for compisitions list")},ek=async(e,t)=>{let i="/compositionsbyuserid/"+e,n=await (0,l.callJsonApi)(i,"GET",null,"Loading user...");if(n.compositions)return f(n.username),W(n.username,e),eS(n.compositions,i);alert("invalid return value for user id"),t.ok?u("my-comp"):u("recent-comp")},eM=async(e,t)=>{let i="/collectionastreebyid/"+e,n=await (0,l.callJsonApi)(i,"GET",null,"Loading collection...");if(n.compositions)return f(n.username),_(n.collection_name,n.username,n.owneruid),eS(n.compositions,i);alert("invalid return value for collection id"),t.ok?u("my-comp"):u("recent-comp")},eL=async e=>{let t=await (0,l.callJsonApi)("/recentcompositions","GET",null,"Loading recent...");if(t.compositions)return eS(t.compositions,"/recentcompositions",e);alert("invalid return value for compisitions list")},eP=async e=>{let t=await (0,l.callJsonApi)("/compositions","GET",null,"Loading all...");if(t.compositions)return eS(t.compositions,"/compositions",e);alert("invalid return value for compisitions list")},eS=(e,t,i)=>{document.getElementById("grid").innerHTML="",document.getElementById("legendbuttons").innerHTML="";let n=!t.includes("/compositionsbyuserid/")&&!t.includes("/collectionastreebyid/");n&&R(!1,i),!e.length&&n?(document.getElementById("initialmessage").hidden=!1,document.getElementById("initialmessage").classList.add("d-flex")):eD(e,t),eg(e),eb()},eD=(e,t)=>{t.includes("/collectionastreebyid/")?eI(x(e,t.replace("/collectionastreebyid/","")),null,t,e.length):m(t)?eI(T(e),"groupedbycollab",t,e.length):eI(C(e),"groupedbyuser_final",t,e.length)},eA=(e,t,i)=>{let n="";for(let o in e){let r=e[o],s="",a="",l=null;for(let e of("collab"===t?a="Collaborations":"coll"===t?(a=Object.values(r)[0].parent_collection,l=Object.values(r)[0].collection_uid):(a=Object.values(r)[0].username,l=Object.values(r)[0].owner_uuid),r))s+=N(e,t,i);n+=B(t,r.length,a,l,s)}return n},e$=(e,t)=>{let i="",n=e.singlecomps;return null==n||n.forEach(e=>{let n=O(e,t);i+=n}),i},eI=(e,t,i,n)=>{let o="",r=Object.keys(e.groupedbycoll).length,s=t?Object.keys(e[t]).length:0,a=e.singlecomps.length;r>0&&(o+=eA(e.groupedbycoll,"coll",i)),s>0&&(o+=eA(e[t],"groupedbycollab"===t?"collab":"user",i)),a>0&&(o+=e$(e,i)),I(o,A(r,s,a,i,n))},eO=async()=>{let e=window.location.search,t=e.split("userid=")[1],i=e.split("collectionid=")[1],n=await eT();eE=n.ok,t?await ek(t,n):i?await eM(i,n):n.ok?await ex():await eL(),d(n,t||i)};document.getElementById("userlogin").innerHTML=`<li class='nav-item'>
        <a class='dropdown-item' href='${window.location.origin}/login.html'>Register / Login</a>
    </li>
    <li class='nav-item'>
        <a class='dropdown-item' href='${ew}demopage'>Test DAW</a>
    </li>
    <li class='nav-item'>
        <a class='dropdown-item' href='${window.location.origin}/static/howto.html'>How-To</a>
    </li>
    <li class='nav-item'>
        <a class='dropdown-item' href='#' id='openNewsModalButton' data-toggle='modal' data-target='#newsModal'><b>News<b></a>
    </li>
    `,document.getElementById("useroptions").innerHTML=`<li class='nav-item'>
      <a class='nav-link' href='${window.location.origin+"/profile.html"}'>Profile <i id='display_profile_name'></i></a>
    </li>
    <li class='nav-item'>
          <a class='nav-link' href='#' id='createNewButton' data-toggle='modal' data-target='#newMusicModal'>/ Create new</a>
    </li>
    <li class='nav-item'>
        <a class='nav-link' href='#' id='openMyCollectionsButton' data-toggle='modal' data-target='#editCollectionsModal'>/ My Collections</a>
    </li>
    <li class='nav-item'>
        <a class='nav-link' href='${window.location.origin+"/static/howto.html"}'>/ How-to</a>
    </li>
    <li class='nav-item'>
        <a class='nav-link' href='#' id='openNewsModalButton' data-toggle='modal' data-target='#newsModal'>/ News</a>
    </li>
    `,$("#newsModal").on("hidden.bs.modal",function(e){let t=document.getElementById("promo-video");t.paused||t.pause()}),(0,l.activateGoHomeLink)(),eO(),document.getElementById("playfloatingbutton").onclick=()=>{ev()};var eN=o("d2TTa"),s=o("72lX3");let eB=!1,eR=document.getElementById("openMyCollectionsButton"),e_=document.getElementById("editmycollectionsbutton"),eW=async()=>{let e=await fetch("/mycollectionsastree");return await e.json()},ej=e=>{let t=`
        <span id='removeCollIcon${e.uuid}' data-uuid='${e.uuid}' data-title='${e.title}' role='button' class='badge badge-pill badge-danger' hidden>-</span>
        <li id='${e.uuid}' class='list-group-item border-bottom-0 border-right-0 border-top-0 border-warning'>
            <input type='text' class='form-control border-secondary' id='treecolltitleinput${e.uuid}' data-uuid='${e.uuid}' placeholder='Type a new title'
            title='collectiontitle' value='${e.title}' disabled>
        </li>`;if(e.compositions.length>0||e.collections.length>0){for(let i of(t+="<ul>",e.compositions))t+=`<li class='list-group-item border-0'><a href='${ew+i.uuid}'><u>${i.title}</u></a></li>`;for(let i of e.collections)t+=ej(i);t+="</ul>"}return t},eH=async()=>{let e=document.getElementById("listCollContainerAllColl"),t=await eW(),i="<ul>";for(let e of t)i+=ej(e);i+="</ul>",e.innerHTML=i},eG=()=>{eB?(eB=!1,e_.innerText="Edit",eq()):(eB=!0,e_.innerText="Done",eU())},eU=()=>{document.querySelectorAll("[id*='removeCollIcon']").forEach(e=>{e.removeAttribute("hidden"),eX(e.getAttribute("data-uuid"),e.getAttribute("data-title"))}),document.querySelectorAll("[id*='treecolltitleinput']").forEach(e=>{e.removeAttribute("disabled"),eY(e.getAttribute("data-uuid"),e.value)})},eq=()=>{document.querySelectorAll("[id*='removeCollIcon']").forEach(e=>{e.setAttribute("hidden","true")}),document.querySelectorAll("[id*='treecolltitleinput']").forEach(e=>{e.setAttribute("disabled","true")})},eV=async()=>{eB=!1,e_.innerText="Edit",await eH(),e_.addEventListener("click",eG,!1)};null==eR||eR.addEventListener("click",eV,!1);let ez=async(e,t,i)=>{if("SPAN"===e.target.tagName){if(!0==confirm(`Are you sure you want remove the collection ${i} and all of its content?`)){let e=await fetch(s.ENDPOINT+"/deletecollection/"+t,{method:"DELETE"});if(null==e?void 0:e.ok){var n;document.getElementById("removeCollIcon"+t).remove();let e=document.getElementById(t);(null==e?void 0:null===(n=e.nextSibling)||void 0===n?void 0:n.tagName)==="UL"&&e.nextSibling.remove(),e.remove()}}else e.target.checked=!1}},eX=(e,t)=>{document.getElementById("removeCollIcon"+e).onclick=async i=>{await ez(i,e,t)}},eY=(e,t)=>{document.getElementById("treecolltitleinput"+e).onblur=i=>{eF(i,e,t)}},eJ=(e,t)=>{fetch(s.ENDPOINT+"/updatecolltitle",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:e,uuid:t})}).then().catch(e=>{console.error("Error updating value:",e)})},eF=(e,t,i)=>{let n=e.target.value;if(i!==n){if(n&&""!==n)eJ(n,t);else{e.target.value=i,alert("Introduce a valid title, please");return}}},eK=document.getElementById("createNewButton"),eQ=document.getElementById("createNewButtonAtHome"),eZ=()=>{eE?(document.getElementById("newtitle").value="",document.getElementById("newdescription").value="",e1(document.getElementById("newcreation")),(0,eN.getCollections)().then(e=>{e?e0(e):(0,eN.getCollectionsError)()})):window.location.href="/login.html"};null==eK||eK.addEventListener("click",eZ,!1),null==eQ||eQ.addEventListener("click",eZ,!1);let e0=e=>{document.getElementById("listCollContainer").innerHTML="",(0,eN.createListCollections)(e,"listCollContainer")},e1=e=>{null==e||e.addEventListener("click",e2)},e2=e=>{let t=document.querySelector('input[name="newMusicTypeRadioButton"]:checked').value,i="/newcomposition";"coll"===t&&(i="/newcollection");let n=document.getElementById("newtitle").value,o=document.querySelector('input[name="newMusicPrivacyRadios"]:checked').value;if(!n){alert("Introduce a valid title, please");return}let r=document.getElementById("newdescription").value,a=document.getElementById("inputGroupSelectCollect"),d=(null==a?void 0:a.value)||null;"0"===d&&(d=null);let c=JSON.stringify({title:n,privacy_level:o,parent_uuid:d,description:r});(0,l.startLoader)("Creating..."),fetch(s.ENDPOINT+i,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:c}).then(e=>(e.ok||e.statusText,e.json())).then(e=>{if((0,l.cancelLoader)(),e)e3(e);else throw Error(e)}).catch(e=>{(0,l.cancelLoader)()})},e3=e=>{$("#newMusicModal").modal("hide"),e.composition?window.location.href=ew+e.composition.uuid:e.ok?(0,a.default).dynamicModalDialog("Collection created successfully!",null,"","Close","New Collection","bg-success"):(0,a.default).dynamicModalDialog("An error happened, item not created",null,"","Close","Error at Creation","bg-danger")}}();
//# sourceMappingURL=index.a72d56f5.js.map
