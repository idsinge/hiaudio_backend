class s extends AudioWorkletProcessor{record(s){var i;this.ringbuf[this.write_idx]=s,this.write_idx=((this.write_idx+1)%(i=this.ringbuf.length)+i)%i}get_past_sample(s){this.write_idx;var i,t=((this.write_idx-1-s)%(i=this.ringbuf.length)+i)%i;return this.ringbuf[t]}process(s,i){var t=s[0];if(!t.length)return!0;for(var r=t[0],e=i[0][0],a=0;a<r.length;a++){if(r[a]>this.threshold&&this.tapped){for(var h=-1,n=0;n++!=this.ringbuf.length;)if(0>this.get_past_sample(n)){h=n;break}for(;n++!=this.ringbuf.length;){var g=(n-h)/this.sq_period;if(!0!=Math.sign(this.get_past_sample(n))&&Math.abs(0-g)>2)break}var l=globalThis.currentFrame+a-n-this.start;if(l>0){for(var o=new Float32Array(2*l),p=0;p<o.length;p++)o[o.length-p]=this.get_past_sample(p);var _=l/globalThis.sampleRate;this.port.postMessage({latency:_,array:o,offset:n,delay_frames:l})}this.tapped=!1}0==this.remaining?(this.sq_remaining==this.sq_frames&&(this.tapped=!0,this.start=globalThis.currentFrame+a,r[a]=-1),e[a]=this.sq_remaining%this.sq_period>this.sq_period/2?this.sq_amp:-this.sq_amp,this.sq_remaining--,0==this.sq_remaining&&(this.sq_remaining=this.sq_frames,this.remaining=this.interval)):this.remaining--,this.record(r[a]+e[a])}return!0}constructor(...s){super(s),this.interval=1*globalThis.sampleRate,this.remaining=this.interval,this.start=0,this.tapped=!1,this.threshold=.2,this.sq_frames=64,this.sq_remaining=64,this.sq_period=16,this.sq_amp=.8,this.ringbuf=new Float32Array(globalThis.sampleRate),this.write_idx=0}}registerProcessor("measure-processor",s);
//# sourceMappingURL=processor.13fb62cf.js.map
