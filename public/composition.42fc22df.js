function t(t,e,i,n){Object.defineProperty(t,e,{get:i,set:n,enumerable:!0,configurable:!0})}var e,i,n=globalThis,s={},a={},r=n.parcelRequire1e7e;null==r&&((r=function(t){if(t in s)return s[t].exports;if(t in a){var e=a[t];delete a[t];var i={id:t,exports:{}};return s[t]=i,e.call(i.exports,i,i.exports),i.exports}var n=Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(t,e){a[t]=e},n.parcelRequire1e7e=r),(0,r.register)("lRrDz",function(e,i){t(e.exports,"getCollections",()=>s),t(e.exports,"getCollectionsError",()=>a),t(e.exports,"createListCollections",()=>o);var n=r("9QUIF");let s=async()=>{let t=await fetch(n.ENDPOINT+"/mycollections"),e=null;return t?.ok&&(e=await t.json()),e},a=()=>{alert("Problem getting collections")},o=(t,e,i)=>{let n=t.all_collections,s=document.getElementById(e),a="<option value='0'>...</option>",r=null;n.forEach(t=>{if(t){r=t.uuid===i?"selected>":null;let e=`<option value='${t.uuid}' ${r||">"}${t.title}</option>`;a+=e}});let o=`<select class='custom-select' id='inputGroupSelectCollect'>${a}</select>`;s.insertAdjacentHTML("afterbegin",o)}});let o=null;const l=t=>new Promise((e,i)=>{let n=indexedDB.open(t,2);n.onerror=t=>{console.log(t),i(Error("Error opening database"))},n.onsuccess=t=>{let i=t.target.result;o=i,e(i)},n.onupgradeneeded=t=>{let i=t.target.result;o=i;let n=i.createObjectStore("tracks",{keyPath:"track_id"});n.createIndex("composition_id","composition_id",{unique:!1}),n.transaction.oncomplete=t=>{e(i)}}}),c=(t,e)=>{if(t)return new Promise((i,n)=>{let s=t.transaction(["tracks"],"readwrite");s.oncomplete=t=>{i()},s.onerror=t=>{console.log("error",t),n(Error("Error updating database"))},s.objectStore("tracks").put(e)})},u=(t,e)=>new Promise((i,n)=>{t&&e||n(Error("No DB or Comp ID"));let s=[],a=t.transaction("tracks").objectStore("tracks").index("composition_id"),r=IDBKeyRange.only(e);a.openCursor(r).onsuccess=t=>{let e=t.target.result;e?(s.push(e.value),e.continue()):i(s)}});var d=r("9QUIF"),h=r("ck9ES"),d=r("9QUIF"),h=r("ck9ES"),d=r("9QUIF"),h=r("ck9ES"),p=r("lRrDz");let f=null;const m=t=>{(0,p.getCollections)().then(e=>{e?v(e,t):(0,p.getCollectionsError)()})},g=t=>{let e=document.getElementById("openSettingsButton");e?.addEventListener("click",()=>{m(t)},!1)},v=(t,e)=>{document.getElementById("listCollContainerNewColl").replaceChildren(),(0,p.createListCollections)(t,"listCollContainerNewColl",f||e),t?.all_collections.length&&e&&(f=e)},y=async t=>{let e=document.getElementById("inputGroupSelectCollect").value;(f||"0"!==e)&&e!==f&&await b(t,e)},b=async(t,e)=>{let i=await to("PATCH","/updatecompcollection",{uuid:t,collection_id:"0"===e?null:e});i?.ok&&(f=e)};let k=null;const w=()=>k,E=t=>{k=t,document.getElementById("newtitle").value=t},x=async t=>{let e=document.getElementById("newtitle").value;e!==k&&await T(t,e)},T=async(t,e)=>{(await to("PATCH","/updatecomptitle",{uuid:t,title:e})).ok&&(k=e,document.getElementById("comp-title").innerHTML=e)};let S=null;const P=()=>S,_=t=>{S=t,document.getElementById("newdescription").value=t},C=async t=>{let e=document.getElementById("newdescription").value;e!==S&&await O(t,e)},O=async(t,e)=>{(await to("PATCH","/updatecompdescription",{uuid:t,description:e})).ok&&(S=e,document.getElementById("comp-description").innerHTML=e)};let A=null;const I=()=>A,M=t=>{A=t,document.getElementById("opentocontribution").checked=t},R=async t=>{let e=document.getElementById("opentocontribution").checked;e!==A&&await D(t,e)},L=t=>{let e=document.getElementById("opentocontribution");0===t?(e.checked=!1,e.disabled=!0):e.disabled=!1},D=async(t,e)=>{if((await to("PATCH","/updatecomptocontrib",{uuid:t,opentocontrib:e})).ok){if(A=e,e)document.getElementById("privacybadgetext").insertAdjacentHTML("afterend",'&nbsp;<span class="badge badge-light">STATUS:&nbsp;</span><span class="badge badge-info">OPEN TO CONTRIB</span>');else if(document.querySelector(".badge-info")){let t=document.getElementById("privacybadgetext").nextSibling.nextSibling,e=t.nextSibling;t.remove(),e.remove()}}};var h=r("ck9ES");let j=null;const N=()=>j,B=()=>{for(let t of document.getElementsByName("settingsPrivacyRadios"))t.addEventListener("change",function(){this.checked&&(3===parseInt(this.value)?L(0):L(1))})},G=t=>{j=t,document.getElementById("settingsPrivacyRadios"+t).checked=!0,t===h.LevelPrivacy.private&&L(0)},F=async t=>{let e=parseInt(document.querySelector('input[name="settingsPrivacyRadios"]:checked').value);e!==j&&await U(t,e)},U=async(t,e)=>{if((await to("PATCH","/updatecompprivacy",{uuid:t,privacy:e})).ok){j=e;let t=document.getElementById("privacybadgetext");t.className="badge "+h.PRIVACY_BADGE_STYLE[e],t.innerText=h.PRIVACY_BADGE_TEXT[e]}};var d=r("9QUIF"),h=r("ck9ES");let z=[],V=[],q=[];const H={1:"Owner",2:"Admin",3:"Member",4:"Guest"},W=()=>z,X=()=>{document.getElementById("contributorinput").value="",document.getElementById("listOfContributors").innerHTML=""},Y=()=>{V=[],q=[]},J=t=>{let e=document.getElementById("listOfContributors");t.length?(z=t,t.flatMap(t=>Q(e,t))):(document.getElementById("contributorinput").value="",e.innerHTML="")},Z=t=>{let e=document.getElementById("addContribButton"),i=document.getElementById("contributorinput"),n=document.getElementById("listOfContributors");e.addEventListener("click",function(){let e=document.getElementById("inputGroupSelectRole").value;document.getElementById("contributorinput").classList.remove("is-invalid"),document.getElementById("validationemailresult").innerText="",i.value&&(0,h.looksLikeMail)(i.value)?K(n,i.value.trim(),t,e):(document.getElementById("contributorinput").classList.add("is-invalid"),document.getElementById("validationemailresult").innerText="Sorry, invalid email address format.")})},Q=(t,e)=>{let i=H[e.role],n=document.createElement("li");n.className="list-group-item",n.id=e.user_uid,n.textContent=e.email+" ("+i+")";let s=`&nbsp;<div class='custom-control custom-switch custom-control-inline float-right'>
    <input type='checkbox' class='custom-control-input is-invalid' id='removeContSwitch${e.user_uid}'>
    <label class='custom-control-label is-invalid' for='removeContSwitch${e.user_uid}'>Remove</label>
  </div>`;n.innerHTML+=s,t.appendChild(n),tn(e)},K=async(t,e,i,n)=>{if(0!==parseInt(document.getElementById("inputGroupSelectRole").value)){let s={email:e,user_uid:e,composition_id:i,role:parseInt(n)},a=z.findIndex(t=>t.email===e),r=V.findIndex(t=>t.email===e),o=q.indexOf(e);o>-1&&q.splice(o,1);if(r<0&&a<0||tt(s,r,a,t)){let i=await fetch(d.ENDPOINT+"/checkuser/"+e);if(i?.ok||i?.status===404){if(i?.status===200){let t=await i.json();s.user_uid=t.user_uid}V.push(s),Q(t,s),i?.status===404&&alert("An invitation via email will be sent to: "+e+", after clicking on the button Confirm")}else alert("User can't be added")}else alert("Duplicate user");h.isSafari&&ei.getEventEmitter().emit("resume")}},tt=(t,e,i,n)=>{let s=!1,a=z[i]?.user_uid||V[e]?.user_uid,r=document.getElementById(a);return r&&(i>=0&&e<0&&z[i].role!==t.role&&(s=!0,r.remove()),e>=0&&i<0&&V[e].role!==t.role&&(s=!0,V.splice(e,1),r.remove()),e>=0&&i>=0&&(z[i].role===t.role&&(V.splice(e,1),r.remove(),Q(n,t)),V.length&&V[e].role!==t.role&&(s=!0,V.splice(e,1),r.remove()))),s},te=async()=>{if(V.length>0){let t=[...V];for(let e=0;e<V.length;e++){let i=V[e],n=await to("POST","/addcontributorbyemail",i);n?.ok&&(V[e].id=n.contribid,i.email===i.user_uid&&(V[e].user_uid=n.uuid,document.getElementById(i.email).id=n.uuid),t[e]=null)}let e=t.filter(t=>null!=t);z=z.concat(V),document.getElementById("contributorinput").value="",V=e}},ti=async t=>{if(q.length>0){let e=[...q];for(let i=0;i<q.length;i++){let n=z.findIndex(t=>t.email===q[i]),s=z[n].user_uid,a={contrib_uuid:s,comp_uuid:t},r=await to("DELETE","/deletecontributor",a);r?.ok?(e[i]=null,z.splice(n,1),document.getElementById(s).remove()):document.getElementById("removeContSwitch"+s).checked=!1}q=e.filter(t=>null!=t)}},tn=t=>{document.getElementById("removeContSwitch"+t.user_uid).addEventListener("change",function(e){let i=e.target;if("INPUT"===i.tagName&&"checkbox"===i.type&&i.checked){let i=confirm(`Do you want remove the contributor: ${t.email}?`);if(h.isSafari&&ei.getEventEmitter().emit("resume"),!0===i){let e=V.findIndex(e=>e.email===t.email);e>-1?(V.splice(e,1),-1===z.findIndex(e=>e.email===t.email)?document.getElementById(t.user_uid).remove():q.push(t.email)):q.push(t.email)}else e.target.checked=!1}})},ts=()=>{let t=document.getElementById("contributorsbadgetext");if(t||z.length){let e=document.getElementById("rolebadgetext");if(t){if(z.length!==parseInt(t.innerText)){if(z.length)t.innerText=z.length;else{let i=t.previousSibling;t.remove(),console.log(t.nextSibling),i.remove(),e.nextSibling.remove()}}}else if(e){let t=`&nbsp;<span class="badge badge-light">COLLABORATORS:&nbsp;</span><span id="contributorsbadgetext" class="badge badge-dark">${z.length}</span>`;e.insertAdjacentHTML("afterend",t)}}},ta=t=>{J(t.contributors),Z(t.uuid),E(t.title),_(t.description),G(t.privacy),M(t.opentocontrib),tu(t.uuid),tc(t),tr(),B(),g(t?.collection_id)},tr=()=>{(0,h.cancelLoader)("settingsloader");let t=document.getElementById("useroptions"),e=document.createElement("li");e.innerHTML=`<li class="nav-item">
    <a class="nav-link" href="#" id="openSettingsButton" data-toggle="modal" data-target="#settingsModal">Settings</a>
  </li>
   `,t.appendChild(e)},to=async(t,e,i)=>{let n=JSON.stringify(i),s=null;try{let i=await fetch(d.ENDPOINT+e,{method:t,headers:{"Content-Type":"application/json",Accept:"application/json"},body:n}),a=await i.json();a&&(s=a)}catch(t){alert(t)}return s},tl=t=>{E(w()||t.title),_(P()||t.description),G(N()||t.privacy),M(I()||t.opentocontrib),X(),J(W().length?W():t.contributors),Y(),document.getElementById("deleteComposition").checked=!1},tc=t=>{let e=document.getElementById("cancelsettingsbutton");e?.addEventListener("click",()=>{tl(t)})},tu=async t=>{let e=document.getElementById("updatecompositionbutton");e?.addEventListener("click",async e=>{h.startLoader("settingsloader","Updating Settings..."),!0===document.getElementById("deleteComposition").checked?await td(t):(await x(t),await C(t),await F(t),await R(t),await te(),await ti(t),await y(t),ts(),$("#settingsModal").modal("hide")),h.cancelLoader("settingsloader")})},td=async t=>{let e=confirm("Delete "+w()+"?");h.isSafari&&ei.getEventEmitter().emit("resume"),e&&(await to("DELETE","/deletecomposition/"+t,null)).ok&&(window.location.href=window.location.origin)};var h=r("ck9ES");const th=new class{constructor(){this.modal=this.getDynamicModal(),this.modal||(this.modal=this.initDynamicModal())}dynamicModalDialog(t,e,i,n,s,a){this.setDynamicModalContent('<div class="modal-header '+a+' text-white"><h5 class="modal-title" id="dynamicModalLabel">'+s+'</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body">'+t+'</div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">'+n+"</button>"+(null!==e?"<button id="+e+' type="button" class="btn btn-primary">'+i+"</button>":"")+"</div>"),$(this.modal).modal("show")}getDynamicModal(){return document.getElementById("dynamicModal")}setDynamicModalContent(t){this.modal.querySelector(".modal-content").innerHTML=t}closeDynamicModal(){$(this.modal).modal("hide")}initDynamicModal(){let t=document.createElement("div");return t.classList.add("modal","fade"),t.setAttribute("id","dynamicModal"),t.setAttribute("tabindex","-1"),t.setAttribute("role","dialog"),t.setAttribute("aria-labelledby","dynamicModalLabel"),t.setAttribute("aria-hidden","true"),t.innerHTML='<div class="modal-dialog modal-sm modal-dialog-centered" role="document"><div class="modal-content"></div></div>',document.body.appendChild(t),t}};let tp=!1,tf=null,tm=null,tg=null,tv=null;const ty=document.getElementById("edittrackinfobutton"),tb=()=>{tD(),tM(),tw(),ty.addEventListener("click",t$,!1)},tk=async(t,e,i)=>{tp=!1,tm=t,tg=i,ty.innerText="Edit",(0,h.startLoader)("trackinfoloader","Loading track info...");let n=await (0,h.callJsonApi)("/getinfotrack/"+i,"GET");"object"==typeof n?(tf=n,t_(n,null)):(th.dynamicModalDialog("Error getting track info",null,"","Close","Error","bg-danger"),t_(null,e))},tw=()=>{document.getElementById("btn-add-new-annot").onclick=()=>{let t=Date.now(),e=document.getElementById("trackinfotablebody"),i=`<tr class="linebreak"><th id='key-edit-${t}' contenteditable='true' scope='row'></th>
        <td contenteditable='true' data-key=''></td>
        <td id='btn-rem-${t}' class='delete-row' data-key=''>&nbsp;<i class="fa fa-trash text-danger"></i></td>
        </tr>`;e.innerHTML+=i,tp||ty.click();let n=document.getElementById("key-edit-"+t);n.addEventListener("input",function(){n.parentNode.children[1].dataset.key=n.innerText,n.parentNode.children[2].dataset.key=n.innerText});let s=document.getElementById("btn-rem-"+t);s.onclick=()=>{tO(s)}}},tE=t=>{let e="";return t.title&&(e+=`<tr><th scope='row'>title</th><td contenteditable='false' data-key='title'>${t.title}</td></tr>`),e},tx=(t,e)=>{let i=[];return e.forEach(e=>{t.some(t=>t.key===e)||i.push(e)}),i},tT=t=>{let e="";for(let i in t)"title"!==t[i]&&(e+=`<tr><th scope='row'>${t[i]}</th><td contenteditable='false' data-key='${t[i]}'></td></tr>`);return e},tS=t=>{let e="";return t.annotations&&(e+=tT(tx(t.annotations,tv))+tC(t.annotations)),e},tP=t=>t.reserved_keys?t.reserved_keys:null,t_=async(t,e)=>{(0,h.cancelLoader)("trackinfoloader");let i=document.getElementById("trackinfotablebody"),n="";t?(tv=tP(t),n+=tE(t)+tS(t)):n+=`<tr><th scope='row'>title</th><td data-key='title' class='linebreak'>${e}</td></tr>`,i.innerHTML=n},tC=t=>{let e="";for(let i in t){let n=t[i];e+=`<tr class="linebreak"><th ${n.custom_added?"contenteditable='false'":""} scope='row'>${n.key}</th>
        <td contenteditable='false' data-key='${n.key}' data-uuid='${n.uuid}'>${n.value}</td>
        <td class='delete-row' data-key='${n.key}' data-uuid='${n.uuid}' hidden>${n.custom_added?'&nbsp;<i class="fa fa-trash text-danger"></i>':""}</td>
        </tr>`}return e},tO=t=>{th.dynamicModalDialog("Delete: <b>"+t.dataset.key+"</b> ?","btn-delete-row","Delete","Cancel","Warning","bg-warning"),document.getElementById("btn-delete-row").onclick=()=>{tA(t)}},tA=async t=>{let e=t.dataset.uuid;e?"object"==typeof await (0,h.callJsonApi)("/deleteannotation/"+e,"DELETE")&&t.parentNode.remove():t.parentNode.remove(),th.closeDynamicModal()},tI=()=>{document.getElementById("trackinfotablebody").innerHTML=""},tM=()=>{let t=document.getElementById("canceltrackinfobutton");t?.addEventListener("click",()=>{tI()})},tR=t=>{let e=t.getAttribute("data-uuid"),i=t.getAttribute("data-key"),n=t.innerText,s=tf.annotations.find(t=>t.uuid===e),a={};return!e||tv.includes(s.key)||tv.includes(i)||s.key===i||(a.key=i),s.value!==n&&(a.value=n),Object.keys(a).length>0&&(a.uuid=e),a},tL=()=>{let t={};return t.annotations=[],document.querySelectorAll("td[contenteditable]").forEach(e=>{if(e.getAttribute("data-uuid")){let i=tR(e);Object.keys(i).length>0&&t.annotations.push(i)}else{let i=e.getAttribute("data-key");"title"===i?tf[i]!==e.innerText&&(t[i]=e.innerText):""===e.innerText&&(""===i||tv.includes(i))||(t.annotations||(t.annotations=[]),t.annotations.push({key:i,value:e.innerText}))}}),t},tD=async()=>{let t=document.getElementById("updatetrackinfobutton");t?.addEventListener("click",async t=>{let e=tL();if(e.title||e.annotations.length>0){h.startLoader("trackinfoloader","Updating track info...");let t={trackid:tg};tj(await h.callJsonApi("/updatetrackinfo","PATCH",{...e,...t}),e),h.cancelLoader("trackinfoloader")}$("#trackInfoModal").modal("hide")})},tj=(t,e)=>{if("object"==typeof t&&t.ok){if(e?.title){ei.tracks[tm].name=e.title;let t=document.querySelectorAll(`[data-track-id='${tg}']`);1===t.length&&(t[0].dataset.name=e.title),ei.getEventEmitter().emit("updateview")}}else if(t?.errors||"string"==typeof t){let e="";t.errors?t.errors.forEach(t=>{e+=t+". "}):e=t,th.dynamicModalDialog("Error updating track info: "+e,null,"","Close","Error","bg-danger")}else th.dynamicModalDialog("Unexpected error happened when updating track info",null,"","Close","Error","bg-danger")},t$=()=>{tp?(tp=!1,ty.innerText="Edit",tB()):(tp=!0,ty.innerText="Done",tN())},tN=()=>{document.querySelectorAll("*[contenteditable='false']").forEach(t=>{if(t.contentEditable=!0,t.classList.add("italic"),"TH"===t.tagName){t.addEventListener("input",function(){t.parentNode.children[1].dataset.key=t.innerText});let e=t.parentNode.lastElementChild;e.classList.contains("delete-row")&&(e.hidden=!1,e.onclick=()=>{tO(e)})}})},tB=()=>{document.querySelectorAll("*[contenteditable='true']").forEach(t=>{if(t.contentEditable=!1,t.classList.remove("italic"),"TH"===t.tagName){let e=t.parentNode.lastElementChild;e.classList.contains("delete-row")&&(e.hidden=!0)}})};let tG=null;function tF(t,e,i,n,s,a,r){this.id=t,this.name=e,this.src=d.ENDPOINT+"/trackfile/"+t,this.muted=i,this.soloed=n,this.gain=s,this.stereoPan=a,this.customClass=r}const tU=(t,e)=>{let i=null;u(t,e?.uuid).then(t=>{i=t}).catch(t=>{console.log(t)}).finally(()=>{tq(e,i),t0(e)})},tz=t=>{let e={};return t.forEach(t=>{e[t.track_id]=t}),e},tV=(t,e,i)=>{let n=!!i&&!!i[t?.uuid]&&i[t.uuid].muted,s=!!i&&!!i[t?.uuid]&&i[t.uuid].soloed,a=i&&i[t?.uuid]?i[t.uuid].gain:1,r=i&&i[t?.uuid]?i[t.uuid].stereoPan:0,o=t.title,l={name:o,track_id:t.uuid,user_id:t.user_id,user_uid:t.user_uid,composition_id:e.uuid,viewer_id:e.viewer_id||"null"};return new tF(t.uuid,o,n,s,a,r,l)},tq=(t,e)=>{let i=t.owner||1<=t.role&&t.role<=3||!1,n=t.role;tG=t.viewer_id;let s=null;if(e?.length&&(s=tz(e)),i&&(ei.controls.widgets.remove=!1,ee(!0),es.enableUpload(),1===n&&ta(t)),t.tracks){let e=[];t.tracks.forEach(i=>{if(i){let n=tV(i,t,s);e.push(n)}}),tH(e,i,n)}else(0,h.cancelLoader)(h.LOADER_ELEM_ID),ei.initExporter(),ea.init()},tH=(t,e,i)=>{let n=null;ei.load(t).then(()=>{ei.initExporter()}).catch(t=>{n=t}).then(()=>{(0,h.cancelLoader)(h.LOADER_ELEM_ID),n?alert(n):(ea.init(),e&&(tb(),en.detectClickOutsideMenuOpt(),en.displayOptMenuForTracks(i)))})},tW=t=>`<span class="badge badge-light">OWNER:&nbsp;</span>
            <i class="fa fa-user"></i>&nbsp;
            <a href="${h.uriUserPage+t.user_id}" class="card-url">${t.username}&nbsp;</a>`,tX=t=>`${t.role?`<span class="badge badge-light">YOUR ROLE:&nbsp;</span>
        <span id="rolebadgetext" class="badge badge-success">
         ${H[t.role]}
        </span>&nbsp;`:""}`,tY=t=>`${t.contributors.length?`<span class="badge badge-light">COLLABORATORS:&nbsp;</span>
        <span id="contributorsbadgetext" class="badge badge-dark">
        ${t.contributors.length}</span>&nbsp;`:""}`,tJ=t=>`${t.opentocontrib?'<span class="badge badge-light">STATUS:&nbsp;</span><span class="badge badge-info">OPEN TO CONTRIB</span>':""}`,tZ=t=>{let e=t.description||"";return`<p>
                <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseDescription" aria-expanded="false">
                Description
                </button>
            </p>
            <div class="collapse" id="collapseDescription">
                <div class="card card-body" id="comp-description">
                ${e}
                </div>
            </div>`},tQ=t=>`<span class="badge badge-light">PRIVACY:&nbsp;</span>
            <span id="privacybadgetext" class="badge 
            ${h.PRIVACY_BADGE_STYLE[t.privacy]}">${h.PRIVACY_BADGE_TEXT[t.privacy]}
            </span>&nbsp;`,tK=t=>`${t.collection_id?`<span class="badge badge-light">COLLECTION:&nbsp;</span>
    <i class="fa fa-th-list"></i>&nbsp;
    <a href="${h.uriCollectionPage+t.collection_id}" class="card-url">${t.parent_collection}&nbsp;</a>`:""}`,t0=t=>{let e='<h1 class="post-title">Test DAW</h1>';t.title&&(e="<br>"+tW(t)+tK(t)+"<br>"+tX(t)+tY(t)+tQ(t)+tJ(t)+`<p><h2 id="comp-title" class="post-title">${t.title}</h2></p>`+tZ(t)),document.getElementById("post-header").insertAdjacentHTML("afterbegin",e)};class t1{displayOptMenuForNewTrack(t){let e=t.result,i=e?.message?.audio||e?.message?.voice,n=i.title||e.message.date,s=i.file_unique_id,a=document.getElementsByClassName("controls"),r=a.length-1;if(r>=0){let t={name:n,track_id:s,user_id:i.user_id,user_uid:i.user_uid,composition_id:i.composition_id};ei.tracks[r].customClass=t,this.createMenuOptButton(a,r,n,s)}}displayOptMenuForTracks(t){document.querySelectorAll(".menuoptbtn").length&&document.querySelectorAll(".menuoptbtn").forEach(t=>t.remove());let e=document.getElementsByClassName("controls"),i=ei.getInfo().tracks;for(let n=0;n<i.length;n++)if(i[n]?.customClass&&(1===t||2===t||3===t&&i[n].customClass.user_uid===tG)){let t=i[n].customClass.name,s=i[n].customClass.track_id;this.createMenuOptButton(e,n,t,s)}}createMenuOptButton(t,e,i,n){let s="menuoptbtn-"+e,a="menuDropdown"+e,r=document.createElement("button"),o=document.createTextNode("...");r.className="menuoptbtn",r.onclick=()=>{document.getElementById(a).classList.toggle("show")},r.id=s,r.appendChild(o),t[e].appendChild(r);let l=this.createListMenuOpt(a,e,i,n);document.getElementById(s).appendChild(l),t[e].getElementsByClassName("track-header")[0].getElementsByTagName("span")[0].style["margin-left"]="3em"}createListMenuOpt(t,e,i,n){let s=document.createElement("ul");s.id=t,s.className="dropdown-menu";let a=this.createDeleteMenuOpt(e,i,n),r=this.createTrackInfoMenuOpt(e,i,n);return s.appendChild(a),s.appendChild(r),s}createDeleteMenuOpt(t,e,i){let n=document.createElement("li");return n.className="dropdown-item btn-light",n.dataset.pos=t,n.dataset.name=e,n.dataset.trackId=i,n.onclick=t=>{this.deleteTrackConfirmDialog(t,this.sendDeleteRequest,this.doAfterDeleted)},n.appendChild(document.createTextNode("Delete")),n}createTrackInfoMenuOpt(t,e,i){let n=document.createElement("li");return n.className="dropdown-item btn-light",n.dataset.target="#trackInfoModal",n.dataset.toggle="modal",n.onclick=n=>{tk(t,e,i)},n.appendChild(document.createTextNode("Track Info")),n}detectClickOutsideMenuOpt(){window.onclick=function(t){let e=document.getElementsByClassName("dropdown-menu show");e.length>0&&"menuoptbtn"!==t.target.className?Array.from(e).forEach(function(t){t.className="dropdown-menu"}):e.length>1&&Array.from(e).forEach(function(e){t.target.contains(e)||(e.className="dropdown-menu")})}}deleteTrackConfirmDialog(t,e,i){let n=confirm("Delete "+t.target.dataset.name+"?");h.isSafari&&ei.getEventEmitter().emit("resume"),n&&e(t.target.dataset.pos,t.target.dataset.trackId,i)}sendDeleteRequest(t,e,i){(0,h.startLoader)(h.LOADER_ELEM_ID,"Deleting track..."),fetch(d.ENDPOINT+"/deletetrack/"+e,{method:"DELETE"}).then(t=>t.json()).then(e=>{i(e,t)}).catch(t=>{console.log(t),(0,h.cancelLoader)(h.LOADER_ELEM_ID)})}doAfterDeleted(t,e){if((0,h.cancelLoader)(h.LOADER_ELEM_ID),t.ok){let i=t.role,n=ei.tracks;ei.getEventEmitter().emit("removeTrack",n[e]),new t1().displayOptMenuForTracks(i)}}}var d=r("9QUIF"),h=r("ck9ES"),t2={};t2=(()=>{var t={6824:t=>{var e,i,n;/*!
 * Cross-Browser Split 1.1.1
 * Copyright 2007-2012 Steven Levithan <stevenlevithan.com>
 * Available under the MIT License
 * ECMAScript compliant, uniform cross-browser split method
 */t.exports=(i=String.prototype.split,n=/()??/.exec("")[1]===e,function(t,s,a){if("[object RegExp]"!==Object.prototype.toString.call(s))return i.call(t,s,a);var r,o,l,c,u=[],d=(s.ignoreCase?"i":"")+(s.multiline?"m":"")+(s.extended?"x":"")+(s.sticky?"y":""),h=0,s=RegExp(s.source,d+"g");for(t+="",n||(r=RegExp("^"+s.source+"$(?!\\s)",d)),a=a===e?4294967295:a>>>0;(o=s.exec(t))&&(!((l=o.index+o[0].length)>h)||(u.push(t.slice(h,o.index)),!n&&o.length>1&&o[0].replace(r,function(){for(var t=1;t<arguments.length-2;t++)arguments[t]===e&&(o[t]=e)}),o.length>1&&o.index<t.length&&Array.prototype.push.apply(u,o.slice(1)),c=o[0].length,h=l,!(u.length>=a)));)s.lastIndex===o.index&&s.lastIndex++;return h===t.length?(c||!s.test(""))&&u.push(""):u.push(t.slice(h)),u.length>a?u.slice(0,a):u})},1804:(t,e,i)=>{var n=i(5618),s=i(7205),a=i(7191),r=i(5516),o=i(9981);(t.exports=function(t,e){var i,s,l,c,u;return arguments.length<2||"string"!=typeof t?(c=e,e=t,t=null):c=arguments[2],n(t)?(i=o.call(t,"c"),s=o.call(t,"e"),l=o.call(t,"w")):(i=l=!0,s=!1),u={value:e,configurable:i,enumerable:s,writable:l},c?a(r(c),u):u}).gs=function(t,e,i){var l,c,u,d;return"string"!=typeof t?(u=i,i=e,e=t,t=null):u=arguments[3],n(e)?s(e)?n(i)?s(i)||(u=i,i=void 0):i=void 0:(u=e,e=i=void 0):e=void 0,n(t)?(l=o.call(t,"c"),c=o.call(t,"e")):(l=!0,c=!1),d={get:e,set:i,configurable:l,enumerable:c},u?a(r(u),d):d}},430:t=>{t.exports=function(){}},7191:(t,e,i)=>{t.exports=i(6560)()?Object.assign:i(7346)},6560:t=>{t.exports=function(){var t,e=Object.assign;return"function"==typeof e&&(e(t={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),t.foo+t.bar+t.trzy==="razdwatrzy")}},7346:(t,e,i)=>{var n=i(5103),s=i(2745),a=Math.max;t.exports=function(t,e){var i,r,o,l=a(arguments.length,2);for(r=1,t=Object(s(t)),o=function(n){try{t[n]=e[n]}catch(t){i||(i=t)}};r<l;++r)e=arguments[r],n(e).forEach(o);if(void 0!==i)throw i;return t}},6914:(t,e,i)=>{var n=i(430)();t.exports=function(t){return t!==n&&null!==t}},5103:(t,e,i)=>{t.exports=i(7446)()?Object.keys:i(6137)},7446:t=>{t.exports=function(){try{return Object.keys("primitive"),!0}catch(t){return!1}}},6137:(t,e,i)=>{var n=i(6914),s=Object.keys;t.exports=function(t){return s(n(t)?Object(t):t)}},5516:(t,e,i)=>{var n=i(6914),s=Array.prototype.forEach,a=Object.create,r=function(t,e){var i;for(i in t)e[i]=t[i]};t.exports=function(t){var e=a(null);return s.call(arguments,function(t){n(t)&&r(Object(t),e)}),e}},1290:t=>{t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function");return t}},2745:(t,e,i)=>{var n=i(6914);t.exports=function(t){if(!n(t))throw TypeError("Cannot use null or undefined");return t}},9981:(t,e,i)=>{t.exports=i(3591)()?String.prototype.contains:i(6042)},3591:t=>{var e="razdwatrzy";t.exports=function(){return"function"==typeof e.contains&&!0===e.contains("dwa")&&!1===e.contains("foo")}},6042:t=>{var e=String.prototype.indexOf;t.exports=function(t){return e.call(this,t,arguments[1])>-1}},8832:(t,e,i)=>{i(4167)("ev-store","7");var n="__EV_STORE_KEY@7";t.exports=function(t){var e=t[n];return e||(e=t[n]={}),e}},8370:(t,e,i)=>{var n,s,a,r,o,l,c,u=i(1804),d=i(1290),h=Function.prototype.apply,p=Function.prototype.call,f=Object.create,m=Object.defineProperty,g=Object.defineProperties,v=Object.prototype.hasOwnProperty,y={configurable:!0,enumerable:!1,writable:!0};n=function(t,e){var i;return d(e),v.call(this,"__ee__")?i=this.__ee__:(i=y.value=f(null),m(this,"__ee__",y),y.value=null),i[t]?"object"==typeof i[t]?i[t].push(e):i[t]=[i[t],e]:i[t]=e,this},s=function(t,e){var i,s;return d(e),s=this,n.call(this,t,i=function(){a.call(s,t,i),h.call(e,this,arguments)}),i.__eeOnceListener__=e,this},o={on:n,once:s,off:a=function(t,e){var i,n,s,a;if(d(e),!v.call(this,"__ee__")||!(i=this.__ee__)[t])return this;if("object"==typeof(n=i[t]))for(a=0;s=n[a];++a)(s===e||s.__eeOnceListener__===e)&&(2===n.length?i[t]=n[a?0:1]:n.splice(a,1));else(n===e||n.__eeOnceListener__===e)&&delete i[t];return this},emit:r=function(t){var e,i,n,s,a;if(v.call(this,"__ee__")&&(s=this.__ee__[t])){if("object"==typeof s){for(e=1,i=arguments.length,a=Array(i-1);e<i;++e)a[e-1]=arguments[e];for(e=0,s=s.slice();n=s[e];++e)h.call(n,this,a)}else switch(arguments.length){case 1:p.call(s,this);break;case 2:p.call(s,this,arguments[1]);break;case 3:p.call(s,this,arguments[1],arguments[2]);break;default:for(e=1,i=arguments.length,a=Array(i-1);e<i;++e)a[e-1]=arguments[e];h.call(s,this,a)}}}},c=g({},l={on:u(n),once:u(s),off:u(a),emit:u(r)}),t.exports=e=function(t){return null==t?f(c):g(Object(t),l)},e.methods=o},6226:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.linear=function(t,e){var i,n,s=new Float32Array(t),a=t-1;for(i=0;i<t;i++)n=i/a,e>0?s[i]=n:s[i]=1-n;return s},e.exponential=function(t,e){var i,n,s=new Float32Array(t),a=t-1;for(i=0;i<t;i++)n=i/a,s[e>0?i:t-1-i]=Math.exp(2*n-1)/Math.exp(1);return s},e.sCurve=function(t,e){var i,n=new Float32Array(t),s=e>0?Math.PI/2:-(Math.PI/2);for(i=0;i<t;++i)n[i]=Math.sin(Math.PI*i/t-s)/2+.5;return n},e.logarithmic=function(t,e,i){var n,s,a=new Float32Array(t),r=0;for(s=0;s<t;s++)n=i>0?s:t-1-s,r=s/t,a[n]=Math.log(1+e*r)/Math.log(1+e);return a}},1114:(t,e,i)=>{e.h7=e.Y1=e.Hp=e.Jl=e.t$=e._h=void 0,e.L7=function(t,e,i,n){switch(e){case s:l.call(t,i,n);break;case a:u.call(t,i,n);break;case r:h.call(t,i,n);break;case o:f.call(t,i,n);break;default:throw Error("Unsupported Fade type")}},e.Mt=function(t,e,i,n){switch(e){case s:c.call(t,i,n);break;case a:d.call(t,i,n);break;case r:p.call(t,i,n);break;case o:m.call(t,i,n);break;default:throw Error("Unsupported Fade type")}};var n=i(6226),s=e._h="sCurve",a=e.t$="linear",r=e.Jl="exponential",o=e.Hp="logarithmic";function l(t,e){var i=(0,n.sCurve)(1e4,1);this.setValueCurveAtTime(i,t,e)}function c(t,e){var i=(0,n.sCurve)(1e4,-1);this.setValueCurveAtTime(i,t,e)}function u(t,e){this.linearRampToValueAtTime(0,t),this.linearRampToValueAtTime(1,t+e)}function d(t,e){this.linearRampToValueAtTime(1,t),this.linearRampToValueAtTime(0,t+e)}function h(t,e){this.exponentialRampToValueAtTime(.01,t),this.exponentialRampToValueAtTime(1,t+e)}function p(t,e){this.exponentialRampToValueAtTime(1,t),this.exponentialRampToValueAtTime(.01,t+e)}function f(t,e){var i=(0,n.logarithmic)(1e4,10,1);this.setValueCurveAtTime(i,t,e)}function m(t,e){var i=(0,n.logarithmic)(1e4,10,-1);this.setValueCurveAtTime(i,t,e)}e.Y1="FadeIn",e.h7="FadeOut"},9144:(t,e,i)=>{var n,s=void 0!==i.g?i.g:"undefined"!=typeof window?window:{},a=i(5893);"undefined"!=typeof document?n=document:(n=s["__GLOBAL_DOCUMENT_CACHE@4"])||(n=s["__GLOBAL_DOCUMENT_CACHE@4"]=a),t.exports=n},8070:(t,e,i)=>{var n="undefined"!=typeof window?window:void 0!==i.g?i.g:{};t.exports=function(t,e){return t in n?n[t]:(n[t]=e,e)}},4167:(t,e,i)=>{var n=i(8070);t.exports=function(t,e,i){var s="__INDIVIDUAL_ONE_VERSION_"+t,a=n(s+"_ENFORCE_SINGLETON",e);if(a!==e)throw Error("Can only have one copy of "+t+".\nYou already have version "+a+" installed.\nThis means you cannot install version "+e);return n(s,i)}},849:(t,e,i)=>{var n=!!(i.g===i.g.window&&i.g.URL&&i.g.Blob&&i.g.Worker);function s(t,e){var s,a=this;if(e=e||{},n)return s=t.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],new i.g.Worker(i.g.URL.createObjectURL(new i.g.Blob([s],{type:"text/javascript"})));this.self=e,this.self.postMessage=function(t){setTimeout(function(){a.onmessage({data:t})},0)},setTimeout(t.bind(e,e),0)}s.prototype.postMessage=function(t){var e=this;setTimeout(function(){e.self.onmessage({data:t})},0)},t.exports=s},6240:t=>{t.exports=function(t){return"object"==typeof t&&null!==t}},1730:t=>{var e,i,n,s,a,r=/^(?:0|[1-9]\d*)$/,o=Object.prototype,l=o.hasOwnProperty,c=o.toString,u=o.propertyIsEnumerable,d=(e=Object.keys,i=Object,function(t){return e(i(t))}),h=Math.max,p=!u.call({valueOf:1},"valueOf");function f(t,e,i){var n=t[e];l.call(t,e)&&v(n,i)&&(void 0!==i||e in t)||(t[e]=i)}function m(t,e){return!!(e=null==e?9007199254740991:e)&&("number"==typeof t||r.test(t))&&t>-1&&t%1==0&&t<e}function g(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||o)}function v(t,e){return t===e||t!=t&&e!=e}var y=Array.isArray;function b(t){var e,i;return null!=t&&"number"==typeof(e=t.length)&&e>-1&&e%1==0&&e<=9007199254740991&&!("[object Function]"==(i=k(t)?c.call(t):"")||"[object GeneratorFunction]"==i)}function k(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}var w=(n=function(t,e){if(p||g(e)||b(e)){!function(t,e,i,n){i||(i={});for(var s=-1,a=e.length;++s<a;){var r=e[s],o=void 0;f(i,r,void 0===o?t[r]:o)}}(e,b(e)?function(t,e){var i=y(t)||t&&"object"==typeof t&&b(t)&&l.call(t,"callee")&&(!u.call(t,"callee")||"[object Arguments]"==c.call(t))?function(t,e){for(var i=-1,n=Array(t);++i<t;)n[i]=e(i);return n}(t.length,String):[],n=i.length,s=!!n;for(var a in t)l.call(t,a)&&!(s&&("length"==a||m(a,n)))&&i.push(a);return i}(e):function(t){if(!g(t))return d(t);var e=[];for(var i in Object(t))l.call(t,i)&&"constructor"!=i&&e.push(i);return e}(e),t);return}for(var i in e)l.call(e,i)&&f(t,i,e[i])},s=function(t,e){var i=-1,s=e.length,a=s>1?e[s-1]:void 0,r=s>2?e[2]:void 0;for(a=n.length>3&&"function"==typeof a?(s--,a):void 0,r&&function(t,e,i){if(!k(i))return!1;var n=typeof e;return("number"==n?!!(b(i)&&m(e,i.length)):"string"==n&&(e in i))&&v(i[e],t)}(e[0],e[1],r)&&(a=s<3?void 0:a,s=1),t=Object(t);++i<s;){var o=e[i];o&&n(t,o,i,a)}return t},a=h(void 0===a?s.length-1:a,0),function(){for(var t=arguments,e=-1,i=h(t.length-a,0),n=Array(i);++e<i;)n[e]=t[a+e];e=-1;for(var r=Array(a+1);++e<a;)r[e]=t[e];return r[a]=n,function(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}(s,this,r)});t.exports=w},2098:(t,e,i)=>{t=i.nmd(t);var n,s,a,r,o,l,c,u="__lodash_hash_undefined__",d="[object Arguments]",h="[object Function]",p="[object Object]",f=/^\[object .+?Constructor\]$/,m=/^(?:0|[1-9]\d*)$/,g={};g["[object Float32Array]"]=g["[object Float64Array]"]=g["[object Int8Array]"]=g["[object Int16Array]"]=g["[object Int32Array]"]=g["[object Uint8Array]"]=g["[object Uint8ClampedArray]"]=g["[object Uint16Array]"]=g["[object Uint32Array]"]=!0,g[d]=g["[object Array]"]=g["[object ArrayBuffer]"]=g["[object Boolean]"]=g["[object DataView]"]=g["[object Date]"]=g["[object Error]"]=g[h]=g["[object Map]"]=g["[object Number]"]=g[p]=g["[object RegExp]"]=g["[object Set]"]=g["[object String]"]=g["[object WeakMap]"]=!1;var v="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g,y="object"==typeof self&&self&&self.Object===Object&&self,b=v||y||Function("return this")(),k=e&&!e.nodeType&&e,w=k&&t&&!t.nodeType&&t,E=w&&w.exports===k,x=E&&v.process,T=function(){try{var t=w&&w.require&&w.require("util").types;if(t)return t;return x&&x.binding&&x.binding("util")}catch(t){}}(),S=T&&T.isTypedArray;function P(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}var _=Array.prototype,C=Function.prototype,O=Object.prototype,A=b["__core-js_shared__"],I=C.toString,M=O.hasOwnProperty,R=(r=/[^.]+$/.exec(A&&A.keys&&A.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"",L=O.toString,D=I.call(Object),j=RegExp("^"+I.call(M).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),N=E?b.Buffer:void 0,B=b.Symbol,G=b.Uint8Array,F=N?N.allocUnsafe:void 0,U=(o=Object.getPrototypeOf,l=Object,function(t){return o(l(t))}),z=Object.create,V=O.propertyIsEnumerable,q=_.splice,H=B?B.toStringTag:void 0,W=function(){try{var t=tf(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),X=N?N.isBuffer:void 0,Y=Math.max,J=Date.now,Z=tf(b,"Map"),Q=tf(Object,"create"),K=function(){function t(){}return function(e){if(!tP(e))return{};if(z)return z(e);t.prototype=e;var i=new t;return t.prototype=void 0,i}}();function tt(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function te(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function ti(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function tn(t){var e=this.__data__=new te(t);this.size=e.size}function ts(t,e,i){(void 0===i||tb(t[e],i))&&(void 0!==i||e in t)||tr(t,e,i)}function ta(t,e){for(var i=t.length;i--;)if(tb(t[i][0],e))return i;return -1}function tr(t,e,i){"__proto__"==e&&W?W(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}tt.prototype.clear=function(){this.__data__=Q?Q(null):{},this.size=0},tt.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},tt.prototype.get=function(t){var e=this.__data__;if(Q){var i=e[t];return i===u?void 0:i}return M.call(e,t)?e[t]:void 0},tt.prototype.has=function(t){var e=this.__data__;return Q?void 0!==e[t]:M.call(e,t)},tt.prototype.set=function(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=Q&&void 0===e?u:e,this},te.prototype.clear=function(){this.__data__=[],this.size=0},te.prototype.delete=function(t){var e=this.__data__,i=ta(e,t);return!(i<0)&&(i==e.length-1?e.pop():q.call(e,i,1),--this.size,!0)},te.prototype.get=function(t){var e=this.__data__,i=ta(e,t);return i<0?void 0:e[i][1]},te.prototype.has=function(t){return ta(this.__data__,t)>-1},te.prototype.set=function(t,e){var i=this.__data__,n=ta(i,t);return n<0?(++this.size,i.push([t,e])):i[n][1]=e,this},ti.prototype.clear=function(){this.size=0,this.__data__={hash:new tt,map:new(Z||te),string:new tt}},ti.prototype.delete=function(t){var e=tp(this,t).delete(t);return this.size-=e?1:0,e},ti.prototype.get=function(t){return tp(this,t).get(t)},ti.prototype.has=function(t){return tp(this,t).has(t)},ti.prototype.set=function(t,e){var i=tp(this,t),n=i.size;return i.set(t,e),this.size+=i.size==n?0:1,this},tn.prototype.clear=function(){this.__data__=new te,this.size=0},tn.prototype.delete=function(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i},tn.prototype.get=function(t){return this.__data__.get(t)},tn.prototype.has=function(t){return this.__data__.has(t)},tn.prototype.set=function(t,e){var i=this.__data__;if(i instanceof te){var n=i.__data__;if(!Z||n.length<199)return n.push([t,e]),this.size=++i.size,this;i=this.__data__=new ti(n)}return i.set(t,e),this.size=i.size,this};var to=function(t,e,i){for(var n=-1,s=Object(t),a=i(t),r=a.length;r--;){var o=a[++n];if(!1===e(s[o],o,s))break}return t};function tl(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":H&&H in Object(t)?function(t){var e=M.call(t,H),i=t[H];try{t[H]=void 0;var n=!0}catch(t){}var s=L.call(t);return n&&(e?t[H]=i:delete t[H]),s}(t):L.call(t)}function tc(t){return t_(t)&&tl(t)==d}function tu(t,e,i,n,s){t!==e&&to(e,function(a,r){if(s||(s=new tn),tP(a))!function(t,e,i,n,s,a,r){var o=tv(t,i),l=tv(e,i),c=r.get(l);if(c){ts(t,i,c);return}var u=a?a(o,l,i+"",t,e,r):void 0,d=void 0===u;if(d){var h,f,m,g=tw(l),v=!g&&tx(l),y=!g&&!v&&tC(l);u=l,g||v||y?tw(o)?u=o:t_(o)&&tE(o)?u=function(t,e){var i=-1,n=t.length;for(e||(e=Array(n));++i<n;)e[i]=t[i];return e}(o):v?(d=!1,u=function(t,e){if(e)return t.slice();var i=t.length,n=F?F(i):new t.constructor(i);return t.copy(n),n}(l,!0)):y?(d=!1,new G(f=new(h=l.buffer).constructor(h.byteLength)).set(new G(h)),m=f,u=new l.constructor(m,l.byteOffset,l.length)):u=[]:function(t){if(!t_(t)||tl(t)!=p)return!1;var e=U(t);if(null===e)return!0;var i=M.call(e,"constructor")&&e.constructor;return"function"==typeof i&&i instanceof i&&I.call(i)==D}(l)||tk(l)?(u=o,tk(o)?u=function(t,e,i,n){var s=!i;i||(i={});for(var a=-1,r=e.length;++a<r;){var o=e[a],l=void 0;void 0===l&&(l=t[o]),s?tr(i,o,l):function(t,e,i){var n=t[e];M.call(t,e)&&tb(n,i)&&(void 0!==i||e in t)||tr(t,e,i)}(i,o,l)}return i}(o,tA(o)):(!tP(o)||tT(o))&&(u="function"!=typeof l.constructor||tg(l)?{}:K(U(l)))):d=!1}d&&(r.set(l,u),s(u,l,n,a,r),r.delete(l)),ts(t,i,u)}(t,e,r,i,tu,n,s);else{var o=n?n(tv(t,r),a,r+"",t,e,s):void 0;void 0===o&&(o=a),ts(t,r,o)}},tA)}function td(t,e){var i,n;return ty((i=e,n=tM,i=Y(void 0===i?t.length-1:i,0),function(){for(var e=arguments,s=-1,a=Y(e.length-i,0),r=Array(a);++s<a;)r[s]=e[i+s];s=-1;for(var o=Array(i+1);++s<i;)o[s]=e[s];return o[i]=n(r),P(t,this,o)}),t+"")}function th(t,e,i,n,s,a){return tP(t)&&tP(e)&&(a.set(e,t),tu(t,e,void 0,th,a),a.delete(e)),t}function tp(t,e){var i,n=t.__data__;return("string"==(i=typeof e)||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==e:null===e)?n["string"==typeof e?"string":"hash"]:n.map}function tf(t,e){var i=null==t?void 0:t[e];return!(!tP(i)||R&&R in i)&&(tT(i)?j:f).test(function(t){if(null!=t){try{return I.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(i))?i:void 0}function tm(t,e){var i=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==i||"symbol"!=i&&m.test(t))&&t>-1&&t%1==0&&t<e}function tg(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||O)}function tv(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var ty=(n=W?function(t,e){return W(t,"toString",{configurable:!0,enumerable:!1,value:function(){return e},writable:!0})}:tM,s=0,a=0,function(){var t=J(),e=16-(t-a);if(a=t,e>0){if(++s>=800)return arguments[0]}else s=0;return n.apply(void 0,arguments)});function tb(t,e){return t===e||t!=t&&e!=e}var tk=tc(function(){return arguments}())?tc:function(t){return t_(t)&&M.call(t,"callee")&&!V.call(t,"callee")},tw=Array.isArray;function tE(t){return null!=t&&tS(t.length)&&!tT(t)}var tx=X||function(){return!1};function tT(t){if(!tP(t))return!1;var e=tl(t);return e==h||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}function tS(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}function tP(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function t_(t){return null!=t&&"object"==typeof t}var tC=S?function(t){return S(t)}:function(t){return t_(t)&&tS(t.length)&&!!g[tl(t)]},tO=td(function(t){return t.push(void 0,th),P(tI,void 0,t)});function tA(t){return tE(t)?function(t,e){var i=tw(t),n=!i&&tk(t),s=!i&&!n&&tx(t),a=!i&&!n&&!s&&tC(t),r=i||n||s||a,o=r?function(t,e){for(var i=-1,n=Array(t);++i<t;)n[i]=e(i);return n}(t.length,String):[],l=o.length;for(var c in t)(e||M.call(t,c))&&!(r&&("length"==c||s&&("offset"==c||"parent"==c)||a&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||tm(c,l)))&&o.push(c);return o}(t,!0):function(t){if(!tP(t))return function(t){var e=[];if(null!=t)for(var i in Object(t))e.push(i);return e}(t);var e=tg(t),i=[];for(var n in t)"constructor"==n&&(e||!M.call(t,n))||i.push(n);return i}(t)}var tI=(c=function(t,e,i,n){tu(t,e,i,n)},td(function(t,e){var i=-1,n=e.length,s=n>1?e[n-1]:void 0,a=n>2?e[2]:void 0;for(s=c.length>3&&"function"==typeof s?(n--,s):void 0,a&&function(t,e,i){if(!tP(i))return!1;var n=typeof e;return("number"==n?!!(tE(i)&&tm(e,i.length)):"string"==n&&(e in i))&&tb(i[e],t)}(e[0],e[1],a)&&(s=n<3?void 0:s,n=1),t=Object(t);++i<n;){var r=e[i];r&&c(t,r,i,s)}return t}));function tM(t){return t}t.exports=tO},3520:t=>{var e,i,n=/^(?:0|[1-9]\d*)$/,s=Object.prototype,a=s.hasOwnProperty,r=s.toString,o=s.propertyIsEnumerable,l=(e=Object.keys,i=Object,function(t){return e(i(t))}),c=function(t,e,i){for(var n=-1,s=Object(t),a=i(t),r=a.length;r--;){var o=a[++n];if(!1===e(s[o],o,s))break}return t},u=Array.isArray;function d(t){var e,i,n;return null!=t&&"number"==typeof(e=t.length)&&e>-1&&e%1==0&&e<=9007199254740991&&!("[object Function]"==(i=typeof t,n=t&&("object"==i||"function"==i)?r.call(t):"")||"[object GeneratorFunction]"==n)}function h(t){return d(t)?function(t,e){var i,s=u(t)||t&&"object"==typeof t&&d(t)&&a.call(t,"callee")&&(!o.call(t,"callee")||"[object Arguments]"==r.call(t))?function(t,e){for(var i=-1,n=Array(t);++i<t;)n[i]=e(i);return n}(t.length,String):[],l=s.length,c=!!l;for(var h in t)a.call(t,h)&&!(c&&("length"==h||(i=null==(i=l)?9007199254740991:i)&&("number"==typeof h||n.test(h))&&h>-1&&h%1==0&&h<i))&&s.push(h);return s}(t):function(t){if(e=t&&t.constructor,t!==("function"==typeof e&&e.prototype||s))return l(t);var e,i=[];for(var n in Object(t))a.call(t,n)&&"constructor"!=n&&i.push(n);return i}(t)}function p(t){return t}t.exports=function(t,e){var i;return t&&(i="function"==typeof e?e:p,t&&c(t,i,h))}},372:(t,e,i)=>{var n=i(6060);t.exports=function(t){if("function"!=typeof t||!hasOwnProperty.call(t,"length"))return!1;try{if("number"!=typeof t.length||"function"!=typeof t.call||"function"!=typeof t.apply)return!1}catch(t){return!1}return!n(t)}},3940:(t,e,i)=>{var n=i(5618),s={object:!0,function:!0,undefined:!0};t.exports=function(t){return!!n(t)&&hasOwnProperty.call(s,typeof t)}},7205:(t,e,i)=>{var n=i(372),s=/^\s*class[\s{/}]/,a=Function.prototype.toString;t.exports=function(t){return!(!n(t)||s.test(a.call(t)))}},6060:(t,e,i)=>{var n=i(3940);t.exports=function(t){if(!n(t))return!1;try{if(!t.constructor)return!1;return t.constructor.prototype===t}catch(t){return!1}}},5618:t=>{var e=void 0;t.exports=function(t){return t!==e&&null!==t}},4935:(t,e,i)=>{var n=i(3513);t.exports=n},7921:(t,e,i)=>{var n=i(3072);t.exports=n},347:(t,e,i)=>{var n=i(8744);t.exports=n},9720:(t,e,i)=>{var n=i(6943);t.exports=n},6672:(t,e,i)=>{var n=i(6240),s=i(7265);function a(t,e,i,n){if(n){var a=n[e];if(s(a))a.unhook&&a.unhook(t,e,i);else if("attributes"===e)for(var r in a)t.removeAttribute(r);else if("style"===e)for(var o in a)t.style[o]="";else"string"==typeof a?t[e]="":t[e]=null}}function r(t){return Object.getPrototypeOf?Object.getPrototypeOf(t):t.__proto__?t.__proto__:t.constructor?t.constructor.prototype:void 0}t.exports=function(t,e,i){for(var o in e){var l=e[o];void 0===l?a(t,o,l,i):s(l)?(a(t,o,l,i),l.hook&&l.hook(t,o,i?i[o]:void 0)):n(l)?function(t,e,i,s,a){var o=i?i[s]:void 0;if("attributes"===s){for(var l in a){var c=a[l];void 0===c?t.removeAttribute(l):t.setAttribute(l,c)}return}if(o&&n(o)&&r(o)!==r(a)){t[s]=a;return}n(t[s])||(t[s]={});var u="style"===s?"":void 0;for(var d in a){var h=a[d];t[s][d]=void 0===h?u:h}}(t,0,i,o,l):t[o]=l}}},3513:(t,e,i)=>{var n=i(9144),s=i(6672),a=i(5170),r=i(6221),o=i(4097),l=i(6078);t.exports=function t(e,i){var c=i&&i.document||n,u=i?i.warn:null;if(o(e=l(e).a))return e.init();if(r(e))return c.createTextNode(e.text);if(!a(e))return u&&u("Item is not a valid virtual dom node",e),null;var d=null===e.namespace?c.createElement(e.tagName):c.createElementNS(e.namespace,e.tagName);s(d,e.properties);for(var h=e.children,p=0;p<h.length;p++){var f=t(h[p],i);f&&d.appendChild(f)}return d}},8992:t=>{var e={};function i(t,e,i){if(0===t.length)return!1;for(var n,s,a=0,r=t.length-1;a<=r;){if(s=t[n=(r+a)/2>>0],a===r)return s>=e&&s<=i;if(s<e)a=n+1;else{if(!(s>i))return!0;r=n-1}}return!1}function n(t,e){return t>e?1:-1}t.exports=function(t,s,a,r){return a&&0!==a.length?(a.sort(n),function t(n,s,a,r,o){if(r=r||{},n){i(a,o,o)&&(r[o]=n);var l=s.children;if(l)for(var c=n.childNodes,u=0;u<s.children.length;u++){o+=1;var d=l[u]||e,h=o+(d.count||0);i(a,o,h)&&t(c[u],d,a,r,o),o=h}}return r}(t,s,a,r,0)):{}}},9120:(t,e,i)=>{var n=i(6672),s=i(4097),a=i(8057),r=i(6670);function o(t,e){"function"==typeof e.destroy&&s(e)&&e.destroy(t)}t.exports=function(t,e,i){var s,l,c,u,d,h,p,f,m=t.type,g=t.vNode,v=t.patch;switch(m){case a.REMOVE:return(s=e.parentNode)&&s.removeChild(e),o(e,g),null;case a.INSERT:return l=i.render(v,i),e&&e.appendChild(l),e;case a.VTEXT:return function(t,e,i,n){var s;if(3===t.nodeType)t.replaceData(0,t.length,i.text),s=t;else{var a=t.parentNode;s=n.render(i,n),a&&s!==t&&a.replaceChild(s,t)}return s}(e,0,v,i);case a.WIDGET:return c=(u=r(g,v))?v.update(g,e)||e:i.render(v,i),(d=e.parentNode)&&c!==e&&d.replaceChild(c,e),u||o(e,g),c;case a.VNODE:return h=e.parentNode,p=i.render(v,i),h&&p!==e&&h.replaceChild(p,e),p;case a.ORDER:return function(t,e){for(var i,n,s,a=t.childNodes,r={},o=0;o<e.removes.length;o++)i=a[(n=e.removes[o]).from],n.key&&(r[n.key]=i),t.removeChild(i);for(var l=a.length,c=0;c<e.inserts.length;c++)i=r[(s=e.inserts[c]).key],t.insertBefore(i,s.to>=l++?null:a[s.to])}(e,v),e;case a.PROPS:return n(e,v,g.properties),e;case a.THUNK:return f=i.patch(e,v,i),e&&f&&e!==f&&e.parentNode&&e.parentNode.replaceChild(f,e),f;default:return e}}},6943:(t,e,i)=>{var n=i(9144),s=i(7362),a=i(3513),r=i(8992),o=i(9120);function l(t,e,i){var a=function(t){var e=[];for(var i in t)"a"!==i&&e.push(Number(i));return e}(e);if(0===a.length)return t;var l=r(t,e.a,a),c=t.ownerDocument;i.document||c===n||(i.document=c);for(var u=0;u<a.length;u++){var d=a[u];t=function(t,e,i,n){if(!e)return t;if(s(i))for(var a,r=0;r<i.length;r++)a=o(i[r],e,n),e===t&&(t=a);else a=o(i,e,n),e===t&&(t=a);return t}(t,l[d],e[d],i)}return t}t.exports=function t(e,i,n){return(n=n||{}).patch=n.patch&&n.patch!==t?n.patch:l,n.render=n.render||a,n.patch(e,i,n)}},6670:(t,e,i)=>{var n=i(4097);t.exports=function(t,e){return!!(n(t)&&n(e))&&("name"in t&&"name"in e?t.id===e.id:t.init===e.init)}},6505:(t,e,i)=>{var n=i(8832);function s(t){if(!(this instanceof s))return new s(t);this.value=t}t.exports=s,s.prototype.hook=function(t,e){n(t)[e.substr(3)]=this.value},s.prototype.unhook=function(t,e){n(t)[e.substr(3)]=void 0}},7199:t=>{function e(t){if(!(this instanceof e))return new e(t);this.value=t}t.exports=e,e.prototype.hook=function(t,e){t[e]!==this.value&&(t[e]=this.value)}},8744:(t,e,i)=>{var n=i(7362),s=i(4282),a=i(4268),r=i(5170),o=i(6221),l=i(4097),c=i(7265),u=i(6741),d=i(1948),h=i(7199),p=i(6505);function f(t){return r(t)||o(t)||l(t)||u(t)}function m(t){try{return JSON.stringify(t,null,"    ")}catch(e){return String(t)}}t.exports=function(t,e,i){var r,o,l,u,g=[];return!i&&("string"==typeof e||n(e)||f(e))&&(i=e,o={}),r=d(t,o=o||e||{}),o.hasOwnProperty("key")&&(l=o.key,o.key=void 0),o.hasOwnProperty("namespace")&&(u=o.namespace,o.namespace=void 0),"INPUT"===r&&!u&&o.hasOwnProperty("value")&&void 0!==o.value&&!c(o.value)&&(o.value=h(o.value)),function(t){for(var e in t)if(t.hasOwnProperty(e)){var i=t[e];if(c(i))continue;"ev-"===e.substr(0,3)&&(t[e]=p(i))}}(o),null!=i&&function t(e,i,s,r){if("string"==typeof e)i.push(new a(e));else if("number"==typeof e)i.push(new a(String(e)));else if(f(e))i.push(e);else if(n(e))for(var o,l,c=0;c<e.length;c++)t(e[c],i,s,r);else{if(null==e)return;throw o={foreignObject:e,parentVnode:{tagName:s,properties:r}},(l=Error()).type="virtual-hyperscript.unexpected.virtual-element",l.message="Unexpected virtual child passed to h().\nExpected a VNode / Vthunk / VWidget / string but:\ngot:\n"+m(o.foreignObject)+".\nThe parent vnode is:\n"+m(o.parentVnode),l.foreignObject=o.foreignObject,l.parentVnode=o.parentVnode,l}}(i,g,r,o),new s(r,o,g,l,u)}},1948:(t,e,i)=>{var n=i(6824),s=/([\.#]?[a-zA-Z0-9\u007F-\uFFFF_:-]+)/,a=/^\.|#/;t.exports=function(t,e){if(!t)return"DIV";var i,r,o,l,c=!e.hasOwnProperty("id"),u=n(t,s),d=null;for(a.test(u[1])&&(d="DIV"),l=0;l<u.length;l++)(r=u[l])&&(o=r.charAt(0),d?"."===o?(i=i||[]).push(r.substring(1,r.length)):"#"===o&&c&&(e.id=r.substring(1,r.length)):d=r);return i&&(e.className&&i.push(e.className),e.className=i.join(" ")),e.namespace?d:d.toUpperCase()}},6078:(t,e,i)=>{var n=i(5170),s=i(6221),a=i(4097),r=i(6741);function o(t,e){var i=t.vnode;if(i||(i=t.vnode=t.render(e)),!(n(i)||s(i)||a(i)))throw Error("thunk did not return a valid node");return i}t.exports=function(t,e){var i=t,n=e;return r(e)&&(n=o(e,t)),r(t)&&(i=o(t,null)),{a:i,b:n}}},6741:t=>{t.exports=function(t){return t&&"Thunk"===t.type}},7265:t=>{t.exports=function(t){return t&&("function"==typeof t.hook&&!t.hasOwnProperty("hook")||"function"==typeof t.unhook&&!t.hasOwnProperty("unhook"))}},5170:(t,e,i)=>{var n=i(9962);t.exports=function(t){return t&&"VirtualNode"===t.type&&t.version===n}},6221:(t,e,i)=>{var n=i(9962);t.exports=function(t){return t&&"VirtualText"===t.type&&t.version===n}},4097:t=>{t.exports=function(t){return t&&"Widget"===t.type}},9962:t=>{t.exports="2"},4282:(t,e,i)=>{var n=i(9962),s=i(5170),a=i(4097),r=i(6741),o=i(7265);t.exports=u;var l={},c=[];function u(t,e,i,n,u){this.tagName=t,this.properties=e||l,this.children=i||c,this.key=null!=n?String(n):void 0,this.namespace="string"==typeof u?u:null;var d,h=i&&i.length||0,p=0,f=!1,m=!1,g=!1;for(var v in e)if(e.hasOwnProperty(v)){var y=e[v];o(y)&&y.unhook&&(d||(d={}),d[v]=y)}for(var b=0;b<h;b++){var k=i[b];s(k)?(p+=k.count||0,!f&&k.hasWidgets&&(f=!0),!m&&k.hasThunks&&(m=!0),!g&&(k.hooks||k.descendantHooks)&&(g=!0)):!f&&a(k)?"function"==typeof k.destroy&&(f=!0):!m&&r(k)&&(m=!0)}this.count=h+p,this.hasWidgets=f,this.hasThunks=m,this.hooks=d,this.descendantHooks=g}u.prototype.version=n,u.prototype.type="VirtualNode"},8057:(t,e,i)=>{var n=i(9962);function s(t,e,i){this.type=Number(t),this.vNode=e,this.patch=i}s.NONE=0,s.VTEXT=1,s.VNODE=2,s.WIDGET=3,s.PROPS=4,s.ORDER=5,s.INSERT=6,s.REMOVE=7,s.THUNK=8,t.exports=s,s.prototype.version=n,s.prototype.type="VirtualPatch"},4268:(t,e,i)=>{var n=i(9962);function s(t){this.text=String(t)}t.exports=s,s.prototype.version=n,s.prototype.type="VirtualText"},9973:(t,e,i)=>{var n=i(6240),s=i(7265);function a(t){return Object.getPrototypeOf?Object.getPrototypeOf(t):t.__proto__?t.__proto__:t.constructor?t.constructor.prototype:void 0}t.exports=function t(e,i){var r;for(var o in e){o in i||((r=r||{})[o]=void 0);var l=e[o],c=i[o];if(l!==c){if(n(l)&&n(c)){if(a(c)!==a(l))(r=r||{})[o]=c;else if(s(c))(r=r||{})[o]=c;else{var u=t(l,c);u&&((r=r||{})[o]=u)}}else(r=r||{})[o]=c}}for(var d in i)d in e||((r=r||{})[d]=i[d]);return r}},3072:(t,e,i)=>{var n=i(7362),s=i(8057),a=i(5170),r=i(6221),o=i(4097),l=i(6741),c=i(6078),u=i(9973);function d(t,e){var i={a:t};return function t(e,i,n,c){if(e!==i){var d=n[c],v=!1;if(l(e)||l(i))p(e,i,n,c);else if(null==i)o(e)||(h(e,n,c),d=n[c]),d=g(d,new s(s.REMOVE,e,i));else if(a(i)){if(a(e)){if(e.tagName===i.tagName&&e.namespace===i.namespace&&e.key===i.key){var y=u(e.properties,i.properties);y&&(d=g(d,new s(s.PROPS,e,y))),d=function(e,i,n,r,o){for(var l=e.children,c=function(t,e){var i,n=m(e),s=n.keys,a=n.free;if(a.length===e.length)return{children:e,moves:null};var r=m(t),o=r.keys;if(r.free.length===t.length)return{children:e,moves:null};for(var l=[],c=0,u=a.length,d=0,h=0;h<t.length;h++){var p,g=t[h];g.key?s.hasOwnProperty(g.key)?(p=s[g.key],l.push(e[p])):(p=h-d++,l.push(null)):c<u?(p=a[c++],l.push(e[p])):(p=h-d++,l.push(null))}for(var v=c>=a.length?e.length:a[c],y=0;y<e.length;y++){var b=e[y];b.key?o.hasOwnProperty(b.key)||l.push(b):y>=v&&l.push(b)}for(var k=l.slice(),w=0,E=[],x=[],T=0;T<e.length;){var S=e[T];for(i=k[w];null===i&&k.length;)E.push(f(k,w,null)),i=k[w];i&&i.key===S.key?(w++,T++):S.key?(i&&i.key&&s[i.key]!==T+1?(E.push(f(k,w,i.key)),(i=k[w])&&i.key===S.key?w++:x.push({key:S.key,to:T})):x.push({key:S.key,to:T}),T++):i&&i.key&&E.push(f(k,w,i.key))}for(;w<k.length;)i=k[w],E.push(f(k,w,i&&i.key));return E.length!==d||x.length?{children:l,moves:{removes:E,inserts:x}}:{children:l,moves:null}}(l,i.children),u=c.children,d=l.length,h=u.length,p=d>h?d:h,v=0;v<p;v++){var y=l[v],b=u[v];o+=1,y?t(y,b,n,o):b&&(r=g(r,new s(s.INSERT,null,b))),a(y)&&y.count&&(o+=y.count)}return c.moves&&(r=g(r,new s(s.ORDER,e,c.moves))),r}(e,i,n,d,c)}else d=g(d,new s(s.VNODE,e,i)),v=!0}else d=g(d,new s(s.VNODE,e,i)),v=!0}else r(i)?r(e)?e.text!==i.text&&(d=g(d,new s(s.VTEXT,e,i))):(d=g(d,new s(s.VTEXT,e,i)),v=!0):o(i)&&(o(e)||(v=!0),d=g(d,new s(s.WIDGET,e,i)));d&&(n[c]=d),v&&h(e,n,c)}}(t,e,i,0),i}function h(t,e,i){(function t(e,i,n){if(a(e)){if(e.hooks&&(i[n]=g(i[n],new s(s.PROPS,e,function(t){var e={};for(var i in t)e[i]=void 0;return e}(e.hooks)))),e.descendantHooks||e.hasThunks)for(var r=e.children,o=r.length,c=0;c<o;c++){var u=r[c];t(u,i,n+=1),a(u)&&u.count&&(n+=u.count)}}else l(e)&&p(e,null,i,n)})(t,e,i),function t(e,i,n){if(o(e))"function"==typeof e.destroy&&(i[n]=g(i[n],new s(s.REMOVE,e,null)));else if(a(e)&&(e.hasWidgets||e.hasThunks))for(var r=e.children,c=r.length,u=0;u<c;u++){var d=r[u];t(d,i,n+=1),a(d)&&d.count&&(n+=d.count)}else l(e)&&p(e,null,i,n)}(t,e,i)}function p(t,e,i,n){var a=c(t,e),r=d(a.a,a.b);(function(t){for(var e in t)if("a"!==e)return!0;return!1})(r)&&(i[n]=new s(s.THUNK,null,r))}function f(t,e,i){return t.splice(e,1),{from:e,key:i}}function m(t){for(var e={},i=[],n=t.length,s=0;s<n;s++){var a=t[s];a.key?e[a.key]=s:i.push(s)}return{keys:e,free:i}}function g(t,e){return t?(n(t)?t.push(e):t=[t,e],t):e}t.exports=d},4991:t=>{function e(t,e){var i=Math.pow(2,e-1);return Math.max(-i,Math.min(i-1,t<0?t*i:t*(i-1)))}function i(t,i,s){var a,r,o,l,c,u,d=t.length,h=Math.ceil(d/i),p=n(s,2*h);for(a=0;a<h;a++)r=a*i,o=(a+1)*i>d?d:(a+1)*i,c=e((u=function(t){for(var e,i=1/0,n=-1/0,s=0,a=t.length;s<a;s++)i>(e=t[s])&&(i=e),n<e&&(n=e);return{min:i,max:n}}(t.subarray(r,o))).min,s),l=e(u.max,s),p[2*a]=c,p[2*a+1]=l;return p}function n(t,e){return new(Function(`return Int${t}Array`)())(e)}function s(t,e){return"number"==typeof t?t:e}t.exports=function(t,e,a,r,o,l){if(e=s(e,1e3),l=s(l,16),null==a&&(a=!0),0>[8,16,32].indexOf(l))throw Error("Invalid number of bits specified for peaks.");var c,u,d=t.numberOfChannels,h=[];if(r=s(r,0),o=s(o,t.length),void 0===t.subarray)for(c=0;c<d;c++)u=t.getChannelData(c).subarray(r,o),h.push(i(u,e,l));else h.push(i(t.subarray(r,o),e,l));return a&&h.length>1&&(h=function(t,e){var i,s,a=t.length,r=1/a,o=t[0].length/2,l=0,c=0,u=n(e,2*o);for(c=0;c<o;c++){for(l=0,i=0,s=0;l<a;l++)i+=r*t[l][2*c],s+=r*t[l][2*c+1];u[2*c]=i,u[2*c+1]=s}return[u]}(h,l)),{length:h[0].length/2,data:h,bits:l}}},7362:t=>{var e=Array.isArray,i=Object.prototype.toString;t.exports=e||function(t){return"[object Array]"===i.call(t)}},5893:()=>{}},e={};function i(n){var s=e[n];if(void 0!==s)return s.exports;var a=e[n]={id:n,loaded:!1,exports:{}};return t[n](a,a.exports,i),a.loaded=!0,a.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.nmd=t=>(t.paths=[],t.children||(t.children=[]),t);var n={};return(()=>{i.r(n),i.d(n,{default:()=>ta,init:()=>ts});var t,e=i(2098),s=i.n(e),a=i(4935),r=i.n(a),o=i(8370),l=i.n(o),c=i(347),u=i.n(c),d=i(7921),h=i.n(d),p=i(9720),f=i.n(p),m=i(849),g=i.n(m);function v(t,e){return Math.ceil(t*e)}function y(t,e,i){return Math.ceil(t*i/e)}let b=class{constructor(t,e,i=l()()){this.src=t,this.ac=e,this.audioRequestState=0,this.ee=i}setStateChange(t){this.audioRequestState=t,this.ee.emit("audiorequeststatechange",this.audioRequestState,this.src)}fileProgress(t){let e=0;0===this.audioRequestState&&this.setStateChange(1),t.lengthComputable&&(e=t.loaded/t.total*100),this.ee.emit("loadprogress",e,this.src)}fileLoad(t){let e=t.target.response||t.target.result;return this.setStateChange(2),new Promise((t,i)=>{this.ac.decodeAudioData(e,e=>{this.audioBuffer=e,this.setStateChange(3),t(e)},t=>{null===t?i(Error("MediaDecodeAudioDataUnknownContentType")):i(t)})})}fetchLoad(t){return this.setStateChange(2),new Promise((e,i)=>{this.ac.decodeAudioData(t,t=>{this.audioBuffer=t,this.setStateChange(3),e(t)},t=>{null===t?i(Error("MediaDecodeAudioDataUnknownContentType")):i(t)})})}},k=class extends b{load(){return new Promise((t,e)=>{if(this.src.type.match(/audio.*/)||this.src.type.match(/video\/ogg/)){let i=new FileReader;i.readAsArrayBuffer(this.src),i.addEventListener("progress",t=>{super.fileProgress(t)}),i.addEventListener("load",i=>{super.fileLoad(i).then(e=>{t(e)}).catch(e)}),i.addEventListener("error",e)}else e(Error(`Unsupported file type ${this.src.type}`))})}};class w extends b{load(){return Promise.resolve(this.src)}}let E=class extends b{load(){return new Promise((t,e)=>{fetch(this.src).then(t=>t.arrayBuffer()).then(t=>super.fetchLoad(t)).then(e=>t(e)).catch(t=>{e(Error(`Track ${this.src} failed to load with error: ${t}`))})})}},x=class{static createLoader(t,e,i){if(t instanceof Blob)return new k(t,e,i);if(t instanceof AudioBuffer)return new w(t,e,i);if("string"==typeof t)return new E(t,e,i);throw Error("Unsupported src type")}},T=class{constructor(t){this.playlist=t}hook(t){let e=this.playlist;if(!e.isScrolling){if(e.isAutomaticScroll){let i=t.getBoundingClientRect(),n=e.controls.show?e.controls.width:0,s=(i.width-n)*e.samplesPerPixel/e.sampleRate,a=e.isPlaying()?e.playbackSeconds:e.getTimeSelection().start;(a<e.scrollLeft||a>=e.scrollLeft+s)&&(e.scrollLeft=Math.min(a,e.duration-s))}let i=y(e.scrollLeft,e.samplesPerPixel,e.sampleRate);t.scrollLeft=i}}},S=class{constructor(t,e,i,n,s){this.tickInfo=t,this.offset=e,this.samplesPerPixel=i,this.duration=n,this.colors=s}hook(t,e,i){if(void 0!==i&&i.offset===this.offset&&i.duration===this.duration&&i.samplesPerPixel===this.samplesPerPixel)return;let n=t.width,s=t.height,a=t.getContext("2d");a.clearRect(0,0,n,s),a.fillStyle=this.colors.timeColor,Object.keys(this.tickInfo).forEach(t=>{let e=this.tickInfo[t];a.fillRect(t,s-e,1,e)})}};class P{constructor(t,e,i,n,s=0,a){this.duration=t,this.offset=e,this.samplesPerPixel=i,this.sampleRate=n,this.marginLeft=s,this.colors=a,this.timeinfo={2e4:{marker:3e4,bigStep:1e4,smallStep:5e3,secondStep:5},12e3:{marker:15e3,bigStep:5e3,smallStep:1e3,secondStep:1},1e4:{marker:1e4,bigStep:5e3,smallStep:1e3,secondStep:1},5e3:{marker:5e3,bigStep:1e3,smallStep:500,secondStep:.5},2500:{marker:2e3,bigStep:1e3,smallStep:500,secondStep:.5},1500:{marker:2e3,bigStep:1e3,smallStep:200,secondStep:.2},700:{marker:1e3,bigStep:500,smallStep:100,secondStep:.1}}}getScaleInfo(t){let e=Object.keys(this.timeinfo).map(t=>parseInt(t,10));e=e.sort((t,e)=>t-e);for(let i=0;i<e.length;i+=1)if(t<=e[i])return this.timeinfo[e[i]];return this.timeinfo[e[0]]}static formatTime(t){let e=t/1e3,i=e%60,n=(e-i)/60;return i<10&&(i=`0${i}`),`${n}:${i}`}render(){let t=y(this.duration,this.samplesPerPixel,this.sampleRate),e=this.sampleRate/this.samplesPerPixel,i=y(this.offset,this.samplesPerPixel,this.sampleRate),n=this.getScaleInfo(this.samplesPerPixel),s={},a=[],r=t+i,o=0;for(let t=0;t<r;t+=e*n.secondStep){let e=Math.floor(t),r=e-i;e>=i&&(n.marker&&o%n.marker==0?(a.push(u()("div.time",{attributes:{style:`position: absolute; left: ${r}px;`}},[P.formatTime(o)])),s[r]=10):n.bigStep&&o%n.bigStep==0?s[r]=5:n.smallStep&&o%n.smallStep==0&&(s[r]=2)),o+=1e3*n.secondStep}return u()("div.playlist-time-scale",{attributes:{style:`position: relative; left: 0; right: 0; margin-left: ${this.marginLeft}px;`}},[a,u()("canvas",{attributes:{width:t,height:30,style:"position: absolute; left: 0; right: 0; top: 0; bottom: 0;"},hook:new S(s,this.offset,this.samplesPerPixel,this.duration,this.colors)})])}}var _=i(1730),C=i.n(_),O=i(3520),A=i.n(O),I=new Uint8Array(16);let M=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var R=[],L=0;L<256;++L)R.push((L+256).toString(16).substr(1));let D=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(R[t[e+0]]+R[t[e+1]]+R[t[e+2]]+R[t[e+3]]+"-"+R[t[e+4]]+R[t[e+5]]+"-"+R[t[e+6]]+R[t[e+7]]+"-"+R[t[e+8]]+R[t[e+9]]+"-"+R[t[e+10]]+R[t[e+11]]+R[t[e+12]]+R[t[e+13]]+R[t[e+14]]+R[t[e+15]]).toLowerCase();if(!("string"==typeof i&&M.test(i)))throw TypeError("Stringified UUID is invalid");return i},j=function(e,i,n){var s=(e=e||{}).random||(e.rng||function(){if(!t&&!(t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(I)})();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,i){n=n||0;for(var a=0;a<16;++a)i[n+a]=s[a];return i}return D(s)};var N=i(4991),B=i.n(N),G=i(1114);let F=class{constructor(t){this.track=t}setup(t,e){this.samplesPerPixel=t,this.sampleRate=e}click(t){t.preventDefault();let e=t.offsetX*this.samplesPerPixel/this.sampleRate;this.track.ee.emit("select",e,e,this.track)}static getClass(){return".state-cursor"}static getEvents(){return["click"]}},U=class{constructor(t){this.track=t,this.active=!1}setup(t,e){this.samplesPerPixel=t,this.sampleRate=e}emitSelection(t){let e=Math.min(t,this.startX),i=Math.max(t,this.startX),n=e*this.samplesPerPixel/this.sampleRate,s=i*this.samplesPerPixel/this.sampleRate;this.track.ee.emit("select",n,s,this.track)}complete(t){this.emitSelection(t),this.active=!1}mousedown(t){t.preventDefault(),this.active=!0,this.startX=t.offsetX;let e=this.startX*this.samplesPerPixel/this.sampleRate;this.track.ee.emit("select",e,e,this.track)}mousemove(t){this.active&&(t.preventDefault(),this.emitSelection(t.offsetX))}mouseup(t){this.active&&(t.preventDefault(),this.complete(t.offsetX))}mouseleave(t){this.active&&(t.preventDefault(),this.complete(t.offsetX))}static getClass(){return".state-select"}static getEvents(){return["mousedown","mousemove","mouseup","mouseleave"]}},z={cursor:F,select:U,shift:class{constructor(t){this.track=t,this.active=!1}setup(t,e){this.samplesPerPixel=t,this.sampleRate=e}emitShift(t){let e=(t-this.prevX)*this.samplesPerPixel/this.sampleRate;this.prevX=t,this.track.ee.emit("shift",e,this.track)}complete(t){this.emitShift(t),this.active=!1}mousedown(t){t.preventDefault(),this.active=!0,this.el=t.target,this.prevX=t.offsetX}mousemove(t){this.active&&(t.preventDefault(),this.emitShift(t.offsetX))}mouseup(t){this.active&&(t.preventDefault(),this.complete(t.offsetX))}mouseleave(t){this.active&&(t.preventDefault(),this.complete(t.offsetX))}static getClass(){return".state-shift"}static getEvents(){return["mousedown","mousemove","mouseup","mouseleave"]}},fadein:class{constructor(t){this.track=t}setup(t,e){this.samplesPerPixel=t,this.sampleRate=e}click(t){let e=t.offsetX*this.samplesPerPixel/this.sampleRate;e>this.track.getStartTime()&&e<this.track.getEndTime()&&this.track.ee.emit("fadein",e-this.track.getStartTime(),this.track)}static getClass(){return".state-fadein"}static getEvents(){return["click"]}},fadeout:class{constructor(t){this.track=t}setup(t,e){this.samplesPerPixel=t,this.sampleRate=e}click(t){let e=t.offsetX*this.samplesPerPixel/this.sampleRate;e>this.track.getStartTime()&&e<this.track.getEndTime()&&this.track.ee.emit("fadeout",this.track.getEndTime()-e,this.track)}static getClass(){return".state-fadeout"}static getEvents(){return["click"]}}};class V{constructor(t,e,i,n,s,a,r,o){this.peaks=t,this.offset=e,this.color=n,this.bits=i,this.scale=s,this.height=a,this.barWidth=r,this.barGap=o}static drawFrame(t,e,i,n,s,a,r){let o=Math.abs(n*e),l=Math.abs(s*e);t.fillRect(i,0,a,e-l),t.fillRect(i,e+o,a,e-o),0!==r&&t.fillRect(i+a,0,r,2*e)}hook(t,e,i){if(void 0!==i&&i.peaks===this.peaks&&i.scale===this.scale&&i.height===this.height)return;let n=this.scale,s=t.width/n,a=t.getContext("2d"),r=t.height/n/2,o=2**(this.bits-1),l=this.barWidth,c=this.barGap,u=l+c;a.clearRect(0,0,t.width,t.height),a.save(),a.fillStyle=this.color,a.scale(n,n);for(let t=0;t<s;t+=u){let e=this.peaks[(t+this.offset)*2]/o,i=this.peaks[(t+this.offset)*2+1]/o;V.drawFrame(a,r,t,e,i,l,c)}a.restore()}}var q=i(6226);class H{constructor(t,e,i,n){this.type=t,this.shape=e,this.duration=i,this.samplesPerPixel=n}static createCurve(t,e,i){let n,s;switch(e){case G.Y1:n=1;break;case G.h7:n=-1;break;default:throw Error("Unsupported fade type.")}switch(t){case G._h:s=(0,q.sCurve)(i,n);break;case G.t$:s=(0,q.linear)(i,n);break;case G.Jl:s=(0,q.exponential)(i,n);break;case G.Hp:s=(0,q.logarithmic)(i,10,n);break;default:throw Error("Unsupported fade shape")}return s}hook(t,e,i){if(void 0!==i&&i.shape===this.shape&&i.type===this.type&&i.duration===this.duration&&i.samplesPerPixel===this.samplesPerPixel)return;let n=t.getContext("2d"),s=t.width,a=t.height,r=H.createCurve(this.shape,this.type,s),o=r.length,l=a-r[0]*a;n.clearRect(0,0,t.width,t.height),n.save(),n.strokeStyle="black",n.beginPath(),n.moveTo(0,l);for(let t=1;t<o;t+=1)l=a-r[t]*a,n.lineTo(t,l);n.stroke(),n.restore()}}let W=class{constructor(t){this.gain=t}hook(t){t.value=100*this.gain,t.title=`${Math.round(100*this.gain)}% volume`}},X=class{constructor(t){this.stereoPan=t}hook(t){let e;t.value=100*this.stereoPan,e=0===this.stereoPan?"Center":this.stereoPan<0?"Left":"Right";let i=`${Math.abs(Math.round(100*this.stereoPan))}% `;t.title=`Pan: ${0!==this.stereoPan?i:""}${e}`}},Y=class{constructor(){this.name="Untitled",this.customClass=void 0,this.waveOutlineColor=void 0,this.gain=1,this.muted=!1,this.soloed=!1,this.fades={},this.peakData={type:"WebAudio",mono:!1},this.cueIn=0,this.cueOut=0,this.duration=0,this.startTime=0,this.endTime=0,this.stereoPan=0}setEventEmitter(t){this.ee=t}setName(t){this.name=t}setCustomClass(t){this.customClass=t}setWaveOutlineColor(t){this.waveOutlineColor=t}setCues(t,e){if(e<t)throw Error("cue out cannot be less than cue in");this.cueIn=t,this.cueOut=e,this.duration=this.cueOut-this.cueIn,this.endTime=this.startTime+this.duration}trim(t,e){let i=this.getStartTime(),n=this.getEndTime(),s=this.cueIn-i;if(i<=t&&n>=t||i<=e&&n>=e){let a=t<i?i:t;this.setCues(a+s,(e>n?n:e)+s),t>i&&this.setStartTime(t)}}setStartTime(t){this.startTime=t,this.endTime=t+this.duration}setPlayout(t){this.playout=t}setOfflinePlayout(t){this.offlinePlayout=t}setEnabledStates(t={}){this.enabledStates=C()({},{cursor:!0,fadein:!0,fadeout:!0,select:!0,shift:!0},t)}setFadeIn(t,e="logarithmic"){if(t>this.duration)throw Error("Invalid Fade In");this.fadeIn&&(this.removeFade(this.fadeIn),this.fadeIn=void 0),this.fadeIn=this.saveFade(G.Y1,e,0,t)}setFadeOut(t,e="logarithmic"){if(t>this.duration)throw Error("Invalid Fade Out");let i={shape:e,start:this.duration-t,end:this.duration};this.fadeOut&&(this.removeFade(this.fadeOut),this.fadeOut=void 0),this.fadeOut=this.saveFade(G.h7,i.shape,i.start,i.end)}saveFade(t,e,i,n){let s=j();return this.fades[s]={type:t,shape:e,start:i,end:n},s}removeFade(t){delete this.fades[t]}setBuffer(t){this.buffer=t}setPeakData(t){this.peakData=t}calculatePeaks(t,e){let i=v(this.cueIn,e),n=v(this.cueOut,e);this.setPeaks(B()(this.buffer,t,this.peakData.mono,i,n))}setPeaks(t){this.peaks=t}setState(t){if(this.state=t,this.state&&this.enabledStates[this.state]){let t=z[this.state];this.stateObj=new t(this)}else this.stateObj=void 0}getStartTime(){return this.startTime}getEndTime(){return this.endTime}getDuration(){return this.duration}isPlaying(){return this.playout.isPlaying()}setShouldPlay(t){this.playout.setShouldPlay(t)}setGainLevel(t){this.gain=t,this.playout.setVolumeGainLevel(t)}setMasterGainLevel(t){this.playout.setMasterGainLevel(t)}setStereoPanValue(t){this.stereoPan=t,this.playout.setStereoPanValue(t)}setEffects(t){this.effectsGraph=t,this.playout.setEffects(t)}schedulePlay(t,e,i,n){let s,a;let r=t,o=i?i-e:void 0,l=C()({},{shouldPlay:!0,masterGain:1,isOffline:!1},n),c=l.isOffline?this.offlinePlayout:this.playout;if(this.endTime<=e||o&&e+o<this.startTime)return Promise.resolve();this.startTime>=e?(s=0,r+=this.startTime-e,i?(o-=this.startTime-e,a=Math.min(o,this.duration)):a=this.duration):(s=e-this.startTime,a=i?Math.min(o,this.duration-s):this.duration-s),s+=this.cueIn;let u=e-this.startTime,d=c.setUpSource();return A()(this.fades,e=>{let i,n;if(u<e.end)switch(u<=e.start?(i=t+(e.start-u),n=e.end-e.start):u>e.start&&u<e.end&&(i=t-(u-e.start),n=e.end-e.start),e.type){case G.Y1:c.applyFadeIn(i,n,e.shape);break;case G.h7:c.applyFadeOut(i,n,e.shape);break;default:throw Error("Invalid fade type saved on track.")}}),c.setVolumeGainLevel(this.gain),c.setShouldPlay(l.shouldPlay),c.setMasterGainLevel(l.masterGain),c.setStereoPanValue(this.stereoPan),c.play(r,s,a),d}scheduleStop(t=0){this.playout.stop(t)}renderOverlay(t){let e=y(t.playlistLength,t.resolution,t.sampleRate),i={attributes:{style:`position: absolute; top: 0; right: 0; bottom: 0; left: 0; width: ${e}px; z-index: 9;`}},n="";if(this.stateObj){this.stateObj.setup(t.resolution,t.sampleRate);let e=z[this.state];e.getEvents().forEach(t=>{i[`on${t}`]=this.stateObj[t].bind(this.stateObj)}),n=e.getClass()}return u()(`div.playlist-overlay${n}`,i)}renderControls(t){let e=t.muted?".active":"",i=t.soloed?".active":"",n=t.collapsed,s=this.peaks.data.length,a=t.controls.widgets,r=u()("button.btn.btn-danger.btn-xs.track-remove",{attributes:{type:"button",title:"Remove track"},onclick:()=>{this.ee.emit("removeTrack",this)}},[u()("i.fas.fa-times")]),o=u()("span",[this.name]),l=u()("button.btn.btn-info.btn-xs.track-collapse",{attributes:{type:"button",title:n?"Expand track":"Collapse track"},onclick:()=>{this.ee.emit("changeTrackView",this,{collapsed:!n})}},[u()(`i.fas.${n?"fa-caret-down":"fa-caret-up"}`)]),c=[];a.remove&&c.push(r),c.push(o),a.collapse&&c.push(l);let d=[u()("div.track-header",c)];return!n&&(a.muteOrSolo&&d.push(u()("div.btn-group",[u()(`button.btn.btn-outline-dark.btn-xs.btn-mute${e}`,{attributes:{type:"button"},onclick:()=>{this.ee.emit("mute",this)}},["Mute"]),u()(`button.btn.btn-outline-dark.btn-xs.btn-solo${i}`,{onclick:()=>{this.ee.emit("solo",this)}},["Solo"])])),a.volume&&d.push(u()("label.volume",[u()("input.volume-slider",{attributes:{"aria-label":"Track volume control",type:"range",min:0,max:100,value:100},hook:new W(this.gain),oninput:t=>{this.ee.emit("volumechange",t.target.value,this)}})])),a.stereoPan&&d.push(u()("label.stereopan",[u()("input.stereopan-slider",{attributes:{"aria-label":"Track stereo pan control",type:"range",min:-100,max:100,value:100},hook:new X(this.stereoPan),oninput:t=>{this.ee.emit("stereopan",t.target.value/100,this)}})]))),u()("div.controls",{attributes:{style:`height: ${s*t.height}px; width: ${t.controls.width}px; position: absolute; left: 0; z-index: 10;`}},d)}render(t){let e=this.peaks.length,i=y(t.playbackSeconds,t.resolution,t.sampleRate),n=y(this.startTime,t.resolution,t.sampleRate),s=y(this.endTime,t.resolution,t.sampleRate),a=0,r=this.peaks.data.length,o=Math.ceil(window.devicePixelRatio);i>0&&i>n&&(a=i<s?i-n:e);let l=[u()("div.cursor",{attributes:{style:`position: absolute; width: 1px; margin: 0; padding: 0; top: 0; left: ${i}px; bottom: 0; z-index: 5;`}})],c=Object.keys(this.peaks.data).map(i=>{let s=[u()("div.channel-progress",{attributes:{style:`position: absolute; width: ${a}px; height: ${t.height}px; z-index: 2;`}})],r=0,l=e,c=this.peaks.data[i];for(;l>0;){let e=Math.min(l,1e3),i=this.waveOutlineColor?this.waveOutlineColor:t.colors.waveOutlineColor;s.push(u()("canvas",{attributes:{width:e*o,height:t.height*o,style:`float: left; position: relative; margin: 0; padding: 0; z-index: 3; width: ${e}px; height: ${t.height}px;`},hook:new V(c,r,this.peaks.bits,i,o,t.height,t.barWidth,t.barGap)})),l-=e,r+=1e3}if(this.fadeIn){let e=this.fades[this.fadeIn],i=y(e.end-e.start,t.resolution,t.sampleRate);s.push(u()("div.wp-fade.wp-fadein",{attributes:{style:`position: absolute; height: ${t.height}px; width: ${i}px; top: 0; left: 0; z-index: 4;`}},[u()("canvas",{attributes:{width:i,height:t.height},hook:new H(e.type,e.shape,e.end-e.start,t.resolution)})]))}if(this.fadeOut){let e=this.fades[this.fadeOut],i=y(e.end-e.start,t.resolution,t.sampleRate);s.push(u()("div.wp-fade.wp-fadeout",{attributes:{style:`position: absolute; height: ${t.height}px; width: ${i}px; top: 0; right: 0; z-index: 4;`}},[u()("canvas",{attributes:{width:i,height:t.height},hook:new H(e.type,e.shape,e.end-e.start,t.resolution)})]))}return u()(`div.channel.channel-${i}`,{attributes:{style:`height: ${t.height}px; width: ${e}px; top: ${i*t.height}px; left: ${n}px; position: absolute; margin: 0; padding: 0; z-index: 1;`}},s)});if(l.push(c),l.push(this.renderOverlay(t)),!0===t.isActive){let e=y(t.timeSelection.start,t.resolution,t.sampleRate),i=y(t.timeSelection.end,t.resolution,t.sampleRate)-e+1;l.push(u()(`div.selection${i>1?".segment":".point"}`,{attributes:{style:`position: absolute; width: ${i}px; bottom: 0; top: 0; left: ${e}px; z-index: 4;`}}))}let d=u()("div.waveform",{attributes:{style:`height: ${r*t.height}px; position: relative;`}},l),h=[],p=0;t.controls.show&&(h.push(this.renderControls(t)),p=t.controls.width),h.push(d);let f=t.shouldPlay?"":".silent",m=void 0===this.customClass?"":`.${this.customClass}`;return u()(`div.channel-wrapper${f}${m}`,{attributes:{style:`margin-left: ${p}px; height: ${t.height*r}px;`}},h)}getTrackDetails(){let t={src:this.src,start:this.startTime,end:this.endTime,name:this.name,muted:this.muted,soloed:this.soloed,customClass:this.customClass,cuein:this.cueIn,cueout:this.cueOut,stereoPan:this.stereoPan,gain:this.gain,effects:this.effectsGraph};if(this.fadeIn){let e=this.fades[this.fadeIn];t.fadeIn={shape:e.shape,duration:e.end-e.start}}if(this.fadeOut){let e=this.fades[this.fadeOut];t.fadeOut={shape:e.shape,duration:e.end-e.start}}return t}};function J(t,e){t.connect(e)}let Z=class{constructor(t,e,i=t.createGain()){this.ac=t,this.gain=1,this.effectsGraph=J,this.masterEffectsGraph=J,this.buffer=e,this.masterGain=i,this.destination=this.ac.destination}applyFade(t,e,i,n="logarithmic"){if(t===G.Y1)(0,G.L7)(this.fadeGain.gain,n,e,i);else if(t===G.h7)(0,G.Mt)(this.fadeGain.gain,n,e,i);else throw Error("Unsupported fade type")}applyFadeIn(t,e,i="logarithmic"){this.applyFade(G.Y1,t,e,i)}applyFadeOut(t,e,i="logarithmic"){this.applyFade(G.h7,t,e,i)}isPlaying(){return void 0!==this.source}getDuration(){return this.buffer.duration}setAudioContext(t){this.ac=t,this.destination=this.ac.destination}createStereoPanner(){return this.ac.createStereoPanner?this.ac.createStereoPanner():this.ac.createPanner()}setUpSource(){let t,e;this.source=this.ac.createBufferSource(),this.source.buffer=this.buffer;let i=new Promise(i=>{this.source.onended=()=>{this.source.disconnect(),this.fadeGain.disconnect(),this.volumeGain.disconnect(),this.shouldPlayGain.disconnect(),this.panner.disconnect(),t&&t(),e&&e(),this.source=void 0,this.fadeGain=void 0,this.volumeGain=void 0,this.shouldPlayGain=void 0,this.panner=void 0,i()}});return this.fadeGain=this.ac.createGain(),this.volumeGain=this.ac.createGain(),this.shouldPlayGain=this.ac.createGain(),this.panner=this.createStereoPanner(),this.source.connect(this.fadeGain),this.fadeGain.connect(this.volumeGain),this.volumeGain.connect(this.shouldPlayGain),this.shouldPlayGain.connect(this.panner),t=this.effectsGraph(this.panner,this.masterGain,this.ac instanceof(window.OfflineAudioContext||window.webkitOfflineAudioContext)),e=this.masterEffectsGraph(this.masterGain,this.destination,this.ac instanceof(window.OfflineAudioContext||window.webkitOfflineAudioContext)),i}setVolumeGainLevel(t){this.volumeGain&&(this.volumeGain.gain.value=t)}setShouldPlay(t){this.shouldPlayGain&&(this.shouldPlayGain.gain.value=t?1:0)}setMasterGainLevel(t){this.masterGain&&(this.masterGain.gain.value=t)}setStereoPanValue(t=0){this.panner&&(void 0!==this.panner.pan?this.panner.pan.value=t:(this.panner.panningModel="equalpower",this.panner.setPosition(t,0,1-Math.abs(t))))}setEffects(t=J){this.effectsGraph=t}setMasterEffects(t=J){this.masterEffectsGraph=t}play(t,e,i){this.source.start(t,e,i)}stop(t=0){this.source&&this.source.stop(t)}},Q=class{constructor(t,e={}){this.playlist=t,this.data=e,this.active=!1,this.ondragover=t=>{this.active&&(t.preventDefault(),this.emitDrag(t.clientX))}}emitDrag(t){let e=t-this.prevX;if(e){let i=e*this.playlist.samplesPerPixel/this.playlist.sampleRate;this.prevX=t,this.playlist.ee.emit("dragged",i,this.data)}}complete(){this.active=!1,document.removeEventListener("dragover",this.ondragover)}dragstart(t){this.active=!0,this.prevX=t.clientX,t.dataTransfer.dropEffect="move",t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",""),document.addEventListener("dragover",this.ondragover)}dragend(t){this.active&&(t.preventDefault(),this.complete())}static getClass(){return".shift"}static getEvents(){return["dragstart","dragend"]}},K=function(){};K.prototype.hook=function(t){let e=t.querySelector(".current");if(e){let i=t.getBoundingClientRect(),n=e.getBoundingClientRect().top-i.top;t.scrollTop+=n}};let tt=class{constructor(t,e,i=[],n=!1,s=!1,a=!1,r=0){this.playlist=t,this.marginLeft=r,this.resizeHandlers=[],this.editable=n,this.annotations=e.map(t=>({id:t.id||j(),start:Number(t.begin)||0,end:Number(t.end)||0,lines:t.lines||[""],lang:t.language||"en"})),this.setupInteractions(),this.controls=i,this.setupEE(t.ee),this.playlist.isContinuousPlay=a,this.playlist.linkEndpoints=s,this.length=this.annotations.length}setupInteractions(){this.annotations.forEach((t,e)=>{let i=new Q(this.playlist,{direction:"left",index:e}),n=new Q(this.playlist,{direction:"right",index:e});this.resizeHandlers.push(i),this.resizeHandlers.push(n)})}setupEE(t){return t.on("dragged",(t,e)=>{let i=e.index,n=this.annotations,s=n[i];if("left"===e.direction){let e=s.start;s.start+=t,s.start<0&&(s.start=0),i&&n[i-1].end>s.start&&(n[i-1].end=s.start),this.playlist.linkEndpoints&&i&&n[i-1].end===e&&(n[i-1].end=s.start)}else{let e=s.end;s.end+=t,s.end>this.playlist.duration&&(s.end=this.playlist.duration),i<n.length-1&&n[i+1].start<s.end&&(n[i+1].start=s.end),this.playlist.linkEndpoints&&i<n.length-1&&n[i+1].start===e&&(n[i+1].start=s.end)}this.playlist.drawRequest()}),t.on("continuousplay",t=>{this.playlist.isContinuousPlay=t}),t.on("linkendpoints",t=>{this.playlist.linkEndpoints=t}),t.on("annotationsrequest",()=>{this.export()}),t}export(){let t=this.annotations.map(t=>({begin:String(t.start.toFixed(3)),end:String(t.end.toFixed(3)),id:String(t.id),language:t.lang,lines:t.lines})),e=`data:text/json;charset=utf-8,${encodeURIComponent(JSON.stringify(t))}`,i=document.createElement("a");document.body.appendChild(i),i.href=e,i.download="annotations.json",i.click(),document.body.removeChild(i)}renderResizeLeft(t){let e=Q.getEvents(),i={attributes:{style:"position: absolute; height: 30px; width: 10px; top: 0; left: -2px",draggable:!0}},n=this.resizeHandlers[2*t];return e.forEach(t=>{i[`on${t}`]=n[t].bind(n)}),u()("div.resize-handle.resize-w",i)}renderResizeRight(t){let e=Q.getEvents(),i={attributes:{style:"position: absolute; height: 30px; width: 10px; top: 0; right: -2px",draggable:!0}},n=this.resizeHandlers[2*t+1];return e.forEach(t=>{i[`on${t}`]=n[t].bind(n)}),u()("div.resize-handle.resize-e",i)}renderControls(t,e){let i=this;return this.controls.map(n=>u()(`i.${n.class}`,{attributes:{title:n.title},onclick:()=>{n.action(t,e,i.annotations,{linkEndpoints:i.playlist.linkEndpoints}),this.setupInteractions(),i.playlist.drawRequest()}}))}render(){let t=u()("div.annotations-boxes",{attributes:{style:`height: 30px; position: relative; margin-left: ${this.marginLeft}px;`}},this.annotations.map((t,e)=>{let i=this.playlist.samplesPerPixel,n=this.playlist.sampleRate,s=n/i,a=y(this.playlist.scrollLeft,i,n),r=Math.floor(t.start*s-a),o=Math.ceil(t.end*s-t.start*s);return u()("div.annotation-box",{attributes:{style:`position: absolute; height: 30px; width: ${o}px; left: ${r}px`,"data-id":t.id}},[this.renderResizeLeft(e),u()("span.id",{onclick:()=>{let t=this.annotations[e].start,i=this.annotations[e].end;this.playlist.isContinuousPlay?(this.playlist.seek(t,t),this.playlist.ee.emit("play",t)):(this.playlist.seek(t,i),this.playlist.ee.emit("play",t,i))}},[t.id]),this.renderResizeRight(e)])})),e=u()("div.annotations-boxes-wrapper",{attributes:{style:"overflow: hidden;"}},[t]),i=u()("div.annotations-text",{hook:new K},this.annotations.map((t,e)=>{let i=function(t){function e(t,e){let i=parseInt(t/3600,10)%24,n=parseInt(t/60,10)%60,s=(t%60).toFixed(e),a=i<10?`0${i}`:i,r=n<10?`0${n}`:n,o=s<10?`0${s}`:s;return`${a}:${r}:${o}`}return({seconds:t=>t.toFixed(0),thousandths:t=>t.toFixed(3),"hh:mm:ss":function(t){return e(t,0)},"hh:mm:ss.u":function(t){return e(t,1)},"hh:mm:ss.uu":function(t){return e(t,2)},"hh:mm:ss.uuu":function(t){return e(t,3)}})[t]}(this.playlist.durationFormat),n=i(t.start),s=i(t.end),a="";this.playlist.isPlaying()&&this.playlist.playbackSeconds>=t.start&&this.playlist.playbackSeconds<=t.end&&(a=".current");let r=this.editable?{attributes:{contenteditable:!0},oninput:e=>{t.lines=[e.target.innerText]},onkeypress:t=>{(13===t.which||13===t.keyCode)&&(t.target.blur(),t.preventDefault())}}:{};return u()(`div.annotation${a}`,[u()("span.annotation-id",[t.id]),u()("span.annotation-start",[n]),u()("span.annotation-end",[s]),u()("span.annotation-lines",r,[t.lines]),u()("span.annotation-actions",this.renderControls(t,e))])}));return u()("div.annotations",[e,i])}};function te(){function t(t,e){let i=2**(e-1);return Math.max(-i,Math.min(i-1,t<0?t*i:t*i-1))}onmessage=function(e){postMessage(function(e,i=1e4,n=8){if(0>[8,16,32].indexOf(n))throw Error("Invalid number of bits specified for peaks.");let s=[],a=e.length;return s.push(function(e,i,n){let s,a,r,o,l;let c=e.length,u=Math.ceil(c/i),d=new self[`Int${n}Array`](2*u);for(let h=0;h<u;h+=1)s=h*i,a=(h+1)*i>c?c:(h+1)*i,o=t((l=function(t){let e,i=1/0,n=-1/0;for(let s=0;s<t.length;s+=1)i>(e=t[s])&&(i=e),n<e&&(n=e);return{min:i,max:n}}(e.subarray(s,a))).min,n),r=t(l.max,n),d[2*h]=o,d[2*h+1]=r;return d}(e.subarray(0,a),i,n)),{bits:n,length:s[0].length/2,data:s}}(e.data.samples,e.data.samplesPerPixel))}}function ti(){let t,e=0,i=[],n=[];function s(t,e,i){for(let n=0;n<i.length;n+=1)t.setUint8(e+n,i.charCodeAt(n))}function a(t,e){let i=new Float32Array(e),n=0;for(let e=0;e<t.length;e+=1)i.set(t[e],n),n+=t[e].length;return i}onmessage=function(r){var o,l;switch(r.data.command){case"init":t=r.data.config.sampleRate;break;case"record":o=r.data.buffer,i.push(o[0]),n.push(o[1]),e+=o[0].length;break;case"exportWAV":l=r.data.type,postMessage(new Blob([function(e,i=!1){let n=new DataView(new ArrayBuffer(44+2*e.length));return s(n,0,"RIFF"),n.setUint32(4,32+2*e.length,!0),s(n,8,"WAVE"),s(n,12,"fmt "),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,i?1:2,!0),n.setUint32(24,t,!0),n.setUint32(28,4*t,!0),n.setUint16(32,4,!0),n.setUint16(34,16,!0),s(n,36,"data"),n.setUint32(40,2*e.length,!0),function(t,e,i){let n=44;for(let e=0;e<i.length;e+=1,n+=2){let s=Math.max(-1,Math.min(1,i[e]));t.setInt16(n,s<0?32768*s:32767*s,!0)}}(n,0,e),n}(function(t,e){let i=t.length+e.length,n=new Float32Array(i),s=0,a=0;for(;s<i;)n[s+=1]=t[a],n[s+=1]=e[a],a+=1;return n}(a(i,e),a(n,e)))],{type:l}));break;case"clear":e=0,i=[],n=[];break;default:throw Error("Unknown export worker command")}}}let tn=class{constructor(){this.tracks=[],this.soloedTracks=[],this.mutedTracks=[],this.collapsedTracks=[],this.playoutPromises=[],this.cursor=0,this.playbackSeconds=0,this.duration=0,this.scrollLeft=0,this.scrollTimer=void 0,this.showTimescale=!1,this.isScrolling=!1,this.fadeType="logarithmic",this.masterGain=1,this.annotations=[],this.durationFormat="hh:mm:ss.uuu",this.isAutomaticScroll=!1,this.resetDrawTimer=void 0}initExporter(){this.exportWorker=new(g())(ti)}trimAudioBuffer(t,e){let i=t.sampleRate,n=Math.floor(e*i);if(n>=t.length)return this.ac.createBuffer(1,1,i);let s=this.ac.createBuffer(t.numberOfChannels,t.length-n,i);for(let e=0;e<t.numberOfChannels;e++){let i=t.getChannelData(e),a=s.getChannelData(e);for(let t=0;t<s.length;t++)a[t]=i[t+n]}return s}initRecorder(t,e,i="Recording"){this.fixedRecordingTrack=void 0!==e,this.recordingTrack=e,this.mediaRecorder=new MediaRecorder(t),this.mediaRecorder.onstart=()=>{if(!this.fixedRecordingTrack){let t=new Y;t.setName(i),t.setEnabledStates(),t.setEventEmitter(this.ee),this.recordingTrack=t,this.tracks.push(t)}let t=this.cursor;this.recordingTrack.setStartTime(t),this.chunks=[],this.working=!1},this.mediaRecorder.ondataavailable=t=>{if(this.chunks.push(t.data),!this.working){let t=new Blob(this.chunks,{type:"audio/ogg; codecs=opus"});x.createLoader(t,this.ac).load().then(t=>{this.latency>0&&(t=this.trimAudioBuffer(t,this.latency)),this.recorderWorker.postMessage({samples:t.getChannelData(0),samplesPerPixel:this.samplesPerPixel}),this.recordingTrack.setCues(0,t.duration),this.recordingTrack.setBuffer(t),this.recordingTrack.setPlayout(new Z(this.ac,t,this.masterGainNode)),this.adjustDuration()}).catch(()=>{this.working=!1}),this.working=!0}},this.mediaRecorder.onstop=()=>{this.chunks=[],this.working=!1},this.recorderWorker=new(g())(te),this.recorderWorker.onmessage=t=>{this.recordingTrack.setPeaks(t.data),this.working=!1,this.drawRequest()}}setShowTimeScale(t){this.showTimescale=t}setMono(t){this.mono=t}setExclSolo(t){this.exclSolo=t}setSeekStyle(t){this.seekStyle=t}getSeekStyle(){return this.seekStyle}setSampleRate(t){this.sampleRate=t}setSamplesPerPixel(t){this.samplesPerPixel=t}setAudioContext(t){this.ac=t,this.masterGainNode=t.createGain()}getAudioContext(){return this.ac}setControlOptions(t){this.controls=t}setWaveHeight(t){this.waveHeight=t}setCollapsedWaveHeight(t){this.collapsedWaveHeight=t}setColors(t){this.colors=t}setBarWidth(t){this.barWidth=t}setBarGap(t){this.barGap=t}setAnnotations(t){let e=this.controls.show?this.controls.width:0;this.annotationList=new tt(this,t.annotations,t.controls,t.editable,t.linkEndpoints,t.isContinuousPlay,e)}setEffects(t){this.effectsGraph=t}setEventEmitter(t){this.ee=t}getEventEmitter(){return this.ee}setUpEventEmitter(){let t=this.ee;t.on("automaticscroll",t=>{this.isAutomaticScroll=t}),t.on("durationformat",t=>{this.durationFormat=t,this.drawRequest()}),t.on("select",(t,e,i)=>{this.isPlaying()?(this.lastSeeked=t,this.pausedAt=void 0,this.restartPlayFrom(t)):(this.seek(t,e,i),this.ee.emit("timeupdate",t),this.drawRequest())}),t.on("startaudiorendering",(t,e)=>{this.startOfflineRender(t,e)}),t.on("statechange",t=>{this.setState(t),this.drawRequest()}),t.on("shift",(t,e)=>{e.setStartTime(e.getStartTime()+t),this.adjustDuration(),this.drawRequest()}),t.on("record",t=>{this.latency=t,this.record()}),t.on("updateview",()=>{this.drawRequest()}),t.on("resume",async()=>{console.log(`Audio context state change: ${this.getAudioContext().state}`),"running"===this.getAudioContext().state&&await this.getAudioContext().resume()}),t.on("play",(t,e)=>{this.play(t,e)}),t.on("pause",()=>{this.pause()}),t.on("stop",()=>{this.stop()}),t.on("rewind",()=>{this.rewind()}),t.on("fastforward",()=>{this.fastForward()}),t.on("clear",()=>{this.clear().then(()=>{this.drawRequest()})}),t.on("solo",t=>{this.soloTrack(t),this.adjustTrackPlayout(),this.drawRequest()}),t.on("mute",t=>{this.muteTrack(t),this.adjustTrackPlayout(),this.drawRequest()}),t.on("removeTrack",t=>{this.removeTrack(t),this.adjustTrackPlayout(),this.drawRequest()}),t.on("changeTrackView",(t,e)=>{this.collapseTrack(t,e),this.drawRequest()}),t.on("volumechange",(t,e)=>{e.setGainLevel(t/100),this.drawRequest()}),t.on("mastervolumechange",t=>{this.masterGain=t/100,this.tracks.forEach(t=>{t.setMasterGainLevel(this.masterGain)})}),t.on("fadein",(t,e)=>{e.setFadeIn(t,this.fadeType),this.drawRequest()}),t.on("fadeout",(t,e)=>{e.setFadeOut(t,this.fadeType),this.drawRequest()}),t.on("stereopan",(t,e)=>{e.setStereoPanValue(t),this.drawRequest()}),t.on("fadetype",t=>{this.fadeType=t}),t.on("newtrack",t=>{this.load([{src:t,name:t.name}])}),t.on("trim",()=>{let t=this.getActiveTrack(),e=this.getTimeSelection();t.trim(e.start,e.end),t.calculatePeaks(this.samplesPerPixel,this.sampleRate),this.setTimeSelection(0,0),this.adjustDuration(),this.drawRequest()}),t.on("zoomin",()=>{let t=Math.max(0,this.zoomIndex-1),e=this.zoomLevels[t];e!==this.samplesPerPixel&&(this.setZoom(e),this.drawRequest())}),t.on("zoomout",()=>{let t=Math.min(this.zoomLevels.length-1,this.zoomIndex+1),e=this.zoomLevels[t];e!==this.samplesPerPixel&&(this.setZoom(e),this.drawRequest())}),t.on("scroll",()=>{this.isScrolling=!0,this.drawRequest(),clearTimeout(this.scrollTimer),this.scrollTimer=setTimeout(()=>{this.isScrolling=!1},200)})}load(t){return Promise.all(t.map(t=>x.createLoader(t.src,this.ac,this.ee).load().then(t=>t.sampleRate===this.sampleRate?t:function(t,e){let i=Math.ceil(t.duration*e),n=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(t.numberOfChannels,i,e),s=n.createBufferSource();return s.buffer=t,s.connect(n.destination),s.start(),n.startRendering()}(t,this.sampleRate)))).then(e=>{this.ee.emit("audiosourcesloaded");let i=e.map((e,i)=>{let n=t[i],s=n.name||"Untitled",a=n.start||0,r=n.states||{},o=n.fadeIn,l=n.fadeOut,c=n.cuein||0,u=n.cueout||e.duration,d=n.gain||1,h=n.muted||!1,p=n.soloed||!1,f=n.selected,m=n.peaks||{type:"WebAudio",mono:this.mono},g=n.customClass||void 0,v=n.waveOutlineColor||void 0,y=n.stereoPan||0,b=n.effects||null,k=new Z(this.ac,e,this.masterGainNode),w=new Y;return w.src=n.src,w.setBuffer(e),w.setName(s),w.setEventEmitter(this.ee),w.setEnabledStates(r),w.setCues(c,u),w.setCustomClass(g),w.setWaveOutlineColor(v),void 0!==o&&w.setFadeIn(o.duration,o.shape),void 0!==l&&w.setFadeOut(l.duration,l.shape),void 0!==f&&(this.setActiveTrack(w),this.setTimeSelection(f.start,f.end)),void 0!==m&&w.setPeakData(m),w.setState(this.getState()),w.setStartTime(a),w.setPlayout(k),w.setGainLevel(d),w.setStereoPanValue(y),b&&w.setEffects(b),h&&this.muteTrack(w),p&&this.soloTrack(w),w.calculatePeaks(this.samplesPerPixel,this.sampleRate),w});this.tracks=this.tracks.concat(i),this.adjustDuration(),this.draw(this.render()),this.ee.emit("audiosourcesrendered")}).catch(t=>{this.ee.emit("audiosourceserror",t)})}setActiveTrack(t){this.activeTrack=t}getActiveTrack(){return this.activeTrack}isSegmentSelection(){return this.timeSelection.start!==this.timeSelection.end}setTimeSelection(t=0,e){this.timeSelection={start:t,end:void 0===e?t:e},this.cursor=t}async startOfflineRender(t,e){if(this.isRendering)return;this.isRendering=!0,this.offlineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(2,44100*this.duration,44100);let i=[];this.ee.emit("audiorenderingstarting",this.offlineAudioContext,i);let n=this.offlineAudioContext.currentTime,s=this.offlineAudioContext.createGain();this.tracks.forEach((t,i)=>{let a=this.shouldTrackPlay(t);e>=0&&(a=i===e);let r=new Z(this.offlineAudioContext,t.buffer,s);r.setEffects(t.effectsGraph),r.setMasterEffects(this.effectsGraph),t.setOfflinePlayout(r),t.schedulePlay(n,0,0,{shouldPlay:a,masterGain:1,isOffline:!0})}),await Promise.all(i);let a=await this.offlineAudioContext.startRendering();"buffer"===t?(this.ee.emit("audiorenderingfinished",t,a),this.isRendering=!1):"wav"===t&&(this.exportWorker.postMessage({command:"init",config:{sampleRate:44100}}),this.exportWorker.onmessage=i=>{this.ee.emit("audiorenderingfinished",t,i.data,e),this.isRendering=!1,this.exportWorker.postMessage({command:"clear"})},this.exportWorker.postMessage({command:"record",buffer:[a.getChannelData(0),a.getChannelData(1)]}),this.exportWorker.postMessage({command:"exportWAV",type:"audio/wav"}))}getTimeSelection(){return this.timeSelection}setState(t){this.state=t,this.tracks.forEach(e=>{e.setState(t)})}getState(){return this.state}setZoomIndex(t){this.zoomIndex=t}setZoomLevels(t){this.zoomLevels=t}setZoom(t){this.samplesPerPixel=t,this.zoomIndex=this.zoomLevels.indexOf(t),this.tracks.forEach(e=>{e.calculatePeaks(t,this.sampleRate)})}muteTrack(t){let e=this.mutedTracks.indexOf(t);e>-1?(t.muted=!1,this.mutedTracks.splice(e,1)):(t.muted=!0,this.mutedTracks.push(t))}soloTrack(t){let e=this.soloedTracks.indexOf(t);e>-1?(t.soloed=!1,this.soloedTracks.splice(e,1)):this.exclSolo?(t.soloed=!0,this.soloedTracks=[t]):(t.soloed=!0,this.soloedTracks.push(t))}collapseTrack(t,e){if(e.collapsed)this.collapsedTracks.push(t);else{let e=this.collapsedTracks.indexOf(t);e>-1&&this.collapsedTracks.splice(e,1)}}removeTrack(t){t.isPlaying()&&t.scheduleStop(),[this.mutedTracks,this.soloedTracks,this.collapsedTracks,this.tracks].forEach(e=>{let i=e.indexOf(t);i>-1&&e.splice(i,1)}),this.adjustDuration()}adjustTrackPlayout(){this.tracks.forEach(t=>{t.setShouldPlay(this.shouldTrackPlay(t))})}adjustDuration(){this.duration=this.tracks.reduce((t,e)=>Math.max(t,e.getEndTime()),0)}shouldTrackPlay(t){let e;return this.soloedTracks.length>0?(e=!1,this.soloedTracks.indexOf(t)>-1&&(e=!0)):(e=!0,this.mutedTracks.indexOf(t)>-1&&(e=!1)),e}isPlaying(){return this.tracks.reduce((t,e)=>t||e.isPlaying(),!1)}getCurrentTime(){return(this.lastSeeked||this.pausedAt||this.cursor)+this.getElapsedTime()}getElapsedTime(){return this.ac.currentTime-this.lastPlay}setMasterGain(t){this.ee.emit("mastervolumechange",t)}restartPlayFrom(t,e){return this.stopAnimation(),this.tracks.forEach(t=>{t.scheduleStop()}),Promise.all(this.playoutPromises).then(this.play.bind(this,t,e))}play(t,e){clearTimeout(this.resetDrawTimer);let i=this.ac.currentTime,n=this.getTimeSelection(),s=[],a=0===t?0:t||this.pausedAt||this.cursor,r=e;return(!r&&n.end!==n.start&&n.end>a&&(r=n.end),this.isPlaying())?this.restartPlayFrom(a,r):(this.effectsGraph&&this.tracks&&this.tracks[0].playout.setMasterEffects(this.effectsGraph),this.tracks.forEach(t=>{t.setState("cursor"),s.push(t.schedulePlay(i,a,r,{shouldPlay:this.shouldTrackPlay(t),masterGain:this.masterGain}))}),this.lastPlay=i,this.playoutPromises=s,this.startAnimation(a),Promise.all(this.playoutPromises))}pause(){return this.isPlaying()?(this.pausedAt=this.getCurrentTime(),this.playbackReset()):Promise.all(this.playoutPromises)}stop(){return this.mediaRecorder&&"recording"===this.mediaRecorder.state&&this.mediaRecorder.stop(),this.pausedAt=void 0,this.playbackSeconds=0,this.playbackReset()}playbackReset(){return this.lastSeeked=void 0,this.stopAnimation(),this.tracks.forEach(t=>{t.scheduleStop(),t.setState(this.getState())}),this.drawRequest(),Promise.all(this.playoutPromises)}rewind(){return this.stop().then(()=>{this.scrollLeft=0,this.ee.emit("select",0,0)})}fastForward(){return this.stop().then(()=>{this.viewDuration<this.duration?this.scrollLeft=this.duration-this.viewDuration:this.scrollLeft=0,this.ee.emit("select",this.duration,this.duration)})}clear(t){return this.stop().then(()=>{var e=[];(t||0===t)&&(this.tracks.splice(t,1),e=this.tracks),this.tracks=e,this.soloedTracks=[],this.mutedTracks=[],this.playoutPromises=[],this.cursor=0,this.playbackSeconds=0,this.duration=0,this.scrollLeft=0,this.seek(0,0,void 0)})}record(){let t=[],e=this.cursor;this.mediaRecorder.start(300),this.tracks.forEach(i=>{i.setState("none"),t.push(i.schedulePlay(this.ac.currentTime,e,void 0,{shouldPlay:i!==this.recordingTrack&&this.shouldTrackPlay(i)}))}),this.playoutPromises=t}startAnimation(t){this.lastDraw=this.ac.currentTime,this.animationRequest=window.requestAnimationFrame(()=>{this.updateEditor(t)})}stopAnimation(){window.cancelAnimationFrame(this.animationRequest),this.lastDraw=void 0}seek(t,e,i){this.isPlaying()?(this.lastSeeked=t,this.pausedAt=void 0,this.restartPlayFrom(t)):(this.setActiveTrack(i||this.tracks[0]),this.pausedAt=t,this.setTimeSelection(t,e),"fill"===this.getSeekStyle()&&(this.playbackSeconds=t))}updateEditor(t){let e=this.ac.currentTime,i=this.getTimeSelection(),n=t||this.cursor,s=e-this.lastDraw;if(this.isPlaying()){let t=n+s;this.ee.emit("timeupdate",t),this.animationRequest=window.requestAnimationFrame(()=>{this.updateEditor(t)}),this.playbackSeconds=t,this.draw(this.render()),this.lastDraw=e}else n+s>=(this.isSegmentSelection()?i.end:this.duration)&&this.ee.emit("finished"),this.stopAnimation(),this.resetDrawTimer=setTimeout(()=>{this.pausedAt=void 0,this.lastSeeked=void 0,this.setState(this.getState()),this.playbackSeconds=0,this.draw(this.render())},0)}drawRequest(){window.requestAnimationFrame(()=>{this.draw(this.render())})}draw(t){let e=h()(this.tree,t);this.rootNode=f()(this.rootNode,e),this.tree=t,this.viewDuration=(this.rootNode.clientWidth-this.controls.width)*this.samplesPerPixel/this.sampleRate}getTrackRenderData(t={}){let e={height:this.waveHeight,resolution:this.samplesPerPixel,sampleRate:this.sampleRate,controls:this.controls,isActive:!1,timeSelection:this.getTimeSelection(),playlistLength:this.duration,playbackSeconds:this.playbackSeconds,colors:this.colors,barWidth:this.barWidth,barGap:this.barGap};return s()({},t,e)}isActiveTrack(t){let e=this.getActiveTrack();return!this.isSegmentSelection()||e===t}renderAnnotations(){return this.annotationList.render()}renderTimeScale(){let t=this.controls.show?this.controls.width:0;return new P(this.duration,this.scrollLeft,this.samplesPerPixel,this.sampleRate,t,this.colors).render()}renderTrackSection(){let t=this.tracks.map(t=>{let e=this.collapsedTracks.indexOf(t)>-1;return t.render(this.getTrackRenderData({isActive:this.isActiveTrack(t),shouldPlay:this.shouldTrackPlay(t),soloed:this.soloedTracks.indexOf(t)>-1,muted:this.mutedTracks.indexOf(t)>-1,collapsed:e,height:e?this.collapsedWaveHeight:this.waveHeight,barGap:this.barGap,barWidth:this.barWidth}))});return u()("div.playlist-tracks",{attributes:{style:"overflow: auto;"},onscroll:t=>{this.scrollLeft=t.target.scrollLeft*this.samplesPerPixel/this.sampleRate,this.ee.emit("scroll")},hook:new T(this)},t)}render(){let t=[];return this.showTimescale&&t.push(this.renderTimeScale()),t.push(this.renderTrackSection()),this.annotationList.length&&t.push(this.renderAnnotations()),u()("div.playlist",{attributes:{style:"overflow: hidden; position: relative;"}},t)}getInfo(){let t=[];return this.tracks.forEach(e=>{t.push(e.getTrackDetails())}),{tracks:t,effects:this.effectsGraph}}};function ts(t={},e=l()()){if(void 0===t.container)throw Error("DOM element container must be given.");let i=s()({},t,{samplesPerPixel:4096,mono:!0,fadeType:"logarithmic",exclSolo:!1,timescale:!1,controls:{show:!1,width:150,widgets:{muteOrSolo:!0,volume:!0,stereoPan:!0,collapse:!0,remove:!0}},colors:{waveOutlineColor:"white",timeColor:"grey",fadeColor:"black"},seekStyle:"line",waveHeight:128,collapsedWaveHeight:30,barWidth:1,barGap:0,state:"cursor",zoomLevels:[512,1024,2048,4096],annotationList:{annotations:[],controls:[],editable:!1,linkEndpoints:!1,isContinuousPlay:!1},isAutomaticScroll:!1}),n=i.zoomLevels.indexOf(i.samplesPerPixel);if(-1===n)throw Error("initial samplesPerPixel must be included in array zoomLevels");let a=new tn,o=window.AudioContext||window.webkitAudioContext||!1,c=i.ac||new o;a.setAudioContext(c),a.setSampleRate(i.sampleRate||c.sampleRate),a.setSamplesPerPixel(i.samplesPerPixel),a.setEventEmitter(e),a.setUpEventEmitter(),a.setTimeSelection(0,0),a.setState(i.state),a.setControlOptions(i.controls),a.setWaveHeight(i.waveHeight),a.setCollapsedWaveHeight(i.collapsedWaveHeight),a.setColors(i.colors),a.setZoomLevels(i.zoomLevels),a.setZoomIndex(n),a.setMono(i.mono),a.setExclSolo(i.exclSolo),a.setShowTimeScale(i.timescale),a.setSeekStyle(i.seekStyle),a.setAnnotations(i.annotationList),a.setBarGap(i.barGap),a.setBarWidth(i.barWidth),a.isAutomaticScroll=i.isAutomaticScroll,a.isContinuousPlay=i.isContinuousPlay,a.linkedEndpoints=i.linkedEndpoints,i.effects&&a.setEffects(i.effects);let u=a.render(),d=r()(u);return i.container.appendChild(d),a.tree=u,a.rootNode=d,a}function ta(t={},e=l()()){return ts(t,e)}})(),n})();var h=r("ck9ES"),t3=r("04BFj");const t9={measure_average_loudness_for_1_sec:0,playing_and_listening:1,waiting:2,passthrough:3,idle:4};function t4(t,e,i){let n=0;for(let s=0;s<i;s++)n+=Math.abs(t[s])+Math.abs(e[s]);return n}class t6{constructor(){this.measurementState=this.nextMeasurementState=t9.idle,this.samplesElapsed=this.sineWave=this.sum=this.threshold=this.state=this.samplerate=this.latencyMs=this.buffersize=0,this.roundTripLatencyMs=Array(t7).fill(0)}toggle(){-1==this.state||this.state>0&&this.state<t7+1?(this.state=0,this.nextMeasurementState=t9.idle):(this.state=1,this.samplerate=this.latencyMs=this.buffersize=0,this.nextMeasurementState=t9.measure_average_loudness_for_1_sec)}processInput(t,e,i,n){switch(this.rampdec=-1,this.samplerate=i,this.buffersize=n,this.nextMeasurementState!=this.measurementState&&(this.nextMeasurementState==t9.measure_average_loudness_for_1_sec&&(this.samplesElapsed=0),this.measurementState=this.nextMeasurementState),this.measurementState){case t9.measure_average_loudness_for_1_sec:if(this.sum+=t4(t,e,n),this.samplesElapsed+=n,this.samplesElapsed>=this.samplerate){let t=20*Math.log10(this.sum/(this.samplesElapsed>>1))+24;this.threshold=Math.pow(10,t/20),this.measurementState=this.nextMeasurementState=t9.playing_and_listening,this.sineWave=0,this.samplesElapsed=0,this.sum=0}break;case t9.playing_and_listening:let s=t4(t,e,n)/n;if(this.rampdec=0,s>this.threshold){let i=0,s=0;for(;i<n&&!(t[s]>this.threshold)&&!(e[s++]>this.threshold);)i++;if(this.samplesElapsed+=i,this.samplesElapsed>n){this.roundTripLatencyMs[this.state-1]=1e3*this.samplesElapsed/this.samplerate;let t=0,e=1e5;for(i=0;i<this.state;i++)this.roundTripLatencyMs[i]>t&&(t=this.roundTripLatencyMs[i]),this.roundTripLatencyMs[i]<e&&(e=this.roundTripLatencyMs[i]),this.sum+=this.roundTripLatencyMs[i];t/e>2?(this.latencyMs=0,this.state=t7,this.measurementState=this.nextMeasurementState=t9.idle):this.state==t7?(this.latencyMs=parseInt(.1*this.sum),this.measurementState=this.nextMeasurementState=t9.idle):(this.latencyMs=parseInt(this.roundTripLatencyMs[this.state-1]),this.measurementState=this.nextMeasurementState=t9.waiting),this.state++}else this.measurementState=this.nextMeasurementState=t9.waiting;this.rampdec=1/n}else this.samplesElapsed+=n,this.samplesElapsed>this.samplerate&&(this.rampdec=1/n,this.measurementState=this.nextMeasurementState=t9.waiting,this.latencyMs=-1,this.samplesElapsed=0);break;case t9.passthrough:case t9.idle:break;default:this.samplesElapsed+=n,this.sum=0,this.samplesElapsed>this.samplerate&&(this.samplesElapsed=0,this.measurementState=this.nextMeasurementState=t9.measure_average_loudness_for_1_sec)}}processOutput(t,e){if(this.measurementState!=t9.passthrough){if(this.rampdec<0){let i=2*this.buffersize,n=0;for(;i--;)t[n]=e[n++]=0}else{let i=1,n=2*Math.PI*1e3/this.samplerate,s=this.buffersize,a=0;for(;s--;)t[a]=e[a++]=Math.sin(n*this.sineWave)*i,i-=this.rampdec,this.sineWave+=1}}}}var h=r("ck9ES");const t7=4;class t5{constructor(){this.currentlatency=null}static setCurrentLatency(t){localStorage.setItem("latency",t),t5.currentlatency=t}static getCurrentLatency(){return t5.currentlatency}static initialize(){let t=localStorage.getItem("latency");t5.currentlatency=t?parseInt(t):null,t5.audioContext=t5.audioNode=null,t5.content=document.getElementById("testlatency");let e="function"==typeof AudioWorkletNode?1:0;t5.data={buffersize:e?128:512,samplerate:"?",audioWorklet:e},t5.runningon="?",t5.displayStart()}static displayStart(){null!=t5.audioContext&&t5.audioContext.close(),t5.audioContext=t5.audioNode=null,t5.content.innerHTML="",t5.startbutton=document.createElement("a"),t5.startbutton.innerText="TEST LATENCY",t5.startbutton.classList.add("btn-outline-success"),t5.startbutton.onclick=t5.start,t5.content.appendChild(t5.startbutton),$("#testlatency").popover("hide"),$("#testlatency").popover({trigger:"focus"})}static onAudioInputPermissionDenied(t){console.log(t)}static onMessageFromAudioScope(t){if(t.latency>0){t5.setCurrentLatency(t.latency);let e=t.state-1;$("#testlatency").attr("data-content",e+"/3 trials. Current latency: "+t.latency+" ms."),$("#testlatency").popover("show")}else $("#testlatency").attr("data-content","No input detected"),$("#testlatency").popover("show");t.state>=t7&&t5.finishTest(t.latency)}static onAudioSetupFinished(){t5.audioContext.createMediaStreamSource(t5.inputStream).connect(t5.audioNode),t5.audioNode.connect(t5.audioContext.destination),t5.startbutton.innerText="STOP",t5.startbutton.classList.remove("btn-outline-success"),t5.startbutton.classList.add("btn-outline-danger"),t5.startbutton.onclick=t5.displayStart}static finishTest(t){null!=t5.audioContext&&t5.audioContext.close(),t5.audioContext=t5.audioNode=null,t5.startbutton.innerText="TEST AGAIN ",t5.startbutton.innerHTML+=`<span class="badge badge-info">latency: ${t} ms.</span>`,t5.startbutton.classList.remove("btn-outline-danger"),t5.startbutton.classList.add("btn-outline-primary"),t5.startbutton.onclick=t5.displayStart,$("#testlatency").popover("hide")}static onAudioPermissionGranted(t){t5.inputStream=t,t5.latencyMeasurer=new t6,t5.latencyMeasurer.toggle(),t5.lastState=0,t5.audioNode=t5.audioContext.createScriptProcessor(512,2,2),t5.audioNode.onaudioprocess=function(t){t5.latencyMeasurer.processInput(t.inputBuffer.getChannelData(0),t.inputBuffer.getChannelData(1),t5.data.samplerate,t.inputBuffer.length),t5.latencyMeasurer.processOutput(t.outputBuffer.getChannelData(0),t.outputBuffer.getChannelData(1)),t5.lastState!=t5.latencyMeasurer.state&&(t5.lastState=t5.latencyMeasurer.state,t5.onMessageFromAudioScope({state:t5.lastState,latency:t5.latencyMeasurer.latencyMs}))},t5.onAudioSetupFinished()}static start(){if($("#testlatency").popover("hide"),!t5.getCurrentLatency()){let t=window.confirm("Please Make sure you are in a quiet place (so the browser can hear itself). Set both input and output audio volume to near maximum. This may be LOUD. Note: not all browsers on all devices will allow the browser permission to the speakers and microphone. If they don't, the test will not function.");if(h.isSafari&&ei.getEventEmitter().emit("resume"),!t)return}let t=window.AudioContext||window.webkitAudioContext||!1;t5.audioContext=new t({latencyHint:0}),t5.data.samplerate=t5.audioContext.sampleRate,navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1}}).then(t5.onAudioPermissionGranted).catch(t5.onAudioInputPermissionDenied):t5.onAudioInputPermissionDenied("Can't access getUserMedia.")}}var h=r("ck9ES");const t8=window.location.search.split("compositionId=")[1];let et=!1;const ee=t=>{et=t},ei=((e=t2)&&e.__esModule?e.default:e)({samplesPerPixel:3e3,waveHeight:100,container:document.getElementById("playlist"),state:"cursor",colors:{waveOutlineColor:"#E0EFF1",timeColor:"grey",fadeColor:"black"},controls:{show:!0,width:200,widgets:{stereoPan:!0,collapse:!1,remove:!0}},zoomLevels:[500,1e3,3e3,5e3],isAutomaticScroll:!0,timescale:!0}),en=new t1,es=new class{constructor(t,e){this.compositionId=t,this.trackhandler=e}enableUpload(){let t=this;document.getElementById("fileInput").addEventListener("change",function(e){e.preventDefault(),t.fileReader(this.files[0])},!1),dropContainer.ondragover=dropContainer.ondragenter=t=>{t.preventDefault()},dropContainer.ondrop=t=>{fileInput.files=t.dataTransfer.files,this.fileReader(fileInput.files[0]),t.preventDefault()}}fileReader(t){let e={dom:document.getElementById("fileInput"),binary:null},i=new FileReader;i.addEventListener("load",()=>{e.binary=i.result}),i.addEventListener("loadend",()=>{this.sendData(e)}),t&&i.readAsBinaryString(t)}sendData(t,e){if(!e&&!t.binary&&t.dom.files.length>0){setTimeout(this.sendData,10);return}let i=new XMLHttpRequest,n=new FormData,s=e?t:t.dom.files[0],a=e?t.fileName:t.dom.files[0].name;n.append("composition_id",this.compositionId),n.append("audio",s,a),i.addEventListener("load",t=>{if((0,h.cancelLoader)(h.LOADER_ELEM_ID),t.srcElement&&t.srcElement.response){let i=JSON.parse(t.srcElement.response);i.ok?(fileInput.value="","blob"===e?en.displayOptMenuForNewTrack(i):ei.getEventEmitter().emit("audiosourcesrendered",i)):alert("Oops! Something went wrong.")}else alert("Oops! Something went wrong.")}),i.addEventListener("error",t=>{(0,h.cancelLoader)(h.LOADER_ELEM_ID),alert("Oops! Something went wrong.")}),i.open("POST",d.UPLOAD_ENDPOINT),i.send(n),(0,h.startLoader)(h.LOADER_ELEM_ID,"Uploading track...")}}(t8,en),ea=new class{constructor(){this.recordGainNode=null}init(){let t;let e={audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1}};navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;let i=e=>{t=this.getCorrectStreamForSafari(e),ei.initRecorder(t,void 0,"Voice Track"),$(".btn-record").removeClass("disabled"),this.setRecordGainNodeForTest(this.recordGainNode)},n=t=>{console.error(t)};navigator.mediaDevices?navigator.mediaDevices.getUserMedia(e).then(i).catch(n):navigator.getUserMedia&&"MediaRecorder"in window&&navigator.getUserMedia(e,i,n)}getCorrectStreamForSafari(t){let e=navigator.userAgent.indexOf("Version/"),i=parseFloat(navigator.userAgent.substring(e+8));if(!h.isSafari||!(i>16))return t;{let e=ei.ac.createMediaStreamSource(t);this.recordGainNode=ei.ac.createGain(),e.connect(this.recordGainNode);let i=localStorage.getItem("micgain"),n=i?parseInt(i):1;this.recordGainNode.gain.value=n;let s=ei.ac.createMediaStreamDestination();return this.recordGainNode.connect(s),s.stream}}setRecordGainNodeForTest(t){let e=navigator.userAgent.indexOf("Version/"),i=parseFloat(navigator.userAgent.substring(e+8));h.isSafari&&i>16&&new t3.TestMic().init(t)}};(0,h.activateGoHomeLink)(),document.getElementById("useroptions").innerHTML=`<li class="nav-item">
    <a class="nav-link" href="#" id="testlatency" data-toggle="modal" 
      data-toggle="popover" data-placement="bottom"  title="Testing ..." data-content="No input detected">
      Test Latency</a>
  </li>${(()=>{let t=navigator.userAgent.indexOf("Version/"),e=parseFloat(navigator.userAgent.substring(t+8));return h.isSafari&&e>16?`<li class="nav-item">
              <a class="nav-link" href="#" id="testmicrophone" data-toggle="modal" data-target="#testMicrophoneModal">
                <i class="fa-solid fa-microphone"></i> TEST MIC
              </a>
            </li>`:""})()}`,t5.initialize(),"demopage"===t8&&alert("WARNING: Be careful, the music you record or upload won't be saved, as you are not a registered user and this is only a test feature!"),((t,e,i)=>{let n=null,s={};fetch(d.ENDPOINT+"/composition/"+t,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}}).then(t=>(t.ok||(n=t.statusText),t.json())).then(t=>{t&&(s=t)}).catch(t=>{n=t}).then(()=>{n&&alert(n),e(s,i)})})(t8,t=>{o?tU(o,t):l(t.viewer_id||"null").then(e=>{tU(e,t)})});var er=ei.getEventEmitter(),eo=$("body"),el=eo.find(".time-format"),ec=eo.find(".audio-start"),eu=eo.find(".audio-end"),ed=eo.find(".audio-pos"),eh="hh:mm:ss.uuu",ep=0,ef=0,em=0,eg=void 0,ev=!1,ey=!1;function eb(t){for(var e=t.parentNode.querySelectorAll(".active"),i=0,n=e.length;i<n;i++)e[i].classList.remove("active");t.classList.toggle("active")}function ek(t){function e(t,e){var i,n,s;return((i=parseInt(t/3600,10)%24)<10?"0"+i:i)+":"+((n=parseInt(t/60,10)%60)<10?"0"+n:n)+":"+((s=(s=t%60).toFixed(e))<10?"0"+s:s)}return({seconds:function(t){return t.toFixed(0)},thousandths:function(t){return t.toFixed(3)},"hh:mm:ss":function(t){return e(t,0)},"hh:mm:ss.u":function(t){return e(t,1)},"hh:mm:ss.uu":function(t){return e(t,2)},"hh:mm:ss.uuu":function(t){return e(t,3)}})[t]}function ew(t,e){t<e?($(".btn-trim-audio").removeClass("disabled"),$(".btn-loop").removeClass("disabled")):($(".btn-trim-audio").addClass("disabled"),$(".btn-loop").addClass("disabled")),ec.val(ek(eh)(t)),eu.val(ek(eh)(e)),ep=t,ef=e}function eE(t){ed.html(ek(eh)(t)),em=t}ew(0,0),eE(em),eo.on("click",".btn-annotations-download",function(){er.emit("annotationsrequest")}),eo.on("click",".btn-loop",function(){ev=!0,i=ei.play(ep,ef)}),eo.on("click",".btn-play",function(){er.emit("play"),$(".btn-group .btn-record").prop("disabled",!0)}),eo.on("click",".btn-pause",function(){ev=!1,er.emit("pause"),$(".btn-group .btn-record").prop("disabled",!1)}),eo.on("click",".btn-stop",function(){if(ev=!1,ey&&(ey=!1,et)){let t=ei.getInfo().tracks.length-1;er.emit("startaudiorendering","wav",t)}er.emit("stop"),$(".btn-group button").prop("disabled",!1)}),eo.on("click",".btn-rewind",function(){ev=!1,er.emit("rewind"),$(".btn-group .btn-record").prop("disabled",!1)}),eo.on("click",".btn-fast-forward",function(){ev=!1,er.emit("fastforward"),$(".btn-group .btn-record").prop("disabled",!1)}),eo.on("click",".btn-clear",function(){ev=!1,er.emit("clear")});const ex=()=>{$("#testLatencyModal").modal("show"),document.getElementById("buttonOkTestLatency").onclick=()=>{$("#testLatencyModal").modal("hide"),t5.start()},document.getElementById("buttonNoTestLatency").onclick=()=>{$("#testLatencyModal").modal("hide"),t5.setCurrentLatency(0),eT(0)}},eT=t=>{ey||(ey=!0,$(".btn-group button").prop("disabled",!0),$(".btn-group .btn-stop").prop("disabled",!1),er.emit("record",t/1e3))};function eS(t){if(t?.customClass){let e=(({muted:t,gain:e,soloed:i,stereoPan:n})=>({muted:t,gain:e,soloed:i,stereoPan:n}))(t);e.track_id=t.customClass.track_id,e.composition_id=t.customClass.composition_id;let i=t.customClass.viewer_id||tG;o?c(o,e):l(i).then(t=>{c(t,e)})}}function eP(t,e){eS(e),$(".sound-status").html(t)}function e_(t){var e=$("<div/>").append(t);$(".loading-data").append(e)}eo.on("click",".btn-record",function(){if(!ey){let t=t5.getCurrentLatency();t||0===t?eT(t):ex()}}),eo.on("click",".btn-cursor",function(){er.emit("statechange","cursor"),eb(this)}),eo.on("click",".btn-select",function(){er.emit("statechange","select"),eb(this)}),eo.on("click",".btn-shift",function(){er.emit("statechange","shift"),eb(this)}),eo.on("click",".btn-fadein",function(){er.emit("statechange","fadein"),eb(this)}),eo.on("click",".btn-fadeout",function(){er.emit("statechange","fadeout"),eb(this)}),eo.on("click",".btn-logarithmic",function(){er.emit("fadetype","logarithmic"),eb(this)}),eo.on("click",".btn-linear",function(){er.emit("fadetype","linear"),eb(this)}),eo.on("click",".btn-scurve",function(){er.emit("fadetype","sCurve"),eb(this)}),eo.on("click",".btn-exponential",function(){er.emit("fadetype","exponential"),eb(this)}),eo.on("click",".btn-zoom-in",function(){er.emit("zoomin")}),eo.on("click",".btn-zoom-out",function(){er.emit("zoomout")}),eo.on("click",".btn-trim-audio",function(){er.emit("trim")}),eo.on("click",".btn.print",function(){console.log(ei.getInfo())}),eo.on("click",".btn-download",function(){er.emit("startaudiorendering","wav")}),eo.on("click",".btn-seektotime",function(){var t=parseInt(document.getElementById("seektime").value,10);er.emit("select",t,t)}),eo.on("change",".select-seek-style",function(t){ei.setSeekStyle(t.target.value)}),eo.on("change","#fileInput",function(t){for(var e=this.files,i=0;i<e.length;i++)er.emit("newtrack",e[i])}),eo.on("dragenter",".track-drop",function(t){t.preventDefault(),t.target.classList.add("drag-enter")}),eo.on("dragover",".track-drop",function(t){t.preventDefault()}),eo.on("dragleave",".track-drop",function(t){t.preventDefault(),t.target.classList.remove("drag-enter")}),eo.on("drop",".track-drop",function(t){t.preventDefault(),t.target.classList.remove("drag-enter");for(var e=t.originalEvent,i=0;i<e.dataTransfer.files.length;i++)er.emit("newtrack",e.dataTransfer.files[i])}),eo.on("change",".time-format",function(t){eh=el.val(),er.emit("durationformat",eh),ew(ep,ef),eE(em)}),eo.on("input change",".master-gain",function(t){er.emit("mastervolumechange",t.target.value)}),eo.on("change",".continuous-play",function(t){er.emit("continuousplay",$(t.target).is(":checked"))}),eo.on("change",".link-endpoints",function(t){er.emit("linkendpoints",$(t.target).is(":checked"))}),eo.on("change",".automatic-scroll",function(t){er.emit("automaticscroll",$(t.target).is(":checked"))}),er.on("select",ew),er.on("timeupdate",eE),er.on("mute",function(t){eP("Mute button pressed for "+t.name,t)}),er.on("solo",function(t){eP("Solo button pressed for "+t.name,t)});let eC=null;er.on("volumechange",function(t,e){eP(e.name+" now has volume "+t+"."),clearTimeout(eC),eC=setTimeout(()=>{eS(e)},500)});let eO=null;er.on("stereopan",function(t,e){eP(e.name+" now has stereo pan "+t+"."),clearTimeout(eO),eO=setTimeout(()=>{eS(e)},500)}),er.on("mastervolumechange",function(t){eP("Master volume now has volume "+t+".")});var eA=["uninitialized","loading","decoding","finished"];er.on("audiorequeststatechange",function(t,e){var i=e;e instanceof File&&(i=e.name),e_("Track "+i+" is in state "+eA[t])}),er.on("loadprogress",function(t,e){var i=e;e instanceof File&&(i=e.name),e_("Track "+i+" has loaded "+t+"%")}),er.on("audiosourcesloaded",function(){e_("Tracks have all finished decoding.")});let eI=null;er.on("audiosourcesrendered",function(t){if(et){if(t){eI=t;let e=ei.tracks.length-1,i=ei.tracks[e];i&&!i?.customClass&&(eI=null,en.displayOptMenuForNewTrack(t))}else if(eI){let t=eI;eI=null,en.displayOptMenuForNewTrack(t)}}e_("Tracks have been rendered")}),er.on("audiosourceserror",function(t){e_(t.message)}),er.on("audiorenderingfinished",function(t,e,i){if(i>=0&&et)e.name="audio",e.fileName=Date.now()+".wav",es.sendData(e,"blob");else if("wav"==t){var n,s;eg&&window.URL.revokeObjectURL(eg),s=$("<a/>",{href:eg=window.URL.createObjectURL(e),download:"waveformplaylist"+(n=new Date().toISOString())+".wav",text:"Download mix "+n,class:"btn btn-small btn-download-link"}),$(".btn-download-link").remove(),$(".btn-download").after(s)}}),er.on("finished",function(){console.log("The cursor has reached the end of the selection !"),$(".btn-group .btn-record").prop("disabled",!1),ev&&i.then(function(){i=ei.play(ep,ef)})});
//# sourceMappingURL=composition.42fc22df.js.map
