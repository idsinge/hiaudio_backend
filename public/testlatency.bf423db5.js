parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"goMX":[function(require,module,exports) {
"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var s=0;s<t.length;s++){var a=t[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,i(a.key),a)}}function a(e,t,a){return t&&s(e.prototype,t),a&&s(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function i(t){var s=r(t,"string");return"symbol"===e(s)?s:String(s)}function r(t,s){if("object"!==e(t)||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var i=a.call(t,s||"default");if("object"!==e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===s?String:Number)(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.latencyMeasurer=void 0;var n={measure_average_loudness_for_1_sec:0,playing_and_listening:1,waiting:2,passthrough:3,idle:4};function h(e,t,s){for(var a=0,i=0;i<s;i++)a+=Math.abs(e[i])+Math.abs(t[i]);return a}var u=function(){function e(){t(this,e),this.measurementState=this.nextMeasurementState=n.idle,this.samplesElapsed=this.sineWave=this.sum=this.threshold=this.state=this.samplerate=this.latencyMs=this.buffersize=0,this.roundTripLatencyMs=new Array(10).fill(0)}return a(e,[{key:"toggle",value:function(){-1==this.state||this.state>0&&this.state<11?(this.state=0,this.nextMeasurementState=n.idle):(this.state=1,this.samplerate=this.latencyMs=this.buffersize=0,this.nextMeasurementState=n.measure_average_loudness_for_1_sec)}},{key:"togglePassThrough",value:function(){-1!=this.state?(this.state=-1,this.nextMeasurementState=n.passthrough):(this.state=0,this.nextMeasurementState=n.idle)}},{key:"processInput",value:function(e,t,s,a){switch(this.rampdec=-1,this.samplerate=s,this.buffersize=a,this.nextMeasurementState!=this.measurementState&&(this.nextMeasurementState==n.measure_average_loudness_for_1_sec&&(this.samplesElapsed=0),this.measurementState=this.nextMeasurementState),this.measurementState){case n.measure_average_loudness_for_1_sec:if(this.sum+=h(e,t,a),this.samplesElapsed+=a,this.samplesElapsed>=this.samplerate){var i=this.sum/(this.samplesElapsed>>1),r=20*Math.log10(i)+24;this.threshold=Math.pow(10,r/20),this.measurementState=this.nextMeasurementState=n.playing_and_listening,this.sineWave=0,this.samplesElapsed=0,this.sum=0}break;case n.playing_and_listening:var u=h(e,t,a)/a;if(this.rampdec=0,u>this.threshold){for(var l=0,o=0;l<a&&!(e[o]>this.threshold)&&!(t[o++]>this.threshold);)l++;if(this.samplesElapsed+=l,this.samplesElapsed>a){this.roundTripLatencyMs[this.state-1]=1e3*this.samplesElapsed/this.samplerate;var m=0,p=1e5;for(l=0;l<this.state;l++)this.roundTripLatencyMs[l]>m&&(m=this.roundTripLatencyMs[l]),this.roundTripLatencyMs[l]<p&&(p=this.roundTripLatencyMs[l]),this.sum+=this.roundTripLatencyMs[l];m/p>2?(this.latencyMs=0,this.state=10,this.measurementState=this.nextMeasurementState=n.idle):10==this.state?(this.latencyMs=parseInt(.1*this.sum),this.measurementState=this.nextMeasurementState=n.idle):(this.latencyMs=parseInt(this.roundTripLatencyMs[this.state-1]),this.measurementState=this.nextMeasurementState=n.waiting),this.state++}else this.measurementState=this.nextMeasurementState=n.waiting;this.rampdec=1/a}else this.samplesElapsed+=a,this.samplesElapsed>this.samplerate&&(this.rampdec=1/a,this.measurementState=this.nextMeasurementState=n.waiting,this.latencyMs=-1);break;case n.passthrough:case n.idle:break;default:this.samplesElapsed+=a,this.sum=0,this.samplesElapsed>this.samplerate&&(this.samplesElapsed=0,this.measurementState=this.nextMeasurementState=n.measure_average_loudness_for_1_sec)}}},{key:"processOutput",value:function(e,t){if(this.measurementState!=n.passthrough)if(this.rampdec<0)for(var s=2*this.buffersize,a=0;s--;)e[a]=t[a++]=0;else for(var i=1,r=2*Math.PI*1e3/this.samplerate,h=this.buffersize,u=0;h--;)e[u]=t[u++]=Math.sin(r*this.sineWave)*i,i-=this.rampdec,this.sineWave+=1}}]),e}();exports.latencyMeasurer=u;
},{}],"ylGr":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LATENCY=void 0;var e=require("./latencyMeasurer.js");function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=o(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){l=!0,i=e},f:function(){try{u||null==n.return||n.return()}finally{if(l)throw i}}}}function o(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,l(o.key),o)}}function u(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function l(e){var n=s(e,"string");return"symbol"===t(n)?n:String(n)}function s(e,n){if("object"!==t(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var a=o.call(e,n||"default");if("object"!==t(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}var c=null;exports.LATENCY=c;var d=function(){function t(){r(this,t)}return u(t,null,[{key:"initialize",value:function(e){t.audioContext=t.audioNode=null,t.content=document.getElementById("content");var n="function"==typeof AudioWorkletNode?1:0;t.data={device:"?",os:"?",browser:"?",browserVersion:"?",buffersize:n?128:512,samplerate:"?",audioWorklet:n},t.runningon="?",t.displayStart()}},{key:"displayStart",value:function(){null!=t.audioContext&&t.audioContext.close(),t.audioContext=t.audioNode=null,t.content.innerHTML="",t.startbutton=document.createElement("button"),t.startbutton.innerText="TEST LATENCY",t.startbutton.addEventListener("click",t.start),t.content.appendChild(t.startbutton)}},{key:"onAudioInputPermissionDenied",value:function(e){console.log(e)}},{key:"onMessageFromAudioScope",value:function(e){var n=null;e.latencyMs<0?(n="The environment is too loud! Please try it again in a quieter environment.",t.displayResult(n)):11==e.state&&(e.latency<1?(n="The variance is too big. Please try it again in a quieter environment.",t.displayResult(n)):(t.data.ms=e.latency,exports.LATENCY=c=e.latency,n="Result: "+e.latency+" ms",console.log(n),t.displayResult(n)))}},{key:"onAudioSetupFinished",value:function(){t.audioContext.createMediaStreamSource(t.inputStream).connect(t.audioNode),t.audioNode.connect(t.audioContext.destination),console.log("Please wait...");var e=document.createElement("button");e.innerText="CANCEL",e.addEventListener("click",t.displayStart),t.content.appendChild(e),t.startbutton.disabled=!0}},{key:"displayResult",value:function(e){null!=t.audioContext&&t.audioContext.close(),t.audioContext=t.audioNode=null;var n=document.createElement("div"),o=document.createElement("button");o.innerText="TRY AGAIN",o.addEventListener("click",t.displayStart),n.appendChild(o),t.content.innerHTML="",t.content.appendChild(n),alert(e)}},{key:"onAudioPermissionGranted",value:function(o){t.inputStream=o;var a,r=n(o.getAudioTracks());try{for(r.s();!(a=r.n()).done;){a.value.applyConstraints({autoGainControl:!1,echoCancellation:!1,noiseSuppression:!1})}}catch(i){r.e(i)}finally{r.f()}t.latencyMeasurer=new e.latencyMeasurer,t.latencyMeasurer.toggle(),t.lastState=0,t.audioNode=t.audioContext.createScriptProcessor(256,2,2),t.audioNode.onaudioprocess=function(e){t.latencyMeasurer.processInput(e.inputBuffer.getChannelData(0),e.inputBuffer.getChannelData(1),t.data.samplerate,e.inputBuffer.length),t.latencyMeasurer.processOutput(e.outputBuffer.getChannelData(0),e.outputBuffer.getChannelData(1)),t.lastState!=t.latencyMeasurer.state&&(t.lastState=t.latencyMeasurer.state,t.onMessageFromAudioScope({state:t.lastState,latency:t.latencyMeasurer.latencyMs}))},t.onAudioSetupFinished()}},{key:"start",value:function(e){console.log("start...");var n=window.AudioContext||window.webkitAudioContext||!1;t.audioContext=new n({latencyHint:0}),t.data.samplerate=t.audioContext.sampleRate;navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({echoCancellation:!1,disableLocalEcho:!1,autoGainControl:!1,audio:{mandatory:{googAutoGainControl:!1,googAutoGainControl2:!1,googEchoCancellation:!1,googNoiseSuppression:!1,googHighpassFilter:!1,googEchoCancellation2:!1,googNoiseSuppression2:!1,googDAEchoCancellation:!1,googNoiseReduction:!1}},video:!1}).then(t.onAudioPermissionGranted).catch(t.onAudioInputPermissionDenied):t.onAudioInputPermissionDenied("Can't access getUserMedia.")}}]),t}();window.addEventListener("load",d.initialize);
},{"./latencyMeasurer.js":"goMX"}]},{},["ylGr"], null)
//# sourceMappingURL=testlatency.bf423db5.js.map