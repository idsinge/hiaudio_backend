!function(){function t(t,e,n,i){Object.defineProperty(t,e,{get:n,set:i,enumerable:!0,configurable:!0})}function e(t){return t&&t.__esModule?t.default:t}var n,i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},a={},o={},s=i.parcelRequire1e7e;null==s&&((s=function(t){if(t in a)return a[t].exports;if(t in o){var e=o[t];delete o[t];var n={id:t,exports:{}};return a[t]=n,e.call(n.exports,n,n.exports),n.exports}var i=Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(t,e){o[t]=e},i.parcelRequire1e7e=s);var r=s.register;r("72lX3",function(e,n){t(e.exports,"ENDPOINT",function(){return a}),t(e.exports,"UPLOAD_ENDPOINT",function(){return o});let i={PROD:{ENDPOINT:"https://hiaudio.fr",UPLOAD_ENDPOINT:"https://hiaudio.fr/fileUpload"},STAGE:{ENDPOINT:window.location.protocol+"//"+window.location.host,UPLOAD_ENDPOINT:window.location.protocol+"//"+window.location.host+"/fileUpload"},DEV:{ENDPOINT:window.location.protocol+"//"+window.location.host,UPLOAD_ENDPOINT:window.location.protocol+"//"+window.location.host+"/fileUpload"}},a=i.DEV.ENDPOINT,o=i.DEV.UPLOAD_ENDPOINT}),r("lV0Oe",function(e,n){t(e.exports,"default",function(){return i});var i=new class{dynamicModalDialog(t,e,n,i,a,o,s){this.setDynamicModalContent('<div class="modal-header '+o+' text-white"><h5 class="modal-title" id="dynamicModalLabel">'+a+'</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body">'+t+'</div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">'+i+"</button>"+(null!==e?"<button id="+e+' type="button" class="btn btn-primary">'+n+"</button>":"")+"</div>"),this.callbackDismiss=s,$(this.modal).modal("show")}getDynamicModal(){return document.getElementById("dynamicModal")}setDynamicModalContent(t){this.modal.querySelector(".modal-content").innerHTML=t}closeDynamicModal(t){$(this.modal).modal("hide"),t&&t()}initDynamicModal(){let t=document.createElement("div");return t.classList.add("modal","fade"),t.setAttribute("id","dynamicModal"),t.setAttribute("tabindex","-1"),t.setAttribute("role","dialog"),t.setAttribute("aria-labelledby","dynamicModalLabel"),t.setAttribute("aria-hidden","true"),t.innerHTML='<div class="modal-dialog modal-sm modal-dialog-centered" role="document"><div class="modal-content"></div></div>',document.body.appendChild(t),t}constructor(){if(this.modal=this.getDynamicModal(),this.callbackDismiss=null,!this.modal){this.modal=this.initDynamicModal();let t=this;$(this.modal).on("hide.bs.modal",function(e){t.callbackDismiss&&(t.callbackDismiss(),t.callbackDismiss=null)})}}}}),r("7hG31",function(e,n){t(e.exports,"uriUserPage",function(){return a}),t(e.exports,"uriCollectionPage",function(){return o}),t(e.exports,"UserRole",function(){return r}),t(e.exports,"LevelPrivacy",function(){return l}),t(e.exports,"PRIVACY_BADGE_STYLE",function(){return c}),t(e.exports,"PRIVACY_BADGE_TEXT",function(){return d}),t(e.exports,"startLoader",function(){return u}),t(e.exports,"cancelLoader",function(){return h}),t(e.exports,"callJsonApi",function(){return p}),t(e.exports,"looksLikeMail",function(){return m}),t(e.exports,"activateGoHomeLink",function(){return f}),t(e.exports,"MEDIA_CONSTRAINTS",function(){return g});var i=s("72lX3");let a="/index.html?userid=",o="/index.html?collectionid=",r=Object.freeze({none:0,owner:1,admin:2,member:3,guest:4}),l=Object.freeze({public:1,onlyreg:2,private:3}),c={[l.public]:"badge-public",[l.onlyreg]:"badge-onlyreg",[l.private]:"badge-private"},d={[l.public]:"PUBLIC",[l.onlyreg]:"REG USERS",[l.private]:"PRIVATE"},u=t=>{let e=document.getElementById("loader");e.innerHTML=`<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>&nbsp;${t}`,e.classList.remove("loader-hidden")},h=()=>{document.getElementById("loader").classList.add("loader-hidden")},p=async(t,e,n,a)=>{let o={method:e||"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}};n&&(o.body=JSON.stringify(n));try{a&&u(a);let e=await fetch(i.ENDPOINT+t,o);a&&h();let n=await e.json();if(n&&!n.error)return n;return(null==n?void 0:n.error)||"An error occurred"}catch(t){return a&&h(),t}},m=t=>{let e=t.lastIndexOf("@"),n=t.lastIndexOf(".");return e<n&&e>0&&-1==t.indexOf("@@")&&n>2&&t.length-n>2},f=()=>{let t=document.getElementById("goHome");"localhost:80"===window.location.host||"http://localhost"===window.location.origin?t.href=window.location.origin+"/index.html":t.href=window.location.origin};/^((?!chrome|android).)*safari/i.test(navigator.userAgent);let g={audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,latency:0,channelCount:1}}}),r("d2TTa",function(e,n){t(e.exports,"getCollections",function(){return o}),t(e.exports,"getCollectionsError",function(){return r}),t(e.exports,"createListCollections",function(){return l});var i=s("72lX3"),a=s("lV0Oe");let o=async()=>{let t=await fetch(i.ENDPOINT+"/mycollections"),e=null;return(null==t?void 0:t.ok)&&(e=await t.json()),e},r=()=>{(0,a.default).dynamicModalDialog("Problem getting collections",null,"","Close","Error","bg-danger")},l=(t,e,n)=>{let i=t.all_collections,a=document.getElementById(e),o="<option value='0'>...</option>",s=null;i.forEach(t=>{if(t){s=t.uuid===n?"selected>":null;let e=`<option value='${t.uuid}' ${s||">"}${t.title}</option>`;o+=e}});let r=`<select class='custom-select' id='inputGroupSelectCollect'>${o}</select>`;a.insertAdjacentHTML("afterbegin",r)}});var l=s("72lX3"),c=s("lV0Oe"),d=s("7hG31"),l=s("72lX3"),c=s("lV0Oe");let u=null,h=t=>new Promise((e,n)=>{let i=indexedDB.open(t,2);i.onerror=t=>{console.log(t),n(Error("Error opening database"))},i.onsuccess=t=>{let n=t.target.result;u=n,e(n)},i.onupgradeneeded=t=>{let n=t.target.result;u=n;let i=n.createObjectStore("tracks",{keyPath:"track_id"});i.createIndex("composition_id","composition_id",{unique:!1}),i.transaction.oncomplete=t=>{e(n)}}}),p=(t,e)=>{if(t)return new Promise((n,i)=>{let a=t.transaction(["tracks"],"readwrite");a.oncomplete=t=>{n()},a.onerror=t=>{console.log("error",t),i(Error("Error updating database"))},a.objectStore("tracks").put(e)})},m=(t,e)=>new Promise((n,i)=>{t&&e||i(Error("No DB or Comp ID"));let a=[],o=t.transaction("tracks").objectStore("tracks").index("composition_id"),s=IDBKeyRange.only(e);o.openCursor(s).onsuccess=t=>{let e=t.target.result;e?(a.push(e.value),e.continue()):n(a)}});var d=s("7hG31"),l=s("72lX3"),c=s("lV0Oe"),d=s("7hG31"),f=s("d2TTa");let g=null,v=t=>{(0,f.getCollections)().then(e=>{e?b(e,t):(0,f.getCollectionsError)()})},y=t=>{let e=document.getElementById("openSettingsButton");null==e||e.addEventListener("click",()=>{v(t)},!1)},b=(t,e)=>{document.getElementById("listCollContainerNewColl").innerHTML="",(0,f.createListCollections)(t,"listCollContainerNewColl",g||e),(null==t?void 0:t.all_collections.length)&&e&&(g=e)},k=async t=>{let e=document.getElementById("inputGroupSelectCollect");if(e){let n=e.value;(g||"0"!==n)&&n!==g&&await w(t,n)}},w=async(t,e)=>{let n=await tv("PATCH","/updatecompcollection",{uuid:t,collection_id:"0"===e?null:e});(null==n?void 0:n.ok)&&(g=e)},x=null,E=()=>x,T=t=>{x=t,document.getElementById("newtitle").value=t},S=async t=>{let e=document.getElementById("newtitle").value;e!==x&&await C(t,e)},C=async(t,e)=>{(await tv("PATCH","/updatecomptitle",{uuid:t,title:e})).ok&&(x=e,document.getElementById("comp-title").innerHTML=e,document.getElementById("clonetitle").value=e+" (Copy)")},P=null,I=()=>P,_=t=>{P=t,document.getElementById("newdescription").value=t},O=async t=>{let e=document.getElementById("newdescription").value;e!==P&&await A(t,e)},A=async(t,e)=>{(await tv("PATCH","/updatecompdescription",{uuid:t,description:e})).ok&&(P=e,document.getElementById("comp-description").innerHTML=e,document.getElementById("clonedescription").value=e+" (Copy)")},M=null,R=()=>M,L=t=>{M=t,document.getElementById("opentocontribution").checked=t},B=async t=>{let e=document.getElementById("opentocontribution").checked;e!==M&&await N(t,e)},D=t=>{let e=document.getElementById("opentocontribution");0===t?(e.checked=!1,e.disabled=!0):e.disabled=!1},N=async(t,e)=>{if((await tv("PATCH","/updatecomptocontrib",{uuid:t,opentocontrib:e})).ok){if(M=e,e)document.getElementById("privacybadgetext").insertAdjacentHTML("afterend",'&nbsp;<span class="badge badge-light">STATUS:&nbsp;</span><span class="badge badge-info">OPEN TO CONTRIB</span>');else if(document.querySelector(".badge-info")){let t=document.getElementById("privacybadgetext").nextSibling.nextSibling,e=t.nextSibling;t.remove(),e.remove()}}};var d=s("7hG31"),c=s("lV0Oe");let j=t=>{document.getElementById("clonetitle").value=t.title+" (Copy)",document.getElementById("clonedescription").value=t.description+" (Copy)",document.getElementById("btn-clone-container").hidden=!1,document.getElementById("btn-clone-comp").onclick=()=>{$("#cloneMusicModal").modal("show")},document.getElementById("clonecreationbtn").onclick=()=>{G(t)}},G=async t=>{document.getElementById("clonetitle").classList.remove("is-invalid"),document.getElementById("validationclonedtitle").innerText="";let e=document.getElementById("clonetitle").value,n=document.querySelector('input[name="cloneMusicPrivacyRadios"]:checked').value;if(!e){document.getElementById("clonetitle").classList.add("is-invalid"),document.getElementById("validationclonedtitle").innerText="Sorry, title can't be empty";return}let i={title:e,description:document.getElementById("clonedescription").value,privacy_level:n,clone_from:t.uuid},a=await (0,d.callJsonApi)("/clonecomposition","POST",i,"Cloning composition...");a.ok?window.location.href="/composition.html?compositionId="+a.composition.uuid:(0,c.default).dynamicModalDialog(a.msg||a,null,"","Close","Error Cloning","bg-danger")},F=null,U=()=>F,H=t=>{F=t,document.getElementById("markastemplatebtn").checked=t},V=async t=>{let e=document.getElementById("markastemplatebtn").checked;e!==F&&await z(t,e)},z=async(t,e)=>{let n={uuid:t.uuid,is_template:e};(await tv("PATCH","/updatecompastemplate",n)).ok&&(F=e,e?(document.getElementById("btn-clone-container").hidden=!1,j(t)):document.getElementById("btn-clone-container").hidden=!0)};var d=s("7hG31");let W=null,q=()=>W,X=()=>{for(let t of document.getElementsByName("settingsPrivacyRadios"))t.addEventListener("change",function(){this.checked&&(3===parseInt(this.value)?D(0):D(1))})},Y=t=>{W=t,document.getElementById("settingsPrivacyRadios"+t).checked=!0,t===d.LevelPrivacy.private&&D(0)},J=async t=>{let e=parseInt(document.querySelector('input[name="settingsPrivacyRadios"]:checked').value);e!==W&&await K(t,e)},K=async(t,e)=>{if((await tv("PATCH","/updatecompprivacy",{uuid:t,privacy:e})).ok){W=e;let t=document.getElementById("privacybadgetext");t.className="badge "+d.PRIVACY_BADGE_STYLE[e],t.innerText=d.PRIVACY_BADGE_TEXT[e]}};var l=s("72lX3"),c=s("lV0Oe"),d=s("7hG31");let Z=[],Q=[],tt=[],te={1:"Owner",2:"Admin",3:"Member",4:"Guest"},tn=()=>Z,ti=()=>{document.getElementById("contributorinput").value="",document.getElementById("listOfContributors").innerHTML=""},ta=()=>{Q=[],tt=[]},to=t=>{let e=document.getElementById("listOfContributors");t.length?(Z=t,t.flatMap(t=>tr(e,t))):(document.getElementById("contributorinput").value="",e.innerHTML="")},ts=t=>{let e=document.getElementById("addContribButton"),n=document.getElementById("contributorinput"),i=document.getElementById("listOfContributors");e.addEventListener("click",function(){let e=document.getElementById("inputGroupSelectRole").value;document.getElementById("contributorinput").classList.remove("is-invalid"),document.getElementById("validationemailresult").innerText="",n.value&&(0,d.looksLikeMail)(n.value)?tl(i,n.value.trim(),t,e):(document.getElementById("contributorinput").classList.add("is-invalid"),document.getElementById("validationemailresult").innerText="Sorry, invalid email address format.")})},tr=(t,e)=>{let n=te[e.role],i=document.createElement("li");i.className="list-group-item",i.id=e.user_uid,i.textContent=e.email+" ("+n+")";let a=`&nbsp;<div class='custom-control custom-switch custom-control-inline float-right'>
    <input type='checkbox' class='custom-control-input is-invalid' id='removeContSwitch${e.user_uid}'>
    <label class='custom-control-label is-invalid' for='removeContSwitch${e.user_uid}'>Remove</label>
  </div>`;i.innerHTML+=a,t.appendChild(i),tp(e)},tl=async(t,e,n,i)=>{if(0!==parseInt(document.getElementById("inputGroupSelectRole").value)){let a={email:e,user_uid:e,composition_id:n,role:parseInt(i)},o=Z.findIndex(t=>t.email===e),s=Q.findIndex(t=>t.email===e),r=tt.indexOf(e);r>-1&&tt.splice(r,1);if(s<0&&o<0||td(a,s,o,t)){let n=await fetch(l.ENDPOINT+"/checkuser/"+e);if((null==n?void 0:n.ok)||(null==n?void 0:n.status)===404){if((null==n?void 0:n.status)===200){let t=await n.json();a.user_uid=t.user_uid}Q.push(a),tr(t,a),(null==n?void 0:n.status)===404&&tc("An invitation via email will be sent to: "+e+", after clicking on the button Confirm")}else tc("User can't be added")}else tc("Duplicate user")}},tc=t=>{(0,c.default).dynamicModalDialog(t,null,"","Close","Warning!","bg-warning")},td=(t,e,n,i)=>{var a,o;let s=!1,r=(null===(a=Z[n])||void 0===a?void 0:a.user_uid)||(null===(o=Q[e])||void 0===o?void 0:o.user_uid),l=document.getElementById(r);return l&&(n>=0&&e<0&&Z[n].role!==t.role&&(s=!0,l.remove()),e>=0&&n<0&&Q[e].role!==t.role&&(s=!0,Q.splice(e,1),l.remove()),e>=0&&n>=0&&(Z[n].role===t.role&&(Q.splice(e,1),l.remove(),tr(i,t)),Q.length&&Q[e].role!==t.role&&(s=!0,Q.splice(e,1),l.remove()))),s},tu=async()=>{if(Q.length>0){let t=[...Q];for(let e=0;e<Q.length;e++){let n=Q[e],i=await tv("POST","/addcontributorbyemail",n);(null==i?void 0:i.ok)&&(Q[e].id=i.contribid,n.email===n.user_uid&&(Q[e].user_uid=i.uuid,document.getElementById(n.email).id=i.uuid),t[e]=null)}let e=t.filter(t=>null!=t);Z=Z.concat(Q),document.getElementById("contributorinput").value="",Q=e}},th=async t=>{if(tt.length>0){let e=[...tt];for(let n=0;n<tt.length;n++){let i=Z.findIndex(t=>t.email===tt[n]),a=Z[i].user_uid,o={contrib_uuid:a,comp_uuid:t},s=await tv("DELETE","/deletecontributor",o);(null==s?void 0:s.ok)?(e[n]=null,Z.splice(i,1),document.getElementById(a).remove()):document.getElementById("removeContSwitch"+a).checked=!1}tt=e.filter(t=>null!=t)}},tp=t=>{document.getElementById("removeContSwitch"+t.user_uid).addEventListener("change",function(e){let n=e.target;"INPUT"===n.tagName&&"checkbox"===n.type&&n.checked&&((0,c.default).dynamicModalDialog(`Do you want remove the contributor: ${t.email}?`,"btn-delete-contributor","OK","Cancel","Delete Contributor","bg-warning",()=>{n.checked=!1}),document.getElementById("btn-delete-contributor").onclick=async()=>{let e=Q.findIndex(e=>e.email===t.email);e>-1?(Q.splice(e,1),-1===Z.findIndex(e=>e.email===t.email)?document.getElementById(t.user_uid).remove():tt.push(t.email)):tt.push(t.email),(0,c.default).closeDynamicModal(()=>{n.checked=!0})})})},tm=()=>{let t=document.getElementById("contributorsbadgetext");if(t||Z.length){let e=document.getElementById("rolebadgetext");if(t){if(Z.length!==parseInt(t.innerText)){if(Z.length)t.innerText=Z.length;else{let n=t.previousSibling;t.remove(),n.remove(),e.nextSibling.remove()}}}else if(e){let t=`&nbsp;<span class="badge badge-light">COLLABORATORS:&nbsp;</span><span id="contributorsbadgetext" class="badge badge-dark">${Z.length}</span>`;e.insertAdjacentHTML("afterend",t)}}},tf=t=>{t.user_isadmin&&!t.cloned_from&&(document.getElementById("form-group-marktemplate").hidden=!1),to(t.contributors),ts(t.uuid),T(t.title),_(t.description),Y(t.privacy),L(t.opentocontrib),H(t.is_template),tk(t),tb(t),tg(),X(),t.cloned_from?document.getElementById("listCollContainerNewColl").innerHTML=t.parent_collection?`<h5><span class="badge badge-secondary">${t.parent_collection}</span></h5>`:"":y(null==t?void 0:t.collection_id)},tg=()=>{(0,d.cancelLoader)();let t=document.getElementById("useroptions"),e=document.createElement("li");e.innerHTML=`<li class="nav-item">
    <a class="nav-link" href="#" id="openSettingsButton" data-toggle="modal" data-target="#settingsModal">Composition Info</a>
  </li>
   `,t.appendChild(e)},tv=async(t,e,n)=>{let i=JSON.stringify(n),a=null;try{let n=await fetch(l.ENDPOINT+e,{method:t,headers:{"Content-Type":"application/json",Accept:"application/json"},body:i}),o=await n.json();o&&(a=o)}catch(t){(0,c.default).dynamicModalDialog(t,null,"","Close","Error","bg-danger")}return a},ty=t=>{T(E()||t.title),_(I()||t.description),Y(q()||t.privacy),L(R()||t.opentocontrib),H(U()||t.is_template),ti(),to(tn().length?tn():t.contributors),ta(),document.getElementById("deleteComposition").checked=!1},tb=t=>{let e=document.getElementById("cancelsettingsbutton");null==e||e.addEventListener("click",()=>{ty(t)})},tk=async t=>{let e=t.uuid,n=document.getElementById("updatecompositionbutton");null==n||n.addEventListener("click",async n=>{(0,d.startLoader)("Updating Settings..."),!0===document.getElementById("deleteComposition").checked?await tw(e):(await S(e),await O(e),await J(e),await B(e),await V(t),await tu(),await th(e),await k(e),tm(),$("#settingsModal").modal("hide")),(0,d.cancelLoader)()})},tw=async t=>{(0,c.default).dynamicModalDialog("Delete "+E()+"?","btn-delete-composition","OK","Cancel","Delete Composition","bg-danger"),document.getElementById("btn-delete-composition").onclick=async()=>{(await tv("DELETE","/deletecomposition/"+t,null)).ok&&(window.location.href=window.location.origin),(0,c.default).closeDynamicModal()}};function tx(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function tE(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),i.forEach(function(e){tx(t,e,n[e])})}return t}var d=s("7hG31"),c=s("lV0Oe");let tT=!1,tS=null,tC=null,tP=null,tI=null,t_=["bit_rate","bits_per_sample","channel_layout","channels","codec_long_name","codec_name","duration","format_long_name","format_name","probe_score","sample_rate","sample_fmt","uploading_date","RMS","size"],tO=document.getElementById("edittrackinfobutton"),tA=document.getElementById("btn-add-new-annot"),tM=document.getElementById("trackinfo-modal-footer"),tR=()=>{tK(),tX(),tD(),tO.addEventListener("click",tQ,!1)},tL=async(t,e,n,i)=>{tT=!1,tC=t,tP=n,tO.innerText="Edit",(0,d.startLoader)("Loading track info...");let a=await (0,d.callJsonApi)("/getinfotrack/"+n,"GET");tB(i),"object"==typeof a?(tS=a,tH(a,null)):((0,c.default).dynamicModalDialog("Error getting track info",null,"","Close","Error","bg-danger"),tH(null,e))},tB=t=>{t!==d.UserRole.owner&&t!==d.UserRole.admin?(tO.hidden=!0,tA.hidden=!0,tM.hidden=!0):(tO.hidden=!1,tA.hidden=!1,tM.hidden=!1)},tD=()=>{tA.onclick=()=>{let t=Date.now(),e=document.getElementById("trackinfotablebody"),n=`<tr class="linebreak"><th id='key-edit-${t}' contenteditable='true' scope='row'></th>
        <td contenteditable='true' data-key=''></td>
        <td id='btn-rem-${t}' class='delete-row' data-key=''>&nbsp;<i class="fa fa-trash text-danger"></i></td>
        </tr>`;e.innerHTML+=n,tT||tO.click();let i=document.getElementById("key-edit-"+t);i.addEventListener("input",function(){i.parentNode.children[1].dataset.key=i.innerText,i.parentNode.children[2].dataset.key=i.innerText});let a=document.getElementById("btn-rem-"+t);a.onclick=()=>{tz(a)}}},tN=t=>{let e="";return t.title&&(e+=`<tr><th scope='row'>title</th><td contenteditable='false' data-key='title'>${t.title}</td></tr>`),e},t$=(t,e)=>{let n=[];return e.forEach(e=>{t.some(t=>t.key===e)||n.push(e)}),n},tj=t=>{let e="";for(let n in t)"title"!==t[n]&&(e+=`<tr><th scope='row'>${t[n]}</th><td contenteditable='false' data-key='${t[n]}'></td></tr>`);return e},tG=t=>{let e="";return t.annotations&&(e+=tj(t$(t.annotations,tI))+tV(t.annotations)),e},tF=t=>{let e=`<tr><th scope='row'>track_uuid</th><td data-key='track_uuid'>${tP}</td></tr>`;if(t.file_metadata){let n=t.file_metadata;for(let t of t_)e+=`<tr><th scope='row'>${t}</th><td data-key='${t}'>${n[t]}</td></tr>`}return e},tU=t=>t.reserved_keys?t.reserved_keys:null,tH=async(t,e)=>{(0,d.cancelLoader)();let n=document.getElementById("trackinfotablebody"),i=document.getElementById("metadatatablebody"),a="",o="";t?(document.getElementById("audio-pending-analysis").hidden=null==t?void 0:t.is_audio_processed,tI=tU(t),a+=tN(t)+tG(t),o+=tF(t)):a+=`<tr><th scope='row'>title</th><td data-key='title' class='linebreak'>${e}</td></tr>`,n.innerHTML=a,i.innerHTML=o},tV=t=>{let e="";for(let n in t){let i=t[n];e+=`<tr class="linebreak"><th ${i.custom_added?"contenteditable='false'":""} scope='row'>${i.key}</th>
        <td contenteditable='false' data-key='${i.key}' data-uuid='${i.uuid}'>${i.value}</td>
        <td class='delete-row' data-key='${i.key}' data-uuid='${i.uuid}' hidden>${i.custom_added?'&nbsp;<i class="fa fa-trash text-danger"></i>':""}</td>
        </tr>`}return e},tz=t=>{(0,c.default).dynamicModalDialog("Delete: <b>"+t.dataset.key+"</b> ?","btn-delete-row","Delete","Cancel","Warning","bg-warning"),document.getElementById("btn-delete-row").onclick=()=>{tW(t)}},tW=async t=>{let e=t.dataset.uuid;e?"object"==typeof await (0,d.callJsonApi)("/deleteannotation/"+e,"DELETE")&&t.parentNode.remove():t.parentNode.remove(),(0,c.default).closeDynamicModal()},tq=()=>{document.getElementById("trackinfotablebody").innerHTML=""},tX=()=>{let t=document.getElementById("canceltrackinfobutton");null==t||t.addEventListener("click",()=>{tq()})},tY=t=>{let e=t.getAttribute("data-uuid"),n=t.getAttribute("data-key"),i=t.innerText,a=tS.annotations.find(t=>t.uuid===e),o={};return!e||tI.includes(a.key)||tI.includes(n)||a.key===n||(o.key=n),a.value!==i&&(o.value=i),Object.keys(o).length>0&&(o.uuid=e),o},tJ=()=>{let t={};return t.annotations=[],document.querySelectorAll("td[contenteditable]").forEach(e=>{if(e.getAttribute("data-uuid")){let n=tY(e);Object.keys(n).length>0&&t.annotations.push(n)}else{let n=e.getAttribute("data-key");"title"===n?tS[n]!==e.innerText&&(t[n]=e.innerText):""===e.innerText&&(""===n||tI.includes(n))||(t.annotations||(t.annotations=[]),t.annotations.push({key:n,value:e.innerText}))}}),t},tK=async()=>{let t=document.getElementById("updatetrackinfobutton");null==t||t.addEventListener("click",async t=>{let e=tJ();if(e.title||e.annotations.length>0){(0,d.startLoader)("Updating track info...");let t={trackid:tP};tZ(await (0,d.callJsonApi)("/updatetrackinfo","PATCH",tE({},e,t)),e),(0,d.cancelLoader)()}$("#trackInfoModal").modal("hide")})},tZ=(t,e)=>{if("object"==typeof t&&t.ok){if(null==e?void 0:e.title){nH.tracks[tC].name=e.title;let t=document.querySelectorAll(`[data-track-id='${tP}']`);1===t.length&&(t[0].dataset.name=e.title),nH.getEventEmitter().emit("updateview")}}else if((null==t?void 0:t.errors)||"string"==typeof t){let e="";t.errors?t.errors.forEach(t=>{e+=t+". "}):e=t,(0,c.default).dynamicModalDialog("Error updating track info: "+e,null,"","Close","Error","bg-danger")}else(0,c.default).dynamicModalDialog("Unexpected error happened when updating track info",null,"","Close","Error","bg-danger")},tQ=()=>{tT?(tT=!1,tO.innerText="Edit",t1()):(tT=!0,tO.innerText="Done",t0())},t0=()=>{document.querySelectorAll("*[contenteditable='false']").forEach(t=>{if(t.contentEditable=!0,t.classList.add("italic"),"TH"===t.tagName){t.addEventListener("input",function(){t.parentNode.children[1].dataset.key=t.innerText});let e=t.parentNode.lastElementChild;e.classList.contains("delete-row")&&(e.hidden=!1,e.onclick=()=>{tz(e)})}})},t1=()=>{document.querySelectorAll("*[contenteditable='true']").forEach(t=>{if(t.contentEditable=!1,t.classList.remove("italic"),"TH"===t.tagName){let e=t.parentNode.lastElementChild;e.classList.contains("delete-row")&&(e.hidden=!0)}})},t2=null,t3=0;function t4(t,e,n,i,a,o,s){this.id=t,this.name=e,this.src=l.ENDPOINT+"/trackfile/"+t,this.muted=n,this.soloed=i,this.gain=a,this.stereoPan=o,this.customClass=s}let t6=(t,e,n)=>{let i=null,a={};fetch(l.ENDPOINT+"/composition/"+t,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}}).then(t=>(t.ok||(i=t.statusText),t.json())).then(e=>{e&&"demopage"!==t&&(a=e)}).catch(t=>{i=t}).then(()=>{i&&(0,c.default).dynamicModalDialog(i,null,"","Close","Error","bg-danger"),e(a,n)})},t7=t=>{(0,d.cancelLoader)(),u?t9(u,t):h(t.viewer_id||"null").then(e=>{t9(e,t)})},t9=(t,e)=>{let n=null;m(t,null==e?void 0:e.uuid).then(t=>{n=t}).catch(t=>{console.log(t)}).finally(()=>{et(e,n),ec(e)})},t5=t=>{let e={};return t.forEach(t=>{e[t.track_id]=t}),e},t8=(t,e,n)=>{let i=!!n&&!!n[null==t?void 0:t.uuid]&&n[t.uuid].muted,a=!!n&&!!n[null==t?void 0:t.uuid]&&n[t.uuid].soloed,o=n&&n[null==t?void 0:t.uuid]?n[t.uuid].gain:1,s=n&&n[null==t?void 0:t.uuid]?n[t.uuid].stereoPan:0,r=t.title,l={name:r,track_id:t.uuid,user_id:t.user_id,user_uid:t.user_uid,composition_id:e.uuid,viewer_id:e.viewer_id||"null"};return new t4(t.uuid,r,i,a,o,s,l)},et=(t,e)=>{document.getElementById("fileInput").accept=[".mp3",".wav",".m4a",".flac",".aac"];let n=t.owner||d.UserRole.owner<=t.role&&t.role<=d.UserRole.member||!1,i=t.role;t2=t.viewer_id;let a=null;if(t2&&t.is_template&&j(t),(null==e?void 0:e.length)&&(a=t5(e)),n&&(nH.controls.widgets.remove=!1,nF(!0),i===d.UserRole.owner&&(document.getElementById("download-mix-btn").hidden=!1,tf(t))),t.tracks){let e=[];t.tracks.length&&(t3=t.tracks.length,document.getElementById("download-progress-elems").hidden=!1,t.tracks.forEach(n=>{if(n){let i=t8(n,t,a);e.push(i)}})),ee(e,n,i)}else nH.initExporter()},ee=(t,e,n)=>{let i=null;nH.load(t).then(()=>{nH.initExporter()}).catch(t=>{i=t}).then(()=>{i?alert(i):e&&(tR(),nV.detectClickOutsideMenuOpt(),nV.displayOptMenuForTracks(n))})},en=t=>`<span class="badge badge-light">OWNER:&nbsp;</span>
            <i class="fa fa-user"></i>&nbsp;
            <a href="${d.uriUserPage+t.user_id}" class="card-url">${t.username}&nbsp;</a>`,ei=t=>`${t.role?`<span class="badge badge-light">YOUR ROLE:&nbsp;</span>
        <span id="rolebadgetext" class="badge badge-success">
         ${te[t.role]}
        </span>&nbsp;`:""}`,ea=t=>`${t.contributors.length?`<span class="badge badge-light">COLLABORATORS:&nbsp;</span>
        <span id="contributorsbadgetext" class="badge badge-dark">
        ${t.contributors.length}</span>&nbsp;`:""}`,eo=t=>`${t.opentocontrib?'<span class="badge badge-light">STATUS:&nbsp;</span><span class="badge badge-info">OPEN TO CONTRIB</span>':""}`,es=t=>{let e=t.description||"";return`<p>
                <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseDescription" aria-expanded="false">
                Description
                </button>
            </p>
            <div class="collapse" id="collapseDescription">
                <div class="card card-body" id="comp-description">
                ${e}
                </div>
            </div>`},er=t=>`<span class="badge badge-light">PRIVACY:&nbsp;</span>
            <span id="privacybadgetext" class="badge 
            ${d.PRIVACY_BADGE_STYLE[t.privacy]}">${d.PRIVACY_BADGE_TEXT[t.privacy]}
            </span>&nbsp;`,el=t=>`${t.collection_id?`<span class="badge badge-light">COLLECTION:&nbsp;</span>
    <i class="fa fa-th-list"></i>&nbsp;
    <a href="${d.uriCollectionPage+t.collection_id}" class="card-url">${t.parent_collection}&nbsp;</a>`:""}`,ec=t=>{let e=`<br><h1 class="post-title">${t.error||"Test DAW"}</h1>`;t.title&&(e="<br>"+en(t)+el(t)+"<br>"+ei(t)+ea(t)+er(t)+eo(t)+`<p><h2 id="comp-title" class="post-title">${t.title}</h2></p>`+es(t)),document.getElementById("post-header").insertAdjacentHTML("afterbegin",e)};class ed{displayOptMenuForNewTrack(t){var e,n;let i=t.result,a=(null==i?void 0:null===(e=i.message)||void 0===e?void 0:e.audio)||(null==i?void 0:null===(n=i.message)||void 0===n?void 0:n.voice),o=a.title||i.message.date,s=a.file_unique_id,r=document.getElementsByClassName("controls"),l=0,c=!1;for(;!c&&l<nH.tracks.length;)nH.tracks[l].trackuid===t.trackuid?c=!0:l++;if(c){let t={name:o,track_id:s,user_id:a.user_id,user_uid:a.user_uid,composition_id:a.composition_id};nH.tracks[l].customClass=t,this.createMenuOptButton(r,l,o,s,d.UserRole.owner)}}displayOptMenuForTracks(t){var e;document.querySelectorAll(".menuoptbtn").length&&document.querySelectorAll(".menuoptbtn").forEach(t=>t.remove());let n=document.getElementsByClassName("controls"),i=nH.getInfo().tracks;for(let a=0;a<i.length;a++)if(null===(e=i[a])||void 0===e?void 0:e.customClass){let e=t;t===d.UserRole.member&&i[a].customClass.user_uid===t2&&(e=d.UserRole.owner);let o=i[a].customClass.name,s=i[a].customClass.track_id;this.createMenuOptButton(n,a,o,s,e)}}createMenuOptButton(t,e,n,i,a){let o="menuoptbtn-"+e,s="menuDropdown"+e,r=document.createElement("button"),l=document.createTextNode("...");r.className="menuoptbtn",r.onclick=()=>{document.getElementById(s).classList.toggle("dropdown-show")},r.id=o,r.appendChild(l),t[e].appendChild(r);let c=this.createListMenuOpt(s,e,n,i,a);document.getElementById(o).appendChild(c),t[e].getElementsByClassName("track-header")[0].getElementsByTagName("span")[0].style["margin-left"]="3em"}createListMenuOpt(t,e,n,i,a){let o=document.createElement("ul");if(o.id=t,o.className="dropdown-menu",a===d.UserRole.owner||a===d.UserRole.admin){let t=this.createDeleteMenuOpt(e,n,i),a=this.createDownloadMenuOpt(i);o.appendChild(t),o.appendChild(a)}let s=this.createTrackInfoMenuOpt(e,n,i,a);return o.appendChild(s),o}createDeleteMenuOpt(t,e,n){let i=document.createElement("li");return i.className="dropdown-item btn-light",i.dataset.pos=t,i.dataset.name=e,i.dataset.trackId=n,i.onclick=t=>{this.deleteTrackConfirmDialog(t,this.sendDeleteRequest,this.doAfterDeleted)},i.appendChild(document.createTextNode("Delete")),i}createDownloadMenuOpt(t){let e=document.createElement("li");return e.className="dropdown-item btn-light",e.dataset.trackId=t,e.onclick=e=>{window.open(window.location.protocol+"//"+window.location.host+"/trackfile/"+t,"_blank")},e.appendChild(document.createTextNode("Download")),e}createTrackInfoMenuOpt(t,e,n,i){let a=document.createElement("li");return a.className="dropdown-item btn-light",a.dataset.target="#trackInfoModal",a.dataset.toggle="modal",a.onclick=a=>{tL(t,e,n,i)},a.appendChild(document.createTextNode("Track Info")),a}detectClickOutsideMenuOpt(){window.onclick=function(t){let e=document.getElementsByClassName("dropdown-menu dropdown-show");e.length>0&&"menuoptbtn"!==t.target.className?Array.from(e).forEach(function(t){t.className="dropdown-menu"}):e.length>1&&Array.from(e).forEach(function(e){t.target.contains(e)||(e.className="dropdown-menu")})}}deleteTrackConfirmDialog(t,e,n){(0,c.default).dynamicModalDialog(`Delete <span class="breakword"><i>${t.target.dataset.name}</i></span> ?`,"btn-delete-track","OK","Cancel","Delete Track","bg-danger"),document.getElementById("btn-delete-track").onclick=()=>{e(t.target.dataset.pos,t.target.dataset.trackId,n),(0,c.default).closeDynamicModal()}}sendDeleteRequest(t,e,n){(0,d.startLoader)("Deleting track..."),fetch(l.ENDPOINT+"/deletetrack/"+e,{method:"DELETE"}).then(t=>t.json()).then(e=>{n(e,t)}).catch(t=>{console.log(t),(0,d.cancelLoader)()})}doAfterDeleted(t,e){if((0,d.cancelLoader)(),t.ok){let n=t.role,i=nH.tracks;nH.getEventEmitter().emit("removeTrack",i[e]),new ed().displayOptMenuForTracks(n)}}}var l=s("72lX3"),c=s("lV0Oe");class eu{sendData(t,e,n){let i=this,a=new XMLHttpRequest,o=new FormData,s=e?t.fileName:t.name;o.append("composition_id",this.compositionId),o.append("audio",t,s);let r=`<div id='${"progress-elem-"+n}'>${s}<br><progress id='upload-progress-bar-${n}'></progress>&nbsp;<span id='upload-percentage-${n}'></span><br/></div>`,c=document.getElementById("upload-progress-bar-container");c.innerHTML+=r,a.addEventListener("load",t=>{if(t.target&&t.target.response){let e=JSON.parse(t.target.response);fileInput.value="",e.ok?(e.trackuid=n,nV.displayOptMenuForNewTrack(e)):i.displayModalDialog(e.error)}else i.displayModalDialog("Oops! Something went wrong.")}),a.addEventListener("error",t=>{i.displayModalDialog("Problem sending file")}),a.upload.addEventListener("progress",t=>{let e=document.getElementById("progress-elem-"+n),i=document.getElementById("upload-progress-bar-"+n),a=document.getElementById("upload-percentage-"+n);t.lengthComputable&&(i.value=t.loaded/t.total,a.innerText=(t.loaded/t.total*100).toFixed(2)+"%",1===i.value&&e.remove())}),a.open("POST",l.UPLOAD_ENDPOINT),a.send(o)}displayModalDialog(t){(0,c.default).dynamicModalDialog(t,null,"","Close","Error","bg-danger")}constructor(t,e){this.compositionId=t,this.trackhandler=e}}var eh={};eh=(()=>{var t={6824:t=>{var e,n,i;/*!
 * Cross-Browser Split 1.1.1
 * Copyright 2007-2012 Steven Levithan <stevenlevithan.com>
 * Available under the MIT License
 * ECMAScript compliant, uniform cross-browser split method
 */t.exports=(n=String.prototype.split,i=/()??/.exec("")[1]===e,function(t,a,o){if("[object RegExp]"!==Object.prototype.toString.call(a))return n.call(t,a,o);var s,r,l,c,d=[],u=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.extended?"x":"")+(a.sticky?"y":""),h=0,a=RegExp(a.source,u+"g");for(t+="",i||(s=RegExp("^"+a.source+"$(?!\\s)",u)),o=o===e?4294967295:o>>>0;(r=a.exec(t))&&(!((l=r.index+r[0].length)>h)||(d.push(t.slice(h,r.index)),!i&&r.length>1&&r[0].replace(s,function(){for(var t=1;t<arguments.length-2;t++)arguments[t]===e&&(r[t]=e)}),r.length>1&&r.index<t.length&&Array.prototype.push.apply(d,r.slice(1)),c=r[0].length,h=l,!(d.length>=o)));)a.lastIndex===r.index&&a.lastIndex++;return h===t.length?(c||!a.test(""))&&d.push(""):d.push(t.slice(h)),d.length>o?d.slice(0,o):d})},1804:(t,e,n)=>{var i=n(5618),a=n(7205),o=n(7191),s=n(5516),r=n(9981);(t.exports=function(t,e){var n,a,l,c,d;return arguments.length<2||"string"!=typeof t?(c=e,e=t,t=null):c=arguments[2],i(t)?(n=r.call(t,"c"),a=r.call(t,"e"),l=r.call(t,"w")):(n=l=!0,a=!1),d={value:e,configurable:n,enumerable:a,writable:l},c?o(s(c),d):d}).gs=function(t,e,n){var l,c,d,u;return"string"!=typeof t?(d=n,n=e,e=t,t=null):d=arguments[3],i(e)?a(e)?i(n)?a(n)||(d=n,n=void 0):n=void 0:(d=e,e=n=void 0):e=void 0,i(t)?(l=r.call(t,"c"),c=r.call(t,"e")):(l=!0,c=!1),u={get:e,set:n,configurable:l,enumerable:c},d?o(s(d),u):u}},430:t=>{t.exports=function(){}},7191:(t,e,n)=>{t.exports=n(6560)()?Object.assign:n(7346)},6560:t=>{t.exports=function(){var t,e=Object.assign;return"function"==typeof e&&(e(t={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),t.foo+t.bar+t.trzy==="razdwatrzy")}},7346:(t,e,n)=>{var i=n(5103),a=n(2745),o=Math.max;t.exports=function(t,e){var n,s,r,l=o(arguments.length,2);for(s=1,t=Object(a(t)),r=function(i){try{t[i]=e[i]}catch(t){n||(n=t)}};s<l;++s)e=arguments[s],i(e).forEach(r);if(void 0!==n)throw n;return t}},6914:(t,e,n)=>{var i=n(430)();t.exports=function(t){return t!==i&&null!==t}},5103:(t,e,n)=>{t.exports=n(7446)()?Object.keys:n(6137)},7446:t=>{t.exports=function(){try{return Object.keys("primitive"),!0}catch(t){return!1}}},6137:(t,e,n)=>{var i=n(6914),a=Object.keys;t.exports=function(t){return a(i(t)?Object(t):t)}},5516:(t,e,n)=>{var i=n(6914),a=Array.prototype.forEach,o=Object.create,s=function(t,e){var n;for(n in t)e[n]=t[n]};t.exports=function(t){var e=o(null);return a.call(arguments,function(t){i(t)&&s(Object(t),e)}),e}},1290:t=>{t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function");return t}},2745:(t,e,n)=>{var i=n(6914);t.exports=function(t){if(!i(t))throw TypeError("Cannot use null or undefined");return t}},9981:(t,e,n)=>{t.exports=n(3591)()?String.prototype.contains:n(6042)},3591:t=>{var e="razdwatrzy";t.exports=function(){return"function"==typeof e.contains&&!0===e.contains("dwa")&&!1===e.contains("foo")}},6042:t=>{var e=String.prototype.indexOf;t.exports=function(t){return e.call(this,t,arguments[1])>-1}},8832:(t,e,n)=>{n(4167)("ev-store","7");var i="__EV_STORE_KEY@7";t.exports=function(t){var e=t[i];return e||(e=t[i]={}),e}},8370:(t,e,n)=>{var i,a,o,s,r,l,c,d=n(1804),u=n(1290),h=Function.prototype.apply,p=Function.prototype.call,m=Object.create,f=Object.defineProperty,g=Object.defineProperties,v=Object.prototype.hasOwnProperty,y={configurable:!0,enumerable:!1,writable:!0};i=function(t,e){var n;return u(e),v.call(this,"__ee__")?n=this.__ee__:(n=y.value=m(null),f(this,"__ee__",y),y.value=null),n[t]?"object"==typeof n[t]?n[t].push(e):n[t]=[n[t],e]:n[t]=e,this},a=function(t,e){var n,a;return u(e),a=this,i.call(this,t,n=function(){o.call(a,t,n),h.call(e,this,arguments)}),n.__eeOnceListener__=e,this},r={on:i,once:a,off:o=function(t,e){var n,i,a,o;if(u(e),!v.call(this,"__ee__")||!(n=this.__ee__)[t])return this;if("object"==typeof(i=n[t]))for(o=0;a=i[o];++o)(a===e||a.__eeOnceListener__===e)&&(2===i.length?n[t]=i[o?0:1]:i.splice(o,1));else(i===e||i.__eeOnceListener__===e)&&delete n[t];return this},emit:s=function(t){var e,n,i,a,o;if(v.call(this,"__ee__")&&(a=this.__ee__[t])){if("object"==typeof a){for(e=1,n=arguments.length,o=Array(n-1);e<n;++e)o[e-1]=arguments[e];for(e=0,a=a.slice();i=a[e];++e)h.call(i,this,o)}else switch(arguments.length){case 1:p.call(a,this);break;case 2:p.call(a,this,arguments[1]);break;case 3:p.call(a,this,arguments[1],arguments[2]);break;default:for(e=1,n=arguments.length,o=Array(n-1);e<n;++e)o[e-1]=arguments[e];h.call(a,this,o)}}}},c=g({},l={on:d(i),once:d(a),off:d(o),emit:d(s)}),t.exports=e=function(t){return null==t?m(c):g(Object(t),l)},e.methods=r},6226:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.linear=function(t,e){var n,i,a=new Float32Array(t),o=t-1;for(n=0;n<t;n++)i=n/o,e>0?a[n]=i:a[n]=1-i;return a},e.exponential=function(t,e){var n,i,a=new Float32Array(t),o=t-1;for(n=0;n<t;n++)i=n/o,a[e>0?n:t-1-n]=Math.exp(2*i-1)/Math.exp(1);return a},e.sCurve=function(t,e){var n,i=new Float32Array(t),a=e>0?Math.PI/2:-(Math.PI/2);for(n=0;n<t;++n)i[n]=Math.sin(Math.PI*n/t-a)/2+.5;return i},e.logarithmic=function(t,e,n){var i,a,o=new Float32Array(t),s=0;for(a=0;a<t;a++)i=n>0?a:t-1-a,s=a/t,o[i]=Math.log(1+e*s)/Math.log(1+e);return o}},1114:(t,e,n)=>{e.h7=e.Y1=e.Hp=e.Jl=e.t$=e._h=void 0,e.L7=function(t,e,n,i){switch(e){case a:l.call(t,n,i);break;case o:d.call(t,n,i);break;case s:h.call(t,n,i);break;case r:m.call(t,n,i);break;default:throw Error("Unsupported Fade type")}},e.Mt=function(t,e,n,i){switch(e){case a:c.call(t,n,i);break;case o:u.call(t,n,i);break;case s:p.call(t,n,i);break;case r:f.call(t,n,i);break;default:throw Error("Unsupported Fade type")}};var i=n(6226),a=e._h="sCurve",o=e.t$="linear",s=e.Jl="exponential",r=e.Hp="logarithmic";function l(t,e){var n=(0,i.sCurve)(1e4,1);this.setValueCurveAtTime(n,t,e)}function c(t,e){var n=(0,i.sCurve)(1e4,-1);this.setValueCurveAtTime(n,t,e)}function d(t,e){this.linearRampToValueAtTime(0,t),this.linearRampToValueAtTime(1,t+e)}function u(t,e){this.linearRampToValueAtTime(1,t),this.linearRampToValueAtTime(0,t+e)}function h(t,e){this.exponentialRampToValueAtTime(.01,t),this.exponentialRampToValueAtTime(1,t+e)}function p(t,e){this.exponentialRampToValueAtTime(1,t),this.exponentialRampToValueAtTime(.01,t+e)}function m(t,e){var n=(0,i.logarithmic)(1e4,10,1);this.setValueCurveAtTime(n,t,e)}function f(t,e){var n=(0,i.logarithmic)(1e4,10,-1);this.setValueCurveAtTime(n,t,e)}e.Y1="FadeIn",e.h7="FadeOut"},9144:(t,e,n)=>{var i,a=void 0!==n.g?n.g:"undefined"!=typeof window?window:{},o=n(5893);"undefined"!=typeof document?i=document:(i=a["__GLOBAL_DOCUMENT_CACHE@4"])||(i=a["__GLOBAL_DOCUMENT_CACHE@4"]=o),t.exports=i},8070:(t,e,n)=>{var i="undefined"!=typeof window?window:void 0!==n.g?n.g:{};t.exports=function(t,e){return t in i?i[t]:(i[t]=e,e)}},4167:(t,e,n)=>{var i=n(8070);t.exports=function(t,e,n){var a="__INDIVIDUAL_ONE_VERSION_"+t,o=i(a+"_ENFORCE_SINGLETON",e);if(o!==e)throw Error("Can only have one copy of "+t+".\nYou already have version "+o+" installed.\nThis means you cannot install version "+e);return i(a,n)}},849:(t,e,n)=>{var i=!!(n.g===n.g.window&&n.g.URL&&n.g.Blob&&n.g.Worker);function a(t,e){var a,o=this;if(e=e||{},i)return a=t.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],new n.g.Worker(n.g.URL.createObjectURL(new n.g.Blob([a],{type:"text/javascript"})));this.self=e,this.self.postMessage=function(t){setTimeout(function(){o.onmessage({data:t})},0)},setTimeout(t.bind(e,e),0)}a.prototype.postMessage=function(t){var e=this;setTimeout(function(){e.self.onmessage({data:t})},0)},t.exports=a},6240:t=>{t.exports=function(t){return"object"==typeof t&&null!==t}},1730:t=>{var e,n,i,a,o,s=/^(?:0|[1-9]\d*)$/,r=Object.prototype,l=r.hasOwnProperty,c=r.toString,d=r.propertyIsEnumerable,u=(e=Object.keys,n=Object,function(t){return e(n(t))}),h=Math.max,p=!d.call({valueOf:1},"valueOf");function m(t,e,n){var i=t[e];l.call(t,e)&&v(i,n)&&(void 0!==n||e in t)||(t[e]=n)}function f(t,e){return!!(e=null==e?9007199254740991:e)&&("number"==typeof t||s.test(t))&&t>-1&&t%1==0&&t<e}function g(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||r)}function v(t,e){return t===e||t!=t&&e!=e}var y=Array.isArray;function b(t){var e,n;return null!=t&&"number"==typeof(e=t.length)&&e>-1&&e%1==0&&e<=9007199254740991&&!("[object Function]"==(n=k(t)?c.call(t):"")||"[object GeneratorFunction]"==n)}function k(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}var w=(i=function(t,e){if(p||g(e)||b(e)){!function(t,e,n,i){n||(n={});for(var a=-1,o=e.length;++a<o;){var s=e[a],r=void 0;m(n,s,void 0===r?t[s]:r)}}(e,b(e)?function(t,e){var n=y(t)||t&&"object"==typeof t&&b(t)&&l.call(t,"callee")&&(!d.call(t,"callee")||"[object Arguments]"==c.call(t))?function(t,e){for(var n=-1,i=Array(t);++n<t;)i[n]=e(n);return i}(t.length,String):[],i=n.length,a=!!i;for(var o in t)l.call(t,o)&&!(a&&("length"==o||f(o,i)))&&n.push(o);return n}(e):function(t){if(!g(t))return u(t);var e=[];for(var n in Object(t))l.call(t,n)&&"constructor"!=n&&e.push(n);return e}(e),t);return}for(var n in e)l.call(e,n)&&m(t,n,e[n])},a=function(t,e){var n=-1,a=e.length,o=a>1?e[a-1]:void 0,s=a>2?e[2]:void 0;for(o=i.length>3&&"function"==typeof o?(a--,o):void 0,s&&function(t,e,n){if(!k(n))return!1;var i=typeof e;return("number"==i?!!(b(n)&&f(e,n.length)):"string"==i&&(e in n))&&v(n[e],t)}(e[0],e[1],s)&&(o=a<3?void 0:o,a=1),t=Object(t);++n<a;){var r=e[n];r&&i(t,r,n,o)}return t},o=h(void 0===o?a.length-1:o,0),function(){for(var t=arguments,e=-1,n=h(t.length-o,0),i=Array(n);++e<n;)i[e]=t[o+e];e=-1;for(var s=Array(o+1);++e<o;)s[e]=t[e];return s[o]=i,function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}(a,this,s)});t.exports=w},2098:(t,e,n)=>{t=n.nmd(t);var i,a,o,s,r,l,c,d="__lodash_hash_undefined__",u="[object Arguments]",h="[object Function]",p="[object Object]",m=/^\[object .+?Constructor\]$/,f=/^(?:0|[1-9]\d*)$/,g={};g["[object Float32Array]"]=g["[object Float64Array]"]=g["[object Int8Array]"]=g["[object Int16Array]"]=g["[object Int32Array]"]=g["[object Uint8Array]"]=g["[object Uint8ClampedArray]"]=g["[object Uint16Array]"]=g["[object Uint32Array]"]=!0,g[u]=g["[object Array]"]=g["[object ArrayBuffer]"]=g["[object Boolean]"]=g["[object DataView]"]=g["[object Date]"]=g["[object Error]"]=g[h]=g["[object Map]"]=g["[object Number]"]=g[p]=g["[object RegExp]"]=g["[object Set]"]=g["[object String]"]=g["[object WeakMap]"]=!1;var v="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,y="object"==typeof self&&self&&self.Object===Object&&self,b=v||y||Function("return this")(),k=e&&!e.nodeType&&e,w=k&&t&&!t.nodeType&&t,x=w&&w.exports===k,E=x&&v.process,T=function(){try{var t=w&&w.require&&w.require("util").types;if(t)return t;return E&&E.binding&&E.binding("util")}catch(t){}}(),S=T&&T.isTypedArray;function C(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}var P=Array.prototype,I=Function.prototype,_=Object.prototype,O=b["__core-js_shared__"],A=I.toString,M=_.hasOwnProperty,R=(s=/[^.]+$/.exec(O&&O.keys&&O.keys.IE_PROTO||""))?"Symbol(src)_1."+s:"",L=_.toString,B=A.call(Object),D=RegExp("^"+A.call(M).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),N=x?b.Buffer:void 0,j=b.Symbol,G=b.Uint8Array,F=N?N.allocUnsafe:void 0,U=(r=Object.getPrototypeOf,l=Object,function(t){return r(l(t))}),H=Object.create,V=_.propertyIsEnumerable,z=P.splice,W=j?j.toStringTag:void 0,q=function(){try{var t=tm(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),X=N?N.isBuffer:void 0,Y=Math.max,J=Date.now,K=tm(b,"Map"),Z=tm(Object,"create"),Q=function(){function t(){}return function(e){if(!tC(e))return{};if(H)return H(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function tt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function te(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function tn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function ti(t){var e=this.__data__=new te(t);this.size=e.size}function ta(t,e,n){(void 0===n||tb(t[e],n))&&(void 0!==n||e in t)||ts(t,e,n)}function to(t,e){for(var n=t.length;n--;)if(tb(t[n][0],e))return n;return -1}function ts(t,e,n){"__proto__"==e&&q?q(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}tt.prototype.clear=function(){this.__data__=Z?Z(null):{},this.size=0},tt.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},tt.prototype.get=function(t){var e=this.__data__;if(Z){var n=e[t];return n===d?void 0:n}return M.call(e,t)?e[t]:void 0},tt.prototype.has=function(t){var e=this.__data__;return Z?void 0!==e[t]:M.call(e,t)},tt.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Z&&void 0===e?d:e,this},te.prototype.clear=function(){this.__data__=[],this.size=0},te.prototype.delete=function(t){var e=this.__data__,n=to(e,t);return!(n<0)&&(n==e.length-1?e.pop():z.call(e,n,1),--this.size,!0)},te.prototype.get=function(t){var e=this.__data__,n=to(e,t);return n<0?void 0:e[n][1]},te.prototype.has=function(t){return to(this.__data__,t)>-1},te.prototype.set=function(t,e){var n=this.__data__,i=to(n,t);return i<0?(++this.size,n.push([t,e])):n[i][1]=e,this},tn.prototype.clear=function(){this.size=0,this.__data__={hash:new tt,map:new(K||te),string:new tt}},tn.prototype.delete=function(t){var e=tp(this,t).delete(t);return this.size-=e?1:0,e},tn.prototype.get=function(t){return tp(this,t).get(t)},tn.prototype.has=function(t){return tp(this,t).has(t)},tn.prototype.set=function(t,e){var n=tp(this,t),i=n.size;return n.set(t,e),this.size+=n.size==i?0:1,this},ti.prototype.clear=function(){this.__data__=new te,this.size=0},ti.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},ti.prototype.get=function(t){return this.__data__.get(t)},ti.prototype.has=function(t){return this.__data__.has(t)},ti.prototype.set=function(t,e){var n=this.__data__;if(n instanceof te){var i=n.__data__;if(!K||i.length<199)return i.push([t,e]),this.size=++n.size,this;n=this.__data__=new tn(i)}return n.set(t,e),this.size=n.size,this};var tr=function(t,e,n){for(var i=-1,a=Object(t),o=n(t),s=o.length;s--;){var r=o[++i];if(!1===e(a[r],r,a))break}return t};function tl(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":W&&W in Object(t)?function(t){var e=M.call(t,W),n=t[W];try{t[W]=void 0;var i=!0}catch(t){}var a=L.call(t);return i&&(e?t[W]=n:delete t[W]),a}(t):L.call(t)}function tc(t){return tP(t)&&tl(t)==u}function td(t,e,n,i,a){t!==e&&tr(e,function(o,s){if(a||(a=new ti),tC(o))!function(t,e,n,i,a,o,s){var r=tv(t,n),l=tv(e,n),c=s.get(l);if(c){ta(t,n,c);return}var d=o?o(r,l,n+"",t,e,s):void 0,u=void 0===d;if(u){var h,m,f,g=tw(l),v=!g&&tE(l),y=!g&&!v&&tI(l);d=l,g||v||y?tw(r)?d=r:tP(r)&&tx(r)?d=function(t,e){var n=-1,i=t.length;for(e||(e=Array(i));++n<i;)e[n]=t[n];return e}(r):v?(u=!1,d=function(t,e){if(e)return t.slice();var n=t.length,i=F?F(n):new t.constructor(n);return t.copy(i),i}(l,!0)):y?(u=!1,new G(m=new(h=l.buffer).constructor(h.byteLength)).set(new G(h)),f=m,d=new l.constructor(f,l.byteOffset,l.length)):d=[]:function(t){if(!tP(t)||tl(t)!=p)return!1;var e=U(t);if(null===e)return!0;var n=M.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&A.call(n)==B}(l)||tk(l)?(d=r,tk(r)?d=function(t,e,n,i){var a=!n;n||(n={});for(var o=-1,s=e.length;++o<s;){var r=e[o],l=void 0;void 0===l&&(l=t[r]),a?ts(n,r,l):function(t,e,n){var i=t[e];M.call(t,e)&&tb(i,n)&&(void 0!==n||e in t)||ts(t,e,n)}(n,r,l)}return n}(r,tO(r)):(!tC(r)||tT(r))&&(d="function"!=typeof l.constructor||tg(l)?{}:Q(U(l)))):u=!1}u&&(s.set(l,d),a(d,l,i,o,s),s.delete(l)),ta(t,n,d)}(t,e,s,n,td,i,a);else{var r=i?i(tv(t,s),o,s+"",t,e,a):void 0;void 0===r&&(r=o),ta(t,s,r)}},tO)}function tu(t,e){var n,i;return ty((n=e,i=tM,n=Y(void 0===n?t.length-1:n,0),function(){for(var e=arguments,a=-1,o=Y(e.length-n,0),s=Array(o);++a<o;)s[a]=e[n+a];a=-1;for(var r=Array(n+1);++a<n;)r[a]=e[a];return r[n]=i(s),C(t,this,r)}),t+"")}function th(t,e,n,i,a,o){return tC(t)&&tC(e)&&(o.set(e,t),td(t,e,void 0,th,o),o.delete(e)),t}function tp(t,e){var n,i=t.__data__;return("string"==(n=typeof e)||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==e:null===e)?i["string"==typeof e?"string":"hash"]:i.map}function tm(t,e){var n=null==t?void 0:t[e];return!(!tC(n)||R&&R in n)&&(tT(n)?D:m).test(function(t){if(null!=t){try{return A.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(n))?n:void 0}function tf(t,e){var n=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&f.test(t))&&t>-1&&t%1==0&&t<e}function tg(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||_)}function tv(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var ty=(i=q?function(t,e){return q(t,"toString",{configurable:!0,enumerable:!1,value:function(){return e},writable:!0})}:tM,a=0,o=0,function(){var t=J(),e=16-(t-o);if(o=t,e>0){if(++a>=800)return arguments[0]}else a=0;return i.apply(void 0,arguments)});function tb(t,e){return t===e||t!=t&&e!=e}var tk=tc(function(){return arguments}())?tc:function(t){return tP(t)&&M.call(t,"callee")&&!V.call(t,"callee")},tw=Array.isArray;function tx(t){return null!=t&&tS(t.length)&&!tT(t)}var tE=X||function(){return!1};function tT(t){if(!tC(t))return!1;var e=tl(t);return e==h||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}function tS(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}function tC(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function tP(t){return null!=t&&"object"==typeof t}var tI=S?function(t){return S(t)}:function(t){return tP(t)&&tS(t.length)&&!!g[tl(t)]},t_=tu(function(t){return t.push(void 0,th),C(tA,void 0,t)});function tO(t){return tx(t)?function(t,e){var n=tw(t),i=!n&&tk(t),a=!n&&!i&&tE(t),o=!n&&!i&&!a&&tI(t),s=n||i||a||o,r=s?function(t,e){for(var n=-1,i=Array(t);++n<t;)i[n]=e(n);return i}(t.length,String):[],l=r.length;for(var c in t)(e||M.call(t,c))&&!(s&&("length"==c||a&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||tf(c,l)))&&r.push(c);return r}(t,!0):function(t){if(!tC(t))return function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}(t);var e=tg(t),n=[];for(var i in t)"constructor"==i&&(e||!M.call(t,i))||n.push(i);return n}(t)}var tA=(c=function(t,e,n,i){td(t,e,n,i)},tu(function(t,e){var n=-1,i=e.length,a=i>1?e[i-1]:void 0,o=i>2?e[2]:void 0;for(a=c.length>3&&"function"==typeof a?(i--,a):void 0,o&&function(t,e,n){if(!tC(n))return!1;var i=typeof e;return("number"==i?!!(tx(n)&&tf(e,n.length)):"string"==i&&(e in n))&&tb(n[e],t)}(e[0],e[1],o)&&(a=i<3?void 0:a,i=1),t=Object(t);++n<i;){var s=e[n];s&&c(t,s,n,a)}return t}));function tM(t){return t}t.exports=t_},3520:t=>{var e,n,i=/^(?:0|[1-9]\d*)$/,a=Object.prototype,o=a.hasOwnProperty,s=a.toString,r=a.propertyIsEnumerable,l=(e=Object.keys,n=Object,function(t){return e(n(t))}),c=function(t,e,n){for(var i=-1,a=Object(t),o=n(t),s=o.length;s--;){var r=o[++i];if(!1===e(a[r],r,a))break}return t},d=Array.isArray;function u(t){var e,n,i;return null!=t&&"number"==typeof(e=t.length)&&e>-1&&e%1==0&&e<=9007199254740991&&!("[object Function]"==(n=typeof t,i=t&&("object"==n||"function"==n)?s.call(t):"")||"[object GeneratorFunction]"==i)}function h(t){return u(t)?function(t,e){var n,a=d(t)||t&&"object"==typeof t&&u(t)&&o.call(t,"callee")&&(!r.call(t,"callee")||"[object Arguments]"==s.call(t))?function(t,e){for(var n=-1,i=Array(t);++n<t;)i[n]=e(n);return i}(t.length,String):[],l=a.length,c=!!l;for(var h in t)o.call(t,h)&&!(c&&("length"==h||(n=null==(n=l)?9007199254740991:n)&&("number"==typeof h||i.test(h))&&h>-1&&h%1==0&&h<n))&&a.push(h);return a}(t):function(t){if(e=t&&t.constructor,t!==("function"==typeof e&&e.prototype||a))return l(t);var e,n=[];for(var i in Object(t))o.call(t,i)&&"constructor"!=i&&n.push(i);return n}(t)}function p(t){return t}t.exports=function(t,e){var n;return t&&(n="function"==typeof e?e:p,t&&c(t,n,h))}},372:(t,e,n)=>{var i=n(6060);t.exports=function(t){if("function"!=typeof t||!hasOwnProperty.call(t,"length"))return!1;try{if("number"!=typeof t.length||"function"!=typeof t.call||"function"!=typeof t.apply)return!1}catch(t){return!1}return!i(t)}},3940:(t,e,n)=>{var i=n(5618),a={object:!0,function:!0,undefined:!0};t.exports=function(t){return!!i(t)&&hasOwnProperty.call(a,typeof t)}},7205:(t,e,n)=>{var i=n(372),a=/^\s*class[\s{/}]/,o=Function.prototype.toString;t.exports=function(t){return!(!i(t)||a.test(o.call(t)))}},6060:(t,e,n)=>{var i=n(3940);t.exports=function(t){if(!i(t))return!1;try{if(!t.constructor)return!1;return t.constructor.prototype===t}catch(t){return!1}}},5618:t=>{var e=void 0;t.exports=function(t){return t!==e&&null!==t}},4935:(t,e,n)=>{var i=n(3513);t.exports=i},7921:(t,e,n)=>{var i=n(3072);t.exports=i},347:(t,e,n)=>{var i=n(8744);t.exports=i},9720:(t,e,n)=>{var i=n(6943);t.exports=i},6672:(t,e,n)=>{var i=n(6240),a=n(7265);function o(t,e,n,i){if(i){var o=i[e];if(a(o))o.unhook&&o.unhook(t,e,n);else if("attributes"===e)for(var s in o)t.removeAttribute(s);else if("style"===e)for(var r in o)t.style[r]="";else"string"==typeof o?t[e]="":t[e]=null}}function s(t){return Object.getPrototypeOf?Object.getPrototypeOf(t):t.__proto__?t.__proto__:t.constructor?t.constructor.prototype:void 0}t.exports=function(t,e,n){for(var r in e){var l=e[r];void 0===l?o(t,r,l,n):a(l)?(o(t,r,l,n),l.hook&&l.hook(t,r,n?n[r]:void 0)):i(l)?function(t,e,n,a,o){var r=n?n[a]:void 0;if("attributes"===a){for(var l in o){var c=o[l];void 0===c?t.removeAttribute(l):t.setAttribute(l,c)}return}if(r&&i(r)&&s(r)!==s(o)){t[a]=o;return}i(t[a])||(t[a]={});var d="style"===a?"":void 0;for(var u in o){var h=o[u];t[a][u]=void 0===h?d:h}}(t,0,n,r,l):t[r]=l}}},3513:(t,e,n)=>{var i=n(9144),a=n(6672),o=n(5170),s=n(6221),r=n(4097),l=n(6078);t.exports=function t(e,n){var c=n&&n.document||i,d=n?n.warn:null;if(r(e=l(e).a))return e.init();if(s(e))return c.createTextNode(e.text);if(!o(e))return d&&d("Item is not a valid virtual dom node",e),null;var u=null===e.namespace?c.createElement(e.tagName):c.createElementNS(e.namespace,e.tagName);a(u,e.properties);for(var h=e.children,p=0;p<h.length;p++){var m=t(h[p],n);m&&u.appendChild(m)}return u}},8992:t=>{var e={};function n(t,e,n){if(0===t.length)return!1;for(var i,a,o=0,s=t.length-1;o<=s;){if(a=t[i=(s+o)/2>>0],o===s)return a>=e&&a<=n;if(a<e)o=i+1;else{if(!(a>n))return!0;s=i-1}}return!1}function i(t,e){return t>e?1:-1}t.exports=function(t,a,o,s){return o&&0!==o.length?(o.sort(i),function t(i,a,o,s,r){if(s=s||{},i){n(o,r,r)&&(s[r]=i);var l=a.children;if(l)for(var c=i.childNodes,d=0;d<a.children.length;d++){r+=1;var u=l[d]||e,h=r+(u.count||0);n(o,r,h)&&t(c[d],u,o,s,r),r=h}}return s}(t,a,o,s,0)):{}}},9120:(t,e,n)=>{var i=n(6672),a=n(4097),o=n(8057),s=n(6670);function r(t,e){"function"==typeof e.destroy&&a(e)&&e.destroy(t)}t.exports=function(t,e,n){var a,l,c,d,u,h,p,m,f=t.type,g=t.vNode,v=t.patch;switch(f){case o.REMOVE:return(a=e.parentNode)&&a.removeChild(e),r(e,g),null;case o.INSERT:return l=n.render(v,n),e&&e.appendChild(l),e;case o.VTEXT:return function(t,e,n,i){var a;if(3===t.nodeType)t.replaceData(0,t.length,n.text),a=t;else{var o=t.parentNode;a=i.render(n,i),o&&a!==t&&o.replaceChild(a,t)}return a}(e,0,v,n);case o.WIDGET:return c=(d=s(g,v))?v.update(g,e)||e:n.render(v,n),(u=e.parentNode)&&c!==e&&u.replaceChild(c,e),d||r(e,g),c;case o.VNODE:return h=e.parentNode,p=n.render(v,n),h&&p!==e&&h.replaceChild(p,e),p;case o.ORDER:return function(t,e){for(var n,i,a,o=t.childNodes,s={},r=0;r<e.removes.length;r++)n=o[(i=e.removes[r]).from],i.key&&(s[i.key]=n),t.removeChild(n);for(var l=o.length,c=0;c<e.inserts.length;c++)n=s[(a=e.inserts[c]).key],t.insertBefore(n,a.to>=l++?null:o[a.to])}(e,v),e;case o.PROPS:return i(e,v,g.properties),e;case o.THUNK:return m=n.patch(e,v,n),e&&m&&e!==m&&e.parentNode&&e.parentNode.replaceChild(m,e),m;default:return e}}},6943:(t,e,n)=>{var i=n(9144),a=n(7362),o=n(3513),s=n(8992),r=n(9120);function l(t,e,n){var o=function(t){var e=[];for(var n in t)"a"!==n&&e.push(Number(n));return e}(e);if(0===o.length)return t;var l=s(t,e.a,o),c=t.ownerDocument;n.document||c===i||(n.document=c);for(var d=0;d<o.length;d++){var u=o[d];t=function(t,e,n,i){if(!e)return t;if(a(n))for(var o,s=0;s<n.length;s++)o=r(n[s],e,i),e===t&&(t=o);else o=r(n,e,i),e===t&&(t=o);return t}(t,l[u],e[u],n)}return t}t.exports=function t(e,n,i){return(i=i||{}).patch=i.patch&&i.patch!==t?i.patch:l,i.render=i.render||o,i.patch(e,n,i)}},6670:(t,e,n)=>{var i=n(4097);t.exports=function(t,e){return!!(i(t)&&i(e))&&("name"in t&&"name"in e?t.id===e.id:t.init===e.init)}},6505:(t,e,n)=>{var i=n(8832);function a(t){if(!(this instanceof a))return new a(t);this.value=t}t.exports=a,a.prototype.hook=function(t,e){i(t)[e.substr(3)]=this.value},a.prototype.unhook=function(t,e){i(t)[e.substr(3)]=void 0}},7199:t=>{function e(t){if(!(this instanceof e))return new e(t);this.value=t}t.exports=e,e.prototype.hook=function(t,e){t[e]!==this.value&&(t[e]=this.value)}},8744:(t,e,n)=>{var i=n(7362),a=n(4282),o=n(4268),s=n(5170),r=n(6221),l=n(4097),c=n(7265),d=n(6741),u=n(1948),h=n(7199),p=n(6505);function m(t){return s(t)||r(t)||l(t)||d(t)}function f(t){try{return JSON.stringify(t,null,"    ")}catch(e){return String(t)}}t.exports=function(t,e,n){var s,r,l,d,g=[];return!n&&("string"==typeof e||i(e)||m(e))&&(n=e,r={}),s=u(t,r=r||e||{}),r.hasOwnProperty("key")&&(l=r.key,r.key=void 0),r.hasOwnProperty("namespace")&&(d=r.namespace,r.namespace=void 0),"INPUT"===s&&!d&&r.hasOwnProperty("value")&&void 0!==r.value&&!c(r.value)&&(r.value=h(r.value)),function(t){for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];if(c(n))continue;"ev-"===e.substr(0,3)&&(t[e]=p(n))}}(r),null!=n&&function t(e,n,a,s){if("string"==typeof e)n.push(new o(e));else if("number"==typeof e)n.push(new o(String(e)));else if(m(e))n.push(e);else if(i(e))for(var r,l,c=0;c<e.length;c++)t(e[c],n,a,s);else{if(null==e)return;throw r={foreignObject:e,parentVnode:{tagName:a,properties:s}},(l=Error()).type="virtual-hyperscript.unexpected.virtual-element",l.message="Unexpected virtual child passed to h().\nExpected a VNode / Vthunk / VWidget / string but:\ngot:\n"+f(r.foreignObject)+".\nThe parent vnode is:\n"+f(r.parentVnode),l.foreignObject=r.foreignObject,l.parentVnode=r.parentVnode,l}}(n,g,s,r),new a(s,r,g,l,d)}},1948:(t,e,n)=>{var i=n(6824),a=/([\.#]?[a-zA-Z0-9\u007F-\uFFFF_:-]+)/,o=/^\.|#/;t.exports=function(t,e){if(!t)return"DIV";var n,s,r,l,c=!e.hasOwnProperty("id"),d=i(t,a),u=null;for(o.test(d[1])&&(u="DIV"),l=0;l<d.length;l++)(s=d[l])&&(r=s.charAt(0),u?"."===r?(n=n||[]).push(s.substring(1,s.length)):"#"===r&&c&&(e.id=s.substring(1,s.length)):u=s);return n&&(e.className&&n.push(e.className),e.className=n.join(" ")),e.namespace?u:u.toUpperCase()}},6078:(t,e,n)=>{var i=n(5170),a=n(6221),o=n(4097),s=n(6741);function r(t,e){var n=t.vnode;if(n||(n=t.vnode=t.render(e)),!(i(n)||a(n)||o(n)))throw Error("thunk did not return a valid node");return n}t.exports=function(t,e){var n=t,i=e;return s(e)&&(i=r(e,t)),s(t)&&(n=r(t,null)),{a:n,b:i}}},6741:t=>{t.exports=function(t){return t&&"Thunk"===t.type}},7265:t=>{t.exports=function(t){return t&&("function"==typeof t.hook&&!t.hasOwnProperty("hook")||"function"==typeof t.unhook&&!t.hasOwnProperty("unhook"))}},5170:(t,e,n)=>{var i=n(9962);t.exports=function(t){return t&&"VirtualNode"===t.type&&t.version===i}},6221:(t,e,n)=>{var i=n(9962);t.exports=function(t){return t&&"VirtualText"===t.type&&t.version===i}},4097:t=>{t.exports=function(t){return t&&"Widget"===t.type}},9962:t=>{t.exports="2"},4282:(t,e,n)=>{var i=n(9962),a=n(5170),o=n(4097),s=n(6741),r=n(7265);t.exports=d;var l={},c=[];function d(t,e,n,i,d){this.tagName=t,this.properties=e||l,this.children=n||c,this.key=null!=i?String(i):void 0,this.namespace="string"==typeof d?d:null;var u,h=n&&n.length||0,p=0,m=!1,f=!1,g=!1;for(var v in e)if(e.hasOwnProperty(v)){var y=e[v];r(y)&&y.unhook&&(u||(u={}),u[v]=y)}for(var b=0;b<h;b++){var k=n[b];a(k)?(p+=k.count||0,!m&&k.hasWidgets&&(m=!0),!f&&k.hasThunks&&(f=!0),!g&&(k.hooks||k.descendantHooks)&&(g=!0)):!m&&o(k)?"function"==typeof k.destroy&&(m=!0):!f&&s(k)&&(f=!0)}this.count=h+p,this.hasWidgets=m,this.hasThunks=f,this.hooks=u,this.descendantHooks=g}d.prototype.version=i,d.prototype.type="VirtualNode"},8057:(t,e,n)=>{var i=n(9962);function a(t,e,n){this.type=Number(t),this.vNode=e,this.patch=n}a.NONE=0,a.VTEXT=1,a.VNODE=2,a.WIDGET=3,a.PROPS=4,a.ORDER=5,a.INSERT=6,a.REMOVE=7,a.THUNK=8,t.exports=a,a.prototype.version=i,a.prototype.type="VirtualPatch"},4268:(t,e,n)=>{var i=n(9962);function a(t){this.text=String(t)}t.exports=a,a.prototype.version=i,a.prototype.type="VirtualText"},9973:(t,e,n)=>{var i=n(6240),a=n(7265);function o(t){return Object.getPrototypeOf?Object.getPrototypeOf(t):t.__proto__?t.__proto__:t.constructor?t.constructor.prototype:void 0}t.exports=function t(e,n){var s;for(var r in e){r in n||((s=s||{})[r]=void 0);var l=e[r],c=n[r];if(l!==c){if(i(l)&&i(c)){if(o(c)!==o(l))(s=s||{})[r]=c;else if(a(c))(s=s||{})[r]=c;else{var d=t(l,c);d&&((s=s||{})[r]=d)}}else(s=s||{})[r]=c}}for(var u in n)u in e||((s=s||{})[u]=n[u]);return s}},3072:(t,e,n)=>{var i=n(7362),a=n(8057),o=n(5170),s=n(6221),r=n(4097),l=n(6741),c=n(6078),d=n(9973);function u(t,e){var n={a:t};return function t(e,n,i,c){if(e!==n){var u=i[c],v=!1;if(l(e)||l(n))p(e,n,i,c);else if(null==n)r(e)||(h(e,i,c),u=i[c]),u=g(u,new a(a.REMOVE,e,n));else if(o(n)){if(o(e)){if(e.tagName===n.tagName&&e.namespace===n.namespace&&e.key===n.key){var y=d(e.properties,n.properties);y&&(u=g(u,new a(a.PROPS,e,y))),u=function(e,n,i,s,r){for(var l=e.children,c=function(t,e){var n,i=f(e),a=i.keys,o=i.free;if(o.length===e.length)return{children:e,moves:null};var s=f(t),r=s.keys;if(s.free.length===t.length)return{children:e,moves:null};for(var l=[],c=0,d=o.length,u=0,h=0;h<t.length;h++){var p,g=t[h];g.key?a.hasOwnProperty(g.key)?(p=a[g.key],l.push(e[p])):(p=h-u++,l.push(null)):c<d?(p=o[c++],l.push(e[p])):(p=h-u++,l.push(null))}for(var v=c>=o.length?e.length:o[c],y=0;y<e.length;y++){var b=e[y];b.key?r.hasOwnProperty(b.key)||l.push(b):y>=v&&l.push(b)}for(var k=l.slice(),w=0,x=[],E=[],T=0;T<e.length;){var S=e[T];for(n=k[w];null===n&&k.length;)x.push(m(k,w,null)),n=k[w];n&&n.key===S.key?(w++,T++):S.key?(n&&n.key&&a[n.key]!==T+1?(x.push(m(k,w,n.key)),(n=k[w])&&n.key===S.key?w++:E.push({key:S.key,to:T})):E.push({key:S.key,to:T}),T++):n&&n.key&&x.push(m(k,w,n.key))}for(;w<k.length;)n=k[w],x.push(m(k,w,n&&n.key));return x.length!==u||E.length?{children:l,moves:{removes:x,inserts:E}}:{children:l,moves:null}}(l,n.children),d=c.children,u=l.length,h=d.length,p=u>h?u:h,v=0;v<p;v++){var y=l[v],b=d[v];r+=1,y?t(y,b,i,r):b&&(s=g(s,new a(a.INSERT,null,b))),o(y)&&y.count&&(r+=y.count)}return c.moves&&(s=g(s,new a(a.ORDER,e,c.moves))),s}(e,n,i,u,c)}else u=g(u,new a(a.VNODE,e,n)),v=!0}else u=g(u,new a(a.VNODE,e,n)),v=!0}else s(n)?s(e)?e.text!==n.text&&(u=g(u,new a(a.VTEXT,e,n))):(u=g(u,new a(a.VTEXT,e,n)),v=!0):r(n)&&(r(e)||(v=!0),u=g(u,new a(a.WIDGET,e,n)));u&&(i[c]=u),v&&h(e,i,c)}}(t,e,n,0),n}function h(t,e,n){(function t(e,n,i){if(o(e)){if(e.hooks&&(n[i]=g(n[i],new a(a.PROPS,e,function(t){var e={};for(var n in t)e[n]=void 0;return e}(e.hooks)))),e.descendantHooks||e.hasThunks)for(var s=e.children,r=s.length,c=0;c<r;c++){var d=s[c];t(d,n,i+=1),o(d)&&d.count&&(i+=d.count)}}else l(e)&&p(e,null,n,i)})(t,e,n),function t(e,n,i){if(r(e))"function"==typeof e.destroy&&(n[i]=g(n[i],new a(a.REMOVE,e,null)));else if(o(e)&&(e.hasWidgets||e.hasThunks))for(var s=e.children,c=s.length,d=0;d<c;d++){var u=s[d];t(u,n,i+=1),o(u)&&u.count&&(i+=u.count)}else l(e)&&p(e,null,n,i)}(t,e,n)}function p(t,e,n,i){var o=c(t,e),s=u(o.a,o.b);(function(t){for(var e in t)if("a"!==e)return!0;return!1})(s)&&(n[i]=new a(a.THUNK,null,s))}function m(t,e,n){return t.splice(e,1),{from:e,key:n}}function f(t){for(var e={},n=[],i=t.length,a=0;a<i;a++){var o=t[a];o.key?e[o.key]=a:n.push(a)}return{keys:e,free:n}}function g(t,e){return t?(i(t)?t.push(e):t=[t,e],t):e}t.exports=u},4991:t=>{function e(t,e){var n=Math.pow(2,e-1);return Math.max(-n,Math.min(n-1,t<0?t*n:t*(n-1)))}function n(t,n,a){var o,s,r,l,c,d,u=t.length,h=Math.ceil(u/n),p=i(a,2*h);for(o=0;o<h;o++)s=o*n,r=(o+1)*n>u?u:(o+1)*n,c=e((d=function(t){for(var e,n=1/0,i=-1/0,a=0,o=t.length;a<o;a++)n>(e=t[a])&&(n=e),i<e&&(i=e);return{min:n,max:i}}(t.subarray(s,r))).min,a),l=e(d.max,a),p[2*o]=c,p[2*o+1]=l;return p}function i(t,e){return new(Function(`return Int${t}Array`)())(e)}function a(t,e){return"number"==typeof t?t:e}t.exports=function(t,e,o,s,r,l){if(e=a(e,1e3),l=a(l,16),null==o&&(o=!0),0>[8,16,32].indexOf(l))throw Error("Invalid number of bits specified for peaks.");var c,d,u=t.numberOfChannels,h=[];if(s=a(s,0),r=a(r,t.length),void 0===t.subarray)for(c=0;c<u;c++)d=t.getChannelData(c).subarray(s,r),h.push(n(d,e,l));else h.push(n(t.subarray(s,r),e,l));return o&&h.length>1&&(h=function(t,e){var n,a,o=t.length,s=1/o,r=t[0].length/2,l=0,c=0,d=i(e,2*r);for(c=0;c<r;c++){for(l=0,n=0,a=0;l<o;l++)n+=s*t[l][2*c],a+=s*t[l][2*c+1];d[2*c]=n,d[2*c+1]=a}return[d]}(h,l)),{length:h[0].length/2,data:h,bits:l}}},7362:t=>{var e=Array.isArray,n=Object.prototype.toString;t.exports=e||function(t){return"[object Array]"===n.call(t)}},5893:()=>{}},e={};function n(i){var a=e[i];if(void 0!==a)return a.exports;var o=e[i]={id:i,loaded:!1,exports:{}};return t[i](o,o.exports,n),o.loaded=!0,o.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.nmd=t=>(t.paths=[],t.children||(t.children=[]),t);var i={};return(()=>{n.r(i),n.d(i,{default:()=>to,init:()=>ta});var t,e=n(2098),a=n.n(e),o=n(4935),s=n.n(o),r=n(8370),l=n.n(r),c=n(347),d=n.n(c),u=n(7921),h=n.n(u),p=n(9720),m=n.n(p),f=n(849),g=n.n(f);function v(t,e){return Math.ceil(t*e)}function y(t,e,n){return Math.ceil(t*n/e)}let b=class{setStateChange(t){this.audioRequestState=t,this.ee.emit("audiorequeststatechange",this.audioRequestState,this.src)}fileProgress(t){let e=0;0===this.audioRequestState&&this.setStateChange(1),t.lengthComputable&&(e=t.loaded/t.total*100),this.ee.emit("loadprogress",e,this.src)}fileLoad(t){let e=t.target.response||t.target.result;return this.setStateChange(2),new Promise((t,n)=>{this.ac.decodeAudioData(e,e=>{this.audioBuffer=e,this.setStateChange(3),t(e)},t=>{null===t?n(Error("MediaDecodeAudioDataUnknownContentType")):n(t)})})}fetchLoad(t){return this.setStateChange(2),new Promise((e,n)=>{this.ac.decodeAudioData(t,t=>{this.audioBuffer=t,this.setStateChange(3),e(t)},t=>{null===t?n(Error("MediaDecodeAudioDataUnknownContentType")):n(t)})})}constructor(t,e,n=l()()){this.src=t,this.ac=e,this.audioRequestState=0,this.ee=n}},k=class extends b{load(){return new Promise((t,e)=>{if(this.src.type.match(/audio.*/)||this.src.type.match(/video\/ogg/)){let n=new FileReader;n.readAsArrayBuffer(this.src),n.addEventListener("progress",t=>{super.fileProgress(t)}),n.addEventListener("load",n=>{super.fileLoad(n).then(e=>{t(e)}).catch(e)}),n.addEventListener("error",e)}else e(Error(`Unsupported file type ${this.src.type}`))})}};class w extends b{load(){return Promise.resolve(this.src)}}let x=class extends b{load(){return new Promise((t,e)=>{let n=new XMLHttpRequest;n.open("GET",this.src,!0),n.responseType="arraybuffer",n.send(),n.addEventListener("progress",t=>{super.fileProgress(t)}),n.addEventListener("load",n=>{super.fileLoad(n).then(e=>{t(e)}).catch(e)}),n.addEventListener("error",()=>{e(Error(`Track ${this.src} failed to load`))})})}},E=class{static createLoader(t,e,n){if(t instanceof Blob)return new k(t,e,n);if(t instanceof AudioBuffer)return new w(t,e,n);if("string"==typeof t)return new x(t,e,n);throw Error("Unsupported src type")}},T=class{hook(t){let e=this.playlist;if(!e.isScrolling){if(e.isAutomaticScroll){let n=t.getBoundingClientRect(),i=e.controls.show?e.controls.width:0,a=(n.width-i)*e.samplesPerPixel/e.sampleRate,o=e.isPlaying()?e.playbackSeconds:e.getTimeSelection().start;(o<e.scrollLeft||o>=e.scrollLeft+a)&&(e.scrollLeft=Math.min(o,e.duration-a))}let n=y(e.scrollLeft,e.samplesPerPixel,e.sampleRate);t.scrollLeft=n}}constructor(t){this.playlist=t}},S=class{hook(t,e,n){if(void 0!==n&&n.offset===this.offset&&n.duration===this.duration&&n.samplesPerPixel===this.samplesPerPixel)return;let i=t.width,a=t.height,o=t.getContext("2d");o.clearRect(0,0,i,a),o.fillStyle=this.colors.timeColor,Object.keys(this.tickInfo).forEach(t=>{let e=this.tickInfo[t];o.fillRect(t,a-e,1,e)})}constructor(t,e,n,i,a){this.tickInfo=t,this.offset=e,this.samplesPerPixel=n,this.duration=i,this.colors=a}};class C{getScaleInfo(t){let e=Object.keys(this.timeinfo).map(t=>parseInt(t,10));e=e.sort((t,e)=>t-e);for(let n=0;n<e.length;n+=1)if(t<=e[n])return this.timeinfo[e[n]];return this.timeinfo[e[0]]}static formatTime(t){let e=t/1e3,n=e%60,i=(e-n)/60;return n<10&&(n=`0${n}`),`${i}:${n}`}render(){let t=y(this.duration,this.samplesPerPixel,this.sampleRate),e=this.sampleRate/this.samplesPerPixel,n=y(this.offset,this.samplesPerPixel,this.sampleRate),i=this.getScaleInfo(this.samplesPerPixel),a={},o=[],s=t+n,r=0;for(let t=0;t<s;t+=e*i.secondStep){let e=Math.floor(t),s=e-n;e>=n&&(i.marker&&r%i.marker==0?(o.push(d()("div.time",{attributes:{style:`position: absolute; left: ${s}px;`}},[C.formatTime(r)])),a[s]=10):i.bigStep&&r%i.bigStep==0?a[s]=5:i.smallStep&&r%i.smallStep==0&&(a[s]=2)),r+=1e3*i.secondStep}return d()("div.playlist-time-scale",{attributes:{style:`position: relative; left: 0; right: 0; margin-left: ${this.marginLeft}px;`}},[o,d()("canvas",{attributes:{width:t,height:30,style:"position: absolute; left: 0; right: 0; top: 0; bottom: 0;"},hook:new S(a,this.offset,this.samplesPerPixel,this.duration,this.colors)})])}constructor(t,e,n,i,a=0,o){this.duration=t,this.offset=e,this.samplesPerPixel=n,this.sampleRate=i,this.marginLeft=a,this.colors=o,this.timeinfo={2e4:{marker:3e4,bigStep:1e4,smallStep:5e3,secondStep:5},12e3:{marker:15e3,bigStep:5e3,smallStep:1e3,secondStep:1},1e4:{marker:1e4,bigStep:5e3,smallStep:1e3,secondStep:1},5e3:{marker:5e3,bigStep:1e3,smallStep:500,secondStep:.5},2500:{marker:2e3,bigStep:1e3,smallStep:500,secondStep:.5},1500:{marker:2e3,bigStep:1e3,smallStep:200,secondStep:.2},700:{marker:1e3,bigStep:500,smallStep:100,secondStep:.1}}}}var P=n(1730),I=n.n(P),_=n(3520),O=n.n(_),A=new Uint8Array(16);let M=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var R=[],L=0;L<256;++L)R.push((L+256).toString(16).substr(1));let B=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(R[t[e+0]]+R[t[e+1]]+R[t[e+2]]+R[t[e+3]]+"-"+R[t[e+4]]+R[t[e+5]]+"-"+R[t[e+6]]+R[t[e+7]]+"-"+R[t[e+8]]+R[t[e+9]]+"-"+R[t[e+10]]+R[t[e+11]]+R[t[e+12]]+R[t[e+13]]+R[t[e+14]]+R[t[e+15]]).toLowerCase();if(!("string"==typeof n&&M.test(n)))throw TypeError("Stringified UUID is invalid");return n},D=function(e,n,i){var a=(e=e||{}).random||(e.rng||function(){if(!t&&!(t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(A)})();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,n){i=i||0;for(var o=0;o<16;++o)n[i+o]=a[o];return n}return B(a)};var N=n(4991),j=n.n(N),G=n(1114);let F=class{setup(t,e){this.samplesPerPixel=t,this.sampleRate=e}click(t){t.preventDefault();let e=t.offsetX*this.samplesPerPixel/this.sampleRate;this.track.ee.emit("select",e,e,this.track)}static getClass(){return".state-cursor"}static getEvents(){return["click"]}constructor(t){this.track=t}},U=class{setup(t,e){this.samplesPerPixel=t,this.sampleRate=e}emitSelection(t){let e=Math.min(t,this.startX),n=Math.max(t,this.startX),i=e*this.samplesPerPixel/this.sampleRate,a=n*this.samplesPerPixel/this.sampleRate;this.track.ee.emit("select",i,a,this.track)}complete(t){this.emitSelection(t),this.active=!1}mousedown(t){t.preventDefault(),this.active=!0,this.startX=t.offsetX;let e=this.startX*this.samplesPerPixel/this.sampleRate;this.track.ee.emit("select",e,e,this.track)}mousemove(t){this.active&&(t.preventDefault(),this.emitSelection(t.offsetX))}mouseup(t){this.active&&(t.preventDefault(),this.complete(t.offsetX))}mouseleave(t){this.active&&(t.preventDefault(),this.complete(t.offsetX))}static getClass(){return".state-select"}static getEvents(){return["mousedown","mousemove","mouseup","mouseleave"]}constructor(t){this.track=t,this.active=!1}},H={cursor:F,select:U,shift:class{setup(t,e){this.samplesPerPixel=t,this.sampleRate=e}emitShift(t){let e=(t-this.prevX)*this.samplesPerPixel/this.sampleRate;this.prevX=t,this.track.ee.emit("shift",e,this.track)}complete(t){this.emitShift(t),this.active=!1}mousedown(t){t.preventDefault(),this.active=!0,this.el=t.target,this.prevX=t.offsetX}mousemove(t){this.active&&(t.preventDefault(),this.emitShift(t.offsetX))}mouseup(t){this.active&&(t.preventDefault(),this.complete(t.offsetX))}mouseleave(t){this.active&&(t.preventDefault(),this.complete(t.offsetX))}static getClass(){return".state-shift"}static getEvents(){return["mousedown","mousemove","mouseup","mouseleave"]}constructor(t){this.track=t,this.active=!1}},fadein:class{setup(t,e){this.samplesPerPixel=t,this.sampleRate=e}click(t){let e=t.offsetX*this.samplesPerPixel/this.sampleRate;e>this.track.getStartTime()&&e<this.track.getEndTime()&&this.track.ee.emit("fadein",e-this.track.getStartTime(),this.track)}static getClass(){return".state-fadein"}static getEvents(){return["click"]}constructor(t){this.track=t}},fadeout:class{setup(t,e){this.samplesPerPixel=t,this.sampleRate=e}click(t){let e=t.offsetX*this.samplesPerPixel/this.sampleRate;e>this.track.getStartTime()&&e<this.track.getEndTime()&&this.track.ee.emit("fadeout",this.track.getEndTime()-e,this.track)}static getClass(){return".state-fadeout"}static getEvents(){return["click"]}constructor(t){this.track=t}}};class V{static drawFrame(t,e,n,i,a,o,s){let r=Math.abs(i*e),l=Math.abs(a*e);t.fillRect(n,0,o,e-l),t.fillRect(n,e+r,o,e-r),0!==s&&t.fillRect(n+o,0,s,2*e)}hook(t,e,n){if(void 0!==n&&n.peaks===this.peaks&&n.scale===this.scale&&n.height===this.height)return;let i=this.scale,a=t.width/i,o=t.getContext("2d"),s=t.height/i/2,r=2**(this.bits-1),l=this.barWidth,c=this.barGap,d=l+c;o.clearRect(0,0,t.width,t.height),o.save(),o.fillStyle=this.color,o.scale(i,i);for(let t=0;t<a;t+=d){let e=this.peaks[(t+this.offset)*2]/r,n=this.peaks[(t+this.offset)*2+1]/r;V.drawFrame(o,s,t,e,n,l,c)}o.restore()}constructor(t,e,n,i,a,o,s,r){this.peaks=t,this.offset=e,this.color=i,this.bits=n,this.scale=a,this.height=o,this.barWidth=s,this.barGap=r}}var z=n(6226);class W{static createCurve(t,e,n){let i,a;switch(e){case G.Y1:i=1;break;case G.h7:i=-1;break;default:throw Error("Unsupported fade type.")}switch(t){case G._h:a=(0,z.sCurve)(n,i);break;case G.t$:a=(0,z.linear)(n,i);break;case G.Jl:a=(0,z.exponential)(n,i);break;case G.Hp:a=(0,z.logarithmic)(n,10,i);break;default:throw Error("Unsupported fade shape")}return a}hook(t,e,n){if(void 0!==n&&n.shape===this.shape&&n.type===this.type&&n.duration===this.duration&&n.samplesPerPixel===this.samplesPerPixel)return;let i=t.getContext("2d"),a=t.width,o=t.height,s=W.createCurve(this.shape,this.type,a),r=s.length,l=o-s[0]*o;i.clearRect(0,0,t.width,t.height),i.save(),i.strokeStyle="black",i.beginPath(),i.moveTo(0,l);for(let t=1;t<r;t+=1)l=o-s[t]*o,i.lineTo(t,l);i.stroke(),i.restore()}constructor(t,e,n,i){this.type=t,this.shape=e,this.duration=n,this.samplesPerPixel=i}}let q=class{hook(t){t.value=100*this.gain,t.title=`${Math.round(100*this.gain)}% volume`}constructor(t){this.gain=t}},X=class{hook(t){let e;t.value=100*this.stereoPan,e=0===this.stereoPan?"Center":this.stereoPan<0?"Left":"Right";let n=`${Math.abs(Math.round(100*this.stereoPan))}% `;t.title=`Pan: ${0!==this.stereoPan?n:""}${e}`}constructor(t){this.stereoPan=t}},Y=class{setEventEmitter(t){this.ee=t}setName(t){this.name=t}setCustomClass(t){this.customClass=t}setWaveOutlineColor(t){this.waveOutlineColor=t}setCues(t,e){if(e<t)throw Error("cue out cannot be less than cue in");this.cueIn=t,this.cueOut=e,this.duration=this.cueOut-this.cueIn,this.endTime=this.startTime+this.duration}trim(t,e){let n=this.getStartTime(),i=this.getEndTime(),a=this.cueIn-n;if(n<=t&&i>=t||n<=e&&i>=e){let o=t<n?n:t;this.setCues(o+a,(e>i?i:e)+a),t>n&&this.setStartTime(t)}}setStartTime(t){this.startTime=t,this.endTime=t+this.duration}setPlayout(t){this.playout=t}setOfflinePlayout(t){this.offlinePlayout=t}setEnabledStates(t={}){this.enabledStates=I()({},{cursor:!0,fadein:!0,fadeout:!0,select:!0,shift:!0},t)}setFadeIn(t,e="logarithmic"){if(t>this.duration)throw Error("Invalid Fade In");this.fadeIn&&(this.removeFade(this.fadeIn),this.fadeIn=void 0),this.fadeIn=this.saveFade(G.Y1,e,0,t)}setFadeOut(t,e="logarithmic"){if(t>this.duration)throw Error("Invalid Fade Out");let n={shape:e,start:this.duration-t,end:this.duration};this.fadeOut&&(this.removeFade(this.fadeOut),this.fadeOut=void 0),this.fadeOut=this.saveFade(G.h7,n.shape,n.start,n.end)}saveFade(t,e,n,i){let a=D();return this.fades[a]={type:t,shape:e,start:n,end:i},a}removeFade(t){delete this.fades[t]}setBuffer(t){this.buffer=t}setPeakData(t){this.peakData=t}calculatePeaks(t,e){let n=v(this.cueIn,e),i=v(this.cueOut,e);this.setPeaks(j()(this.buffer,t,this.peakData.mono,n,i))}setPeaks(t){this.peaks=t}setState(t){if(this.state=t,this.state&&this.enabledStates[this.state]){let t=H[this.state];this.stateObj=new t(this)}else this.stateObj=void 0}getStartTime(){return this.startTime}getEndTime(){return this.endTime}getDuration(){return this.duration}isPlaying(){var t;return null===(t=this.playout)||void 0===t?void 0:t.isPlaying()}setShouldPlay(t){this.playout.setShouldPlay(t)}setGainLevel(t){this.gain=t,this.playout.setVolumeGainLevel(t)}setMasterGainLevel(t){this.playout.setMasterGainLevel(t)}setStereoPanValue(t){this.stereoPan=t,this.playout.setStereoPanValue(t)}setEffects(t){this.effectsGraph=t,this.playout.setEffects(t)}schedulePlay(t,e,n,i){let a,o;let s=t,r=n?n-e:void 0,l=I()({},{shouldPlay:!0,masterGain:1,isOffline:!1},i),c=l.isOffline?this.offlinePlayout:this.playout;if(this.endTime<=e||r&&e+r<this.startTime)return Promise.resolve();this.startTime>=e?(a=0,s+=this.startTime-e,n?(r-=this.startTime-e,o=Math.min(r,this.duration)):o=this.duration):(a=e-this.startTime,o=n?Math.min(r,this.duration-a):this.duration-a),a+=this.cueIn;let d=e-this.startTime,u=c.setUpSource();return O()(this.fades,e=>{let n,i;if(d<e.end)switch(d<=e.start?(n=t+(e.start-d),i=e.end-e.start):d>e.start&&d<e.end&&(n=t-(d-e.start),i=e.end-e.start),e.type){case G.Y1:c.applyFadeIn(n,i,e.shape);break;case G.h7:c.applyFadeOut(n,i,e.shape);break;default:throw Error("Invalid fade type saved on track.")}}),c.setVolumeGainLevel(this.gain),c.setShouldPlay(l.shouldPlay),c.setMasterGainLevel(l.masterGain),c.setStereoPanValue(this.stereoPan),c.play(s,a,o),u}scheduleStop(t=0){this.playout.stop(t)}renderOverlay(t){let e=y(t.playlistLength,t.resolution,t.sampleRate),n={attributes:{style:`position: absolute; top: 0; right: 0; bottom: 0; left: 0; width: ${e}px; z-index: 9;`}},i="";if(this.stateObj){this.stateObj.setup(t.resolution,t.sampleRate);let e=H[this.state];e.getEvents().forEach(t=>{n[`on${t}`]=this.stateObj[t].bind(this.stateObj)}),i=e.getClass()}return d()(`div.playlist-overlay${i}`,n)}renderControls(t){let e=t.muted?".active":"",n=t.soloed?".active":"",i=t.collapsed,a=this.peaks.data.length,o=t.controls.widgets,s=d()("button.btn.btn-danger.btn-xs.track-remove",{attributes:{type:"button",title:"Remove track"},onclick:()=>{this.ee.emit("removeTrack",this)}},[d()("i.fas.fa-times")]),r=d()("span",[this.name]),l=d()("button.btn.btn-info.btn-xs.track-collapse",{attributes:{type:"button",title:i?"Expand track":"Collapse track"},onclick:()=>{this.ee.emit("changeTrackView",this,{collapsed:!i})}},[d()(`i.fas.${i?"fa-caret-down":"fa-caret-up"}`)]),c=[];o.remove&&c.push(s),c.push(r),o.collapse&&c.push(l);let u=[d()("div.track-header",c)];return!i&&(o.muteOrSolo&&u.push(d()("div.btn-group",[d()(`button.btn.btn-outline-dark.btn-xs.btn-mute${e}`,{attributes:{type:"button"},onclick:()=>{this.ee.emit("mute",this)}},["Mute"]),d()(`button.btn.btn-outline-dark.btn-xs.btn-solo${n}`,{onclick:()=>{this.ee.emit("solo",this)}},["Solo"])])),o.volume&&u.push(d()("label.volume",[d()("input.volume-slider",{attributes:{"aria-label":"Track volume control",type:"range",min:0,max:100,value:100},hook:new q(this.gain),oninput:t=>{this.ee.emit("volumechange",t.target.value,this)}})])),o.stereoPan&&u.push(d()("label.stereopan",[d()("input.stereopan-slider",{attributes:{"aria-label":"Track stereo pan control",type:"range",min:-100,max:100,value:100},hook:new X(this.stereoPan),oninput:t=>{this.ee.emit("stereopan",t.target.value/100,this)}})]))),d()("div.controls",{attributes:{style:`height: ${a*t.height}px; width: ${t.controls.width}px; position: absolute; left: 0; z-index: 10;`}},u)}render(t){if(!this.peaks)return;let e=this.peaks.length,n=y(t.playbackSeconds,t.resolution,t.sampleRate),i=y(this.startTime,t.resolution,t.sampleRate),a=y(this.endTime,t.resolution,t.sampleRate),o=0,s=this.peaks.data.length,r=Math.ceil(window.devicePixelRatio);n>0&&n>i&&(o=n<a?n-i:e);let l=[d()("div.cursor",{attributes:{style:`position: absolute; width: 1px; margin: 0; padding: 0; top: 0; left: ${n}px; bottom: 0; z-index: 5;`}})],c=Object.keys(this.peaks.data).map(n=>{let a=[d()("div.channel-progress",{attributes:{style:`position: absolute; width: ${o}px; height: ${t.height}px; z-index: 2;`}})],s=0,l=e,c=this.peaks.data[n];for(;l>0;){let e=Math.min(l,1e3),n=this.waveOutlineColor?this.waveOutlineColor:t.colors.waveOutlineColor;a.push(d()("canvas",{attributes:{width:e*r,height:t.height*r,style:`float: left; position: relative; margin: 0; padding: 0; z-index: 3; width: ${e}px; height: ${t.height}px;`},hook:new V(c,s,this.peaks.bits,n,r,t.height,t.barWidth,t.barGap)})),l-=e,s+=1e3}if(this.fadeIn){let e=this.fades[this.fadeIn],n=y(e.end-e.start,t.resolution,t.sampleRate);a.push(d()("div.wp-fade.wp-fadein",{attributes:{style:`position: absolute; height: ${t.height}px; width: ${n}px; top: 0; left: 0; z-index: 4;`}},[d()("canvas",{attributes:{width:n,height:t.height},hook:new W(e.type,e.shape,e.end-e.start,t.resolution)})]))}if(this.fadeOut){let e=this.fades[this.fadeOut],n=y(e.end-e.start,t.resolution,t.sampleRate);a.push(d()("div.wp-fade.wp-fadeout",{attributes:{style:`position: absolute; height: ${t.height}px; width: ${n}px; top: 0; right: 0; z-index: 4;`}},[d()("canvas",{attributes:{width:n,height:t.height},hook:new W(e.type,e.shape,e.end-e.start,t.resolution)})]))}return d()(`div.channel.channel-${n}`,{attributes:{style:`height: ${t.height}px; width: ${e}px; top: ${n*t.height}px; left: ${i}px; position: absolute; margin: 0; padding: 0; z-index: 1;`}},a)});if(l.push(c),l.push(this.renderOverlay(t)),!0===t.isActive){let e=y(t.timeSelection.start,t.resolution,t.sampleRate),n=y(t.timeSelection.end,t.resolution,t.sampleRate)-e+1;l.push(d()(`div.selection${n>1?".segment":".point"}`,{attributes:{style:`position: absolute; width: ${n}px; bottom: 0; top: 0; left: ${e}px; z-index: 4;`}}))}let u=d()("div.waveform",{attributes:{style:`height: ${s*t.height}px; position: relative;`}},l),h=[],p=0;t.controls.show&&(h.push(this.renderControls(t)),p=t.controls.width),h.push(u);let m=t.shouldPlay?"":".silent",f=void 0===this.customClass?"":`.${this.customClass}`;return d()(`div.channel-wrapper${m}${f}`,{attributes:{style:`margin-left: ${p}px; height: ${t.height*s}px;`}},h)}getTrackDetails(){let t={src:this.src,start:this.startTime,end:this.endTime,name:this.name,muted:this.muted,soloed:this.soloed,customClass:this.customClass,cuein:this.cueIn,cueout:this.cueOut,stereoPan:this.stereoPan,gain:this.gain,effects:this.effectsGraph};if(this.fadeIn){let e=this.fades[this.fadeIn];t.fadeIn={shape:e.shape,duration:e.end-e.start}}if(this.fadeOut){let e=this.fades[this.fadeOut];t.fadeOut={shape:e.shape,duration:e.end-e.start}}return t}constructor(){this.name="Untitled",this.customClass=void 0,this.waveOutlineColor=void 0,this.gain=1,this.muted=!1,this.soloed=!1,this.fades={},this.peakData={type:"WebAudio",mono:!1},this.cueIn=0,this.cueOut=0,this.duration=0,this.startTime=0,this.endTime=0,this.stereoPan=0}};function J(t,e){t.connect(e)}let K=class{applyFade(t,e,n,i="logarithmic"){if(t===G.Y1)(0,G.L7)(this.fadeGain.gain,i,e,n);else if(t===G.h7)(0,G.Mt)(this.fadeGain.gain,i,e,n);else throw Error("Unsupported fade type")}applyFadeIn(t,e,n="logarithmic"){this.applyFade(G.Y1,t,e,n)}applyFadeOut(t,e,n="logarithmic"){this.applyFade(G.h7,t,e,n)}isPlaying(){return void 0!==this.source}getDuration(){return this.buffer.duration}setAudioContext(t){this.ac=t,this.destination=this.ac.destination}createStereoPanner(){return this.ac.createStereoPanner?this.ac.createStereoPanner():this.ac.createPanner()}setUpSource(){let t,e;this.source=this.ac.createBufferSource(),this.source.buffer=this.buffer;let n=new Promise(n=>{this.source.onended=()=>{this.source.disconnect(),this.fadeGain.disconnect(),this.volumeGain.disconnect(),this.shouldPlayGain.disconnect(),this.panner.disconnect(),t&&t(),e&&e(),this.source=void 0,this.fadeGain=void 0,this.volumeGain=void 0,this.shouldPlayGain=void 0,this.panner=void 0,n()}});return this.fadeGain=this.ac.createGain(),this.volumeGain=this.ac.createGain(),this.shouldPlayGain=this.ac.createGain(),this.panner=this.createStereoPanner(),this.source.connect(this.fadeGain),this.fadeGain.connect(this.volumeGain),this.volumeGain.connect(this.shouldPlayGain),this.shouldPlayGain.connect(this.panner),t=this.effectsGraph(this.panner,this.masterGain,this.ac instanceof(window.OfflineAudioContext||window.webkitOfflineAudioContext)),e=this.masterEffectsGraph(this.masterGain,this.destination,this.ac instanceof(window.OfflineAudioContext||window.webkitOfflineAudioContext)),n}setVolumeGainLevel(t){this.volumeGain&&(this.volumeGain.gain.value=t)}setShouldPlay(t){this.shouldPlayGain&&(this.shouldPlayGain.gain.value=t?1:0)}setMasterGainLevel(t){this.masterGain&&(this.masterGain.gain.value=t)}setStereoPanValue(t=0){this.panner&&(void 0!==this.panner.pan?this.panner.pan.value=t:(this.panner.panningModel="equalpower",this.panner.setPosition(t,0,1-Math.abs(t))))}setEffects(t=J){this.effectsGraph=t}setMasterEffects(t=J){this.masterEffectsGraph=t}play(t,e,n){this.source.start(t,e,n)}stop(t=0){this.source&&this.source.stop(t)}constructor(t,e,n=t.createGain()){this.ac=t,this.gain=1,this.effectsGraph=J,this.masterEffectsGraph=J,this.buffer=e,this.masterGain=n,this.destination=this.ac.destination}},Z=class{emitDrag(t){let e=t-this.prevX;if(e){let n=e*this.playlist.samplesPerPixel/this.playlist.sampleRate;this.prevX=t,this.playlist.ee.emit("dragged",n,this.data)}}complete(){this.active=!1,document.removeEventListener("dragover",this.ondragover)}dragstart(t){this.active=!0,this.prevX=t.clientX,t.dataTransfer.dropEffect="move",t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",""),document.addEventListener("dragover",this.ondragover)}dragend(t){this.active&&(t.preventDefault(),this.complete())}static getClass(){return".shift"}static getEvents(){return["dragstart","dragend"]}constructor(t,e={}){this.playlist=t,this.data=e,this.active=!1,this.ondragover=t=>{this.active&&(t.preventDefault(),this.emitDrag(t.clientX))}}},Q=function(){};Q.prototype.hook=function(t){let e=t.querySelector(".current");if(e){let n=t.getBoundingClientRect(),i=e.getBoundingClientRect().top-n.top;t.scrollTop+=i}};let tt=class{setupInteractions(){this.annotations.forEach((t,e)=>{let n=new Z(this.playlist,{direction:"left",index:e}),i=new Z(this.playlist,{direction:"right",index:e});this.resizeHandlers.push(n),this.resizeHandlers.push(i)})}setupEE(t){return t.on("dragged",(t,e)=>{let n=e.index,i=this.annotations,a=i[n];if("left"===e.direction){let e=a.start;a.start+=t,a.start<0&&(a.start=0),n&&i[n-1].end>a.start&&(i[n-1].end=a.start),this.playlist.linkEndpoints&&n&&i[n-1].end===e&&(i[n-1].end=a.start)}else{let e=a.end;a.end+=t,a.end>this.playlist.duration&&(a.end=this.playlist.duration),n<i.length-1&&i[n+1].start<a.end&&(i[n+1].start=a.end),this.playlist.linkEndpoints&&n<i.length-1&&i[n+1].start===e&&(i[n+1].start=a.end)}this.playlist.drawRequest()}),t.on("continuousplay",t=>{this.playlist.isContinuousPlay=t}),t.on("linkendpoints",t=>{this.playlist.linkEndpoints=t}),t.on("annotationsrequest",()=>{this.export()}),t}export(){let t=this.annotations.map(t=>({begin:String(t.start.toFixed(3)),end:String(t.end.toFixed(3)),id:String(t.id),language:t.lang,lines:t.lines})),e=`data:text/json;charset=utf-8,${encodeURIComponent(JSON.stringify(t))}`,n=document.createElement("a");document.body.appendChild(n),n.href=e,n.download="annotations.json",n.click(),document.body.removeChild(n)}renderResizeLeft(t){let e=Z.getEvents(),n={attributes:{style:"position: absolute; height: 30px; width: 10px; top: 0; left: -2px",draggable:!0}},i=this.resizeHandlers[2*t];return e.forEach(t=>{n[`on${t}`]=i[t].bind(i)}),d()("div.resize-handle.resize-w",n)}renderResizeRight(t){let e=Z.getEvents(),n={attributes:{style:"position: absolute; height: 30px; width: 10px; top: 0; right: -2px",draggable:!0}},i=this.resizeHandlers[2*t+1];return e.forEach(t=>{n[`on${t}`]=i[t].bind(i)}),d()("div.resize-handle.resize-e",n)}renderControls(t,e){let n=this;return this.controls.map(i=>d()(`i.${i.class}`,{attributes:{title:i.title},onclick:()=>{i.action(t,e,n.annotations,{linkEndpoints:n.playlist.linkEndpoints}),this.setupInteractions(),n.playlist.drawRequest()}}))}render(){let t=d()("div.annotations-boxes",{attributes:{style:`height: 30px; position: relative; margin-left: ${this.marginLeft}px;`}},this.annotations.map((t,e)=>{let n=this.playlist.samplesPerPixel,i=this.playlist.sampleRate,a=i/n,o=y(this.playlist.scrollLeft,n,i),s=Math.floor(t.start*a-o),r=Math.ceil(t.end*a-t.start*a);return d()("div.annotation-box",{attributes:{style:`position: absolute; height: 30px; width: ${r}px; left: ${s}px`,"data-id":t.id}},[this.renderResizeLeft(e),d()("span.id",{onclick:()=>{let t=this.annotations[e].start,n=this.annotations[e].end;this.playlist.isContinuousPlay?(this.playlist.seek(t,t),this.playlist.ee.emit("play",t)):(this.playlist.seek(t,n),this.playlist.ee.emit("play",t,n))}},[t.id]),this.renderResizeRight(e)])})),e=d()("div.annotations-boxes-wrapper",{attributes:{style:"overflow: hidden;"}},[t]),n=d()("div.annotations-text",{hook:new Q},this.annotations.map((t,e)=>{let n=function(t){function e(t,e){let n=parseInt(t/3600,10)%24,i=parseInt(t/60,10)%60,a=(t%60).toFixed(e),o=n<10?`0${n}`:n,s=i<10?`0${i}`:i,r=a<10?`0${a}`:a;return`${o}:${s}:${r}`}return({seconds:t=>t.toFixed(0),thousandths:t=>t.toFixed(3),"hh:mm:ss":function(t){return e(t,0)},"hh:mm:ss.u":function(t){return e(t,1)},"hh:mm:ss.uu":function(t){return e(t,2)},"hh:mm:ss.uuu":function(t){return e(t,3)}})[t]}(this.playlist.durationFormat),i=n(t.start),a=n(t.end),o="";this.playlist.isPlaying()&&this.playlist.playbackSeconds>=t.start&&this.playlist.playbackSeconds<=t.end&&(o=".current");let s=this.editable?{attributes:{contenteditable:!0},oninput:e=>{t.lines=[e.target.innerText]},onkeypress:t=>{(13===t.which||13===t.keyCode)&&(t.target.blur(),t.preventDefault())}}:{};return d()(`div.annotation${o}`,[d()("span.annotation-id",[t.id]),d()("span.annotation-start",[i]),d()("span.annotation-end",[a]),d()("span.annotation-lines",s,[t.lines]),d()("span.annotation-actions",this.renderControls(t,e))])}));return d()("div.annotations",[e,n])}constructor(t,e,n=[],i=!1,a=!1,o=!1,s=0){this.playlist=t,this.marginLeft=s,this.resizeHandlers=[],this.editable=i,this.annotations=e.map(t=>({id:t.id||D(),start:Number(t.begin)||0,end:Number(t.end)||0,lines:t.lines||[""],lang:t.language||"en"})),this.setupInteractions(),this.controls=n,this.setupEE(t.ee),this.playlist.isContinuousPlay=o,this.playlist.linkEndpoints=a,this.length=this.annotations.length}};function te(){function t(t,e){let n=2**(e-1);return Math.max(-n,Math.min(n-1,t<0?t*n:t*n-1))}onmessage=function(e){postMessage(function(e,n=1e4,i=8){if(0>[8,16,32].indexOf(i))throw Error("Invalid number of bits specified for peaks.");let a=[],o=e.length;return a.push(function(e,n,i){let a,o,s,r,l;let c=e.length,d=Math.ceil(c/n),u=new self[`Int${i}Array`](2*d);for(let h=0;h<d;h+=1)a=h*n,o=(h+1)*n>c?c:(h+1)*n,r=t((l=function(t){let e,n=1/0,i=-1/0;for(let a=0;a<t.length;a+=1)n>(e=t[a])&&(n=e),i<e&&(i=e);return{min:n,max:i}}(e.subarray(a,o))).min,i),s=t(l.max,i),u[2*h]=r,u[2*h+1]=s;return u}(e.subarray(0,o),n,i)),{bits:i,length:a[0].length/2,data:a}}(e.data.samples,e.data.samplesPerPixel))}}function tn(){let t,e=0,n=[],i=[];function a(t,e,n){for(let i=0;i<n.length;i+=1)t.setUint8(e+i,n.charCodeAt(i))}function o(t,e){let n=new Float32Array(e),i=0;for(let e=0;e<t.length;e+=1)n.set(t[e],i),i+=t[e].length;return n}onmessage=function(s){var r,l;switch(s.data.command){case"init":t=s.data.config.sampleRate;break;case"record":r=s.data.buffer,n.push(r[0]),i.push(r[1]),e+=r[0].length;break;case"exportWAV":l=s.data.type,postMessage(new Blob([function(e,n=!1){let i=new DataView(new ArrayBuffer(44+2*e.length));return a(i,0,"RIFF"),i.setUint32(4,32+2*e.length,!0),a(i,8,"WAVE"),a(i,12,"fmt "),i.setUint32(16,16,!0),i.setUint16(20,1,!0),i.setUint16(22,n?1:2,!0),i.setUint32(24,t,!0),i.setUint32(28,4*t,!0),i.setUint16(32,4,!0),i.setUint16(34,16,!0),a(i,36,"data"),i.setUint32(40,2*e.length,!0),function(t,e,n){let i=44;for(let e=0;e<n.length;e+=1,i+=2){let a=Math.max(-1,Math.min(1,n[e]));t.setInt16(i,a<0?32768*a:32767*a,!0)}}(i,0,e),i}(function(t,e){let n=t.length+e.length,i=new Float32Array(n),a=0,o=0;for(;a<n;)i[a+=1]=t[o],i[a+=1]=e[o],o+=1;return i}(o(n,e),o(i,e)))],{type:l}));break;case"clear":e=0,n=[],i=[];break;default:throw Error("Unknown export worker command")}}}let ti=class{initExporter(){this.exportWorker=new(g())(tn)}trimAudioBuffer(t,e){let n=t.sampleRate,i=Math.floor(e*n);if(i>=t.length)return this.ac.createBuffer(1,1,n);let a=this.ac.createBuffer(t.numberOfChannels,t.length-i,n);for(let e=0;e<t.numberOfChannels;e++){let n=t.getChannelData(e),o=a.getChannelData(e);for(let t=0;t<a.length;t++)o[t]=n[t+i]}return a}initRecorder(t,e,n="Recording"){this.fixedRecordingTrack=void 0!==e,this.recordingTrack=e,this.mediaRecorder=new MediaRecorder(t),this.mediaRecorder.onstart=()=>{if(!this.fixedRecordingTrack){let t=new Y;t.setName(n),t.setEnabledStates(),t.setEventEmitter(this.ee),this.recordingTrack=t,this.tracks.push(t)}let t=this.cursor;this.recordingTrack.setStartTime(t),this.chunks=[],this.working=!1},this.mediaRecorder.ondataavailable=t=>{if(this.chunks.push(t.data),!this.working){let t=new Blob(this.chunks,{type:"audio/ogg; codecs=opus"});E.createLoader(t,this.ac).load().then(t=>{this.latency>0&&(t=this.trimAudioBuffer(t,this.latency)),this.recorderWorker.postMessage({samples:t.getChannelData(0),samplesPerPixel:this.samplesPerPixel}),this.recordingTrack.setCues(0,t.duration),this.recordingTrack.setBuffer(t),this.recordingTrack.setPlayout(new K(this.ac,t,this.masterGainNode)),this.adjustDuration()}).catch(()=>{this.working=!1}),this.working=!0}},this.mediaRecorder.onstop=()=>{this.chunks=[],this.working=!1},this.recorderWorker=new(g())(te),this.recorderWorker.onmessage=t=>{this.recordingTrack.setPeaks(t.data),this.working=!1,this.drawRequest()}}setShowTimeScale(t){this.showTimescale=t}setMono(t){this.mono=t}setExclSolo(t){this.exclSolo=t}setSeekStyle(t){this.seekStyle=t}getSeekStyle(){return this.seekStyle}setSampleRate(t){this.sampleRate=t}setSamplesPerPixel(t){this.samplesPerPixel=t}setAudioContext(t){this.ac=t,this.masterGainNode=t.createGain()}getAudioContext(){return this.ac}setControlOptions(t){this.controls=t}setWaveHeight(t){this.waveHeight=t}setCollapsedWaveHeight(t){this.collapsedWaveHeight=t}setColors(t){this.colors=t}setBarWidth(t){this.barWidth=t}setBarGap(t){this.barGap=t}setAnnotations(t){let e=this.controls.show?this.controls.width:0;this.annotationList=new tt(this,t.annotations,t.controls,t.editable,t.linkEndpoints,t.isContinuousPlay,e)}setEffects(t){this.effectsGraph=t}setEventEmitter(t){this.ee=t}getEventEmitter(){return this.ee}setUpEventEmitter(){let t=this.ee;t.on("automaticscroll",t=>{this.isAutomaticScroll=t}),t.on("durationformat",t=>{this.durationFormat=t,this.drawRequest()}),t.on("select",(t,e,n)=>{this.isPlaying()?(this.lastSeeked=t,this.pausedAt=void 0,this.restartPlayFrom(t)):(this.seek(t,e,n),this.ee.emit("timeupdate",t),this.drawRequest())}),t.on("startaudiorendering",(t,e)=>{this.startOfflineRender(t,e)}),t.on("statechange",t=>{this.setState(t),this.drawRequest()}),t.on("shift",(t,e)=>{e.setStartTime(e.getStartTime()+t),this.adjustDuration(),this.drawRequest()}),t.on("record",t=>{this.latency=t,this.record()}),t.on("updateview",()=>{this.drawRequest()}),t.on("resume",async()=>{console.log(`Audio context state change: ${this.getAudioContext().state}`),"running"===this.getAudioContext().state&&await this.getAudioContext().resume()}),t.on("play",(t,e)=>{this.play(t,e)}),t.on("pause",()=>{this.pause()}),t.on("stop",()=>{this.stop()}),t.on("rewind",()=>{this.rewind()}),t.on("fastforward",()=>{this.fastForward()}),t.on("clear",()=>{this.clear().then(()=>{this.drawRequest()})}),t.on("solo",t=>{this.soloTrack(t),this.adjustTrackPlayout(),this.drawRequest()}),t.on("mute",t=>{this.muteTrack(t),this.adjustTrackPlayout(),this.drawRequest()}),t.on("removeTrack",t=>{this.removeTrack(t),this.adjustTrackPlayout(),this.drawRequest()}),t.on("changeTrackView",(t,e)=>{this.collapseTrack(t,e),this.drawRequest()}),t.on("volumechange",(t,e)=>{e.setGainLevel(t/100),this.drawRequest()}),t.on("mastervolumechange",t=>{this.masterGain=t/100,this.tracks.forEach(t=>{t.setMasterGainLevel(this.masterGain)})}),t.on("fadein",(t,e)=>{e.setFadeIn(t,this.fadeType),this.drawRequest()}),t.on("fadeout",(t,e)=>{e.setFadeOut(t,this.fadeType),this.drawRequest()}),t.on("stereopan",(t,e)=>{e.setStereoPanValue(t),this.drawRequest()}),t.on("fadetype",t=>{this.fadeType=t}),t.on("newtrack",t=>{this.load([{src:t,name:t.name}])}),t.on("trim",()=>{let t=this.getActiveTrack(),e=this.getTimeSelection();t.trim(e.start,e.end),t.calculatePeaks(this.samplesPerPixel,this.sampleRate),this.setTimeSelection(0,0),this.adjustDuration(),this.drawRequest()}),t.on("zoomin",()=>{let t=Math.max(0,this.zoomIndex-1),e=this.zoomLevels[t];e!==this.samplesPerPixel&&(this.setZoom(e),this.drawRequest())}),t.on("zoomout",()=>{let t=Math.min(this.zoomLevels.length-1,this.zoomIndex+1),e=this.zoomLevels[t];e!==this.samplesPerPixel&&(this.setZoom(e),this.drawRequest())}),t.on("scroll",()=>{this.isScrolling=!0,this.drawRequest(),clearTimeout(this.scrollTimer),this.scrollTimer=setTimeout(()=>{this.isScrolling=!1},200)})}load(t){return Promise.all(t.map(t=>E.createLoader(t.src,this.ac,this.ee).load().then(t=>t.sampleRate===this.sampleRate?t:function(t,e){let n=Math.ceil(t.duration*e),i=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(t.numberOfChannels,n,e),a=i.createBufferSource();return a.buffer=t,a.connect(i.destination),a.start(),i.startRendering()}(t,this.sampleRate)))).then(e=>{this.ee.emit("audiosourcesloaded");let n=e.map((e,n)=>{let i=t[n],a=i.name||"Untitled",o=i.start||0,s=i.states||{},r=i.fadeIn,l=i.fadeOut,c=i.cuein||0,d=i.cueout||e.duration,u=i.gain||1,h=i.muted||!1,p=i.soloed||!1,m=i.selected,f=i.peaks||{type:"WebAudio",mono:this.mono},g=i.customClass||void 0,v=i.waveOutlineColor||void 0,y=i.stereoPan||0,b=i.effects||null,k=new K(this.ac,e,this.masterGainNode),w=new Y;return w.src=i.src,w.setBuffer(e),w.setName(a),w.setEventEmitter(this.ee),w.setEnabledStates(s),w.setCues(c,d),w.setCustomClass(g),w.setWaveOutlineColor(v),void 0!==r&&w.setFadeIn(r.duration,r.shape),void 0!==l&&w.setFadeOut(l.duration,l.shape),void 0!==m&&(this.setActiveTrack(w),this.setTimeSelection(m.start,m.end)),void 0!==f&&w.setPeakData(f),w.setState(this.getState()),w.setStartTime(o),w.setPlayout(k),w.setGainLevel(u),w.setStereoPanValue(y),b&&w.setEffects(b),h&&this.muteTrack(w),p&&this.soloTrack(w),w.calculatePeaks(this.samplesPerPixel,this.sampleRate),w});this.tracks=this.tracks.concat(n),this.adjustDuration(),this.draw(this.render()),this.ee.emit("audiosourcesrendered")}).catch(t=>{this.ee.emit("audiosourceserror",t)})}setActiveTrack(t){this.activeTrack=t}getActiveTrack(){return this.activeTrack}isSegmentSelection(){return this.timeSelection.start!==this.timeSelection.end}setTimeSelection(t=0,e){this.timeSelection={start:t,end:void 0===e?t:e},this.cursor=t}async startOfflineRender(t,e){if(this.isRendering)return;this.isRendering=!0,this.offlineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(2,44100*this.duration,44100);let n=[];this.ee.emit("audiorenderingstarting",this.offlineAudioContext,n);let i=this.offlineAudioContext.currentTime,a=this.offlineAudioContext.createGain();this.tracks.forEach((t,n)=>{let o=this.shouldTrackPlay(t);e>=0&&(o=n===e);let s=new K(this.offlineAudioContext,t.buffer,a);s.setEffects(t.effectsGraph),s.setMasterEffects(this.effectsGraph),t.setOfflinePlayout(s),t.schedulePlay(i,0,0,{shouldPlay:o,masterGain:1,isOffline:!0})}),await Promise.all(n);let o=await this.offlineAudioContext.startRendering();"buffer"===t?(this.ee.emit("audiorenderingfinished",t,o),this.isRendering=!1):"wav"===t&&(this.exportWorker.postMessage({command:"init",config:{sampleRate:44100}}),this.exportWorker.onmessage=n=>{this.ee.emit("audiorenderingfinished",t,n.data,e),this.isRendering=!1,this.exportWorker.postMessage({command:"clear"})},this.exportWorker.postMessage({command:"record",buffer:[o.getChannelData(0),o.getChannelData(1)]}),this.exportWorker.postMessage({command:"exportWAV",type:"audio/wav"}))}getTimeSelection(){return this.timeSelection}setState(t){this.state=t,this.tracks.forEach(e=>{e.setState(t)})}getState(){return this.state}setZoomIndex(t){this.zoomIndex=t}setZoomLevels(t){this.zoomLevels=t}setZoom(t){this.samplesPerPixel=t,this.zoomIndex=this.zoomLevels.indexOf(t),this.tracks.forEach(e=>{e.calculatePeaks(t,this.sampleRate)})}muteTrack(t){let e=this.mutedTracks.indexOf(t);e>-1?(t.muted=!1,this.mutedTracks.splice(e,1)):(t.muted=!0,this.mutedTracks.push(t))}soloTrack(t){let e=this.soloedTracks.indexOf(t);e>-1?(t.soloed=!1,this.soloedTracks.splice(e,1)):this.exclSolo?(t.soloed=!0,this.soloedTracks=[t]):(t.soloed=!0,this.soloedTracks.push(t))}collapseTrack(t,e){if(e.collapsed)this.collapsedTracks.push(t);else{let e=this.collapsedTracks.indexOf(t);e>-1&&this.collapsedTracks.splice(e,1)}}removeTrack(t){t.isPlaying()&&t.scheduleStop(),[this.mutedTracks,this.soloedTracks,this.collapsedTracks,this.tracks].forEach(e=>{let n=e.indexOf(t);n>-1&&e.splice(n,1)}),this.adjustDuration()}adjustTrackPlayout(){this.tracks.forEach(t=>{t.setShouldPlay(this.shouldTrackPlay(t))})}adjustDuration(){this.duration=this.tracks.reduce((t,e)=>Math.max(t,e.getEndTime()),0)}shouldTrackPlay(t){let e;return this.soloedTracks.length>0?(e=!1,this.soloedTracks.indexOf(t)>-1&&(e=!0)):(e=!0,this.mutedTracks.indexOf(t)>-1&&(e=!1)),e}isPlaying(){return this.tracks.reduce((t,e)=>t||e.isPlaying()||this.mediaRecorder&&"recording"===this.mediaRecorder.state,!1)}getCurrentTime(){return(this.lastSeeked||this.pausedAt||this.cursor)+this.getElapsedTime()}getElapsedTime(){return this.ac.currentTime-this.lastPlay}setMasterGain(t){this.ee.emit("mastervolumechange",t)}restartPlayFrom(t,e){return this.stopAnimation(),this.tracks.forEach(t=>{t.scheduleStop()}),Promise.all(this.playoutPromises).then(this.play.bind(this,t,e))}play(t,e){clearTimeout(this.resetDrawTimer);let n=this.ac.currentTime,i=this.getTimeSelection(),a=[],o=0===t?0:t||this.pausedAt||this.cursor,s=e;return(!s&&i.end!==i.start&&i.end>o&&(s=i.end),this.isPlaying())?this.restartPlayFrom(o,s):(this.effectsGraph&&this.tracks&&this.tracks[0].playout.setMasterEffects(this.effectsGraph),this.tracks.forEach(t=>{t.setState("cursor"),a.push(t.schedulePlay(n,o,s,{shouldPlay:this.shouldTrackPlay(t),masterGain:this.masterGain}))}),this.lastPlay=n,this.playoutPromises=a,this.startAnimation(o),Promise.all(this.playoutPromises))}pause(){return this.isPlaying()?(this.pausedAt=this.getCurrentTime(),this.playbackReset()):Promise.all(this.playoutPromises)}stop(){return this.mediaRecorder&&"recording"===this.mediaRecorder.state&&this.mediaRecorder.stop(),this.pausedAt=void 0,this.playbackSeconds=0,this.playbackReset()}playbackReset(){return this.lastSeeked=void 0,this.stopAnimation(),this.tracks.forEach(t=>{t.scheduleStop(),t.setState(this.getState())}),this.isSafari||this.masterGainNode.disconnect(),this.drawRequest(),Promise.all(this.playoutPromises)}rewind(){return this.stop().then(()=>{this.scrollLeft=0,this.ee.emit("select",0,0)})}fastForward(){return this.stop().then(()=>{this.viewDuration<this.duration?this.scrollLeft=this.duration-this.viewDuration:this.scrollLeft=0,this.ee.emit("select",this.duration,this.duration)})}clear(t){return this.stop().then(()=>{var e=[];(t||0===t)&&(this.tracks.splice(t,1),e=this.tracks),this.tracks=e,this.soloedTracks=[],this.mutedTracks=[],this.playoutPromises=[],this.cursor=0,this.playbackSeconds=0,this.duration=0,this.scrollLeft=0,this.seek(0,0,void 0)})}record(){let t=[],e=this.cursor;this.mediaRecorder.start(300),this.tracks.forEach(n=>{n.setState("none"),t.push(n.schedulePlay(this.ac.currentTime,e,void 0,{shouldPlay:n!==this.recordingTrack&&this.shouldTrackPlay(n)}))}),this.playoutPromises=t,this.startAnimation(e)}startAnimation(t){this.lastDraw=this.ac.currentTime,this.animationRequest=window.requestAnimationFrame(()=>{this.updateEditor(t)})}stopAnimation(){window.cancelAnimationFrame(this.animationRequest),this.lastDraw=void 0}seek(t,e,n){this.isPlaying()?(this.lastSeeked=t,this.pausedAt=void 0,this.restartPlayFrom(t)):(this.setActiveTrack(n||this.tracks[0]),this.pausedAt=t,this.setTimeSelection(t,e),"fill"===this.getSeekStyle()&&(this.playbackSeconds=t))}updateEditor(t){let e=this.ac.currentTime,n=this.getTimeSelection(),i=t||this.cursor,a=e-this.lastDraw;if(this.isPlaying()){let t=i+a;this.ee.emit("timeupdate",t),this.animationRequest=window.requestAnimationFrame(()=>{this.updateEditor(t)}),this.playbackSeconds=t,this.draw(this.render()),this.lastDraw=e}else i+a>=(this.isSegmentSelection()?n.end:this.duration)&&this.ee.emit("finished"),this.stopAnimation(),this.resetDrawTimer=setTimeout(()=>{this.pausedAt=void 0,this.lastSeeked=void 0,this.setState(this.getState()),this.playbackSeconds=0,this.draw(this.render())},0)}drawRequest(){window.requestAnimationFrame(()=>{this.draw(this.render())})}draw(t){let e=h()(this.tree,t);this.rootNode=m()(this.rootNode,e),this.tree=t,this.viewDuration=(this.rootNode.clientWidth-this.controls.width)*this.samplesPerPixel/this.sampleRate}getTrackRenderData(t={}){let e={height:this.waveHeight,resolution:this.samplesPerPixel,sampleRate:this.sampleRate,controls:this.controls,isActive:!1,timeSelection:this.getTimeSelection(),playlistLength:this.duration,playbackSeconds:this.playbackSeconds,colors:this.colors,barWidth:this.barWidth,barGap:this.barGap};return a()({},t,e)}isActiveTrack(t){let e=this.getActiveTrack();return!this.isSegmentSelection()||e===t}renderAnnotations(){return this.annotationList.render()}renderTimeScale(){let t=this.controls.show?this.controls.width:0;return new C(this.duration,this.scrollLeft,this.samplesPerPixel,this.sampleRate,t,this.colors).render()}renderTrackSection(){let t=this.tracks.map(t=>{let e=this.collapsedTracks.indexOf(t)>-1;return t.render(this.getTrackRenderData({isActive:this.isActiveTrack(t),shouldPlay:this.shouldTrackPlay(t),soloed:this.soloedTracks.indexOf(t)>-1,muted:this.mutedTracks.indexOf(t)>-1,collapsed:e,height:e?this.collapsedWaveHeight:this.waveHeight,barGap:this.barGap,barWidth:this.barWidth}))});return d()("div.playlist-tracks",{attributes:{style:"overflow: auto;"},onscroll:t=>{this.scrollLeft=t.target.scrollLeft*this.samplesPerPixel/this.sampleRate,this.ee.emit("scroll")},hook:new T(this)},t)}render(){let t=[];return this.showTimescale&&t.push(this.renderTimeScale()),t.push(this.renderTrackSection()),this.annotationList.length&&t.push(this.renderAnnotations()),d()("div.playlist",{attributes:{style:"overflow: hidden; position: relative;"}},t)}getInfo(){let t=[];return this.tracks.forEach(e=>{t.push(e.getTrackDetails())}),{tracks:t,effects:this.effectsGraph}}constructor(){this.tracks=[],this.soloedTracks=[],this.mutedTracks=[],this.collapsedTracks=[],this.playoutPromises=[],this.cursor=0,this.playbackSeconds=0,this.duration=0,this.scrollLeft=0,this.scrollTimer=void 0,this.showTimescale=!1,this.isScrolling=!1,this.fadeType="logarithmic",this.masterGain=1,this.annotations=[],this.durationFormat="hh:mm:ss.uuu",this.isAutomaticScroll=!1,this.resetDrawTimer=void 0,this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}};function ta(t={},e=l()()){if(void 0===t.container)throw Error("DOM element container must be given.");let n=a()({},t,{samplesPerPixel:4096,mono:!0,fadeType:"logarithmic",exclSolo:!1,timescale:!1,controls:{show:!1,width:150,widgets:{muteOrSolo:!0,volume:!0,stereoPan:!0,collapse:!0,remove:!0}},colors:{waveOutlineColor:"white",timeColor:"grey",fadeColor:"black"},seekStyle:"line",waveHeight:128,collapsedWaveHeight:30,barWidth:1,barGap:0,state:"cursor",zoomLevels:[512,1024,2048,4096],annotationList:{annotations:[],controls:[],editable:!1,linkEndpoints:!1,isContinuousPlay:!1},isAutomaticScroll:!1}),i=n.zoomLevels.indexOf(n.samplesPerPixel);if(-1===i)throw Error("initial samplesPerPixel must be included in array zoomLevels");let o=new ti,r=window.AudioContext||window.webkitAudioContext||!1,c=n.ac||new r({latencyHint:0});o.setAudioContext(c),o.setSampleRate(n.sampleRate||c.sampleRate),o.setSamplesPerPixel(n.samplesPerPixel),o.setEventEmitter(e),o.setUpEventEmitter(),o.setTimeSelection(0,0),o.setState(n.state),o.setControlOptions(n.controls),o.setWaveHeight(n.waveHeight),o.setCollapsedWaveHeight(n.collapsedWaveHeight),o.setColors(n.colors),o.setZoomLevels(n.zoomLevels),o.setZoomIndex(i),o.setMono(n.mono),o.setExclSolo(n.exclSolo),o.setShowTimeScale(n.timescale),o.setSeekStyle(n.seekStyle),o.setAnnotations(n.annotationList),o.setBarGap(n.barGap),o.setBarWidth(n.barWidth),o.isAutomaticScroll=n.isAutomaticScroll,o.isContinuousPlay=n.isContinuousPlay,o.linkedEndpoints=n.linkedEndpoints,n.effects&&o.setEffects(n.effects);let d=o.render(),u=s()(d);return n.container.appendChild(u),o.tree=d,o.rootNode=u,o}function to(t={},e=l()()){return ta(t,e)}})(),i})();var d=s("7hG31"),ep=s("kJxWi"),c=s("lV0Oe"),em={},ef={};ef=function(t,e,n){if(e===self.location.origin)return t;var i=n?"import "+JSON.stringify(t)+";":"importScripts("+JSON.stringify(t)+");";return URL.createObjectURL(new Blob([i],{type:"application/javascript"}))};var eg=s("luG8Y");let ev=eg.getBundleURL("4Iqbg")+"metronomeworker.fe4b894a.js";em=ef(ev,eg.getOrigin(ev),!1);class ey{init(){this.timerWorker=new Worker(em),this.timerWorker.onmessage=t=>{"tick"===t.data&&this.scheduler()},this.timerWorker.postMessage({interval:this.lookahead})}nextNote(){let t=60/this.tempo*(4/this.noteDuration);this.nextNoteTime+=t,this.currentBeatInBar++,(this.currentBeatInBar===this.beatsPerBar||this.prevBeatBar!==this.beatsPerBar)&&(this.currentBeatInBar=0,this.prevBeatBar=this.beatsPerBar)}scheduleNote(t,e){this.notesInQueue.push({note:t,time:e});let n=this.audioContext.createOscillator(),i=this.audioContext.createGain();n.frequency.value=0===t?1e3:800,i.gain.value=1,i.gain.exponentialRampToValueAtTime(1,e+.001),i.gain.exponentialRampToValueAtTime(.001,e+.02),n.connect(i),i.connect(this.audioContext.destination),n.start(e),n.stop(e+.03)}scheduler(){for(;this.nextNoteTime<this.audioContext.currentTime+this.scheduleAheadTime;)this.scheduleNote(this.currentBeatInBar,this.nextNoteTime),this.nextNote()}start(t=0){if(this.isRunning)return;null===this.audioContext&&(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.isRunning=!0;let e=60/this.tempo*(4/this.noteDuration),n=Math.floor(t/e),i=t%(e*this.beatsPerBar);this.currentBeatInBar=n%this.beatsPerBar,this.nextNoteTime=this.audioContext.currentTime+.05-i,this.timerWorker.postMessage("start"),this.callback_start&&this.callback_start()}stop(){this.isRunning=!1,this.timerWorker.postMessage("stop"),this.callback_stop&&this.callback_stop()}startStop(t=0){this.isRunning?this.stop():this.start(t)}constructor(){this.audioContext=null,this.notesInQueue=[],this.currentBeatInBar=0,this.beatsPerBar=4,this.noteDuration=4,this.tempo=120,this.lookahead=25,this.scheduleAheadTime=.1,this.nextNoteTime=0,this.isRunning=!1,this.timerWorker=null,this.activate=!1,this.callback_start=null,this.callback_stop=null,this.prevBeatBar=4}}let eb=null,ek=()=>{(null==eb?void 0:eb.isRunning)&&eb.stop()},ew=()=>{let t=document.getElementById("tempo");t.textContent=eb.tempo;let e=document.querySelectorAll("[data-id='tempo-change']");for(let n=0;n<e.length;n++)e[n].addEventListener("click",function(){let e=parseInt(this.dataset.change),n=eb.tempo+e;n>=5&&n<=500&&(eb.tempo=n,t.textContent=eb.tempo,eS())})},ex=()=>{let t=document.getElementById("beatsperbar");t.textContent=eb.beatsPerBar;let e=document.querySelectorAll("[data-id='beatsperbar-change']");for(let n=0;n<e.length;n++)e[n].addEventListener("click",function(){let e=parseInt(this.dataset.change),n=eb.beatsPerBar+e;n>=1&&n<=50&&(eb.beatsPerBar=n,t.textContent=eb.beatsPerBar,document.getElementById("topnumbersignature").textContent=eb.beatsPerBar,eS())})},eE={1:"",2:"",4:"",8:"",16:""},eT=()=>{let t=document.getElementById("notedurationselectable");t.onchange=()=>{eb.noteDuration=t.value,document.getElementById("bottomnumbersignature").textContent=t.value,document.getElementById("noteMusicSymbol").textContent=eE[t.value],eS()}},eS=()=>{if(null==eb?void 0:eb.isRunning){let t=60/eb.tempo*(4/eb.noteDuration);document.getElementById("metronome-fonticon").style.animation=`blink ${t}s infinite`}},eC=()=>{document.getElementById("metronome-fonticon").classList.remove("text-success"),document.getElementById("metronome-fonticon").classList.add("text-warning"),eS()},eP=()=>{document.getElementById("metronome-fonticon").classList.remove("text-warning"),eb.activate&&document.getElementById("metronome-fonticon").classList.add("text-success"),document.getElementById("metronome-fonticon").style.animation="none"},eI=()=>{let t=document.getElementById("play-pause-icon");eb.startStop(),eb.isRunning?t.className="pause-metronome-icon":t.className="play-metronome-icon"},e_=()=>{eb.activate=!eb.activate,eb.activate?document.getElementById("metronome-fonticon").classList.add("text-success"):document.getElementById("metronome-fonticon").classList.remove("text-success")},eO=()=>{(0,c.default).dynamicModalDialog(`<div class='subtext-metronome'>Time signature: <span id='topnumbersignature'>4</span>/<span id='bottomnumbersignature'>4</span></div>
        <div class='metronome-controls'>
            <div class='metronome-switch custom-control custom-switch'>
                <input type='checkbox' class='custom-control-input' id='metronomeSwitch'>
                <label class='custom-control-label' for='metronomeSwitch'>Activate</label>
            </div>
        </div>
        <div class='metronome-controls'>
            <button id='play-button' type='button' class='btn metronome-button play-pause-metronome-button btn-success'>
                <div id='play-pause-icon' class='play-metronome-icon'></div>
            </button>
        </div>        
        <div class='metronome-controls'>
        
            <button data-id='tempo-change' type='button' class='btn btn-secondary metronome-button' data-change='-5'>-5</button>
            <button data-id='tempo-change' type='button' class='btn btn-light metronome-button' data-change='-1'>-</button>

            <div class='tempo-container'>
                <div id='tempo' class='number-metronome'>120</div>
                <div class='subtext-metronome'>bpm</div>
            </div>

            <button data-id='tempo-change' type='button' class='btn btn-light metronome-button' data-change='+1'>+</button>
            <button data-id='tempo-change' type='button' class='btn btn-secondary metronome-button' data-change='+5'>+5</button>
        </div>
        <div class='metronome-controls'>
            <button data-id='beatsperbar-change' type='button' class='btn btn-light metronome-button' data-change='-1'>-</button>
            <div class='bar-container'>
                <div id='beatsperbar' class='number-metronome'>4</div>
                <div class='subtext-metronome'>&nbsp;beats / bar</div>                
            </div>
            <button data-id='beatsperbar-change' type='button' class='btn btn-light metronome-button' data-change='+1'>+</button>            
        </div>
        <div class='metronome-controls'>
            <div class='tempo-container'>
                <label class='subtext-metronome' for='notedurationselectable'>Note value:&nbsp;</label>
                <span id='noteMusicSymbol' class='music-symbols'>
                    &#xE1D3;
                </span>
                <select class='custom-select' id='notedurationselectable'>
                    <option value='1'>1 = Whole note (semibreve)</option>
                    <option value='2'>2 = Minim</option>
                    <option value='4' selected>4 = Crotchet</option>
                    <option value='8'>8 = Quaver</option>
                    <option value='16'>16 = Semi-Quaver</option>
                </select>
            </div>
        </div>`,null,"","Close","<i class='fas fa-music'></i>&nbsp;&nbsp;<span>Metronome</span>","bg-secondary",ek),eb||((eb=new ey).init(),eb.callback_start=eC,eb.callback_stop=eP),eb.isRunning&&(document.getElementById("play-pause-icon").className="pause-metronome-icon");let t=document.getElementById("metronomeSwitch");t.checked=eb.activate,document.getElementById("play-button").onclick=eI,ew(),ex(),eT(),t.onclick=e_,document.getElementById("topnumbersignature").textContent=eb.beatsPerBar,document.getElementById("bottomnumbersignature").textContent=eb.noteDuration,document.getElementById("notedurationselectable").value=eb.noteDuration,document.getElementById("noteMusicSymbol").textContent=eE[eb.noteDuration]},eA=()=>`<li class='nav-item'>
    <a class='nav-link' href='#' id='trigger-metronome-btn' data-toggle='modal' 
      data-toggle='popover' data-placement='bottom'  title='Tic Tac...' data-content='Volume please'>
      METRONOME  <i id='metronome-fonticon' class='fas fa-square'>&nbsp;</i></a>
  </li>`,eM=()=>{document.getElementById("trigger-metronome-btn").onclick=()=>{eO()}};var eR=null,eL=$("body"),eB=eL.find(".time-format"),eD=eL.find(".audio-start"),eN=eL.find(".audio-end"),e$=eL.find(".audio-pos"),ej="hh:mm:ss.uuu",eG=0,eF=0,eU=0,eH=void 0,eV=!1,ez=!1;function eW(t){for(var e=t.parentNode.querySelectorAll(".active"),n=0,i=e.length;n<i;n++)e[n].classList.remove("active");t.classList.toggle("active")}function eq(t){function e(t,e){var n,i,a;return((n=parseInt(t/3600,10)%24)<10?"0"+n:n)+":"+((i=parseInt(t/60,10)%60)<10?"0"+i:i)+":"+((a=(a=t%60).toFixed(e))<10?"0"+a:a)}return({seconds:function(t){return t.toFixed(0)},thousandths:function(t){return t.toFixed(3)},"hh:mm:ss":function(t){return e(t,0)},"hh:mm:ss.u":function(t){return e(t,1)},"hh:mm:ss.uu":function(t){return e(t,2)},"hh:mm:ss.uuu":function(t){return e(t,3)}})[t]}function eX(t,e){t<e?($(".btn-trim-audio").removeClass("disabled"),$(".btn-loop").removeClass("disabled")):($(".btn-trim-audio").addClass("disabled"),$(".btn-loop").addClass("disabled")),eD.val(eq(ej)(t)),eN.val(eq(ej)(e)),eG=t,eF=e}function eY(t){e$.html(eq(ej)(t)),eU=t}eX(0,0),eY(eU);let eJ={};eL.on("click",".btn-annotations-download",function(){eR.emit("annotationsrequest")}),eL.on("click",".btn-loop",function(){eV=!0,n=nH.play(eG,eF)}),eL.on("click",".btn-play",function(){(null==eb?void 0:eb.activate)&&!(null==eb?void 0:eb.isRunning)&&eb.start(nH.cursor),eR.emit("play"),$(".btn-group .btn-record").prop("disabled",!0)}),eL.on("click",".btn-pause",function(){eV=!1,eR.emit("pause"),$(".btn-group .btn-record").prop("disabled",!1)}),eL.on("click",".btn-stop",function(){if((null==eb?void 0:eb.activate)&&(null==eb?void 0:eb.isRunning)&&eb.stop(),eV=!1,ez&&(ez=!1,nj)){let t=nH.getInfo().tracks.length-1;eR.emit("startaudiorendering","wav",t)}eR.emit("stop"),$(".btn-group button").prop("disabled",!1)}),eL.on("click",".btn-rewind",function(){eV=!1,eR.emit("rewind"),$(".btn-group .btn-record").prop("disabled",!1)}),eL.on("click",".btn-fast-forward",function(){eV=!1,eR.emit("fastforward"),$(".btn-group .btn-record").prop("disabled",!1)}),eL.on("click",".btn-clear",function(){eV=!1,eR.emit("clear")});let eK=t=>{ez||((null==eb?void 0:eb.activate)&&((null==eb?void 0:eb.isRunning)&&eb.stop(),eb.start(nH.cursor)),ez=!0,$(".btn-group button").prop("disabled",!0),$(".btn-group .btn-stop").prop("disabled",!1),eR.emit("record",t/1e3))};function eZ(t){if(null==t?void 0:t.customClass){let e=(({muted:t,gain:e,soloed:n,stereoPan:i})=>({muted:t,gain:e,soloed:n,stereoPan:i}))(t);e.track_id=t.customClass.track_id,e.composition_id=t.customClass.composition_id;let n=t.customClass.viewer_id||t2;u?p(u,e):h(n).then(t=>{p(t,e)})}}function eQ(t,e){eZ(e),$(".sound-status").html(t)}function e0(t){var e=$("<div/>").append(t);$(".loading-data").append(e)}eL.on("click",".btn-record",function(){if(nG)nQ();else if(!ez){t2?nj||n2():n1();let t=localStorage.getItem("latency");eK(t=t?parseInt(t):0)}}),eL.on("click",".btn-cursor",function(){eR.emit("statechange","cursor"),eW(this)}),eL.on("click",".btn-select",function(){eR.emit("statechange","select"),eW(this)}),eL.on("click",".btn-shift",function(){eR.emit("statechange","shift"),eW(this)}),eL.on("click",".btn-fadein",function(){eR.emit("statechange","fadein"),eW(this)}),eL.on("click",".btn-fadeout",function(){eR.emit("statechange","fadeout"),eW(this)}),eL.on("click",".btn-logarithmic",function(){eR.emit("fadetype","logarithmic"),eW(this)}),eL.on("click",".btn-linear",function(){eR.emit("fadetype","linear"),eW(this)}),eL.on("click",".btn-scurve",function(){eR.emit("fadetype","sCurve"),eW(this)}),eL.on("click",".btn-exponential",function(){eR.emit("fadetype","exponential"),eW(this)}),eL.on("click",".btn-zoom-in",function(){eR.emit("zoomin")}),eL.on("click",".btn-zoom-out",function(){eR.emit("zoomout")}),eL.on("click",".btn-trim-audio",function(){eR.emit("trim")}),eL.on("click",".btn.print",function(){console.log(nH.getInfo())}),eL.on("click",".btn-download",function(){nH.tracks.length&&eR.emit("startaudiorendering","wav")}),eL.on("click",".btn-seektotime",function(){var t=parseInt(document.getElementById("seektime").value,10);eR.emit("select",t,t)}),eL.on("change",".select-seek-style",function(t){nH.setSeekStyle(t.target.value)}),eL.on("change","#fileInput",function(t){for(var e=this.files,n=0;n<e.length;n++)eR.emit("newtrack",e[n])}),eL.on("dragenter",".track-drop",function(t){t.preventDefault(),t.target.classList.add("drag-enter")}),eL.on("dragover",".track-drop",function(t){t.preventDefault()}),eL.on("dragleave",".track-drop",function(t){t.preventDefault(),t.target.classList.remove("drag-enter")}),eL.on("drop",".track-drop",function(t){t.preventDefault(),t.target.classList.remove("drag-enter");for(var e=t.originalEvent,n=0;n<e.dataTransfer.files.length;n++)eR.emit("newtrack",e.dataTransfer.files[n])}),eL.on("change",".time-format",function(t){ej=eB.val(),eR.emit("durationformat",ej),eX(eG,eF),eY(eU)}),eL.on("input change",".master-gain",function(t){eR.emit("mastervolumechange",t.target.value)}),eL.on("change",".continuous-play",function(t){eR.emit("continuousplay",$(t.target).is(":checked"))}),eL.on("change",".link-endpoints",function(t){eR.emit("linkendpoints",$(t.target).is(":checked"))}),eL.on("change",".automatic-scroll",function(t){eR.emit("automaticscroll",$(t.target).is(":checked"))});let e1=()=>{eR=nH.getEventEmitter()},e2=()=>{eR.on("select",eX),eR.on("timeupdate",eY),eR.on("mute",function(t){eQ("Mute button pressed for "+t.name,t)}),eR.on("solo",function(t){eQ("Solo button pressed for "+t.name,t)});let t=null;eR.on("volumechange",function(e,n){eQ(n.name+" now has volume "+e+"."),clearTimeout(t),t=setTimeout(()=>{eZ(n)},500)});let e=null;eR.on("stereopan",function(t,n){eQ(n.name+" now has stereo pan "+t+"."),clearTimeout(e),e=setTimeout(()=>{eZ(n)},500)}),eR.on("mastervolumechange",function(t){eQ("Master volume now has volume "+t+".")});var i=["uninitialized","loading","decoding","finished"];eR.on("audiorequeststatechange",function(t,e){var n=e;e instanceof File&&(n=e.name),e0("Track "+n+" is in state "+i[t])}),eR.on("loadprogress",function(t,e){var n=e;e instanceof File&&(n=e.name),function(t,e){let n=document.getElementById("download-progress-elems");if(n&&!n.hidden){let i=0;eJ[t]=e;let a=document.getElementById("download-progress-bar"),o=document.getElementById("download-percentage");for(let[t,e]of Object.entries(eJ))i+=e;let s=(i/t3).toFixed(2);a.value=s/100,o.innerHTML=s+" %",100==s&&(n.innerHTML="Rendering...<br><progress></progress>")}}(n,t),e0("Track "+n+" has loaded "+t+"%")}),eR.on("audiosourcesloaded",function(){e0("Tracks have all finished decoding.")});let a=0,o=[];eR.on("audiosourcesrendered",function(){if(nZ(),n3(),nj){let t=document.getElementById("fileInput"),e=t.files.length;if(e){let n=nH.tracks.length-1,i=Date.now();if(nH.tracks[n].trackuid=i,a<e&&(o.push(nH.tracks[n]),a++),a===e){let e=Array.from(t.files);for(let n=0;n<t.files.length;n++){let t=e.findIndex(t=>t.name===o[n].name);nz.sendData(e[t],null,o[n].trackuid)}o=[],a=0}}else e0("Tracks have been rendered")}}),eR.on("audiosourceserror",function(t){n0(t)}),eR.on("audiorenderingfinished",function(t,e,n){if(n>=0&&nj){let t=Date.now();e.name="audio",e.fileName=t+".wav",nH.tracks[n].trackuid=t,nz.sendData(e,"blob",t)}else if("wav"==t){var i,a;eH&&window.URL.revokeObjectURL(eH),a=$("<a/>",{href:eH=window.URL.createObjectURL(e),download:"waveformplaylist"+(i=new Date().toISOString())+".wav",text:"Download mix "+i,class:"btn btn-small btn-download-link"}),$(".btn-download-link").remove(),$(".btn-download").after(a)}}),eR.on("finished",function(){console.log("The cursor has reached the end of the selection !"),$(".btn-group .btn-record").prop("disabled",!1),eV&&n.then(function(){n=nH.play(eG,eF)})})},e3=window.AudioContext||window.webkitAudioContext||!1,e4=()=>{let t=document.getElementById("autocorrelationCanvas1");t.width=window.innerWidth/2,t.height=window.innerHeight/2,t.getContext("2d").clearRect(0,0,t.width,t.height);let e=document.getElementById("autocorrelationCanvas2");e.width=window.innerWidth/2,e.height=window.innerHeight/2,e.getContext("2d").clearRect(0,0,e.width,e.height);let n=document.getElementById("leftChannelCanvas");n.getContext("2d").clearRect(0,0,n.width,n.height);let i=document.getElementById("rightChannelCanvas");i.getContext("2d").clearRect(0,0,i.width,i.height)},e6=(t,e,n,i)=>{let a=document.getElementById(e);!function(t,e,n,i){let a=Math.ceil(i.length/t),o=e/2;for(let e=0;e<t;e++){let t=1,s=-1;for(let n=0;n<a;n++){let o=i[e*a+n];o<t&&(t=o),o>s&&(s=o)}n.fillRect(e,(1+t)*o,1,Math.max(1,(s-t)*o))}}(a.width,a.height,a.getContext("2d"),t),function(t,e){let n=document.getElementById(e);n.width=window.innerWidth/2,n.height=window.innerHeight/2;let i=n.getContext("2d");i.clearRect(0,0,n.width,n.height);let a=n.width,o=n.height,s=Math.max(...t);t.forEach((e,n)=>{let r=n/t.length*(a-40)+20;i.beginPath(),i.moveTo(r,o-20),i.lineTo(r,(1-e/s)*(o-40)+20),i.strokeStyle="#FF0000",i.stroke()}),i.fillStyle="#000000",i.textAlign="center",i.textBaseline="top";let r=Math.ceil(t.length/10);for(let e=0;e<=t.length;e+=r){let n=e/t.length*(a-40)+20;i.fillText(e,n,o-10)}i.textAlign="right",i.textBaseline="middle";let l=s/5;for(let t=0;t<=5;t++){let e=(l*t).toFixed(2),n=(1-t/5)*(o-40)+20;i.fillText(e,10,n)}}(i,n)};class e7 extends Error{constructor(t){super(t),this.name="BitError"}}let e9={2:[1],3:[2],4:[3],5:[2],6:[5],7:[6],8:[4,5,6],9:[5],10:[7],11:[9],12:[6,8,11],13:[4,12],14:[5,13],15:[14],16:[4,13,15]},e5=`<div class='container' id='audio-area'>
                    <canvas id='leftChannelCanvas' width='800' height='100' style='border:1px solid #000000;'></canvas>
                    <canvas id='rightChannelCanvas' width='800' height='100' style='border:1px solid #000000;' hidden></canvas>
                    <canvas id='autocorrelationCanvas1' style='border:1px solid #000000;'></canvas>
                    <canvas id='autocorrelationCanvas2' style='border:1px solid #000000;' hidden></canvas>
                </div>`;var e8={},eg=s("luG8Y");let nt=eg.getBundleURL("4Iqbg")+"worker.e40333ee.js";e8=ef(nt,eg.getOrigin(nt),!1);class ne{static setCurrentLatency(t){localStorage.setItem("latency",t),nI(t),ne.currentlatency=t}static getCurrentLatency(){return ne.currentlatency}static getCorrectStreamForSafari(t){let e=parseInt(ne.browserId.version);if("safari"!==ne.browserId.browser||!(e>=16))return t;{let e=ne.audioContext.createMediaStreamSource(t);ne.recordGainNode=ne.audioContext.createGain(),e.connect(ne.recordGainNode),ne.recordGainNode.gain.value=50;let n=ne.audioContext.createMediaStreamDestination();return n.channelCount=1,ne.recordGainNode.connect(n),n.stream}}static async initialize(t,e,n,i,a){ne.browserId=a,ne.btnId=n,ne.worker=new Worker(e8),ne.worker.addEventListener("message",t=>{ne.workerMessageHanlder(t)}),i&&(console.log("AudioContext",t),ne.debugCanvas=i,document.getElementById("page-header").insertAdjacentHTML("afterend",e5));let o=localStorage.getItem("latency");ne.currentlatency=o?parseInt(o):null,ne.audioContext=t,ne.onAudioPermissionGranted(e)}static onAudioPermissionGranted(t){let e=function(t,e=null){if(!(t in e9))throw new e7(`taps for ${t} bits unknown`);let n=e9[t];if(null===e)e=Array(t).fill(1);else if(e.length!==t)throw new e7(`length of seed must equal ${t}`);return function(t,e){let n=e.length,i=e.slice(),a=[];for(let e=0;e<(1<<n)-1;e++){let e=i[0];a.push(e?1:0),t.forEach(t=>{e^=i[t]}),i.push(e),i.shift()}return a}(n,e)}(parseInt(15));ne.noiseBuffer=ne.generateAudio(e,ne.audioContext.sampleRate);let n=ne.getCorrectStreamForSafari(t);ne.inputStream=n,ne.debugCanvas&&n.getTracks().forEach(async function(t){console.log("Test Latency Track Settings",t.getSettings())}),ne.displayStart()}static displayStart(){ne.content=document.getElementById(ne.btnId),ne.content.innerHTML="",ne.startbutton=document.createElement("a"),ne.startbutton.innerText="TEST LATENCY",ne.startbutton.classList.add("btn-outline-success"),ne.startbutton.onclick=ne.onAudioSetupFinished,ne.content.appendChild(ne.startbutton),ne.debugCanvas&&e4()}static async onAudioSetupFinished(){ne.startbutton.innerText="STOP",ne.startbutton.classList.remove("btn-outline-success"),ne.startbutton.classList.add("btn-outline-danger"),ne.startbutton.onclick=ne.displayStart,ne.prepareAudioToPlayAndrecord()}static prepareAudioToPlayAndrecord(){ne.signalrecorded=null;let t=ne.audioContext.createBuffer(1,4*ne.audioContext.sampleRate,ne.audioContext.sampleRate),e=ne.audioContext.createBufferSource();e.buffer=t,e.start(0),(()=>{let t=ne.audioContext.createBufferSource();t.buffer=ne.noiseBuffer,t.connect(ne.audioContext.destination);let e=[],n=new MediaRecorder(ne.inputStream);n.ondataavailable=async t=>{e.push(t.data)},n.onstop=async()=>{t.disconnect(ne.audioContext.destination),ne.displayAudioTagElem(e,n.mimeType)},n.start(),t.start(),t.onended=function(){n.stop(),ne.finishTest()}})()}static finishTest(){ne.startbutton.innerText="PROCESSING... ",ne.startbutton.classList.remove("btn-outline-danger"),ne.startbutton.classList.add("btn-outline-primary"),ne.startbutton.onclick=ne.displayStart}static async blobToAudioBuffer(t,e){let n=await e.arrayBuffer();return await t.decodeAudioData(n)}static workerMessageHanlder(t){t.data.correlation&&(ne.correlation=t.data.correlation,ne.worker.postMessage({command:"findpeak",array:ne.correlation,channel:t.data.channel})),t.data.peakValuePow&&ne.displayresults(t.data,ne.signalrecorded,ne.noiseBuffer,ne.correlation)}static async displayAudioTagElem(t,e){let n=new Blob(t,{type:e});ne.signalrecorded=await ne.blobToAudioBuffer(ne.audioContext,n),ne.debugCanvas&&(console.log("signalrecorded",ne.signalrecorded),console.log("mlssignal",ne.noiseBuffer)),ne.correlation=null,ne.worker.postMessage({command:"correlation",data1:ne.signalrecorded.getChannelData(0),data2:ne.noiseBuffer.getChannelData(0),maxLag:.6*ne.audioContext.sampleRate,channel:0}),URL.revokeObjectURL(n)}static generateAudio(t,e){let n=ne.audioContext.createBuffer(1,t.length,e),i=n.getChannelData(0);for(let e=0;e<t.length;e++)i[e]=1===t[e]?1:-1;return n}static displayresults(t,e,n,i){if(0===t.channel){let a=Number(t.peakIndex/n.sampleRate*1e3).toFixed(2),o=10*Math.log10(t.peakValuePow/t.mean);console.log("Corr Ratio",o),isNaN(o)||o<=18?$("#latencyTestWarning").modal("show"):ne.setCurrentLatency(a),ne.startbutton.innerText="TEST AGAIN ",ne.startbutton.innerHTML+=`<span class='badge badge-info'>lat: ${a} ms.</span>`,ne.startbutton.innerHTML+=`<span class='badge badge-light'>ratio: ${o.toFixed(2)} dB</span>`,ne.startbutton.classList.remove("btn-outline-danger"),ne.debugCanvas&&(console.log("peak energy info",t),console.log("Latency = ",a+" ms"),e6(e.getChannelData(0),"leftChannelCanvas","autocorrelationCanvas1",i),console.log("signalrecorded.numberOfChannels",e.numberOfChannels),e.numberOfChannels>1&&(document.getElementById("rightChannelCanvas").hidden=!1,document.getElementById("autocorrelationCanvas2").hidden=!1,ne.correlation=null,ne.worker.postMessage({command:"correlation",data1:ne.signalrecorded.getChannelData(1),data2:ne.noiseBuffer.getChannelData(0),maxLag:.6*ne.audioContext.sampleRate,channel:1})))}else console.log("Channel",t.channel),console.log("Latency = ",t.peakIndex/n.sampleRate*1e3+" ms"),console.log("Corr Ratio",10*Math.log10(t.peakValuePow/t.mean)),e6(e.getChannelData(1),"rightChannelCanvas","autocorrelationCanvas2",ne.correlation)}constructor(){tx(this,"currentlatency",null),tx(this,"noiseBuffer",null),tx(this,"debugCanvas",!1),tx(this,"audioContext",null),tx(this,"worker",null),tx(this,"signalrecorded",null),tx(this,"btnId",null),tx(this,"inputStream",null),tx(this,"browserId",null)}}let nn={measure_average_loudness_for_1_sec:0,playing_and_listening:1,waiting:2,passthrough:3,idle:4};function ni(t,e,n){let i=0;for(let a=0;a<n;a++)i+=Math.abs(t[a])+Math.abs(e[a]);return i}class na{toggle(){-1==this.state||this.state>0&&this.state<no+1?(this.state=0,this.nextMeasurementState=nn.idle):(this.state=1,this.samplerate=this.latencyMs=this.buffersize=0,this.nextMeasurementState=nn.measure_average_loudness_for_1_sec)}processInput(t,e,n,i){switch(this.rampdec=-1,this.samplerate=n,this.buffersize=i,this.nextMeasurementState!=this.measurementState&&(this.nextMeasurementState==nn.measure_average_loudness_for_1_sec&&(this.samplesElapsed=0),this.measurementState=this.nextMeasurementState),this.measurementState){case nn.measure_average_loudness_for_1_sec:if(this.sum+=ni(t,e,i),this.samplesElapsed+=i,this.samplesElapsed>=this.samplerate){let t=20*Math.log10(this.sum/(this.samplesElapsed>>1))+24;this.threshold=Math.pow(10,t/20),this.measurementState=this.nextMeasurementState=nn.playing_and_listening,this.sineWave=0,this.samplesElapsed=0,this.sum=0}break;case nn.playing_and_listening:let a=ni(t,e,i)/i;if(this.rampdec=0,a>this.threshold){let n=0,a=0;for(;n<i&&!(t[a]>this.threshold)&&!(e[a++]>this.threshold);)n++;if(this.samplesElapsed+=n,this.samplesElapsed>i){this.roundTripLatencyMs[this.state-1]=1e3*this.samplesElapsed/this.samplerate;let t=0,e=1e5;for(n=0;n<this.state;n++)this.roundTripLatencyMs[n]>t&&(t=this.roundTripLatencyMs[n]),this.roundTripLatencyMs[n]<e&&(e=this.roundTripLatencyMs[n]),this.sum+=this.roundTripLatencyMs[n];t/e>2?(this.latencyMs=0,this.state=no,this.measurementState=this.nextMeasurementState=nn.idle):this.state==no?(this.latencyMs=parseInt(.1*this.sum),this.measurementState=this.nextMeasurementState=nn.idle):(this.latencyMs=parseInt(this.roundTripLatencyMs[this.state-1]),this.measurementState=this.nextMeasurementState=nn.waiting),this.state++}else this.measurementState=this.nextMeasurementState=nn.waiting;this.rampdec=1/i}else this.samplesElapsed+=i,this.samplesElapsed>this.samplerate&&(this.rampdec=1/i,this.measurementState=this.nextMeasurementState=nn.waiting,this.latencyMs=-1,this.samplesElapsed=0);break;case nn.passthrough:case nn.idle:break;default:this.samplesElapsed+=i,this.sum=0,this.samplesElapsed>this.samplerate&&(this.samplesElapsed=0,this.measurementState=this.nextMeasurementState=nn.measure_average_loudness_for_1_sec)}}processOutput(t,e){if(this.measurementState!=nn.passthrough){if(this.rampdec<0){let n=2*this.buffersize,i=0;for(;n--;)t[i]=e[i++]=0}else{let n=1,i=2*Math.PI*1e3/this.samplerate,a=this.buffersize,o=0;for(;a--;)t[o]=e[o++]=Math.sin(i*this.sineWave)*n,n-=this.rampdec,this.sineWave+=1}}}constructor(){this.measurementState=this.nextMeasurementState=nn.idle,this.samplesElapsed=this.sineWave=this.sum=this.threshold=this.state=this.samplerate=this.latencyMs=this.buffersize=0,this.roundTripLatencyMs=Array(no).fill(0)}}var d=s("7hG31");let no=6;class ns{static setCurrentLatency(t){localStorage.setItem("latency",t),ns.currentlatency=t}static getCurrentLatency(){return ns.currentlatency}static initialize(t){let e=localStorage.getItem("latency");ns.currentlatency=e?parseInt(e):null,ns.audioContext=ns.audioNode=null,ns.audioContext=t,ns.displayStart()}static displayStart(){ns.audioNode=null,ns.content=document.getElementById(nE),ns.content.innerHTML="",ns.startbutton=document.createElement("a"),ns.startbutton.innerText="TEST LATENCY",ns.startbutton.classList.add("btn-outline-warning"),ns.startbutton.onclick=ns.start,ns.content.appendChild(ns.startbutton),$("#"+nE).popover("hide"),$("#"+nE).popover({trigger:"focus"})}static onAudioInputPermissionDenied(t){console.log(t)}static onMessageFromAudioScope(t){if(t.latency>0){nI(t.latency),ns.setCurrentLatency(t.latency);let e=t.state-1;$("#"+nE).attr("data-content",e+"/5 trials. Current latency: "+t.latency+" ms."),$("#"+nE).popover("show")}else $("#"+nE).attr("data-content","No input detected"),$("#"+nE).popover("show");t.state>=no&&ns.finishTest(t.latency)}static onAudioSetupFinished(){ns.audioInput=ns.audioContext.createMediaStreamSource(ns.inputStream),ns.audioInput.connect(ns.audioNode),ns.audioNode.connect(ns.audioContext.destination),ns.startbutton.innerText="STOP",ns.startbutton.classList.remove("btn-outline-warning"),ns.startbutton.classList.add("btn-outline-danger"),ns.startbutton.onclick=ns.finishTest}static displayResultLatency(t){t&&t>0&&(ns.startbutton.innerText="TEST AGAIN ","object"!=typeof t&&(ns.startbutton.innerHTML+=`<span class="badge badge-info">latency: ${t} ms.</span>`),ns.startbutton.classList.remove("btn-outline-danger"),ns.startbutton.classList.add("btn-outline-primary"))}static finishTest(t){ns.audioInput.disconnect(ns.audioNode),ns.audioNode.disconnect(ns.audioContext.destination),ns.audioNode=null,ns.displayResultLatency(t),ns.startbutton.onclick=ns.displayStart,$("#"+nE).popover("hide")}static onAudioPermissionGranted(t){ns.inputStream=t,ns.latencyMeasurer=new na,ns.latencyMeasurer.toggle(),ns.lastState=0,ns.audioNode=ns.audioContext.createScriptProcessor(256,2,2),ns.audioNode.onaudioprocess=function(t){ns.latencyMeasurer.processInput(t.inputBuffer.getChannelData(0),t.inputBuffer.getChannelData(1),ns.audioContext.sampleRate,t.inputBuffer.length),ns.latencyMeasurer.processOutput(t.outputBuffer.getChannelData(0),t.outputBuffer.getChannelData(1)),ns.lastState!=ns.latencyMeasurer.state&&(ns.lastState=ns.latencyMeasurer.state,ns.onMessageFromAudioScope({state:ns.lastState,latency:ns.latencyMeasurer.latencyMs}))},ns.onAudioSetupFinished()}static async start(){$("#"+nE).popover("hide"),navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(d.MEDIA_CONSTRAINTS).then(ns.onAudioPermissionGranted).catch(ns.onAudioInputPermissionDenied):ns.onAudioInputPermissionDenied("Can't access getUserMedia.")}constructor(){this.currentlatency=null,this.audioInput=null}}var nr={};nr=s("luG8Y").getBundleURL("4Iqbg")+"processor.13fb62cf.js";let nl=navigator.userAgent.indexOf("Version/"),nc=parseFloat(navigator.userAgent.substring(nl+8)),nd=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);class nu{static async initialize(t,n){nu.buttonHandlers();try{nu.ac=t,await nu.ac.audioWorklet.addModule(e(nr));let i=nu.ac.createMediaStreamSource(n);nu.worklet_node=new AudioWorkletNode(nu.ac,"measure-processor",{outputChannelCount:[1]}),nu.worklet_node.channelCount=1;let a=1;nd&&nc>16&&(a=50);let o=nu.ac.createGain();o.gain.value=a,i.connect(o),o.connect(nu.worklet_node),nu.worklet_node.port.onmessage=function(t){nu.displayResults(t)}}catch(t){console.log(t)}}static buttonHandlers(){nu.btnstart=document.getElementById("btn-start"),nu.btnstart.onclick=nu.startTest}static displayResults(t){nu.running&&t.data.latency&&(nu.latvalue=Number(1e3*t.data.latency).toFixed(2),nu.btnstart.innerHTML=`STOP <span class='badge badge-info'>lat: ${nu.latvalue} ms.</span>`,nI(nu.latvalue))}static startTest(){nu.latvalue=0,nu.worklet_node.connect(nu.ac.destination),nu.btnstart.innerText="STOP",nu.btnstart.onclick=nu.stopTest,nu.running=!0}static async stopTest(){nu.latvalue&&0!==nu.latvalue?(localStorage.setItem("latency",nu.latvalue),nu.btnstart.innerHTML=`START <span class='badge badge-info'>lat: ${nu.latvalue} ms.</span>`):nu.btnstart.innerHTML="START",nu.worklet_node.disconnect(nu.ac.destination),nu.btnstart.onclick=nu.startTest,nu.running=!1}constructor(){tx(this,"ac",null),tx(this,"worklet_node",null),tx(this,"btnstart",null),tx(this,"running",!1),tx(this,"latvalue",0)}}var c=s("lV0Oe");let nh=/^mozilla\/\d\.\d\W/,np=/(\w+)\/(\d+\.\d+(?:\.\d+)?(?:\.\d+)?)/g,nm=/^(ver|cri|gec)/,nf=["chrome","opera","safari","edge","firefox"],ng="Unknown",{isArray:nv}=Array,ny=window.navigator.userAgentData,nb=window.navigator.userAgent,nk={iphone:/iphone/,ipad:/ipad|macintosh/,android:/android/},nw={windows:/win/,mac:/macintosh/,linux:/linux/};var nx=(t,e)=>{if(nb="string"==typeof t?t:nb,ny="string"==typeof e?e:ny,nb){let t=nb.toLowerCase().replace(nh,""),e=Object.keys(nk).find(e=>nk[e].test(t)&&window.navigator.maxTouchPoints>=1),n=Object.keys(nw).find(e=>nw[e].test(t)),i=t.match(np),a=t.match(/version\/(\d+(\.\d+)*)/),o=nv(a)?a[1]:null,s=i&&(i.length>2&&!nm.test(i[1])?1:0),r=i&&i[i.length-1-(s||0)].split("/"),l=r&&r[0],c=o||r&&r[1];if(t.includes("edg/")){let e=t.match(/edg\/(\d+\.\d+)/);l="edge",c=e&&e[1]}return{os:e||n,browser:l,version:c}}if(!ny)return console.error("Could not find `userAgent` or `userAgentData` window.navigator properties to set `os`, `browser` and `version`"),{os:navigator.platform||ng,browser:ng,version:ng};{let t;let e=ny.platform.toLowerCase();for(let e of ny.brands){let n=e.brand.toLowerCase(),i=nf.find(t=>{if(n.includes(t))return t});if(i){t={browser:i,version:e.version};break}}return tE({os:e},t||{browser:ng,version:ng})}};let nE="testlatencybtn",nT="testlatencymlsbtn",nS=!1,nC=nx(),nP=new URL(s("luG8Y").getBundleURL("4Iqbg")+"imgtestlatdemo.92f5146f.webp"),nI=t=>{let e=document.getElementById("current-lat-val");e&&(e.innerText=t)},n_=()=>`<li class='nav-item'>
    <a class='nav-link' href='#' id='trigger-lat-test-btn' data-toggle='modal' 
      data-toggle='popover' data-placement='bottom'  title='Testing ...' data-content='No input detected'>
      LATENCY TEST</a>
  </li>`,nO={mls:!0,ringbuf:!1,scrptprc:!1},nA=()=>{nO.ringbuf&&nu.running&&nu.stopTest(),nO.scrptprc&&"STOP"===ns.startbutton.innerText&&ns.finishTest()},nM=`<div class="modal fade" id="latencyTestWarning" tabindex="-1" aria-labelledby="latencyTestWarningLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header bg-warning">
              <h5 class="modal-title" id="latencyTestWarning">Latency Test Issue</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
                <p>It seems there's a problem trying to estimate the latency. Please check the audio settings of your device carefully.</p> 
                <!-- If you have any issue you can also visit our support page. <p>More information at: <span> <a href="${window.location.origin}/static/support.html" target="_blank">${window.location.origin}/static/support.html</a></span></p> -->
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
    </div>`,nR=()=>{document.getElementById("latencyslider").onchange=t=>{localStorage.setItem("latency",t.target.value),document.getElementById("latinputval").value=t.target.value,nI(t.target.value)},document.getElementById("latinputval").onchange=t=>{localStorage.setItem("latency",t.target.value),document.getElementById("latencyslider").value=t.target.value,nI(t.target.value)}},nL=t=>{let e=-1!==document.location.search.indexOf("debug"),n=localStorage.getItem("latency");(0,c.default).dynamicModalDialog(`<img src='${nP}' class='mx-auto d-block visible-animate' alt='...' width='266' height='266'>
        <p>Place your mic as close as possible to the speakers/headphones.</p>
        <p class='alert alert-danger'><b>WARNING!</b> Be careful with the volume as a noise will be played through the speakers.</p>
        <p>${n?'<i>Current latency: <span id="current-lat-val">'+n+"</span> ms.</i>":""}</p>
        ${nO.mls?`<a class='nav-link' href='#' id='${nT}' data-toggle='modal' 
        data-toggle='popover' data-placement='bottom'  title='Testing ...' data-content='No input detected'></a><br>`:""}       
        <details ${e?"":"hidden"}>
            <summary>Advanced</summary>
            <br/>
             ${nO.ringbuf?`<label for=''><i>Test using AudioWorklet: </i></label>
             <a id='btn-start' class='nav-link' href='#'>START</a><br>`:""}
             ${nO.scrptprc?`<label for=''>Via ScriptProcessor: </label>
             <a class='nav-link' href='#' id='${nE}' data-toggle='modal' 
                data-toggle='popover' data-placement='bottom'  title='Testing ...' data-content='No input detected'>
                Test Latency</a><br>`:""}
            <p><label for='formControlLatRange'>Set the value manually (ms): </label>
                <div class='form-group col-md-5'>
                <input id='latinputval' type='number' min='0' max='500' class='form-control' placeholder='${n||0}'>
                </div>
                <input type='range' min='0' max='500' class='form-control-range' id='latencyslider' value='${n||0}'>
            </p>
        </details>
        ${nM}
       `,null,"","Close","Latency Test","bg-success",nA),nR(),nS?(nO.mls&&ne.displayStart(),nO.ringbuf&&nu.buttonHandlers(),nO.scrptprc&&ns.displayStart()):(nS=!0,nO.mls&&ne.initialize(nH.ac,t,nT,e,nC),nO.ringbuf&&nu.initialize(nH.ac,t),nO.scrptprc&&ns.initialize(nH.ac))},nB=null,nD=async()=>{if("wakeLock"in navigator)try{nB=await navigator.wakeLock.request("screen"),console.log("Wake Lock Activated")}catch(t){nB=!1,console.log("Error",t)}},nN=t=>{console.log(nC),("ipad"===nC.os||"iphone"===nC.os||"safari"===nC.browser)&&(nO.ringbuf=!1),document.getElementById("trigger-lat-test-btn").onclick=async()=>{nG?nQ():(null===nB&&await nD(),nL(t))}};var c=s("lV0Oe"),d=s("7hG31");let n$=window.location.search.split("compositionId=")[1],nj=!1,nG=null,nF=t=>{nj=t},nU=t=>{nG=t},nH=null,nV=null,nz=null,nW=(t,n)=>{nH=e(eh)({samplesPerPixel:3e3,waveHeight:100,container:document.getElementById("playlist"),state:"cursor",colors:{waveOutlineColor:"#E0EFF1",timeColor:"grey",fadeColor:"black"},controls:{show:!0,width:200,widgets:{stereoPan:!0,collapse:!1,remove:!0}},zoomLevels:[500,1e3,3e3,5e3],isAutomaticScroll:!0,timescale:!0,ac:t}),nz=new eu(n$,nV=new ed),nN(n),eM()},nq=nx(),nX=new class{init(t){let e;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;let n=n=>{nW(new e3({latencyHint:0}),n),e=this.getCorrectStreamForSafari(n),nH.initRecorder(e,void 0,"Voice Track"),$(".btn-record").removeClass("disabled"),this.setRecordGainNodeForTest(this.recordGainNode),e1(),e2(),t6(t,t7)},i=e=>{console.error(e),nW(new e3({latencyHint:0})),e1(),e2(),t6(t,t7),nU(e)};navigator.mediaDevices?navigator.mediaDevices.getUserMedia(d.MEDIA_CONSTRAINTS).then(n).catch(i):navigator.getUserMedia&&"MediaRecorder"in window&&navigator.getUserMedia(d.MEDIA_CONSTRAINTS,n,i)}getCorrectStreamForSafari(t){let e=parseInt(this.browserId.version);if("safari"!==this.browserId.browser||!(e>=16))return t;{let e=nH.ac.createMediaStreamSource(t);this.recordGainNode=nH.ac.createGain(),e.connect(this.recordGainNode);let n=localStorage.getItem("micgain"),i=n?parseInt(n):1;this.recordGainNode.gain.value=i;let a=nH.ac.createMediaStreamDestination();return a.channelCount=1,this.recordGainNode.connect(a),a.stream}}setRecordGainNodeForTest(t){let e=parseInt(this.browserId.version);"safari"===this.browserId.browser&&e>=16&&new ep.TestMic().init(t,nH.ac)}constructor(t){this.recordGainNode=null,this.browserId=t}}(nq),nY=()=>{let t=parseInt(nX.browserId.version);return"safari"===nX.browserId.browser&&t>=16?`<li class='nav-item'>
              <a class='nav-link' href='#' id='testmicrophone'>
                <i class='fa-solid fa-microphone'></i> TEST MIC
              </a>
            </li>`:""},nJ=t=>{t.onclick=nK},nK=()=>{nG?nQ():$("#testMicrophoneModal").modal("show")},nZ=()=>{let t=document.querySelectorAll(".hidden-first");if(t.length)for(let e=0;e<t.length;e++)t[e].classList.add("visible-animate")},nQ=t=>{(0,c.default).dynamicModalDialog(`<p>Please, verify the following error related to your microphone/input: &#10;&#13;</p>
      <p><b><i>${t||nG}</i></b></p>`,null,"","Close","Warning!","bg-warning")},n0=t=>{(0,c.default).dynamicModalDialog(`<p>There was a problem while loading the data, probably not supported type of media by the browser: &#10;&#13;</p>
      <p class="breakword"><b>${t}</b></p>`,null,"","Close","Error","bg-danger",n3)},n1=()=>{document.getElementById("toastNotLoggedIn").style.display="",$("#toastNotLoggedIn").toast("show")},n2=()=>{document.getElementById("toastNotPermission").style.display="",$("#toastNotPermission").toast("show")},n3=()=>{let t=document.getElementById("download-progress-elems");t&&!t.hidden&&t.remove()};(0,d.activateGoHomeLink)(),(()=>{document.getElementById("useroptions").innerHTML=`${n_()}${nY()}${eA()}`;let t=document.getElementById("testmicrophone");t&&nJ(t)})(),nX.init(n$),"demopage"===n$&&(document.getElementById("download-mix-btn").hidden=!1,(0,c.default).dynamicModalDialog("Be careful, the music you record or upload won't be saved, as you are not a registered user and this is only a test feature!",null,"","Close","Warning!","bg-warning",nZ))}();
//# sourceMappingURL=composition.d570c7b4.js.map
